import{r as t}from"./react-vendor-EfHycc-t.js";import{n as e,r as a,g as n}from"./index-CCg2rRgv.js";const i=i=>{const{accountingMethod:s}=e(),o="cash"===s,r=t.useCallback(t=>o&&t._expandedTrades&&t._expandedTrades.length>0?t._expandedTrades.reduce((t,e)=>t+a(e,!0),0):a(t,o),[o]);return t.useMemo(()=>{if(!i||0===i.length)return{tradesWithAccountingPL:[],totalTrades:0,winningTrades:[],losingTrades:[],winRate:0,grossPL:0,avgGain:0,avgLoss:0,avgPosMove:0,avgNegMove:0,avgPositionSize:0,avgHoldingDays:0,avgR:0,planFollowed:0,openPositions:0,useCashBasis:o,accountingMethod:s};let t;if(o){const e=i.flatMap(t=>Array.isArray(t._expandedTrades)?t._expandedTrades.filter(t=>t._cashBasisExit):t._cashBasisExit?[t]:[]),n=new Map;e.forEach(t=>{const e=t.id.split("_exit_")[0];n.has(e)||n.set(e,[]),n.get(e).push(t)}),t=Array.from(n.entries()).map(([t,e])=>{const n=e.reduce((t,e)=>t+a(e,o),0),i=e[0];try{return{...i,id:t,accountingPL:n}}catch(s){return{...i,id:t,accountingPL:0}}})}else t=i.map(t=>{try{return{...t,accountingPL:r(t)}}catch(e){return{...t,accountingPL:0}}});const e=t.length,d=t.filter(t=>t.accountingPL>0),c=t.filter(t=>t.accountingPL<0),g=e>0?d.length/e*100:0,l=t.reduce((t,e)=>t+e.accountingPL,0),u=d.length>0?d.reduce((t,e)=>t+e.accountingPL,0)/d.length:0,h=c.length>0?c.reduce((t,e)=>t+e.accountingPL,0)/c.length:0,p=d.length>0?d.reduce((t,e)=>t+(e.stockMove||0),0)/d.length:0,y=c.length>0?c.reduce((t,e)=>t+(e.stockMove||0),0)/c.length:0,P=e>0?t.reduce((t,e)=>t+(e.allocation||0),0)/e:0,v=e>0?t.reduce((t,e)=>{const a=[{date:e.pyramid1Date,qty:e.pyramid1Qty||0},{date:e.pyramid2Date,qty:e.pyramid2Qty||0}].filter(t=>t.date&&""!==t.date.trim()&&t.qty>0),i=[{date:e.exit1Date,qty:e.exit1Qty||0},{date:e.exit2Date,qty:e.exit2Qty||0},{date:e.exit3Date,qty:e.exit3Qty||0}].filter(t=>t.date&&""!==t.date.trim()&&t.qty>0);let s=null;if("Closed"===e.positionStatus||"Partial"===e.positionStatus){const t=[e.exit1Date,e.exit2Date,e.exit3Date].filter(Boolean);t.length>0&&(s=t.sort((t,e)=>new Date(t).getTime()-new Date(e).getTime())[0])}return t+n(e.date,s,a,i)},0)/e:0,x=e>0?t.reduce((t,e)=>t+(e.r||0),0)/e:0,m=e>0?t.filter(t=>t.planFollowed).length/e*100:0,L=t.filter(t=>"Open"===t.positionStatus||"Partial"===t.positionStatus).length;return{tradesWithAccountingPL:t,totalTrades:e,winningTrades:d,losingTrades:c,winRate:g,grossPL:l,avgGain:u,avgLoss:h,avgPosMove:p,avgNegMove:y,avgPositionSize:P,avgHoldingDays:v,avgR:x,planFollowed:m,openPositions:L,useCashBasis:o,accountingMethod:s}},[i,r,o,s])},s=()=>{const{accountingMethod:t}=e(),a="cash"===t;return{accountingMethod:t,useCashBasis:a,displayName:a?"Cash Basis":"Accrual Basis",description:a?"P/L attributed to exit dates":"P/L attributed to entry dates",shortDescription:a?"Exit-based":"Entry-based"}};export{s as a,i as u};
//# sourceMappingURL=use-accounting-calculations-2iOnH437.js.map
