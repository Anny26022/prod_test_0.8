{"version":3,"mappings":"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","names":["m","require$$0","i","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","c","o","usingClientEntryPoint","createRoot","client","hydrateRoot","h","ThemeSwitcher","theme","setTheme","useTheme","isDark","Tooltip","content","placement","className","children","_jsx","Icon","icon","Switch","isSelected","onValueChange","handleToggle","size","color","getExitDatesWithFallback","trade","exits","date","exit1Date","qty","exit1Qty","price","exit1Price","exit2Date","exit2Qty","exit2Price","exit3Date","exit3Qty","exit3Price","filter","exit","trim","length","positionStatus","exitedQty","avgExitPrice","availableExitDates","sort","a","b","Date","getTime","calculateTradePL","useCashBasis","cashBasisExit","_cashBasisExit","avgEntry","entry","correctExitPrice","buySell","plRs","totalRealizedPL","getTradeDateForAccounting","exitDates","getTradesForMonth","trades","month","year","monthTrades","forEach","exitDate","exitMonth","toLocaleString","exitYear","getFullYear","partialTrade","push","tradeDate","tradeMonth","tradeYear","TruePortfolioContext","undefined","TruePortfolioProvider","yearlyStartingCapitals","setYearlyStartingCapitals","useState","capitalChanges","setCapitalChanges","monthlyStartingCapitalOverrides","setMonthlyStartingCapitalOverrides","hydrated","setHydrated","useEffect","loadData","capitals","stored","localStorage","getItem","JSON","parse","error","fetchYearlyStartingCapitals","changes","fetchCapitalChanges","overrides","fetchMonthlyStartingCapitalOverrides","Array","isArray","setItem","stringify","saveYearlyStartingCapitals","saveCapitalChanges","saveMonthlyStartingCapitalOverrides","setYearlyStartingCapital","useCallback","amount","prev","updated","existingIndex","findIndex","item","newCapital","startingCapital","updatedAt","toISOString","getYearlyStartingCapital","capital","find","setMonthlyStartingCapitalOverride","normalizedMonth","January","February","March","April","May","June","July","August","September","October","November","December","newOverride","id","localeCompare","removeMonthlyStartingCapitalOverride","getMonthlyStartingCapitalOverride","override","addCapitalChange","change","newChange","Math","random","updateCapitalChange","updatedChange","map","deleteCapitalChange","getTradesPLForMonth","result","reduce","sum","monthPL","getMonth","exitPL","pl","getCapitalChangesForMonth","changeDate","changeMonth","changeYear","type","normalizeMonth","shortMonths","includes","monthMap","calculateMonthlyTruePortfolio","memo","Map","minOverallDate","months","monthIndex","indexOf","Error","key","has","get","currentMonthDate","finalCapital","prevMonthIndex","prevMonth","prevYear","capitalChangesAmount","revisedStartingCapital","set","getMonthlyTruePortfolio","itemDate","capitalDate","setDate","setHours","getTruePortfolioSize","getLatestTruePortfolioSize","currentDate","currentMonth","currentYear","getAllMonthlyTruePortfolios","maxOverallDate","entryDate","exitDateObj","isNaN","setMonth","monthlyData","portfolioSize","React","useMemo","safeGetTruePortfolioSize","safeGetLatestTruePortfolioSize","contextValue","Provider","value","useTruePortfolio","ctx","useContext","TruePortfolioSetup","isOpen","onOpenChange","onSetupComplete","userName","setUserName","setStartingCapital","selectedYear","setSelectedYear","toString","handleSetup","parseFloat","parseInt","alert","setTimeout","Modal","isDismissable","hideCloseButton","classNames","base","wrapper","body","backdrop","motionProps","variants","enter","opacity","scale","y","transition","duration","ease","initial","ModalContent","_jsxs","_Fragment","ModalHeader","motion","div","x","animate","delay","whileHover","rotate","stiffness","damping","ModalBody","text","index","Input","label","placeholder","variant","startContent","isRequired","min","max","step","repeat","Infinity","repeatDelay","ModalFooter","Button","onPress","isDisabled","radius","span","WelcomeMessageModal","firstName","split","supabase","createClient","auth","autoRefreshToken","persistSession","detectSessionInUrl","flowType","storage","window","storageKey","AuthService","signUp","email","password","lastName","data","options","first_name","last_name","full_name","signIn","console","log","signInWithPassword","message","_a","user","authError","signInWithProvider","provider","signInWithOAuth","redirectTo","location","origin","queryParams","access_type","prompt","signOut","resetPassword","resetPasswordForEmail","updatePassword","newPassword","updateUser","resendVerification","resend","checkUserExists","updateProfile","updates","getCurrentUser","getUser","getCurrentSession","session","getSession","onAuthStateChange","callback","isAuthenticated","this","getUserId","userId","refreshSession","getAuthState","async","loading","getAuthErrorMessage","toLowerCase","AuthContext","AuthProvider","authState","setAuthState","initializing","setInitializing","sessionError","initializeAuth","fallbackTimer","clearTimeout","subscription","event","unsubscribe","errorMessage","state","useAuth","context","USER_NAME_LOCAL_KEY","WELCOME_COMPLETE_LOCAL_KEY","TruePortfolioSetupManager","isSetupModalOpen","setIsSetupModalOpen","isWelcomeModalOpen","setIsWelcomeModalOpen","hasCheckedSetup","setHasCheckedSetup","hasCompletedWelcome","setHasCompletedWelcome","storedUserName","name","YearlyStartingCapitalModal","newYear","setNewYear","newAmount","setNewAmount","editingYear","setEditingYear","editingAmount","setEditingAmount","nextYear","handleAddYear","handleSaveEdit","handleCancelEdit","sortedYears","scrollBehavior","onChange","e","target","input","inputWrapper","isIconOnly","yearData","Chip","toLocaleDateString","handleEditYear","onClose","AccountingMethodContext","AccountingMethodProvider","accountingMethod","setAccountingMethodState","isLoading","setIsLoading","setAccountingMethod","method","requestIdleCallback","toggleAccountingMethod","clearAccountingMethodData","removeItem","useAccountingMethod","useTruePortfolioWithTrades","truePortfolioContext","getPortfolioSize","defaultFilter","loadGlobalFilterFromLocalStorage","parsedFilter","startDate","endDate","GlobalFilterContext","createContext","setFilter","GlobalFilterProvider","filterObj","filterToSave","saveGlobalFilterToLocalStorage","useGlobalFilter","isInGlobalFilter","dateStr","d","now","weekAgo","getDate","fyStartYear","fyStart","fyEnd","cyYear","cyStart","cyEnd","isTradeInGlobalFilter","calcAvgEntry","entries","totalQty","totalValue","calcPositionSize","round","calcAllocation","positionSize","calcSLPercent","sl","abs","calcExitedQty","exitQtys","calcAvgExitPrice","calcStockMove","avgExit","cmp","openQty","movePercentage","calcRewardRisk","risk","reward","calcHoldingDays","pyramidDates","tradeLegs","quantity","p","remainingExits","leg","exitQty","shift","totalDays","totalQuantity","ceil","calculateWeightedHoldingDays","calcRealisedAmount","calcPFImpact","portfolioValue","calcOpenHeat","t","calcTradeOpenHeat","defaultPortfolioSize","monthlyPortfolioSize","effectivePortfolioSize","entryPrice","tsl","stop","daysToYears","days","calculateNPV","rate","dates","cashFlows","npv","cashFlow","yearFraction","pow","calcXIRR","endingCapital","allFlows","guess","hasPositive","some","cf","hasNegative","derivative","j","newRate","calculateXIRR","flow","calcUnrealizedPL","calcRealizedPL_FIFO","entryLots","totalPL","remainingExitQty","lot","qtyToUse","calcIndividualMoves","comparePrice","movePercent","description","calcWeightedRewardRisk","Number","initialQty","pyramid1Price","pyramid1Qty","pyramid2Price","pyramid2Qty","totalQtyAll","entryBreakdown","rawRisk","realizedReward","potentialReward","rrValue","calculateDailyPortfolioValues","dailyValues","allRelevantDates","Set","add","pyramid1Date","pyramid2Date","from","timestamp","getUniqueSortedDates","concat","cc","currentCashComponent","initialDate","initialChange","tradesOnDate","uniqueTradesForDate","seenTradeIds","originalId","accountingPL","calculateDailyReturns","dailyPortfolioValues","dailyReturns","sortedDates","keys","prevValue","currentValue","returns","calculateStandardDeviation","mean","r","variance","sqrt","calculateMaxDrawdown","peak","maxDrawdown","dateTimestamp","drawdown","calculateDownsideDeviation","targetReturn","sumOfSquaredDownsideDeviations","downsideVariance","calculateSharpeRatio","annualizedReturn","riskFreeRate","portfolioStdDev","calculateCalmarRatio","calculateSortinoRatio","downsideDeviation","annualizeMetric","dailyMetric","numPeriods","simpleHash","str","hash","charCodeAt","padStart","convertToUUID","test","hash1","hash2","hash3","hash4","substr","join","idMappings","dbRowToTrade","row","legacyId","uuid","tradeNo","trade_no","avg_entry","buy_sell","setup","baseDuration","base_duration","initial_qty","pyramid1_price","pyramid1_qty","pyramid1_date","pyramid2_price","pyramid2_qty","pyramid2_date","position_size","allocation","slPercent","sl_percent","exit1_price","exit1_qty","exit1_date","exit2_price","exit2_qty","exit2_date","exit3_price","exit3_qty","exit3_date","open_qty","exited_qty","avg_exit_price","stockMove","stock_move","rewardRisk","reward_risk","holdingDays","holding_days","position_status","realisedAmount","realised_amount","pl_rs","pfImpact","pf_impact","cummPf","cumm_pf","planFollowed","Boolean","plan_followed","exitTrigger","exit_trigger","proficiencyGrowthAreas","proficiency_growth_areas","sector","openHeat","open_heat","notes","chartAttachments","chart_attachments","_userEditedFields","user_edited_fields","_cmpAutoFetched","cmp_auto_fetched","_needsRecalculation","needs_recalculation","tradeToDbRow","user_id","SupabaseService","getAllTrades","startTime","performance","cacheKey","cached","tradesCache","CACHE_DURATION","select","eq","order","ascending","endTime","clearTradesCache","delete","clear","getTrade","single","getTradeFromSupabaseOnly","code","saveTrade","warn","dbRow","existingTrade","update","insert","saveAllTrades","deleteError","dbRows","batchSize","batch","slice","floor","insertError","deleteTrade","getUserPreferences","saveUserPreferences","preferences","upsert","onConflict","getPortfolioData","savePortfolioData","dataWithUserId","getTradeSettings","saveTradeSettings","settings","getTaxData","saveTaxData","getMilestonesData","saveMilestonesData","achievements","getMiscData","maybeSingle","saveMiscData","deleteMiscData","saveChartImageBlob","imageBlob","binaryData","Uint8Array","atob","conversionError","insertData","trade_id","image_type","filename","mime_type","size_bytes","uploaded_at","compressed","original_size","insertResult","getChartImageBlob","blobId","metadata","metadataError","binaryError","getAllChartImageBlobs","deleteChartImageBlob","getTradeChartImageBlobs","tradeId","deleteTradeChartImageBlobs","updateChartImageBlobTradeId","newTradeId","getDashboardConfig","saveDashboardConfig","config","getCommentaryData","saveCommentaryData","clearAllData","tables","table","__publicField","getTradesFromSupabase","saveTradesToSupabase","success","recalculateAllTrades","skipExpensiveCalculations","sorted","runningCummPf","toUpperCase","allEntries","totalInitialQty","tradePortfolioSize","allExits","exitDatesForHolding","primaryExitDateForHolding","validExitDates","entryLotsForFifo","exitLotsForFifo","relevantDate","finalOpenQty","restOfTrade","calculatedPositionStatus","preservedFields","field","idx","accrualPL","cashPL","getPortfolioSizeForAccounting","useCashBasisForCalc","accrualPortfolioSize","cashPortfolioSize","accrualPfImpact","cashPfImpact","_accrualPL","_cashPL","_accrualPfImpact","_cashPfImpact","DEFAULT_VISIBLE_COLUMNS","useTrades","setTrades","isRecalculating","setIsRecalculating","searchQuery","setSearchQuery","statusFilter","setStatusFilter","sortDescriptor","setSortDescriptor","column","direction","visibleColumns","setVisibleColumns","globalFilter","prevAccountingMethodRef","useRef","stableGetPortfolioSize","recalculateTradesWithCurrentPortfolio","tradesToRecalculate","calculationCache","lastCalculationHash","currentHash","current","filtered","query","_b","_c","_d","isDescending","aValue","bValue","String","interval","setInterval","memInfo","memory","usedJSHeapSize","jsHeapSizeLimit","gc","clearInterval","settingsCache","lastLoadTime","cachedTrades","loadedTrades","Promise","all","quickTrades","savedSearchQuery","search_query","savedStatusFilter","status_filter","sort_descriptor","visible_columns","fullyCalculatedTrades","timeoutId","recalculatedTrades","addTrade","beforeEntry","afterExit","combinedTrades","dateA","dateB","newTrades","then","catch","debouncedRecalculateRef","pendingUpdatesRef","updateCallbacksRef","updateTrade","updatedTrade","onComplete","pendingUpdates","values","callbacks","currentTrades","updatedTrades","pendingUpdate","saveSuccess","originalTradeId","ChartImageService","__vitePreload","import","n","__VITE_PRELOAD__","deleteTradeChartImages","filteredTrades","bulkImportTrades","importedTrades","quickProcessedTrades","clearAllTrades","keysToRemove","startsWith","sessionStorage","clearAllTradeAndSettingsData","tradeCache","portfolioCache","getAccountingAwareValues","_expandedTrades","expandedTrade","currentPortfolioSize","groupTradesForDisplay","expandedTrades","groupedMap","expandedTradesMap","aggregatedTrade","latest","debugExpandedMap","exitIndex","filteredExpandedTrades","lowerQuery","comparison","endsWith","StringA","StringB","aExitDate","bExitDate","runningDisplayCummPf","currentPfImpact","originalTrades","ALL_MILESTONES","level","criteria","monthlyPortfolios","initialCapital","closedTrades","consecutiveWins","every","runningMax","endYear","years","_","ProfileSettingsModal","isFullWidthEnabled","setIsFullWidthEnabled","achievedMilestones","setAchievedMilestones","milestonesRecord","loadMilestones","checkAndAwardMilestones","newlyAchieved","uniqueTrades","milestone","achievedAt","useMilestones","selectedTab","setSelectedTab","isYearlyCapitalModalOpen","setIsYearlyCapitalModalOpen","selectedMonth","setSelectedMonth","editingCell","setEditingCell","editValue","setEditValue","newCapitalAmount","setNewCapitalAmount","newCapitalType","setNewCapitalType","newCapitalDescription","setNewCapitalDescription","overrideMonth","setOverrideMonth","overrideYear","setOverrideYear","overrideAmount","setOverrideAmount","handleAddCapitalChange","handleAddMonthlyOverride","sortedCapitalChanges","sortedYearlyCapitals","sortedMonthlyOverrides","Card","CardBody","labelPlacement","AnimatePresence","mode","fontWeight","whileTap","navigator","vibrate","thumbIcon","thumb","Tabs","selectedKey","onSelectionChange","tabList","cursor","tab","tabContent","Tab","title","Select","selectedKeys","SelectItem","Table","selectionMode","th","td","TableHeader","TableColumn","allowsSorting","TableBody","items","TableRow","TableCell","Intl","NumberFormat","style","currency","format","handleRemoveMonthlyOverride","isAchieved","filterOptions","GlobalFilterBar","handleClearAllData","confirm","dbName","indexedDB","deleteDatabase","reload","Dropdown","DropdownTrigger","opt","DropdownMenu","selected","DropdownItem","textValue","monthIdx","f","onAction","AnimatedBrandName","letter","animationDelay","ErrorBoundary","Component","constructor","props","super","resetError","setState","hasError","errorInfo","getDerivedStateFromError","componentDidCatch","render","fallback","FallbackComponent","componentStack","isBrowser","detectEnvironment","env","isDevelopment","vam","inject","debug","setMode","va","params","vaq","beforeSend","call","src","scriptSrc","basePath","getScriptSrc","document","head","querySelector","script","createElement","defer","dataset","sdkn","framework","sdkv","disableAutoTrack","endpoint","dsn","onerror","appendChild","getBasePath","process","define_process_env_default","REACT_APP_VERCEL_OBSERVABILITY_BASEPATH","Analytics","route","path","pageview","Loader","fullScreen","containerClasses","displayName","AuthModal","onGuestMode","onShowAuth","setEmail","setPassword","confirmPassword","setConfirmPassword","setFirstName","setLastName","showPassword","setShowPassword","showConfirmPassword","setShowConfirmPassword","setError","setSuccess","focusedField","setFocusedField","isReady","setIsReady","timer","switchMode","newMode","handleSocialAuth","hidden","visible","viewBox","fill","xmlns","cx","cy","stroke","strokeWidth","strokeLinejoin","onClick","disabled","onSubmit","preventDefault","stopPropagation","setAttribute","errorCode","removeAttribute","noValidate","autoComplete","required","AuthGuard","mounted","setMounted","showAuthModal","setShowAuthModal","isGuestMode","setIsGuestMode","setAuthError","circle","pathLength","h1","letterSpacing","width","exports","extendStatics","Object","setPrototypeOf","__proto__","prototype","hasOwnProperty","__extends","TypeError","__","create","__assign","assign","s","arguments","apply","__spreadArray","to","pack","ar","l","_global","globalThis","self","global","extend","obj","extension","getProto","getPrototypeOf","_hasOwn","hasOwn","prop","proto","Reflect","ownKeys","setProp","defineProperty","functionOrGetSet","configurable","writable","derive","Child","Parent","bind","getOwnPropertyDescriptor","getPropertyDescriptor","_slice","args","start","end","origFunc","overridedFactory","assert","asap$1","fn","setImmediate","arrayToObject","array","extractor","nameAndValue","getByKeyPath","keyPath","rv","val","period","innerObj","setByKeyPath","isFrozen","currentKeyPath","remainingKeyPath","splice","delByKeyPath","kp","shallowClone","flatten","intrinsicTypeNames","num","intrinsicTypes","cloneSimpleObjectTree","k","v","objectIsEmpty","circularRefs","deepClone","any","WeakMap","innerDeepClone","toStringTag","iteratorSymbol","Symbol","iterator","getIteratorOf","delArrayItem","NO_CHAR_ARRAY","getArrayOf","arrayLike","it","next","done","isAsyncFunction","idbDomErrorNames","errorList","defaultTexts","VersionChanged","DatabaseClosed","Abort","TransactionInactive","MissingAPI","DexieError","msg","getMultiErrorMessage","failures","ModifyError","successCount","failedKeys","BulkError","pos","failuresByPos","errnames","BaseException","exceptions","fullName","msgOrInner","inner","Syntax","SyntaxError","Type","Range","RangeError","exceptionMap","mapError","domError","stack","fullNameExceptions","nop","mirror","pureFunctionChain","f1","f2","callBoth","on1","on2","hookCreatingChain","res","onsuccess","res2","hookDeletingChain","hookUpdatingChain","modifications","reverseStoppableEventChain","promisableChain","thiz","href","setDebug","INTERNAL","ZONE_ECHO_LIMIT","_a$1","globalP","resolve","crypto","subtle","nativeP","digest","resolvedNativePromise","nativePromiseProto","resolvedGlobalPromise","nativePromiseThen","NativePromise","patchGlobalPromise","schedulePhysicalTick","queueMicrotask","physicalTick","asap","microtickQueue","needsNewPhysicalTick","isOutsideMicroTick","unhandledErrors","rejectingErrors","rejectionMapper","globalPSD","ref","unhandleds","onunhandled","pgp","finalize","PSD","numScheduledCalls","tickFinalizers","DexiePromise","_listeners","_lib","psd","_PSD","_state","_value","handleRejection","executePromiseTask","thenProp","microTaskId","totalEchoes","onFulfilled","onRejected","_this","possibleAwait","cleanup","decrementExpectedAwaits","reject","propagateToListener","Listener","nativeAwaitCompatibleWrap","_consoleTask","zone","promise","shouldExecuteTick","beginMicroTickScope","_then","propagateAllListeners","endMicroTickScope","ex","reason","addPossiblyUnhandledError","listeners","len","finalizePhysicalTick","listener","cb","callListener","ret","run","markErrorAsHandled","usePSD","wasRootExec","unhandledErrs","finalizers","run_at_end_of_this_or_next_physical_tick","finalizer","PromiseReject","wrap","errorCatcher","outerScope","switchToZone","handler","err","finally","onFinally","timeout","ms","handle","Timeout","snapShot","onPossibleParallellAsync","remaining","race","newPSD","newScope","scheduler","follow","zoneProps","allSettled","possiblePromises","results","status","AggregateError","failure","withResolvers","task","awaits","echoes","taskCounter","zoneStack","zoneEchoes","zone_id_counter","a1","a2","parent","PromiseProp","incrementExpectedAwaits","possiblePromise","rejection","zoneEnterEcho","targetZone","zoneLeaveEcho","pop","bEnteringZone","currentZone","GlobalPromise","targetEnv","a3","outerZone","execInGlobalContext","enqueueNativeMicroTask","tempTransaction","db","storeNames","idbdb","openComplete","letThrough","_vip","trans","_createTransaction","_dbSchema","PR1398_maxLoop","InvalidState","close","disableAutoOpen","open","_promise","idbtrans","commit","_completion","dbOpenError","isBeingOpened","autoOpen","dbReadyPromise","DEXIE_VERSION","maxString","fromCharCode","minKey","INVALID_KEY_ARGUMENT","STRING_EXPECTED","connections","DBNAMES_DB","READONLY","READWRITE","combine","filter1","filter2","AnyRange","lower","lowerOpen","upper","upperOpen","workaroundForUndefinedPrimKey","Entity","ta","tb","NaN","compareUint8Arrays","getUint8Array","compareArrays","al","bl","ArrayBuffer","isView","tsTag","buffer","byteOffset","byteLength","_trans","writeLocked","_tx","tableName","createTask","checkTableInTransaction","schema","NotFound","_novip","transless","trace","keyOrCrit","where","first","core","hook","reading","fire","indexOrCrit","WhereClause","keyPaths","equals","compoundIndex","indexes","primKey","ix","compound","_maxKey","keyPathsInValidOrder","idxByName","prevIndex","prevFilterFn","multi","filterFunction","toCollection","and","count","thenShortcut","offset","limit","numRows","each","toArray","Collection","orderBy","reverse","mapToClass","mappedClass","_super","class_1","enumerable","inheritedProps","getOwnPropertyNames","propName","readHook","defineClass","Class","auto","objToAdd","mutate","numFailures","lastResult","keyOrObject","modify","InvalidArgument","put","range","bulkGet","getMany","bulkAdd","objects","keysOrOptions","wantResults","allKeys","numObjects","objectsToAdd","bulkPut","objectsToPut","bulkUpdate","keysAndChanges","coreTable","changeSpecs","offsetMap","cache","objs","resultKeys","resultObjs","_i","Constraint","numEntries","mappedOffset","bulkDelete","numKeys","Events","evs","eventName","subscriber","subscribe","addEventType","chainFunction","defaultFunction","addConfiguredEvents","subscribers","cfg","makeClassConstructor","createTableConstructor","tableSchema","_allTables","creating","updating","deleting","isPlainKeyRange","ignoreLimitFilter","algorithm","or","justLimit","replayFilter","addFilter","addReplayFilter","factory","isLimitFilter","curr","addMatchFilter","isMatch","getIndexOrStore","coreSchema","isPrimKey","primaryKey","getIndexByKeyPath","Schema","openCursor","keysOnly","dir","unique","iter","coreTrans","set_1","union","advance","fail","_iterate","iterate","valueMapper","cursorPromise","wrappedFn","continue","advancer","PropModification","spec","execute","term","BigInt","remove","subtrahend_1","prefixToReplace","replacePrefix","substring","_read","_ctx","_write","_addAlgorithm","clone","raw","sortBy","parts","lastPart","lastIndex","getval","sorter","valueMapper_1","a_1","offsetLeft","rowsLeft","until","bIncludeStopEntry","last","indexName","_ondirectionchange","desc","eachKey","eachUniqueKey","eachPrimaryKey","primaryKeys","uniqueKeys","firstKey","lastKey","distinct","strKey","found","modifyer","anythingModified","origVal","outbound","extractKey","modifyChunkSize","_options","totalFailures","applyMutateResult","expectedCount","deleteCallback","nextChunk","addValues","putValues","putKeys","deleteKeys","origValue","ctx_1","changeSpec","isAdditionalChunk","coreRange","createCollectionConstructor","whereClause","keyRangeGenerator","keyRange","whereCtx","readingHook","simpleCompare","simpleCompareReverse","collectionOrWhereClause","T","collection","emptyCollection","rangeEqual","upperFactory","lowerFactory","nextCasing","lowerKey","upperNeedle","lowerNeedle","llp","lwrKeyChar","addIgnoreCaseAlgorithm","match","needles","suffix","compare","upperNeedles","lowerNeedles","nextKeySuffix","needlesLen","initDirection","needleBounds","needle","nb","createRange","firstPossibleNeedle","lowestPossibleCasing","casing","between","includeLower","includeUpper","_cmp","above","aboveOrEqual","below","belowOrEqual","startsWithIgnoreCase","equalsIgnoreCase","anyOfIgnoreCase","startsWithAnyOfIgnoreCase","anyOf","_ascending","_descending","notEqual","inAnyRange","includeLowers","includeUppers","noneOf","ranges","descending","_min","_max","addRange","newRange","sortDirection","rangeSorter","rangePos","keyIsBeyondCurrentEntry","keyIsBeforeCurrentEntry","keyWithinCurrentRange","checkKey","startsWithAnyOf","createWhereClauseConstructor","orCollection","_IDBKeyRange","_deps","IDBKeyRange","eventRejectHandler","DEXIE_STORAGE_MUTATED_EVENT_NAME","STORAGE_MUTATED_DOM_EVENT_NAME","globalEvents","Transaction","_lock","_reculock","lockOwnerFor","_unlock","_blockedFuncs","_locked","fnAndPSD","OpenFailed","active","transaction","durability","chromeTransactionDurability","ev","_reject","onabort","on","oncomplete","_resolve","storagemutated","bWriteLock","ReadOnly","_root","waitFor","promiseLike","root","_waitingFor","_waitingQueue","store","objectStore","spin","_spinCount","currentWaitPromise","abort","memoizedTables","_memoizedTables","transactionBoundTable","createTransactionConstructor","dbschema","complete","wasActive","createIndexSpec","nameFromKeyPath","createTableSchema","safariMultiStoreFix","getMaxKey","IdbKeyRange","only","getKeyExtractor","getSinglePathKeyExtractor","arrayify","_id_counter","getKeyPathAlias","createDBCore","tmpTrans","extractSchema","objectStoreNames","autoIncrement","indexByKeyPath","isPrimaryKey","indexNames","multiEntry","hasGetAll","userAgent","makeIDBKeyRange","upperBound","lowerBound","bound","createDbCoreTable","isAddOrPut","req","reqs","errorHandler","args1","args2","source","openKeyCursor","___id","_cursorContinue","_cursorContinuePrimaryKey","continuePrimaryKey","_cursorAdvance","doThrowCursorIsNotStarted","doThrowCursorIsStopped","gotOne","iterationPromise","resolveIteration","rejectIteration","guardedCallback","request","nonInfinitLimit","idbKeyRange","getAll","getAllKeys","count_1","req_1","result_1","keyCount","callbackCount","successHandler","_pos","tableMap","MIN_KEY","MAX_KEY","createMiddlewareStack","stackImpl","middlewares","down","createMiddlewareStacks","dbcore","generateMiddlewareStacks","stacks","_middlewares","tbl","setApiOnPlace","tableNames","propDesc","removeTablesApi","lowerVersionFirst","_cfg","version","runUpgraders","oldVersion","idbUpgradeTrans","globalSchema","contains","$meta","parseIndexSyntax","_storeNames","rejectTransaction","getExistingVersion","updateTablesAndIndexes","createTable","populate","patchCurrentVersion","createObjectStore","buildGlobalSchema","_loop_1","tableChange","recreate","addIndex","getSchemaDiff","state_1","metaVersion","queue","versions","_versions","versToRun","runQueue","oldSchema","newSchema","diff","tuple","Upgrade","store_1","deleteIndex","del","idxName","contentUpgrade","upgradeSchema_1","returnValue_1","contentUpgradeIsAsync_1","promiseFollowed","decrementor","deleteRemovedTables","deleteObjectStore","createMissingTables","oldDef","newDef","def","oldIndexes","newIndexes","oldIdx","newIdx","storeName","createIndex","idbindex","readGlobalSchema","verno","verifyInstalledSchema","ch","adjustToExistingIndexNames","_hasGetAll","dexieName","indexSpec","WorkerGlobalScope","primKeyAndIndexes","indexNum","replace","Version","_parseStoresSpec","stores","outSchema","storesSource","storesSpec","upgrade","upgradeFunction","createVersionConstructor","versionNumber","getDbNamesTable","dbNamesDB","Dexie$1","addons","dbnames","hasDatabasesNative","databases","getDatabaseNames","infos","info","_onDatabaseCreated","_onDatabaseDeleted","vip","idbReady","intervalId","userAgentData","tryIdb","isEmptyRange","node","RangeSet","fromOrTree","left","right","rebalance","rightWasCutOff","mergeRanges","newSet","_addRangeSet","rangesOverlap","rangeSet1","rangeSet2","i1","getRangeSetIterator","nextResult1","i2","nextResult2","keyProvided","up","rootClone","oldRootRight","computeDepth","extendObservabilitySet","part","obsSetsOverlap","os1","os2","rangeSet","addKey","addKeys","hasKey","unsignaledParts","isTaskEnqueued","signalSubscribersLazily","optimistic","signalSubscribersNow","updatedParts","deleteAffectedCacheEntries","queriesToSignal","collectTableSubscribers","tblCache","exec","requery","outQueriesToSignal","updatedEntryLists","queries","filteredEntries","entries_1","obsSet","updatedEntryLists_1","_e","dexieOpen","openCanceller","nativeVerToOpen","schemaPatchMode","throwIfCancelled","resolveDbReady","dbReadyResolve","upgradeTransaction","wasCreated","tryOpenDB","autoSchema","onblocked","_fireOnBlocked","onupgradeneeded","allowEmptyDB","delreq","NoSuchDatabase","oldVer","onversionchange","vcFired","onclose","onReadyBeingFired","ready","fireRemainders","remainders_1","_close","everything_1","awaitIterator","callNext","doThrow","throw","onSuccess","onError","getNext","extractTransactionArgs","_tableArgs_","scopeFunc","enterTransactionScope","parentTransaction","explicit","_explicit","returnValue","scopeFuncIsAsync","PrematureCommit","pad","createVirtualIndexMiddleware","indexLookup","allVirtualIndexes","addVirtualIndexes","keyTail","lowLevelIndex","keyPathAlias","indexList","keyLength","isVirtual","virtualIndex","findBestIndex","translateRange","translateRequest","createVirtualCursor","_continue","virtualIndexMiddleware","getObjectDiff","prfx","ap","bp","apTypeName","getEffectiveKeys","hooksMiddleware","downCore","downTable","dxTrans","addPutOrDelete","deleteRange","getExistingValues","existingValues","contexts","existingValue","generatedPrimaryKey","objectDiff","additionalChanges_1","requestedValue_1","deleteNextChunk","effectiveKeys","getFromTransactionCache","cacheExistingValuesMiddleware","cachedResult","isCachableContext","subscr","isCachableRequest","observabilityMiddleware","FULL_RANGE","querier","indexesWithAutoIncPK","tableClone","mutatedParts","getRangeSet","pkRangeSet","delsRangeSet","newObjs","oldCache","oldObjs","trackAffectedIndexes","idxVals","pkPos","getRange","readSubscribers","isLiveQuery","pkRangeSet_1","delsRangeSet_1","queriedIndex","queriedRanges","keysPromise_1","resultingKeys","pKeys","cursor_1","wantValues_1","pkey","addAffectedIndex","addKeyOrKeys","oldKey","newKey","adjustOptimisticFromFailures","numBulkOps","isAboveLower","isBelowUpper","isWithinRange","applyOptimisticOps","ops","cacheEntry","immutable","queryRange","extractPrimKey","extractIndex","extractLowLevelIndex","finalResult","op","modifedResult","includedValues","includedPKs","pk","existingKeys_1","keySet_1","keysToDelete_1","range_1","dirty","freeze","areRangesEqual","r1","r2","compareLowers","lower1","lower2","lowerOpen1","lowerOpen2","compareUppers","upper1","upper2","upperOpen1","upperOpen2","isSuperRange","findCompatibleQuery","equalEntry","countQuery","subscribeToCacheEntry","container","signal","addEventListener","enqueForDeletion","cacheMiddleware","ac_1","AbortController","endTransaction","wasCommitted","affectedSubscribers_1","stores_1","optimisticOps","_f","_g","_h","freezeResults","modRes","adjustedReq","reqWithResolvedKeys","valueWithKey","exactMatch","vipify","vipDb","Proxy","receiver","domDeps","Dexie","deps","dependencies","cancelOpen","bSticky","db_1","newVersion","use","vipDB","addon","versionInstance","_whenReady","unuse","mw","closeOptions","hasInvalidArguments","doDelete","backendDB","hasBeenClosed","hasFailed","dynamicallyOpened","_transaction","idbMode","onlyIfCompatible","SubTransaction","enterTransaction","InvalidTable","symbolObservable","observable","Observable","_subscribe","mozIndexedDB","webkitIndexedDB","msIndexedDB","webkitIDBKeyRange","liveQuery","hasValue","observer","abortController","closed","accumMuts","currentObs","startedListening","mutationListener","doQuery","_doQuery","shouldNotify","aborted","getValue","propagateLocally","updateParts","wasMe","propagatingLocally","databaseName","exists","ignoreTransaction","generatorFn","spawn","currentTransaction","promiseOrFunction","optionalTimeout","semVer","maxKey","dispatchEvent","event_1","CustomEvent","detail","bc","createBC","BroadcastChannel","onmessage","unref","changedParts","postMessage","disableBfCache","persisted","connections_1","default","DexieSymbol","for","_Dexie","tradeSettings","userPreferences","portfolioData","taxData","commentaryData","dashboardConfig","milestonesData","miscData","backups","chartImageBlobs","tx","createdAt","cleanDataForIndexedDB","cleaned","cleanedValue","DatabaseService","cleanedTrade","cleanedTrades","allSettings","allPrefs","createBackup","cleanedData","allBackups","toDelete","getLatestBackup","allConfigs","allMilestones","cleanedAchievements","record","Blob","blob","getChartImageBlobsSize","total","clearAllChartImages","getOrphanedChartImages","blobs","tradeIds","cleanupOrphanedChartImages","orphanedBlobs","orphanedIds","inspectChartImageDatabase","validBlobs","getAllChartImageBlobsWithTradeInfo","tradeMap","tradeInfo","tradeName","getFilteredChartImageBlobs","imageType","dateFrom","dateTo","getDatabaseSize","tradesCount","settingsCount","prefsCount","portfolioCount","taxCount","commentaryCount","dashboardCount","milestonesCount","miscCount","backupsCount","chartImagesCount","chartImages","MigrationService","migrateToSupabase","onProgress","currentStep","totalSteps","updateProgress","completed","errorMsg","miscKeys","chartBlobs","hasDataToMigrate","hasTradeData","hasChartData","hasPortfolioInfo","getMigrationSummary","hasPreferences","hasPortfolioData","clearIndexedDBData","MigrationModal","onMigrationComplete","onNeverShowAgain","migrationSummary","setMigrationSummary","migrationProgress","setMigrationProgress","migrationCompleted","setMigrationCompleted","migrationError","setMigrationError","loadMigrationSummary","summary","progressPercentage","header","footer","Progress","track","indicator","progress","handleComplete","AuthCallback","history","useHistory","useLocation","setStatus","searchParams","URLSearchParams","search","hashParams","errorDescription","accessToken","refreshToken","setSessionError","setSession","access_token","refresh_token","attempt","handleAuthCallback","TradeJournal","lazy","module","TradeAnalytics","TaxAnalytics","MonthlyPerformanceTable","DeepAnalyticsPage","AppContent","isMobileMenuOpen","setIsMobileMenuOpen","isProfileOpen","setIsProfileOpen","loadingPrefs","setLoadingPrefs","showMigrationModal","setShowMigrationModal","migrationChecked","setMigrationChecked","mainContentRef","isMainContentFullscreen","setIsMainContentFullscreen","getDefaultUserName","user_metadata","neverShowAgain","checkForMigration","fetchUserPreferences","prefs","is_mobile_menu_open","is_profile_open","user_name","is_full_width_enabled","loadPreferences","handleToggleMainContentFullscreen","fullscreenElement","exitFullscreen","requestFullscreen","handleFullscreenChange","removeEventListener","navItems","Link","isActive","pathname","height","Suspense","Route","exact","toggleFullscreen","isFullscreen","component","App","ReactDOM","getElementById","StrictMode","BrowserRouter","HeroUIProvider","ToastProvider"],"ignoreList":[0,24,28,29],"sources":["../../node_modules/react-dom/client.js","../../src/components/theme-switcher.tsx","../../src/utils/accountingUtils.ts","../../src/utils/TruePortfolioContext.tsx","../../src/components/TruePortfolioSetup.tsx","../../src/components/WelcomeMessageModal.tsx","../../src/lib/supabase.ts","../../src/services/authService.ts","../../src/context/AuthContext.tsx","../../src/components/TruePortfolioSetupManager.tsx","../../src/components/YearlyStartingCapitalModal.tsx","../../src/context/AccountingMethodContext.tsx","../../src/hooks/use-true-portfolio-with-trades.ts","../../src/context/GlobalFilterContext.tsx","../../src/utils/dateFilterUtils.ts","../../src/utils/tradeCalculations.ts","../../src/services/supabaseService.ts","../../src/hooks/use-trades.ts","../../src/utils/milestones.ts","../../src/components/ProfileSettingsModal.tsx","../../src/hooks/use-milestones.ts","../../src/components/GlobalFilterBar.tsx","../../src/components/AnimatedBrandName.tsx","../../src/components/ErrorBoundary.tsx","../../node_modules/@vercel/analytics/dist/react/index.mjs","../../src/components/Loader.tsx","../../src/components/auth/AuthModal.tsx","../../src/components/auth/AuthGuard.tsx","../../node_modules/dexie/dist/dexie.js","../../node_modules/dexie/import-wrapper.mjs","../../src/db/database.ts","../../src/services/migrationService.ts","../../src/components/migration/MigrationModal.tsx","../../src/pages/AuthCallback.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","import React from \"react\";\r\nimport { Switch, Tooltip } from \"@heroui/react\";\r\nimport { Icon } from \"@iconify/react\";\r\nimport { useTheme } from \"@heroui/use-theme\";\r\n\r\nexport const ThemeSwitcher: React.FC = () => {\r\n  const { theme, setTheme } = useTheme();\r\n  const isDark = theme === \"dark\";\r\n\r\n  const handleToggle = () => {\r\n    setTheme(isDark ? \"light\" : \"dark\");\r\n  };\r\n\r\n  return (\r\n    <Tooltip\r\n      content={`Switch to ${isDark ? \"light\" : \"dark\"} mode`}\r\n      placement=\"bottom\"\r\n      className=\"animate-fade-in\"\r\n    >\r\n      <div className=\"flex items-center gap-2 p-2 rounded-lg transition-all duration-300 ease-in-out hover:bg-foreground-100/50\">\r\n        <Icon\r\n          icon={isDark ? \"lucide:moon\" : \"lucide:sun\"}\r\n          className={`text-lg transition-all duration-300 transform ${\r\n            isDark\r\n              ? \"text-primary-400 rotate-0\"\r\n              : \"text-warning-400 rotate-90\"\r\n          }`}\r\n        />\r\n        <Switch\r\n          isSelected={isDark}\r\n          onValueChange={handleToggle}\r\n          size=\"sm\"\r\n          color={isDark ? \"primary\" : \"warning\"}\r\n          className=\"mx-0 shadow-soft-sm hover:shadow-soft-md transition-shadow duration-200\"\r\n        />\r\n      </div>\r\n    </Tooltip>\r\n  );\r\n};","import { Trade } from '../types/trade';\r\n\r\n/**\r\n * Helper function to get exit dates with fallback logic\r\n * @param trade - The trade object\r\n * @returns Array of exit objects with date, qty, and price\r\n */\r\nexport function getExitDatesWithFallback(trade: Trade): Array<{ date: string; qty: number; price: number }> {\r\n  // First, try to get individual exit dates\r\n  const exits = [\r\n    { date: trade.exit1Date, qty: trade.exit1Qty || 0, price: trade.exit1Price || 0 },\r\n    { date: trade.exit2Date, qty: trade.exit2Qty || 0, price: trade.exit2Price || 0 },\r\n    { date: trade.exit3Date, qty: trade.exit3Qty || 0, price: trade.exit3Price || 0 }\r\n  ].filter(exit => exit.date && exit.date.trim() !== '' && exit.qty > 0);\r\n\r\n  // If we have individual exit data, return it\r\n  if (exits.length > 0) {\r\n    return exits;\r\n  }\r\n\r\n  // Fallback: If no individual exit dates but we have exitedQty and avgExitPrice\r\n  // Create a synthetic exit using the trade date as fallback\r\n  if ((trade.positionStatus === 'Closed' || trade.positionStatus === 'Partial') &&\r\n      trade.exitedQty > 0 && trade.avgExitPrice > 0) {\r\n\r\n    // Try to find the latest exit date from available exits (even if qty/price is 0)\r\n    const availableExitDates = [\r\n      trade.exit1Date,\r\n      trade.exit2Date,\r\n      trade.exit3Date\r\n    ].filter(date => date && date.trim() !== '');\r\n\r\n    const fallbackDate = availableExitDates.length > 0\r\n      ? availableExitDates.sort((a, b) => new Date(b).getTime() - new Date(a).getTime())[0]\r\n      : trade.date; // Ultimate fallback to trade entry date\r\n\r\n    return [{\r\n      date: fallbackDate,\r\n      qty: trade.exitedQty,\r\n      price: trade.avgExitPrice\r\n    }];\r\n  }\r\n\r\n  return [];\r\n}\r\n\r\n/**\r\n * Groups trades by month based on the accounting method\r\n * @param trades - Array of trades\r\n * @param useCashBasis - Whether to use cash basis (true) or accrual basis (false)\r\n * @returns Object with month keys and arrays of trades\r\n */\r\nexport function groupTradesByMonth(trades: Trade[], useCashBasis: boolean = false): Record<string, Trade[]> {\r\n  const groupedTrades: Record<string, Trade[]> = {};\r\n\r\n  trades.forEach(trade => {\r\n    if (useCashBasis) {\r\n      // Cash basis: Group by exit dates\r\n      if (trade.positionStatus === 'Closed' || trade.positionStatus === 'Partial') {\r\n        const exits = getExitDatesWithFallback(trade);\r\n\r\n        exits.forEach(exit => {\r\n          const exitDate = new Date(exit.date);\r\n          const monthKey = `${exitDate.toLocaleString('default', { month: 'short' })} ${exitDate.getFullYear()}`;\r\n\r\n          if (!groupedTrades[monthKey]) {\r\n            groupedTrades[monthKey] = [];\r\n          }\r\n\r\n          // Create a partial trade object for this exit\r\n          const partialTrade: Trade = {\r\n            ...trade,\r\n            // Mark this as a partial exit for cash basis calculation\r\n            _cashBasisExit: {\r\n              date: exit.date,\r\n              qty: exit.qty,\r\n              price: exit.price\r\n            }\r\n          };\r\n\r\n          groupedTrades[monthKey].push(partialTrade);\r\n        });\r\n      }\r\n    } else {\r\n      // Accrual basis: Group by trade initiation date (current behavior)\r\n      if (trade.date) {\r\n        const tradeDate = new Date(trade.date);\r\n        const monthKey = `${tradeDate.toLocaleString('default', { month: 'short' })} ${tradeDate.getFullYear()}`;\r\n\r\n        if (!groupedTrades[monthKey]) {\r\n          groupedTrades[monthKey] = [];\r\n        }\r\n\r\n        groupedTrades[monthKey].push(trade);\r\n      }\r\n    }\r\n  });\r\n\r\n  return groupedTrades;\r\n}\r\n\r\n/**\r\n * Calculates P/L for a trade based on accounting method\r\n * @param trade - The trade object\r\n * @param useCashBasis - Whether to use cash basis accounting\r\n * @returns P/L amount\r\n */\r\nexport function calculateTradePL(trade: Trade, useCashBasis: boolean = false): number {\r\n  if (!useCashBasis) {\r\n    // Accrual basis: Use the trade's total realized P/L\r\n    const accrualPL = trade.plRs ?? 0;\r\n\r\n    return accrualPL;\r\n  } else {\r\n    // Cash basis: Calculate P/L for the specific exit if it's a cash basis exit\r\n    const cashBasisExit = trade._cashBasisExit;\r\n    if (cashBasisExit) {\r\n      const avgEntry = trade.avgEntry || trade.entry || 0;\r\n\r\n      // Use the exit price from the cash basis exit data\r\n      const correctExitPrice = cashBasisExit.price;\r\n\r\n      if (avgEntry > 0 && correctExitPrice > 0) {\r\n        const pl = trade.buySell === 'Buy'\r\n          ? (correctExitPrice - avgEntry) * cashBasisExit.qty\r\n          : (avgEntry - correctExitPrice) * cashBasisExit.qty;\r\n\r\n        return pl;\r\n      }\r\n    } else {\r\n      // Cash basis for individual trades (not grouped): Use the trade's total realized P/L\r\n      // This handles the case when calculating stats for individual trades\r\n      if (trade.positionStatus === 'Closed') {\r\n        return trade.plRs || 0;\r\n      } else if (trade.positionStatus === 'Partial') {\r\n        // For partial positions, calculate realized P/L from exits only\r\n        const avgEntry = trade.avgEntry || trade.entry || 0;\r\n        let totalRealizedPL = 0;\r\n\r\n        // Calculate P/L for each exit\r\n        if (trade.exit1Date && trade.exit1Qty && trade.exit1Price && avgEntry > 0) {\r\n          const pl = trade.buySell === 'Buy'\r\n            ? (trade.exit1Price - avgEntry) * trade.exit1Qty\r\n            : (avgEntry - trade.exit1Price) * trade.exit1Qty;\r\n          totalRealizedPL += pl;\r\n        }\r\n\r\n        if (trade.exit2Date && trade.exit2Qty && trade.exit2Price && avgEntry > 0) {\r\n          const pl = trade.buySell === 'Buy'\r\n            ? (trade.exit2Price - avgEntry) * trade.exit2Qty\r\n            : (avgEntry - trade.exit2Price) * trade.exit2Qty;\r\n          totalRealizedPL += pl;\r\n        }\r\n\r\n        if (trade.exit3Date && trade.exit3Qty && trade.exit3Price && avgEntry > 0) {\r\n          const pl = trade.buySell === 'Buy'\r\n            ? (trade.exit3Price - avgEntry) * trade.exit3Qty\r\n            : (avgEntry - trade.exit3Price) * trade.exit3Qty;\r\n          totalRealizedPL += pl;\r\n        }\r\n\r\n        // Fallback: If no individual exit data but we have partial exit information\r\n        // Use the aggregate partial exit data (exitedQty, avgExitPrice, plRs)\r\n        if (totalRealizedPL === 0 && trade.exitedQty > 0) {\r\n          // Option 1: Use stored plRs if available (most reliable)\r\n          if (trade.plRs !== undefined && trade.plRs !== null) {\r\n            return trade.plRs;\r\n          }\r\n\r\n          // Option 2: Calculate from aggregate exit data if avgExitPrice is available\r\n          if (trade.avgExitPrice > 0 && avgEntry > 0) {\r\n            const pl = trade.buySell === 'Buy'\r\n              ? (trade.avgExitPrice - avgEntry) * trade.exitedQty\r\n              : (avgEntry - trade.avgExitPrice) * trade.exitedQty;\r\n            return pl;\r\n          }\r\n        }\r\n\r\n        return totalRealizedPL;\r\n      }\r\n    }\r\n\r\n    return 0;\r\n  }\r\n}\r\n\r\n/**\r\n * Gets the relevant date for a trade based on accounting method\r\n * @param trade - The trade object\r\n * @param useCashBasis - Whether to use cash basis accounting\r\n * @returns Date string\r\n */\r\nexport function getTradeDateForAccounting(trade: Trade, useCashBasis: boolean = false): string {\r\n  if (!useCashBasis) {\r\n    // Accrual basis: Use trade initiation date\r\n    return trade.date;\r\n  } else {\r\n    // Cash basis: Use exit date if it's a cash basis exit\r\n    const cashBasisExit = trade._cashBasisExit;\r\n    if (cashBasisExit) {\r\n      return cashBasisExit.date;\r\n    }\r\n\r\n    // For cash basis without _cashBasisExit, try to find the most recent exit date\r\n    if (trade.positionStatus === 'Closed' || trade.positionStatus === 'Partial') {\r\n      // Find the latest exit date from available exits\r\n      const exitDates = [\r\n        trade.exit1Date,\r\n        trade.exit2Date,\r\n        trade.exit3Date\r\n      ].filter(date => date && date.trim() !== '');\r\n\r\n      if (exitDates.length > 0) {\r\n        // Return the latest exit date for cash basis\r\n        const latestExitDate = exitDates.sort((a, b) => new Date(b).getTime() - new Date(a).getTime())[0];\r\n        return latestExitDate;\r\n      }\r\n    }\r\n\r\n    // Fallback to trade date if no exit information available\r\n    return trade.date;\r\n  }\r\n}\r\n\r\n/**\r\n * Filters trades for a specific month and year based on accounting method\r\n * @param trades - Array of trades\r\n * @param month - Month name (e.g., 'Jan', 'Feb')\r\n * @param year - Year number\r\n * @param useCashBasis - Whether to use cash basis accounting\r\n * @returns Filtered trades for the month\r\n */\r\nexport function getTradesForMonth(trades: Trade[], month: string, year: number, useCashBasis: boolean = false): Trade[] {\r\n  if (!useCashBasis) {\r\n    // Accrual basis: Filter by trade initiation date\r\n    return trades.filter(trade => {\r\n      if (!trade.date) return false;\r\n      const tradeDate = new Date(trade.date);\r\n      const tradeMonth = tradeDate.toLocaleString('default', { month: 'short' });\r\n      const tradeYear = tradeDate.getFullYear();\r\n      return tradeMonth === month && tradeYear === year;\r\n    });\r\n  } else {\r\n    // Cash basis: Filter by exit dates\r\n    const monthTrades: Trade[] = [];\r\n\r\n    trades.forEach(trade => {\r\n      if (trade.positionStatus === 'Closed' || trade.positionStatus === 'Partial') {\r\n        const exits = getExitDatesWithFallback(trade);\r\n\r\n        exits.forEach(exit => {\r\n          const exitDate = new Date(exit.date);\r\n          const exitMonth = exitDate.toLocaleString('default', { month: 'short' });\r\n          const exitYear = exitDate.getFullYear();\r\n\r\n          if (exitMonth === month && exitYear === year) {\r\n            // Create a partial trade object for this exit\r\n            const partialTrade: Trade = {\r\n              ...trade,\r\n              _cashBasisExit: {\r\n                date: exit.date,\r\n                qty: exit.qty,\r\n                price: exit.price\r\n              }\r\n            };\r\n\r\n            monthTrades.push(partialTrade);\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    return monthTrades;\r\n  }\r\n}\r\n","import React, { createContext, useContext, useState, ReactNode, useEffect, useCallback, useMemo } from \"react\";\r\nimport { getExitDatesWithFallback } from './accountingUtils';\r\n\r\nexport interface YearlyStartingCapital {\r\n  year: number;\r\n  startingCapital: number;\r\n  updatedAt: string;\r\n}\r\n\r\nexport interface MonthlyStartingCapitalOverride {\r\n  id: string;\r\n  month: string; // Short month name like 'Jan', 'Feb'\r\n  year: number;\r\n  startingCapital: number;\r\n  updatedAt: string;\r\n}\r\n\r\nexport interface CapitalChange {\r\n  id: string;\r\n  date: string;\r\n  amount: number;  // Positive for deposits, negative for withdrawals\r\n  type: 'deposit' | 'withdrawal';\r\n  description: string;\r\n}\r\n\r\nexport interface MonthlyTruePortfolio {\r\n  month: string;\r\n  year: number;\r\n  startingCapital: number;\r\n  capitalChanges: number; // Net deposits - withdrawals for the month\r\n  pl: number; // P&L from trades for the month\r\n  finalCapital: number; // Starting + changes + P&L\r\n}\r\n\r\ninterface TruePortfolioContextType {\r\n  // Core functions\r\n  getTruePortfolioSize: (month: string, year: number, trades?: any[], useCashBasis?: boolean) => number;\r\n  getLatestTruePortfolioSize: (trades?: any[], useCashBasis?: boolean) => number;\r\n\r\n  // Starting capital management\r\n  yearlyStartingCapitals: YearlyStartingCapital[];\r\n  setYearlyStartingCapital: (year: number, amount: number) => void;\r\n  getYearlyStartingCapital: (year: number) => number;\r\n\r\n  // Monthly starting capital overrides\r\n  monthlyStartingCapitalOverrides: MonthlyStartingCapitalOverride[];\r\n  setMonthlyStartingCapitalOverride: (month: string, year: number, amount: number) => void;\r\n  removeMonthlyStartingCapitalOverride: (month: string, year: number) => void;\r\n  getMonthlyStartingCapitalOverride: (month: string, year: number) => number | null;\r\n\r\n  // Capital changes\r\n  capitalChanges: CapitalChange[];\r\n  addCapitalChange: (change: Omit<CapitalChange, 'id'>) => void;\r\n  updateCapitalChange: (change: CapitalChange) => void;\r\n  deleteCapitalChange: (id: string) => void;\r\n\r\n  // Monthly calculations\r\n  getMonthlyTruePortfolio: (month: string, year: number, trades?: any[], useCashBasis?: boolean) => MonthlyTruePortfolio;\r\n  getAllMonthlyTruePortfolios: (trades?: any[], useCashBasis?: boolean) => MonthlyTruePortfolio[];\r\n\r\n  // Backward compatibility\r\n  portfolioSize: number; // Latest true portfolio size\r\n}\r\n\r\nconst TruePortfolioContext = createContext<TruePortfolioContextType | undefined>(undefined);\r\n\r\n// localStorage helpers\r\nfunction fetchYearlyStartingCapitals(): YearlyStartingCapital[] {\r\n  try {\r\n    const stored = localStorage.getItem('yearlyStartingCapitals');\r\n    const capitals = stored ? JSON.parse(stored) : [];\r\n    return capitals;\r\n  } catch (error) {\r\n    return [];\r\n  }\r\n}\r\n\r\nfunction saveYearlyStartingCapitals(capitals: YearlyStartingCapital[]) {\r\n  try {\r\n    localStorage.setItem('yearlyStartingCapitals', JSON.stringify(capitals));\r\n  } catch (error) {\r\n    // Handle error silently\r\n  }\r\n}\r\n\r\nfunction fetchCapitalChanges(): CapitalChange[] {\r\n  try {\r\n    const stored = localStorage.getItem('capitalChanges');\r\n    const changes = stored ? JSON.parse(stored) : [];\r\n    return changes;\r\n  } catch (error) {\r\n    return [];\r\n  }\r\n}\r\n\r\nfunction saveCapitalChanges(changes: CapitalChange[]) {\r\n  try {\r\n    localStorage.setItem('capitalChanges', JSON.stringify(changes));\r\n  } catch (error) {\r\n    // Handle error silently\r\n  }\r\n}\r\n\r\nfunction fetchMonthlyStartingCapitalOverrides(): MonthlyStartingCapitalOverride[] {\r\n  try {\r\n    const stored = localStorage.getItem('monthlyStartingCapitalOverrides');\r\n    const overrides = stored ? JSON.parse(stored) : [];\r\n    return overrides;\r\n  } catch (error) {\r\n    return [];\r\n  }\r\n}\r\n\r\nfunction saveMonthlyStartingCapitalOverrides(overrides: MonthlyStartingCapitalOverride[]) {\r\n  try {\r\n    localStorage.setItem('monthlyStartingCapitalOverrides', JSON.stringify(overrides));\r\n  } catch (error) {\r\n    // Handle error silently\r\n  }\r\n}\r\n\r\nexport const TruePortfolioProvider = ({ children }: { children: ReactNode }) => {\r\n  const [yearlyStartingCapitals, setYearlyStartingCapitals] = useState<YearlyStartingCapital[]>([]);\r\n  const [capitalChanges, setCapitalChanges] = useState<CapitalChange[]>([]);\r\n  const [monthlyStartingCapitalOverrides, setMonthlyStartingCapitalOverrides] = useState<MonthlyStartingCapitalOverride[]>([]);\r\n  const [hydrated, setHydrated] = useState(false);\r\n\r\n  // Load from localStorage on mount\r\n  useEffect(() => {\r\n    const loadData = () => {\r\n      try {\r\n        // Load from localStorage\r\n        const capitals = fetchYearlyStartingCapitals();\r\n        const changes = fetchCapitalChanges();\r\n        const overrides = fetchMonthlyStartingCapitalOverrides();\r\n\r\n        if (Array.isArray(capitals)) {\r\n          setYearlyStartingCapitals(capitals);\r\n        }\r\n\r\n        if (Array.isArray(changes)) {\r\n          setCapitalChanges(changes);\r\n        }\r\n\r\n        if (Array.isArray(overrides)) {\r\n          setMonthlyStartingCapitalOverrides(overrides);\r\n        }\r\n      } catch (error) {\r\n        // Handle error silently\r\n      } finally {\r\n        setHydrated(true);\r\n      }\r\n    };\r\n\r\n    loadData();\r\n  }, []);\r\n\r\n  // Save to localStorage when data changes\r\n  useEffect(() => {\r\n    if (hydrated && yearlyStartingCapitals.length > 0) {\r\n      saveYearlyStartingCapitals(yearlyStartingCapitals);\r\n    }\r\n  }, [yearlyStartingCapitals, hydrated]);\r\n\r\n  useEffect(() => {\r\n    if (hydrated && capitalChanges.length > 0) {\r\n      saveCapitalChanges(capitalChanges);\r\n    }\r\n  }, [capitalChanges, hydrated]);\r\n\r\n  useEffect(() => {\r\n    if (hydrated && monthlyStartingCapitalOverrides.length > 0) {\r\n      saveMonthlyStartingCapitalOverrides(monthlyStartingCapitalOverrides);\r\n    }\r\n  }, [monthlyStartingCapitalOverrides, hydrated]);\r\n\r\n  const setYearlyStartingCapital = useCallback((year: number, amount: number) => {\r\n    setYearlyStartingCapitals(prev => {\r\n      const updated = [...prev];\r\n      const existingIndex = updated.findIndex(item => item.year === year);\r\n\r\n      const newCapital = {\r\n        year,\r\n        startingCapital: amount,\r\n        updatedAt: new Date().toISOString()\r\n      };\r\n\r\n      if (existingIndex >= 0) {\r\n        updated[existingIndex] = newCapital;\r\n      } else {\r\n        updated.push(newCapital);\r\n      }\r\n\r\n      return updated.sort((a, b) => a.year - b.year);\r\n    });\r\n  }, []);\r\n\r\n  const getYearlyStartingCapital = useCallback((year: number): number => {\r\n    const capital = yearlyStartingCapitals.find(item => item.year === year);\r\n    return capital?.startingCapital || 0;\r\n  }, [yearlyStartingCapitals]);\r\n\r\n  const setMonthlyStartingCapitalOverride = useCallback((month: string, year: number, amount: number) => {\r\n    const normalizedMonth = month.length > 3 ?\r\n      ({ \"January\": \"Jan\", \"February\": \"Feb\", \"March\": \"Mar\", \"April\": \"Apr\", \"May\": \"May\", \"June\": \"Jun\",\r\n         \"July\": \"Jul\", \"August\": \"Aug\", \"September\": \"Sep\", \"October\": \"Oct\", \"November\": \"Nov\", \"December\": \"Dec\" }[month] || month) :\r\n      month;\r\n\r\n    setMonthlyStartingCapitalOverrides(prev => {\r\n      const updated = [...prev];\r\n      const existingIndex = updated.findIndex(item => item.month === normalizedMonth && item.year === year);\r\n\r\n      const newOverride: MonthlyStartingCapitalOverride = {\r\n        id: `${normalizedMonth}-${year}`,\r\n        month: normalizedMonth,\r\n        year,\r\n        startingCapital: amount,\r\n        updatedAt: new Date().toISOString()\r\n      };\r\n\r\n      if (existingIndex >= 0) {\r\n        updated[existingIndex] = newOverride;\r\n      } else {\r\n        updated.push(newOverride);\r\n      }\r\n\r\n      return updated.sort((a, b) => a.year - b.year || a.month.localeCompare(b.month));\r\n    });\r\n  }, []);\r\n\r\n  const removeMonthlyStartingCapitalOverride = useCallback((month: string, year: number) => {\r\n    const normalizedMonth = month.length > 3 ?\r\n      ({ \"January\": \"Jan\", \"February\": \"Feb\", \"March\": \"Mar\", \"April\": \"Apr\", \"May\": \"May\", \"June\": \"Jun\",\r\n         \"July\": \"Jul\", \"August\": \"Aug\", \"September\": \"Sep\", \"October\": \"Oct\", \"November\": \"Nov\", \"December\": \"Dec\" }[month] || month) :\r\n      month;\r\n\r\n    setMonthlyStartingCapitalOverrides(prev =>\r\n      prev.filter(item => !(item.month === normalizedMonth && item.year === year))\r\n    );\r\n  }, []);\r\n\r\n  const getMonthlyStartingCapitalOverride = useCallback((month: string, year: number): number | null => {\r\n    const normalizedMonth = month.length > 3 ?\r\n      ({ \"January\": \"Jan\", \"February\": \"Feb\", \"March\": \"Mar\", \"April\": \"Apr\", \"May\": \"May\", \"June\": \"Jun\",\r\n         \"July\": \"Jul\", \"August\": \"Aug\", \"September\": \"Sep\", \"October\": \"Oct\", \"November\": \"Nov\", \"December\": \"Dec\" }[month] || month) :\r\n      month;\r\n\r\n    const override = monthlyStartingCapitalOverrides.find(item => item.month === normalizedMonth && item.year === year);\r\n    return override ? override.startingCapital : null;\r\n  }, [monthlyStartingCapitalOverrides]);\r\n\r\n  const addCapitalChange = useCallback((change: Omit<CapitalChange, 'id'>) => {\r\n    const newChange = {\r\n      ...change,\r\n      id: `capital_${new Date().getTime()}_${Math.random()}`\r\n    };\r\n\r\n    setCapitalChanges(prev => [...prev, newChange]);\r\n  }, []);\r\n\r\n  const updateCapitalChange = useCallback((updatedChange: CapitalChange) => {\r\n    setCapitalChanges(prev =>\r\n      prev.map(change =>\r\n        change.id === updatedChange.id ? updatedChange : change\r\n      )\r\n    );\r\n  }, []);\r\n\r\n  const deleteCapitalChange = useCallback((id: string) => {\r\n    setCapitalChanges(prev => prev.filter(change => change.id !== id));\r\n  }, []);\r\n\r\n  // Helper function to get trades P&L for a specific month/year\r\n  const getTradesPLForMonth = useCallback((month: string, year: number, trades: any[] = [], useCashBasis: boolean = false): number => {\r\n    if (!trades || trades.length === 0) return 0;\r\n\r\n    if (useCashBasis) {\r\n      // Cash basis: P&L is attributed to the month when trades are exited/closed\r\n      const result = trades\r\n        .filter(trade => {\r\n          // Only include trades that have exits (closed or partial)\r\n          return trade.positionStatus === 'Closed' || trade.positionStatus === 'Partial';\r\n        })\r\n        .reduce((sum, trade) => {\r\n          let monthPL = 0;\r\n\r\n          // Check each exit and attribute P&L to the respective exit months\r\n          const exits = getExitDatesWithFallback(trade);\r\n\r\n          // Calculate P&L for exits in this specific month/year\r\n          exits.forEach(exit => {\r\n            const exitDate = new Date(exit.date);\r\n            // Use consistent month name conversion\r\n            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\r\n            const exitMonth = monthNames[exitDate.getMonth()];\r\n            const exitYear = exitDate.getFullYear();\r\n\r\n            if (exitMonth === month && exitYear === year) {\r\n              // Calculate P&L for this specific exit\r\n              const avgEntry = trade.avgEntry || trade.entry || 0;\r\n              if (avgEntry > 0 && exit.price > 0 && exit.qty > 0) {\r\n                const exitPL = trade.buySell === 'Buy'\r\n                  ? (exit.price - avgEntry) * exit.qty\r\n                  : (avgEntry - exit.price) * exit.qty;\r\n                monthPL += exitPL;\r\n              }\r\n            }\r\n          });\r\n\r\n          return sum + monthPL;\r\n        }, 0);\r\n\r\n      return result;\r\n    } else {\r\n      // Accrual basis: P&L is attributed to the month when trades are initiated (current behavior)\r\n      return trades\r\n        .filter(trade => {\r\n          if (!trade.date) return false;\r\n          const tradeDate = new Date(trade.date);\r\n          // Use consistent month name conversion\r\n          const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\r\n          const tradeMonth = monthNames[tradeDate.getMonth()];\r\n          const tradeYear = tradeDate.getFullYear();\r\n          return tradeMonth === month && tradeYear === year;\r\n        })\r\n        .reduce((sum, trade) => {\r\n          // Use plRs if available, otherwise calculate basic P&L\r\n          if (trade.plRs !== undefined && trade.plRs !== null) {\r\n            return sum + trade.plRs;\r\n          }\r\n          // Fallback calculation for trades without plRs\r\n          const exitedQty = trade.exitedQty || 0;\r\n          const avgExitPrice = trade.avgExitPrice || 0;\r\n          const avgEntry = trade.avgEntry || trade.entry || 0;\r\n          if (exitedQty > 0 && avgExitPrice > 0 && avgEntry > 0) {\r\n            const pl = trade.buySell === 'Buy'\r\n              ? (avgExitPrice - avgEntry) * exitedQty\r\n              : (avgEntry - avgExitPrice) * exitedQty;\r\n            return sum + pl;\r\n          }\r\n          return sum;\r\n        }, 0);\r\n    }\r\n  }, []);\r\n\r\n  // Helper function to get capital changes for a specific month/year\r\n  const getCapitalChangesForMonth = useCallback((month: string, year: number): number => {\r\n    return capitalChanges\r\n      .filter(change => {\r\n        if (!change.date) return false;\r\n        const changeDate = new Date(change.date);\r\n        // Use consistent month name conversion\r\n        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\r\n        const changeMonth = monthNames[changeDate.getMonth()];\r\n        const changeYear = changeDate.getFullYear();\r\n        return changeMonth === month && changeYear === year;\r\n      })\r\n      .reduce((sum, change) => {\r\n        return sum + (change.type === 'deposit' ? change.amount : -change.amount);\r\n      }, 0);\r\n  }, [capitalChanges]);\r\n\r\n  // Helper function to normalize month names\r\n  const normalizeMonth = useCallback((month: string): string => {\r\n    // If it's already a short month name, return as is\r\n    const shortMonths = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\r\n    if (shortMonths.includes(month)) {\r\n      return month;\r\n    }\r\n\r\n    // Convert full month names to short month names\r\n    const monthMap: Record<string, string> = {\r\n      \"January\": \"Jan\", \"February\": \"Feb\", \"March\": \"Mar\", \"April\": \"Apr\",\r\n      \"May\": \"May\", \"June\": \"Jun\", \"July\": \"Jul\", \"August\": \"Aug\",\r\n      \"September\": \"Sep\", \"October\": \"Oct\", \"November\": \"Nov\", \"December\": \"Dec\"\r\n    };\r\n\r\n    return monthMap[month] || month;\r\n  }, []);\r\n\r\n  // Core function to calculate monthly true portfolio with memoization\r\n  const calculateMonthlyTruePortfolio = useCallback((month: string, year: number, trades: any[] = [], memo: Map<string, MonthlyTruePortfolio> = new Map(), minOverallDate: Date | null = null, useCashBasis: boolean = false): MonthlyTruePortfolio => {\r\n    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\r\n\r\n    // Normalize the month name\r\n    const normalizedMonth = normalizeMonth(month);\r\n    const monthIndex = months.indexOf(normalizedMonth);\r\n\r\n    if (monthIndex === -1) {\r\n      throw new Error(`Invalid month: ${month}. Expected short month names like 'Jan', 'Feb', etc.`);\r\n    }\r\n\r\n    const key = `${normalizedMonth}-${year}`;\r\n    if (memo.has(key)) {\r\n      return memo.get(key)!;\r\n    }\r\n\r\n    let startingCapital = 0;\r\n\r\n    const currentMonthDate = new Date(year, monthIndex, 1);\r\n\r\n    // Base case: If current month is before the overall minimum date, return zero capital.\r\n    // This prevents infinite recursion when going too far back in time.\r\n    if (minOverallDate && currentMonthDate < minOverallDate) {\r\n      return {\r\n        month: normalizedMonth,\r\n        year,\r\n        startingCapital: 0,\r\n        capitalChanges: 0,\r\n        pl: 0,\r\n        finalCapital: 0\r\n      };\r\n    }\r\n\r\n    // Check for monthly starting capital override first\r\n    const override = getMonthlyStartingCapitalOverride(normalizedMonth, year);\r\n    if (override !== null) {\r\n      startingCapital = override;\r\n    } else if (minOverallDate && currentMonthDate.getFullYear() === minOverallDate.getFullYear() && currentMonthDate.getMonth() === minOverallDate.getMonth()) {\r\n      // If this is the absolute first month with data for the *entire* portfolio journey,\r\n      // and there's no monthly override, use the yearly starting capital for its year.\r\n      startingCapital = getYearlyStartingCapital(year);\r\n    } else {\r\n      // For subsequent months, get final capital from previous month\r\n      const prevMonthIndex = monthIndex - 1;\r\n      let prevMonth = months[prevMonthIndex];\r\n      let prevYear = year;\r\n\r\n      if (prevMonthIndex < 0) {\r\n        prevMonth = months[11]; // December of previous year\r\n        prevYear = year - 1;\r\n      }\r\n\r\n      const prevMonthData = calculateMonthlyTruePortfolio(prevMonth, prevYear, trades, memo, minOverallDate, useCashBasis); // Pass minOverallDate and useCashBasis recursively\r\n      startingCapital = prevMonthData.finalCapital;\r\n    }\r\n\r\n    // Get capital changes for this month\r\n    const capitalChangesAmount = getCapitalChangesForMonth(normalizedMonth, year);\r\n\r\n    // Revised starting capital = original starting capital + capital changes\r\n    const revisedStartingCapital = startingCapital + capitalChangesAmount;\r\n\r\n    // Get P&L for this month\r\n    const pl = getTradesPLForMonth(normalizedMonth, year, trades, useCashBasis);\r\n\r\n    // Final capital = revised starting capital + P&L\r\n    const finalCapital = revisedStartingCapital + pl;\r\n\r\n    const result: MonthlyTruePortfolio = {\r\n      month: normalizedMonth, // Always return normalized month name\r\n      year,\r\n      startingCapital: revisedStartingCapital, // This is the revised starting capital\r\n      capitalChanges: capitalChangesAmount,\r\n      pl,\r\n      finalCapital\r\n    };\r\n\r\n    memo.set(key, result);\r\n    return result;\r\n  }, [getYearlyStartingCapital, getCapitalChangesForMonth, getTradesPLForMonth, normalizeMonth, getMonthlyStartingCapitalOverride]);\r\n\r\n  // Public function to get monthly true portfolio\r\n  const getMonthlyTruePortfolio = useCallback((month: string, year: number, trades: any[] = [], useCashBasis: boolean = false): MonthlyTruePortfolio => {\r\n    const memo = new Map<string, MonthlyTruePortfolio>();\r\n\r\n    // Determine the earliest and latest dates with data (trades or capital changes)\r\n    let minOverallDate: Date | null = null;\r\n\r\n    [...trades, ...capitalChanges].forEach(item => {\r\n        if (item.date) {\r\n            const itemDate = new Date(item.date);\r\n            if (!minOverallDate || itemDate < minOverallDate) {\r\n                minOverallDate = itemDate;\r\n            }\r\n        }\r\n    });\r\n\r\n    // Also consider yearly starting capitals for the earliest date\r\n    yearlyStartingCapitals.forEach(capital => {\r\n        const capitalDate = new Date(capital.year, 0, 1); // January 1st of the capital year\r\n        if (!minOverallDate || capitalDate < minOverallDate) {\r\n            minOverallDate = capitalDate;\r\n        }\r\n    });\r\n\r\n    // If there's no data at all, fallback to current year\r\n    if (!minOverallDate) {\r\n        minOverallDate = new Date(new Date().getFullYear(), 0, 1); // January 1st of current year\r\n    }\r\n\r\n    // Adjust minOverallDate to the beginning of its month\r\n    minOverallDate.setDate(1);\r\n    minOverallDate.setHours(0, 0, 0, 0);\r\n\r\n    return calculateMonthlyTruePortfolio(month, year, trades, memo, minOverallDate, useCashBasis);\r\n  }, [calculateMonthlyTruePortfolio, yearlyStartingCapitals, capitalChanges]);\r\n\r\n  // Get true portfolio size for a specific month/year\r\n  const getTruePortfolioSize = useCallback((month: string, year: number, trades: any[] = [], useCashBasis: boolean = false): number => {\r\n    try {\r\n      const monthlyData = getMonthlyTruePortfolio(month, year, trades, useCashBasis);\r\n      return monthlyData.finalCapital;\r\n    } catch (error) {\r\n      return 100000; // Fallback value\r\n    }\r\n  }, [getMonthlyTruePortfolio]);\r\n\r\n  // Get latest true portfolio size\r\n  const getLatestTruePortfolioSize = useCallback((trades: any[] = [], useCashBasis: boolean = false): number => {\r\n    try {\r\n      const currentDate = new Date();\r\n      const currentMonth = currentDate.toLocaleString('default', { month: 'short' });\r\n      const currentYear = currentDate.getFullYear();\r\n\r\n      return getTruePortfolioSize(currentMonth, currentYear, trades, useCashBasis);\r\n    } catch (error) {\r\n      return 100000; // Fallback value\r\n    }\r\n  }, [getTruePortfolioSize]);\r\n\r\n  // Get all monthly true portfolios for a year or range\r\n  const getAllMonthlyTruePortfolios = useCallback((trades: any[] = [], useCashBasis: boolean = false): MonthlyTruePortfolio[] => {\r\n    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\r\n    const result: MonthlyTruePortfolio[] = [];\r\n    const memo = new Map<string, MonthlyTruePortfolio>();\r\n\r\n    // Determine the earliest and latest dates with data (trades or capital changes)\r\n    let minOverallDate: Date | null = null;\r\n    let maxOverallDate: Date | null = null;\r\n\r\n    // Process trades - consider both entry and exit dates for cash basis\r\n    trades.forEach(trade => {\r\n        if (trade.date) {\r\n            const entryDate = new Date(trade.date);\r\n            if (!minOverallDate || entryDate < minOverallDate) {\r\n                minOverallDate = entryDate;\r\n            }\r\n            if (!maxOverallDate || entryDate > maxOverallDate) {\r\n                maxOverallDate = entryDate;\r\n            }\r\n        }\r\n\r\n        // For cash basis, also consider exit dates\r\n        if (useCashBasis && (trade.positionStatus === 'Closed' || trade.positionStatus === 'Partial')) {\r\n            [trade.exit1Date, trade.exit2Date, trade.exit3Date].forEach(exitDate => {\r\n                if (exitDate) {\r\n                    const exitDateObj = new Date(exitDate);\r\n                    if (!isNaN(exitDateObj.getTime())) {\r\n                        if (!minOverallDate || exitDateObj < minOverallDate) {\r\n                            minOverallDate = exitDateObj;\r\n                        }\r\n                        if (!maxOverallDate || exitDateObj > maxOverallDate) {\r\n                            maxOverallDate = exitDateObj;\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    });\r\n\r\n    // Process capital changes\r\n    capitalChanges.forEach(item => {\r\n        if (item.date) {\r\n            const itemDate = new Date(item.date);\r\n            if (!minOverallDate || itemDate < minOverallDate) {\r\n                minOverallDate = itemDate;\r\n            }\r\n            if (!maxOverallDate || itemDate > maxOverallDate) {\r\n                maxOverallDate = itemDate;\r\n            }\r\n        }\r\n    });\r\n\r\n    // Also consider yearly starting capitals for the earliest date\r\n    yearlyStartingCapitals.forEach(capital => {\r\n        const capitalDate = new Date(capital.year, 0, 1); // January 1st of the capital year\r\n        if (!minOverallDate || capitalDate < minOverallDate) {\r\n            minOverallDate = capitalDate;\r\n        }\r\n    });\r\n\r\n    // If there's no data at all, fallback to current year\r\n    if (!minOverallDate) {\r\n        minOverallDate = new Date(new Date().getFullYear(), 0, 1); // January 1st of current year\r\n    }\r\n\r\n    // Adjust minOverallDate to the beginning of its month\r\n    minOverallDate.setDate(1);\r\n    minOverallDate.setHours(0, 0, 0, 0);\r\n\r\n    // If maxOverallDate is not set (e.g., only yearly capital with no trades/capital changes), default to current date\r\n    if (!maxOverallDate) {\r\n      maxOverallDate = new Date();\r\n    }\r\n\r\n    // Ensure maxOverallDate is at the end of its month to include all trades/changes within that month\r\n    maxOverallDate.setMonth(maxOverallDate.getMonth() + 1);\r\n    maxOverallDate.setDate(0); // This sets it to the last day of the previous month\r\n    maxOverallDate.setHours(23, 59, 59, 999);\r\n\r\n    let currentDate = new Date(minOverallDate.getFullYear(), minOverallDate.getMonth(), 1);\r\n\r\n    while (currentDate <= maxOverallDate) {\r\n        const year = currentDate.getFullYear();\r\n        const month = months[currentDate.getMonth()]; // Get short month name\r\n\r\n        try {\r\n            const monthlyData = calculateMonthlyTruePortfolio(month, year, trades, memo, minOverallDate, useCashBasis); // Pass minOverallDate and useCashBasis\r\n            result.push(monthlyData);\r\n        } catch (error) {\r\n            // Skip months with no data\r\n        }\r\n\r\n        currentDate.setMonth(currentDate.getMonth() + 1);\r\n    }\r\n\r\n    return result;\r\n  }, [yearlyStartingCapitals, capitalChanges, calculateMonthlyTruePortfolio]);\r\n\r\n  // Backward compatibility - get current portfolio size\r\n  const portfolioSize = React.useMemo(() => {\r\n    try {\r\n      return getLatestTruePortfolioSize();\r\n    } catch (error) {\r\n      return 100000; // Fallback value\r\n    }\r\n  }, [getLatestTruePortfolioSize]);\r\n\r\n  // Create safe wrapper functions that check hydration status\r\n  const safeGetTruePortfolioSize = useCallback((month: string, year: number, trades?: any[], useCashBasis?: boolean) => {\r\n    if (!hydrated) return 100000; // Return default value during hydration\r\n    return getTruePortfolioSize(month, year, trades, useCashBasis);\r\n  }, [hydrated, getTruePortfolioSize]);\r\n\r\n  const safeGetLatestTruePortfolioSize = useCallback((trades?: any[], useCashBasis?: boolean) => {\r\n    if (!hydrated) return 100000; // Return default value during hydration\r\n    return getLatestTruePortfolioSize(trades, useCashBasis);\r\n  }, [hydrated, getLatestTruePortfolioSize]);\r\n\r\n  // Memoize the context value to prevent unnecessary re-renders\r\n  const contextValue = useMemo(() => ({\r\n    getTruePortfolioSize: safeGetTruePortfolioSize,\r\n    getLatestTruePortfolioSize: safeGetLatestTruePortfolioSize,\r\n    yearlyStartingCapitals,\r\n    setYearlyStartingCapital,\r\n    getYearlyStartingCapital,\r\n    monthlyStartingCapitalOverrides,\r\n    setMonthlyStartingCapitalOverride,\r\n    removeMonthlyStartingCapitalOverride,\r\n    getMonthlyStartingCapitalOverride,\r\n    capitalChanges,\r\n    addCapitalChange,\r\n    updateCapitalChange,\r\n    deleteCapitalChange,\r\n    getMonthlyTruePortfolio,\r\n    getAllMonthlyTruePortfolios,\r\n    portfolioSize: hydrated ? portfolioSize : 100000\r\n  }), [\r\n    safeGetTruePortfolioSize,\r\n    safeGetLatestTruePortfolioSize,\r\n    yearlyStartingCapitals,\r\n    setYearlyStartingCapital,\r\n    getYearlyStartingCapital,\r\n    monthlyStartingCapitalOverrides,\r\n    setMonthlyStartingCapitalOverride,\r\n    removeMonthlyStartingCapitalOverride,\r\n    getMonthlyStartingCapitalOverride,\r\n    capitalChanges,\r\n    addCapitalChange,\r\n    updateCapitalChange,\r\n    deleteCapitalChange,\r\n    getMonthlyTruePortfolio,\r\n    getAllMonthlyTruePortfolios,\r\n    portfolioSize,\r\n    hydrated\r\n  ]);\r\n\r\n  // Always render children to prevent hook count mismatches\r\n  return (\r\n    <TruePortfolioContext.Provider value={contextValue}>\r\n      {children}\r\n    </TruePortfolioContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useTruePortfolio = (): TruePortfolioContextType => {\r\n  const ctx = useContext(TruePortfolioContext);\r\n  if (!ctx) throw new Error(\"useTruePortfolio must be used within a TruePortfolioProvider\");\r\n  return ctx;\r\n};\r\n","import React, { useState } from 'react';\nimport {\n  Modal,\n  ModalContent,\n  ModalHeader,\n  ModalBody,\n  ModalFooter,\n  Button,\n  Input\n} from \"@heroui/react\";\nimport { Icon } from \"@iconify/react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { useTruePortfolio } from '../utils/TruePortfolioContext';\n\ninterface TruePortfolioSetupProps {\n  isOpen: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSetupComplete: (userName: string) => void;\n  userName: string;\n  setUserName: React.Dispatch<React.SetStateAction<string>>;\n}\n\nexport const TruePortfolioSetup: React.FC<TruePortfolioSetupProps> = ({\n  isOpen,\n  onOpenChange,\n  onSetupComplete,\n  userName,\n  setUserName\n}) => {\n  const { yearlyStartingCapitals, setYearlyStartingCapital } = useTruePortfolio();\n  const [startingCapital, setStartingCapital] = useState<string>('');\n  const [selectedYear, setSelectedYear] = useState<string>(new Date().getFullYear().toString());\n\n  const handleSetup = () => {\n    const amount = parseFloat(startingCapital);\n    const year = parseInt(selectedYear);\n\n    if (isNaN(amount) || isNaN(year) || amount <= 0) {\n      alert('Please enter a valid amount and year');\n      return;\n    }\n\n    setYearlyStartingCapital(year, amount);\n\n    // Clear form and close modal\n    setStartingCapital('');\n    onOpenChange(false);\n\n    // Show success message\n    setTimeout(() => {\n      alert('✅ Portfolio setup complete! Your True Portfolio system is now active.');\n    }, 500);\n\n    onSetupComplete(userName);\n  };\n\n  // Check if setup is needed\n  const needsSetup = yearlyStartingCapitals.length === 0;\n\n  if (!needsSetup) {\n    return null; // Don't show if already set up\n  }\n\n  return (\n    <Modal\n      isOpen={isOpen}\n      onOpenChange={onOpenChange}\n      size=\"lg\"\n      isDismissable={false}\n      hideCloseButton={true}\n      classNames={{\n        base: \"max-w-[90vw] max-h-[90vh] sm:max-w-lg\",\n        wrapper: \"items-center justify-center p-4\",\n        body: \"overflow-y-auto p-0\",\n        backdrop: \"bg-black/60\"\n      }}\n      motionProps={{\n        variants: {\n          enter: {\n            opacity: 1,\n            scale: 1,\n            y: 0,\n            transition: {\n              duration: 0.5,\n              ease: [0.16, 1, 0.3, 1]\n            }\n          },\n          exit: {\n            opacity: 0,\n            scale: 0.95,\n            y: 20,\n            transition: {\n              duration: 0.3,\n              ease: [0.16, 1, 0.3, 1]\n            }\n          }\n        },\n        initial: { opacity: 0, scale: 0.95, y: 20 }\n      }}\n    >\n      <ModalContent className=\"bg-background/95 backdrop-blur-xl border border-divider/50 shadow-2xl\">\n        {(onClose) => (\n          <>\n            <ModalHeader className=\"flex items-center gap-3 px-6 py-4 border-b border-divider/50 bg-gradient-to-r from-primary/5 via-secondary/5 to-success/5\">\n              <motion.div\n                className=\"flex items-center gap-3\"\n                initial={{ opacity: 0, x: -20 }}\n                animate={{ opacity: 1, x: 0 }}\n                transition={{ duration: 0.5, delay: 0.2 }}\n              >\n                <motion.div\n                  className=\"p-2 rounded-xl bg-gradient-to-br from-primary/20 to-secondary/20 border border-primary/30\"\n                  whileHover={{ scale: 1.05, rotate: 5 }}\n                  transition={{ type: \"spring\", stiffness: 400, damping: 10 }}\n                >\n                  <Icon icon=\"lucide:sparkles\" className=\"text-primary text-xl\" />\n                </motion.div>\n                <div>\n                  <span className=\"text-lg font-bold tracking-tight bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent\">\n                    Welcome to True Portfolio!\n                  </span>\n                  <p className=\"text-xs text-default-500 mt-0.5\">Let's set up your trading journey</p>\n                </div>\n              </motion.div>\n            </ModalHeader>\n            <ModalBody className=\"p-6 space-y-4\">\n              <motion.div\n                className=\"bg-gradient-to-br from-content1/60 to-content2/40 rounded-2xl p-4 border border-divider/30 shadow-lg\"\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ duration: 0.5, delay: 0.3 }}\n              >\n                <div className=\"flex items-start gap-3\">\n                  <motion.div\n                    className=\"p-2 rounded-lg bg-primary/10 border border-primary/20\"\n                    whileHover={{ scale: 1.1 }}\n                    transition={{ type: \"spring\", stiffness: 400, damping: 10 }}\n                  >\n                    <Icon icon=\"lucide:sparkles\" className=\"text-primary text-lg\" />\n                  </motion.div>\n                  <div className=\"flex-1\">\n                    <h3 className=\"font-semibold text-base mb-2 text-foreground\">What's New?</h3>\n                    <p className=\"text-xs text-default-600 mb-3\">\n                      Your journal now uses a <span className=\"font-semibold text-primary\">True Portfolio System</span> that auto-calculates portfolio size:\n                    </p>\n                    <div className=\"grid grid-cols-1 gap-2\">\n                      {[\n                        { icon: \"lucide:dollar-sign\", text: \"Starting Capital\", color: \"text-success\" },\n                        { icon: \"lucide:trending-up\", text: \"Capital Changes\", color: \"text-warning\" },\n                        { icon: \"lucide:activity\", text: \"Trading P&L\", color: \"text-primary\" }\n                      ].map((item, index) => (\n                        <motion.div\n                          key={item.text}\n                          className=\"flex items-center gap-2\"\n                          initial={{ opacity: 0, x: -10 }}\n                          animate={{ opacity: 1, x: 0 }}\n                          transition={{ duration: 0.3, delay: 0.5 + index * 0.1 }}\n                        >\n                          <div className={`w-5 h-5 rounded-full flex items-center justify-center bg-gradient-to-br ${item.color}/10 to-${item.color}/5`}>\n                            <Icon icon={item.icon} className={`${item.color} text-xs`} />\n                          </div>\n                          <span className=\"text-xs font-medium text-foreground\">{item.text}</span>\n                        </motion.div>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n              </motion.div>\n\n              <motion.div\n                className=\"bg-gradient-to-br from-content1/60 to-content2/40 rounded-2xl p-4 border border-divider/30 shadow-lg\"\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ duration: 0.5, delay: 0.6 }}\n              >\n                <div className=\"flex items-center gap-3 mb-3\">\n                  <motion.div\n                    className=\"p-2 rounded-lg bg-success/10 border border-success/20\"\n                    whileHover={{ scale: 1.1 }}\n                    transition={{ type: \"spring\", stiffness: 400, damping: 10 }}\n                  >\n                    <Icon icon=\"lucide:user-plus\" className=\"text-success text-lg\" />\n                  </motion.div>\n                  <div>\n                    <h4 className=\"font-semibold text-base text-foreground\">Set Your Starting Capital</h4>\n                    <p className=\"text-xs text-default-600\">\n                      Enter your details for January {selectedYear}\n                    </p>\n                  </div>\n                </div>\n\n                <motion.div\n                  className=\"space-y-3\"\n                  initial={{ opacity: 0, y: 10 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ duration: 0.4, delay: 0.8 }}\n                >\n                  <motion.div initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.3, delay: 0.9 }}>\n                    <Input\n                      label=\"Your Name\"\n                      placeholder=\"Enter your name\"\n                      value={userName}\n                      onValueChange={setUserName}\n                      size=\"sm\"\n                      variant=\"bordered\"\n                      startContent={<Icon icon=\"lucide:user\" className=\"text-default-400 text-base\" />}\n                      isRequired\n                    />\n                  </motion.div>\n\n                  <motion.div initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.3, delay: 1.0 }}>\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n                      <Input\n                        label=\"Year\"\n                        placeholder=\"e.g., 2025\"\n                        value={selectedYear}\n                        onValueChange={setSelectedYear}\n                        type=\"number\"\n                        min=\"2000\"\n                        max=\"2099\"\n                        size=\"sm\"\n                        variant=\"bordered\"\n                      />\n                      <Input\n                        label=\"Starting Capital\"\n                        placeholder=\"e.g., 100000\"\n                        value={startingCapital}\n                        onValueChange={setStartingCapital}\n                        type=\"number\"\n                        min=\"0\"\n                        step=\"1000\"\n                        startContent={<span className=\"text-default-400 text-base\">₹</span>}\n                        size=\"sm\"\n                        variant=\"bordered\"\n                      />\n                    </div>\n                  </motion.div>\n                </motion.div>\n              </motion.div>\n\n              <motion.div\n                className=\"bg-gradient-to-r from-warning/10 to-orange/10 p-3 rounded-xl border border-warning/20\"\n                initial={{ opacity: 0, scale: 0.95 }}\n                animate={{ opacity: 1, scale: 1 }}\n                transition={{ duration: 0.4, delay: 1.0 }}\n              >\n                <div className=\"flex items-center gap-2\">\n                  <motion.div\n                    animate={{ rotate: [0, 10, -10, 0] }}\n                    transition={{ duration: 2, repeat: Infinity, repeatDelay: 3 }}\n                  >\n                    <Icon icon=\"lucide:lightbulb\" className=\"text-warning text-base\" />\n                  </motion.div>\n                  <div>\n                    <p className=\"font-medium text-warning text-xs\">Pro Tip:</p>\n                    <p className=\"text-warning-700 dark:text-warning-300 text-xs\">\n                      Add more years later via <span className=\"font-semibold\">Portfolio Settings</span>\n                    </p>\n                  </div>\n                </div>\n              </motion.div>\n            </ModalBody>\n            <ModalFooter className=\"border-t border-divider/50 px-6 py-4 bg-gradient-to-r from-background/50 to-content1/30\">\n              <motion.div\n                className=\"w-full\"\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ duration: 0.4, delay: 1.2 }}\n              >\n                <Button\n                  color=\"primary\"\n                  onPress={handleSetup}\n                  isDisabled={!userName.trim() || !startingCapital || !selectedYear || parseFloat(startingCapital) <= 0 || parseInt(selectedYear) < 2000 || parseInt(selectedYear) > 2099}\n                  startContent={<Icon icon=\"lucide:rocket\" className=\"w-4 h-4\" />}\n                  className=\"w-full bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 transition-all duration-300\"\n                  size=\"md\"\n                  variant=\"shadow\"\n                  radius=\"full\"\n                >\n                  <motion.span\n                    whileHover={{ scale: 1.05 }}\n                    transition={{ type: \"spring\", stiffness: 400, damping: 10 }}\n                  >\n                    Set Up Portfolio\n                  </motion.span>\n                </Button>\n              </motion.div>\n            </ModalFooter>\n          </>\n        )}\n      </ModalContent>\n    </Modal>\n  );\n};\n","import React from 'react';\r\nimport {\r\n  Modal,\r\n  ModalContent,\r\n  ModalHeader,\r\n  ModalBody,\r\n  ModalFooter,\r\n  Button\r\n} from \"@heroui/react\";\r\nimport { Icon } from \"@iconify/react\";\r\nimport { motion } from \"framer-motion\";\r\n\r\ninterface WelcomeMessageModalProps {\r\n  isOpen: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  userName: string;\r\n}\r\n\r\nexport const WelcomeMessageModal: React.FC<WelcomeMessageModalProps> = ({ isOpen, onOpenChange, userName }) => {\r\n  const firstName = userName.split(' ')[0];\r\n\r\n  return (\r\n    <Modal\r\n      isOpen={isOpen}\r\n      onOpenChange={onOpenChange}\r\n      size=\"sm\"\r\n      isDismissable={false}\r\n      hideCloseButton={true}\r\n      classNames={{\r\n        base: \"max-w-[90vw] sm:max-w-sm\",\r\n        wrapper: \"items-center justify-center p-4\",\r\n        backdrop: \"bg-black/60\"\r\n      }}\r\n      motionProps={{\r\n        variants: {\r\n          enter: {\r\n            opacity: 1,\r\n            scale: 1,\r\n            y: 0,\r\n            transition: {\r\n              duration: 0.5,\r\n              ease: [0.16, 1, 0.3, 1]\r\n            }\r\n          },\r\n          exit: {\r\n            opacity: 0,\r\n            scale: 0.95,\r\n            y: 20,\r\n            transition: {\r\n              duration: 0.3,\r\n              ease: [0.16, 1, 0.3, 1]\r\n            }\r\n          }\r\n        },\r\n        initial: { opacity: 0, scale: 0.95, y: 20 }\r\n      }}\r\n    >\r\n      <ModalContent className=\"bg-background/95 backdrop-blur-xl border border-divider/50 shadow-2xl\">\r\n        <ModalHeader className=\"flex items-center gap-3 px-6 py-4 border-b border-divider/50 bg-gradient-to-r from-success/5 via-primary/5 to-secondary/5\">\r\n          <motion.div\r\n            className=\"flex items-center gap-3\"\r\n            initial={{ opacity: 0, scale: 0.8 }}\r\n            animate={{ opacity: 1, scale: 1 }}\r\n            transition={{ duration: 0.5, delay: 0.2 }}\r\n          >\r\n            <motion.div\r\n              className=\"p-2 rounded-xl bg-gradient-to-br from-success/20 to-primary/20 border border-success/30\"\r\n              animate={{\r\n                rotate: [0, 10, -10, 0],\r\n                scale: [1, 1.1, 1]\r\n              }}\r\n              transition={{\r\n                duration: 2,\r\n                repeat: Infinity,\r\n                repeatDelay: 3,\r\n                ease: \"easeInOut\"\r\n              }}\r\n            >\r\n              <Icon icon=\"lucide:party-popper\" className=\"text-success text-xl\" />\r\n            </motion.div>\r\n            <div>\r\n              <span className=\"text-lg font-bold tracking-tight bg-gradient-to-r from-success to-primary bg-clip-text text-transparent\">\r\n                Welcome, {firstName || 'Trader'}!\r\n              </span>\r\n              <p className=\"text-xs text-default-500 mt-0.5\">You're all set to trade!</p>\r\n            </div>\r\n          </motion.div>\r\n        </ModalHeader>\r\n        <ModalBody className=\"px-4 py-3 space-y-2\">\r\n          <motion.div\r\n            initial={{ opacity: 0, y: 10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            transition={{ duration: 0.4, delay: 0.4 }}\r\n          >\r\n            <p className=\"text-sm text-default-700 dark:text-default-300\">\r\n              Get ready to feel <span className=\"font-semibold text-success\">something truly good</span> about your trading journey!\r\n            </p>\r\n          </motion.div>\r\n          <motion.div\r\n            initial={{ opacity: 0, y: 10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            transition={{ duration: 0.4, delay: 0.6 }}\r\n          >\r\n            <p className=\"text-xs text-default-500\">\r\n              Your True Portfolio System is ready to empower your trades.\r\n            </p>\r\n          </motion.div>\r\n        </ModalBody>\r\n        <ModalFooter className=\"border-t border-divider/50 px-4 py-3 bg-gradient-to-r from-background/50 to-content1/30\">\r\n          <motion.div\r\n            className=\"w-full\"\r\n            initial={{ opacity: 0, y: 10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            transition={{ duration: 0.4, delay: 0.8 }}\r\n          >\r\n            <Button\r\n              color=\"success\"\r\n              onPress={() => onOpenChange(false)}\r\n              startContent={<Icon icon=\"lucide:rocket\" className=\"w-4 h-4\" />}\r\n              className=\"w-full bg-gradient-to-r from-success to-primary hover:from-success/90 hover:to-primary/90 transition-all duration-300\"\r\n              size=\"md\"\r\n              variant=\"shadow\"\r\n              radius=\"full\"\r\n            >\r\n              <motion.span\r\n                whileHover={{ scale: 1.05 }}\r\n                transition={{ type: \"spring\", stiffness: 400, damping: 10 }}\r\n              >\r\n                Let's Go!\r\n              </motion.span>\r\n            </Button>\r\n          </motion.div>\r\n        </ModalFooter>\r\n      </ModalContent>\r\n    </Modal>\r\n  );\r\n};","import { createClient } from '@supabase/supabase-js'\n\n// Supabase configuration\nconst supabaseUrl = (import.meta as any).env.VITE_SUPABASE_URL || 'https://pbhevzjyyjkahlwvvfhj.supabase.co'\nconst supabaseAnonKey = (import.meta as any).env.VITE_SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiaGV2emp5eWprYWhsd3Z2ZmhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA4MTM3NjksImV4cCI6MjA1NjM4OTc2OX0.xgrPk3cz4Vclry_9WmHaO1NVCi2TOQQI0jsLZvtl6I8'\n\n// Create Supabase client\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey, {\n  auth: {\n    autoRefreshToken: true,\n    persistSession: true,\n    detectSessionInUrl: false, // We'll handle this manually\n    flowType: 'implicit',\n    storage: typeof window !== 'undefined' ? window.localStorage : undefined,\n    storageKey: 'supabase.auth.token'\n  }\n})\n\n// Database types based on our schema\nexport interface Database {\n  public: {\n    Tables: {\n      trades: {\n        Row: {\n          id: string\n          user_id: string\n          trade_no: string\n          date: string\n          name: string\n          entry: number\n          avg_entry: number\n          sl: number\n          tsl: number\n          buy_sell: 'Buy' | 'Sell'\n          cmp: number\n          setup: string\n          base_duration: string\n          initial_qty: number\n          pyramid1_price: number\n          pyramid1_qty: number\n          pyramid1_date: string | null\n          pyramid2_price: number\n          pyramid2_qty: number\n          pyramid2_date: string | null\n          position_size: number\n          allocation: number\n          sl_percent: number\n          exit1_price: number\n          exit1_qty: number\n          exit1_date: string | null\n          exit2_price: number\n          exit2_qty: number\n          exit2_date: string | null\n          exit3_price: number\n          exit3_qty: number\n          exit3_date: string | null\n          open_qty: number\n          exited_qty: number\n          avg_exit_price: number\n          stock_move: number\n          reward_risk: number\n          holding_days: number\n          position_status: 'Open' | 'Closed' | 'Partial'\n          realised_amount: number\n          pl_rs: number\n          pf_impact: number\n          cumm_pf: number\n          plan_followed: boolean\n          exit_trigger: string\n          proficiency_growth_areas: string\n          sector: string\n          open_heat: number\n          notes: string\n          chart_attachments: any\n          user_edited_fields: string[]\n          cmp_auto_fetched: boolean\n          needs_recalculation: boolean\n          created_at: string\n          updated_at: string\n        }\n        Insert: {\n          id?: string\n          user_id: string\n          trade_no: string\n          date: string\n          name: string\n          entry?: number\n          avg_entry?: number\n          sl?: number\n          tsl?: number\n          buy_sell?: 'Buy' | 'Sell'\n          cmp?: number\n          setup?: string\n          base_duration?: string\n          initial_qty?: number\n          pyramid1_price?: number\n          pyramid1_qty?: number\n          pyramid1_date?: string | null\n          pyramid2_price?: number\n          pyramid2_qty?: number\n          pyramid2_date?: string | null\n          position_size?: number\n          allocation?: number\n          sl_percent?: number\n          exit1_price?: number\n          exit1_qty?: number\n          exit1_date?: string | null\n          exit2_price?: number\n          exit2_qty?: number\n          exit2_date?: string | null\n          exit3_price?: number\n          exit3_qty?: number\n          exit3_date?: string | null\n          open_qty?: number\n          exited_qty?: number\n          avg_exit_price?: number\n          stock_move?: number\n          reward_risk?: number\n          holding_days?: number\n          position_status?: 'Open' | 'Closed' | 'Partial'\n          realised_amount?: number\n          pl_rs?: number\n          pf_impact?: number\n          cumm_pf?: number\n          plan_followed?: boolean\n          exit_trigger?: string\n          proficiency_growth_areas?: string\n          sector?: string\n          open_heat?: number\n          notes?: string\n          chart_attachments?: any\n          user_edited_fields?: string[]\n          cmp_auto_fetched?: boolean\n          needs_recalculation?: boolean\n        }\n        Update: {\n          id?: string\n          user_id?: string\n          trade_no?: string\n          date?: string\n          name?: string\n          entry?: number\n          avg_entry?: number\n          sl?: number\n          tsl?: number\n          buy_sell?: 'Buy' | 'Sell'\n          cmp?: number\n          setup?: string\n          base_duration?: string\n          initial_qty?: number\n          pyramid1_price?: number\n          pyramid1_qty?: number\n          pyramid1_date?: string | null\n          pyramid2_price?: number\n          pyramid2_qty?: number\n          pyramid2_date?: string | null\n          position_size?: number\n          allocation?: number\n          sl_percent?: number\n          exit1_price?: number\n          exit1_qty?: number\n          exit1_date?: string | null\n          exit2_price?: number\n          exit2_qty?: number\n          exit2_date?: string | null\n          exit3_price?: number\n          exit3_qty?: number\n          exit3_date?: string | null\n          open_qty?: number\n          exited_qty?: number\n          avg_exit_price?: number\n          stock_move?: number\n          reward_risk?: number\n          holding_days?: number\n          position_status?: 'Open' | 'Closed' | 'Partial'\n          realised_amount?: number\n          pl_rs?: number\n          pf_impact?: number\n          cumm_pf?: number\n          plan_followed?: boolean\n          exit_trigger?: string\n          proficiency_growth_areas?: string\n          sector?: string\n          open_heat?: number\n          notes?: string\n          chart_attachments?: any\n          user_edited_fields?: string[]\n          cmp_auto_fetched?: boolean\n          needs_recalculation?: boolean\n        }\n      }\n      user_preferences: {\n        Row: {\n          id: string\n          user_id: string\n          is_mobile_menu_open: boolean\n          is_profile_open: boolean\n          user_name: string\n          is_full_width_enabled: boolean\n          accounting_method: 'cash' | 'accrual'\n          theme: 'light' | 'dark' | 'system'\n          created_at: string\n          updated_at: string\n        }\n        Insert: {\n          id?: string\n          user_id: string\n          is_mobile_menu_open?: boolean\n          is_profile_open?: boolean\n          user_name?: string\n          is_full_width_enabled?: boolean\n          accounting_method?: 'cash' | 'accrual'\n          theme?: 'light' | 'dark' | 'system'\n        }\n        Update: {\n          id?: string\n          user_id?: string\n          is_mobile_menu_open?: boolean\n          is_profile_open?: boolean\n          user_name?: string\n          is_full_width_enabled?: boolean\n          accounting_method?: 'cash' | 'accrual'\n          theme?: 'light' | 'dark' | 'system'\n        }\n      }\n      portfolio_data: {\n        Row: {\n          id: string\n          user_id: string\n          type: 'yearly_capital' | 'capital_change' | 'monthly_override'\n          year: number | null\n          month: string | null\n          amount: number\n          date: string | null\n          description: string\n          created_at: string\n          updated_at: string\n        }\n        Insert: {\n          id?: string\n          user_id: string\n          type: 'yearly_capital' | 'capital_change' | 'monthly_override'\n          year?: number | null\n          month?: string | null\n          amount: number\n          date?: string | null\n          description?: string\n        }\n        Update: {\n          id?: string\n          user_id?: string\n          type?: 'yearly_capital' | 'capital_change' | 'monthly_override'\n          year?: number | null\n          month?: string | null\n          amount?: number\n          date?: string | null\n          description?: string\n        }\n      }\n      chart_image_blobs: {\n        Row: {\n          id: string\n          user_id: string\n          trade_id: string\n          image_type: 'beforeEntry' | 'afterExit'\n          filename: string\n          mime_type: string\n          size_bytes: number\n          data: any\n          uploaded_at: string\n          compressed: boolean\n          original_size: number | null\n          created_at: string\n          updated_at: string\n        }\n        Insert: {\n          id?: string\n          user_id: string\n          trade_id: string\n          image_type: 'beforeEntry' | 'afterExit'\n          filename: string\n          mime_type: string\n          size_bytes: number\n          data: any\n          uploaded_at?: string\n          compressed?: boolean\n          original_size?: number | null\n        }\n        Update: {\n          id?: string\n          user_id?: string\n          trade_id?: string\n          image_type?: 'beforeEntry' | 'afterExit'\n          filename?: string\n          mime_type?: string\n          size_bytes?: number\n          data?: any\n          uploaded_at?: string\n          compressed?: boolean\n          original_size?: number | null\n        }\n      }\n    }\n  }\n}\n","import { supabase } from '../lib/supabase'\r\nimport type { User, Session, AuthError } from '@supabase/supabase-js'\r\n\r\nexport interface AuthState {\r\n  user: User | null\r\n  session: Session | null\r\n  loading: boolean\r\n  error: string | null\r\n}\r\n\r\nexport interface SignUpData {\r\n  email: string\r\n  password: string\r\n  firstName?: string\r\n  lastName?: string\r\n}\r\n\r\nexport interface SignInData {\r\n  email: string\r\n  password: string\r\n}\r\n\r\nexport class AuthService {\r\n  /**\r\n   * Sign up a new user with email and password\r\n   */\r\n  static async signUp({ email, password, firstName, lastName }: SignUpData) {\r\n    try {\r\n      const { data, error } = await supabase.auth.signUp({\r\n        email,\r\n        password,\r\n        options: {\r\n          data: {\r\n            first_name: firstName,\r\n            last_name: lastName,\r\n            full_name: firstName && lastName ? `${firstName} ${lastName}` : firstName || lastName || '',\r\n          }\r\n        }\r\n      })\r\n\r\n      if (error) {\r\n        throw error\r\n      }\r\n\r\n      return { data, error: null }\r\n    } catch (error) {\r\n      return { data: null, error: error as AuthError }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sign in an existing user with email and password\r\n   */\r\n  static async signIn({ email, password }: SignInData) {\r\n    try {\r\n      console.log('🔐 Attempting sign in for email:', email)\r\n\r\n      const { data, error } = await supabase.auth.signInWithPassword({\r\n        email,\r\n        password\r\n      })\r\n\r\n      if (error) {\r\n        console.error('❌ Sign in error:', error.message)\r\n        throw error\r\n      }\r\n\r\n      console.log('✅ Sign in successful for user:', data.user?.email)\r\n      return { data, error: null }\r\n    } catch (error) {\r\n      const authError = error as AuthError\r\n      console.error('❌ Sign in failed:', authError.message)\r\n      return { data: null, error: authError }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sign in with OAuth provider (Twitter, Google, GitHub)\r\n   */\r\n  static async signInWithProvider(provider: 'twitter' | 'google' | 'github') {\r\n    try {\r\n      const { data, error } = await supabase.auth.signInWithOAuth({\r\n        provider,\r\n        options: {\r\n          redirectTo: `${window.location.origin}/auth/callback`,\r\n          queryParams: {\r\n            access_type: 'offline',\r\n            prompt: 'consent'\r\n          }\r\n        }\r\n      })\r\n\r\n      if (error) {\r\n        throw error\r\n      }\r\n\r\n      return { data, error: null }\r\n    } catch (error) {\r\n      return { data: null, error: error as AuthError }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sign out the current user\r\n   */\r\n  static async signOut() {\r\n    try {\r\n      const { error } = await supabase.auth.signOut()\r\n\r\n      if (error) {\r\n        throw error\r\n      }\r\n\r\n      return { error: null }\r\n    } catch (error) {\r\n      return { error: error as AuthError }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send password reset email\r\n   */\r\n  static async resetPassword(email: string) {\r\n    try {\r\n      const { data, error } = await supabase.auth.resetPasswordForEmail(email, {\r\n        redirectTo: `${window.location.origin}/reset-password`\r\n      })\r\n\r\n      if (error) {\r\n        throw error\r\n      }\r\n\r\n      return { data, error: null }\r\n    } catch (error) {\r\n      return { data: null, error: error as AuthError }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update user password\r\n   */\r\n  static async updatePassword(newPassword: string) {\r\n    try {\r\n      const { data, error } = await supabase.auth.updateUser({\r\n        password: newPassword\r\n      })\r\n\r\n      if (error) {\r\n        throw error\r\n      }\r\n\r\n      return { data, error: null }\r\n    } catch (error) {\r\n      return { data: null, error: error as AuthError }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resend email verification\r\n   */\r\n  static async resendVerification(email: string) {\r\n    try {\r\n      const { data, error } = await supabase.auth.resend({\r\n        type: 'signup',\r\n        email: email\r\n      })\r\n\r\n      if (error) {\r\n        throw error\r\n      }\r\n\r\n      return { data, error: null }\r\n    } catch (error) {\r\n      return { data: null, error: error as AuthError }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if user exists (for better error messaging)\r\n   */\r\n  static async checkUserExists(email: string): Promise<boolean> {\r\n    try {\r\n      // Try to initiate password reset - this will tell us if user exists\r\n      const { error } = await supabase.auth.resetPasswordForEmail(email, {\r\n        redirectTo: `${window.location.origin}/reset-password`\r\n      })\r\n\r\n      // If no error, user exists\r\n      // If error contains \"User not found\", user doesn't exist\r\n      if (error && error.message.includes('User not found')) {\r\n        return false\r\n      }\r\n\r\n      return true\r\n    } catch (error) {\r\n      // If there's an error, assume user doesn't exist\r\n      return false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update user profile\r\n   */\r\n  static async updateProfile(updates: {\r\n    email?: string\r\n    firstName?: string\r\n    lastName?: string\r\n  }) {\r\n    try {\r\n      const { data, error } = await supabase.auth.updateUser({\r\n        email: updates.email,\r\n        data: {\r\n          first_name: updates.firstName,\r\n          last_name: updates.lastName,\r\n          full_name: updates.firstName && updates.lastName\r\n            ? `${updates.firstName} ${updates.lastName}`\r\n            : updates.firstName || updates.lastName || '',\r\n        }\r\n      })\r\n\r\n      if (error) {\r\n        throw error\r\n      }\r\n\r\n      return { data, error: null }\r\n    } catch (error) {\r\n      return { data: null, error: error as AuthError }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current user\r\n   */\r\n  static async getCurrentUser() {\r\n    try {\r\n      const { data: { user }, error } = await supabase.auth.getUser()\r\n\r\n      if (error) {\r\n        // Don't log session missing errors as they're expected on initial load\r\n        if (error.message !== 'Auth session missing!') {\r\n          console.error('Auth error getting user:', error)\r\n        }\r\n        throw error\r\n      }\r\n\r\n      return { user, error: null }\r\n    } catch (error) {\r\n      // Only log non-session-missing errors\r\n      const authError = error as AuthError\r\n      if (authError.message !== 'Auth session missing!') {\r\n        console.error('Auth error in getCurrentUser:', authError)\r\n      }\r\n      return { user: null, error: authError }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current session\r\n   */\r\n  static async getCurrentSession() {\r\n    try {\r\n      const { data: { session }, error } = await supabase.auth.getSession()\r\n\r\n      if (error) {\r\n        throw error\r\n      }\r\n\r\n      return { session, error: null }\r\n    } catch (error) {\r\n      return { session: null, error: error as AuthError }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Listen to auth state changes\r\n   */\r\n  static onAuthStateChange(callback: (event: string, session: Session | null) => void) {\r\n    return supabase.auth.onAuthStateChange(callback)\r\n  }\r\n\r\n  /**\r\n   * Check if user is authenticated\r\n   */\r\n  static async isAuthenticated(): Promise<boolean> {\r\n    const { session } = await this.getCurrentSession()\r\n    return !!session\r\n  }\r\n\r\n  /**\r\n   * Get user ID if authenticated\r\n   */\r\n  static async getUserId(): Promise<string | null> {\r\n    const { user } = await this.getCurrentUser()\r\n    const userId = user?.id || null\r\n\r\n    if (userId) {\r\n      console.log('🔐 User authenticated with ID:', userId)\r\n    } else {\r\n      console.log('❌ No authenticated user found')\r\n    }\r\n\r\n    return userId\r\n  }\r\n\r\n  /**\r\n   * Refresh session\r\n   */\r\n  static async refreshSession() {\r\n    try {\r\n      const { data, error } = await supabase.auth.refreshSession()\r\n\r\n      if (error) {\r\n        throw error\r\n      }\r\n\r\n      return { data, error: null }\r\n    } catch (error) {\r\n      return { data: null, error: error as AuthError }\r\n    }\r\n  }\r\n}\r\n\r\n// Export auth state management utilities\r\nexport const getAuthState = async (): Promise<AuthState> => {\r\n  try {\r\n    const { session } = await AuthService.getCurrentSession()\r\n    const { user } = await AuthService.getCurrentUser()\r\n\r\n    return {\r\n      user,\r\n      session,\r\n      loading: false,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    const authError = error as AuthError\r\n    // Don't treat session missing as an error state\r\n    if (authError.message === 'Auth session missing!') {\r\n      return {\r\n        user: null,\r\n        session: null,\r\n        loading: false,\r\n        error: null\r\n      }\r\n    }\r\n\r\n    return {\r\n      user: null,\r\n      session: null,\r\n      loading: false,\r\n      error: authError.message\r\n    }\r\n  }\r\n}\r\n\r\n// Helper function to handle auth errors\r\nexport const getAuthErrorMessage = (error: AuthError | null): string => {\r\n  if (!error) return ''\r\n\r\n  console.log('🔍 Processing auth error:', error.message)\r\n\r\n  switch (error.message) {\r\n    case 'Invalid login credentials':\r\n      return 'INVALID_CREDENTIALS'\r\n    case 'Email not confirmed':\r\n    case 'Email link is invalid or has expired':\r\n    case 'Signup requires a valid password':\r\n      return 'EMAIL_NOT_CONFIRMED'\r\n    case 'User already registered':\r\n      return 'An account with this email already exists. Please sign in instead.'\r\n    case 'Password should be at least 6 characters':\r\n      return 'Password must be at least 6 characters long.'\r\n    case 'Unable to validate email address: invalid format':\r\n      return 'Please enter a valid email address.'\r\n    case 'Signup is disabled':\r\n      return 'New user registration is currently disabled.'\r\n    case 'For security purposes, you can only request this once every 60 seconds':\r\n      return 'Please wait 60 seconds before requesting another verification email.'\r\n    case 'Auth session missing!':\r\n      return 'SESSION_MISSING'\r\n    default:\r\n      // Check for specific error patterns\r\n      if (error.message.toLowerCase().includes('invalid login') ||\r\n          error.message.toLowerCase().includes('invalid credentials') ||\r\n          error.message.toLowerCase().includes('wrong password') ||\r\n          error.message.toLowerCase().includes('incorrect password')) {\r\n        return 'INVALID_CREDENTIALS'\r\n      }\r\n\r\n      // Check for email confirmation related errors\r\n      if (error.message.toLowerCase().includes('confirm') ||\r\n          error.message.toLowerCase().includes('verify') ||\r\n          error.message.toLowerCase().includes('email')) {\r\n        return 'EMAIL_NOT_CONFIRMED'\r\n      }\r\n\r\n      console.log('⚠️ Unhandled auth error:', error.message)\r\n      return error.message || 'An unexpected error occurred. Please try again.'\r\n  }\r\n}\r\n","import React, { createContext, useContext, useEffect, useState, ReactNode } from 'react'\r\nimport { User, Session } from '@supabase/supabase-js'\r\nimport { AuthService, AuthState, getAuthState } from '../services/authService'\r\nimport { supabase } from '../lib/supabase'\r\n\r\ninterface AuthContextType extends AuthState {\r\n  signIn: (email: string, password: string) => Promise<{ error: string | null }>\r\n  signUp: (email: string, password: string, firstName?: string, lastName?: string) => Promise<{ error: string | null }>\r\n  signInWithProvider: (provider: 'twitter' | 'google' | 'github') => Promise<{ error: string | null }>\r\n  signOut: () => Promise<void>\r\n  resetPassword: (email: string) => Promise<{ error: string | null }>\r\n  resendVerification: (email: string) => Promise<{ error: string | null }>\r\n  updatePassword: (newPassword: string) => Promise<{ error: string | null }>\r\n  updateProfile: (updates: { email?: string; firstName?: string; lastName?: string }) => Promise<{ error: string | null }>\r\n  refreshSession: () => Promise<void>\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined)\r\n\r\ninterface AuthProviderProps {\r\n  children: ReactNode\r\n}\r\n\r\nexport const AuthProvider: React.FC<AuthProviderProps> = ({ children }) => {\r\n  const [authState, setAuthState] = useState<AuthState>({\r\n    user: null,\r\n    session: null,\r\n    loading: true,\r\n    error: null\r\n  })\r\n  const [initializing, setInitializing] = useState(true)\r\n\r\n  // Initialize auth state\r\n  useEffect(() => {\r\n    const initializeAuth = async () => {\r\n      try {\r\n        // First, try to get the current session\r\n        const { data: { session }, error: sessionError } = await supabase.auth.getSession()\r\n\r\n        if (sessionError) {\r\n          setAuthState({\r\n            user: null,\r\n            session: null,\r\n            loading: false,\r\n            error: null\r\n          })\r\n          setInitializing(false)\r\n          return\r\n        }\r\n\r\n        if (session) {\r\n          // We have a valid session, user is already in the session\r\n          setAuthState({\r\n            user: session.user,\r\n            session,\r\n            loading: false,\r\n            error: null\r\n          })\r\n          } else {\r\n          // No session found\r\n          setAuthState({\r\n            user: null,\r\n            session: null,\r\n            loading: false,\r\n            error: null\r\n          })\r\n        }\r\n\r\n        setInitializing(false)\r\n      } catch (error) {\r\n        setAuthState({\r\n          user: null,\r\n          session: null,\r\n          loading: false,\r\n          error: null\r\n        })\r\n        setInitializing(false)\r\n      }\r\n    }\r\n\r\n    initializeAuth()\r\n\r\n    // Set a fallback timeout to ensure loading doesn't hang forever\r\n    const fallbackTimer = setTimeout(() => {\r\n      setAuthState(prev => ({\r\n        ...prev,\r\n        loading: false\r\n      }))\r\n      setInitializing(false)\r\n    }, 2000) // 2 second fallback\r\n\r\n    return () => clearTimeout(fallbackTimer)\r\n  }, [])\r\n\r\n  // Listen for auth state changes\r\n  useEffect(() => {\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event, session) => {\r\n      // Don't process events during initial setup\r\n      if (initializing) {\r\n        return\r\n      }\r\n\r\n      try {\r\n        if (event === 'SIGNED_OUT') {\r\n          setAuthState({\r\n            user: null,\r\n            session: null,\r\n            loading: false,\r\n            error: null\r\n          })\r\n          return\r\n        }\r\n\r\n        if (event === 'SIGNED_IN') {\r\n          if (session) {\r\n            setAuthState({\r\n              user: session.user,\r\n              session: session,\r\n              loading: false,\r\n              error: null\r\n            })\r\n          }\r\n          return\r\n        }\r\n\r\n        if (event === 'TOKEN_REFRESHED') {\r\n          if (session) {\r\n            setAuthState(prev => ({\r\n              ...prev,\r\n              user: session.user,\r\n              session: session,\r\n              loading: false,\r\n              error: null\r\n            }))\r\n          }\r\n          return\r\n        }\r\n\r\n        if (event === 'INITIAL_SESSION') {\r\n          // This should be handled by the initialization above\r\n          return\r\n        }\r\n\r\n        // For other events, just update loading state\r\n        setAuthState(prev => ({\r\n          ...prev,\r\n          loading: false\r\n        }))\r\n\r\n      } catch (error) {\r\n        setAuthState(prev => ({\r\n          ...prev,\r\n          loading: false,\r\n          error: null\r\n        }))\r\n      }\r\n    })\r\n\r\n    return () => subscription.unsubscribe()\r\n  }, [initializing])\r\n\r\n  const signIn = async (email: string, password: string) => {\r\n    console.log('🔐 AuthContext signIn called for:', email)\r\n    setAuthState(prev => ({ ...prev, loading: true, error: null }))\r\n\r\n    try {\r\n      const { data, error } = await AuthService.signIn({ email, password })\r\n\r\n      if (error) {\r\n        console.error('❌ AuthService returned error:', error.message)\r\n        // Don't update auth state on error - keep user in current state\r\n        setAuthState(prev => ({ ...prev, loading: false }))\r\n        return { error: error.message }\r\n      }\r\n\r\n      console.log('✅ AuthService sign in successful')\r\n      // Auth state will be updated by the onAuthStateChange listener\r\n      // Don't update loading here - let the auth state change handle it\r\n      return { error: null }\r\n    } catch (error) {\r\n      console.error('❌ Unexpected error in AuthContext signIn:', error)\r\n      const errorMessage = 'An unexpected error occurred during sign in'\r\n      setAuthState(prev => ({ ...prev, loading: false }))\r\n      return { error: errorMessage }\r\n    }\r\n  }\r\n\r\n  const signUp = async (email: string, password: string, firstName?: string, lastName?: string) => {\r\n    setAuthState(prev => ({ ...prev, loading: true, error: null }))\r\n\r\n    try {\r\n      const { data, error } = await AuthService.signUp({ email, password, firstName, lastName })\r\n\r\n      if (error) {\r\n        setAuthState(prev => ({ ...prev, loading: false, error: error.message }))\r\n        return { error: error.message }\r\n      }\r\n\r\n      // For email confirmation flow, user won't be immediately signed in\r\n      setAuthState(prev => ({ ...prev, loading: false }))\r\n      return { error: null }\r\n    } catch (error) {\r\n      const errorMessage = 'An unexpected error occurred during sign up'\r\n      setAuthState(prev => ({ ...prev, loading: false, error: errorMessage }))\r\n      return { error: errorMessage }\r\n    }\r\n  }\r\n\r\n  const signInWithProvider = async (provider: 'twitter' | 'google' | 'github') => {\r\n    setAuthState(prev => ({ ...prev, loading: true, error: null }))\r\n\r\n    try {\r\n      const { data, error } = await AuthService.signInWithProvider(provider)\r\n\r\n      if (error) {\r\n        setAuthState(prev => ({ ...prev, loading: false, error: error.message }))\r\n        return { error: error.message }\r\n      }\r\n\r\n      // OAuth will redirect, so we don't need to update state here\r\n      return { error: null }\r\n    } catch (error) {\r\n      const errorMessage = `An unexpected error occurred during ${provider} sign in`\r\n      setAuthState(prev => ({ ...prev, loading: false, error: errorMessage }))\r\n      return { error: errorMessage }\r\n    }\r\n  }\r\n\r\n  const signOut = async () => {\r\n    setAuthState(prev => ({ ...prev, loading: true, error: null }))\r\n\r\n    try {\r\n      await AuthService.signOut()\r\n      // Auth state will be updated by the onAuthStateChange listener\r\n    } catch (error) {\r\n      setAuthState(prev => ({ ...prev, loading: false, error: 'Failed to sign out' }))\r\n    }\r\n  }\r\n\r\n  const resetPassword = async (email: string) => {\r\n    try {\r\n      const { data, error } = await AuthService.resetPassword(email)\r\n\r\n      if (error) {\r\n        return { error: error.message }\r\n      }\r\n\r\n      return { error: null }\r\n    } catch (error) {\r\n      return { error: 'An unexpected error occurred while resetting password' }\r\n    }\r\n  }\r\n\r\n  const resendVerification = async (email: string) => {\r\n    try {\r\n      const { data, error } = await AuthService.resendVerification(email)\r\n\r\n      if (error) {\r\n        return { error: error.message }\r\n      }\r\n\r\n      return { error: null }\r\n    } catch (error) {\r\n      return { error: 'An unexpected error occurred while resending verification email' }\r\n    }\r\n  }\r\n\r\n  const updatePassword = async (newPassword: string) => {\r\n    try {\r\n      const { data, error } = await AuthService.updatePassword(newPassword)\r\n\r\n      if (error) {\r\n        return { error: error.message }\r\n      }\r\n\r\n      return { error: null }\r\n    } catch (error) {\r\n      return { error: 'An unexpected error occurred while updating password' }\r\n    }\r\n  }\r\n\r\n  const updateProfile = async (updates: { email?: string; firstName?: string; lastName?: string }) => {\r\n    try {\r\n      const { data, error } = await AuthService.updateProfile(updates)\r\n\r\n      if (error) {\r\n        return { error: error.message }\r\n      }\r\n\r\n      // Refresh auth state to get updated user data\r\n      const state = await getAuthState()\r\n      setAuthState(state)\r\n\r\n      return { error: null }\r\n    } catch (error) {\r\n      return { error: 'An unexpected error occurred while updating profile' }\r\n    }\r\n  }\r\n\r\n  const refreshSession = async () => {\r\n    try {\r\n      await AuthService.refreshSession()\r\n      const state = await getAuthState()\r\n      setAuthState(state)\r\n    } catch (error) {\r\n      }\r\n  }\r\n\r\n  const contextValue: AuthContextType = {\r\n    ...authState,\r\n    signIn,\r\n    signUp,\r\n    signInWithProvider,\r\n    signOut,\r\n    resetPassword,\r\n    resendVerification,\r\n    updatePassword,\r\n    updateProfile,\r\n    refreshSession\r\n  }\r\n\r\n  return (\r\n    <AuthContext.Provider value={contextValue}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  )\r\n}\r\n\r\nexport const useAuth = (): AuthContextType => {\r\n  const context = useContext(AuthContext)\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider')\r\n  }\r\n  return context\r\n}\r\n\r\n// Helper hooks for common auth checks\r\nexport const useUser = (): User | null => {\r\n  const { user } = useAuth()\r\n  return user\r\n}\r\n\r\nexport const useSession = (): Session | null => {\r\n  const { session } = useAuth()\r\n  return session\r\n}\r\n\r\nexport const useIsAuthenticated = (): boolean => {\r\n  const { user, session } = useAuth()\r\n  return !!(user && session)\r\n}\r\n\r\nexport const useAuthLoading = (): boolean => {\r\n  const { loading } = useAuth()\r\n  return loading\r\n}\r\n","import React, { useEffect, useState } from 'react';\nimport { useTruePortfolio } from '../utils/TruePortfolioContext';\nimport { TruePortfolioSetup } from './TruePortfolioSetup';\nimport { WelcomeMessageModal } from './WelcomeMessageModal';\nimport { useAuth } from '../context/AuthContext';\n\nconst USER_NAME_LOCAL_KEY = 'user_name';\nconst WELCOME_COMPLETE_LOCAL_KEY = 'welcome_complete';\n\ninterface TruePortfolioSetupManagerProps {\n  userName: string;\n  setUserName: React.Dispatch<React.SetStateAction<string>>;\n}\n\nexport const TruePortfolioSetupManager: React.FC<TruePortfolioSetupManagerProps> = ({\n  userName,\n  setUserName\n}) => {\n  const { user } = useAuth();\n  const { yearlyStartingCapitals } = useTruePortfolio();\n  const [isSetupModalOpen, setIsSetupModalOpen] = useState(false);\n  const [isWelcomeModalOpen, setIsWelcomeModalOpen] = useState(false);\n  const [hasCheckedSetup, setHasCheckedSetup] = useState(false);\n  const [hasCompletedWelcome, setHasCompletedWelcome] = useState<boolean>(() => localStorage.getItem(WELCOME_COMPLETE_LOCAL_KEY) === 'true');\n\n  // Early return if user is not authenticated\n  if (!user) {\n    return null;\n  }\n\n  // Effect to load user name and welcome status on initial mount\n  useEffect(() => {\n    const storedUserName = localStorage.getItem(USER_NAME_LOCAL_KEY);\n    if (storedUserName) {\n      setUserName(storedUserName);\n    }\n    const storedWelcomeStatus = localStorage.getItem(WELCOME_COMPLETE_LOCAL_KEY);\n    if (storedWelcomeStatus === 'true') {\n      setHasCompletedWelcome(true);\n    }\n    setHasCheckedSetup(true); // Mark as checked after trying to load\n  }, [setUserName]); // Add setUserName to dependency array\n\n  // Check if initial setup is needed (yearly starting capital not set)\n  // This now runs only once after hydration\n  useEffect(() => {\n    if (hasCheckedSetup && yearlyStartingCapitals.length === 0 && !isWelcomeModalOpen) {\n      setIsSetupModalOpen(true);\n    }\n  }, [yearlyStartingCapitals, hasCheckedSetup, isWelcomeModalOpen]);\n\n  // Handles closing the initial setup modal and opening the welcome message\n  const handleSetupComplete = (name: string) => {\n    setUserName(name);\n    localStorage.setItem(USER_NAME_LOCAL_KEY, name);\n    setIsSetupModalOpen(false);\n    // Only show welcome message if it hasn't been completed before\n    if (!hasCompletedWelcome) {\n      setIsWelcomeModalOpen(true);\n      localStorage.setItem(WELCOME_COMPLETE_LOCAL_KEY, 'true');\n      setHasCompletedWelcome(true);\n    }\n  };\n\n  return (\n    <>\n      <TruePortfolioSetup\n        isOpen={isSetupModalOpen}\n        onOpenChange={setIsSetupModalOpen}\n        onSetupComplete={handleSetupComplete} // New prop for callback\n        userName={userName}\n        setUserName={setUserName}\n      />\n      <WelcomeMessageModal\n        isOpen={isWelcomeModalOpen}\n        onOpenChange={setIsWelcomeModalOpen}\n        userName={userName}\n      />\n    </>\n  );\n};\n","import React, { useState, useEffect } from 'react';\nimport {\n  Modal,\n  ModalContent,\n  ModalHeader,\n  ModalBody,\n  ModalFooter,\n  Button,\n  Input,\n  Chip\n} from \"@heroui/react\";\nimport { Icon } from \"@iconify/react\";\nimport { useTruePortfolio } from '../utils/TruePortfolioContext';\n\ninterface YearlyStartingCapitalModalProps {\n  isOpen: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport const YearlyStartingCapitalModal: React.FC<YearlyStartingCapitalModalProps> = ({\n  isOpen,\n  onOpenChange\n}) => {\n  const {\n    yearlyStartingCapitals,\n    setYearlyStartingCapital,\n    getYearlyStartingCapital\n  } = useTruePortfolio();\n\n  const [newYear, setNewYear] = useState<string>('');\n  const [newAmount, setNewAmount] = useState<string>('');\n  const [editingYear, setEditingYear] = useState<number | null>(null);\n  const [editingAmount, setEditingAmount] = useState<string>('');\n\n  // Get current year and next year for suggestions\n  const currentYear = new Date().getFullYear();\n  const nextYear = currentYear + 1;\n\n  const formatCurrency = (value: number) => {\n    return new Intl.NumberFormat('en-IN', {\n      style: 'currency',\n      currency: 'INR',\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0\n    }).format(value);\n  };\n\n  const handleAddYear = () => {\n    const year = parseInt(newYear);\n    const amount = parseFloat(newAmount);\n\n    if (isNaN(year) || isNaN(amount) || year < 2000 || year > 2100 || amount <= 0) {\n      alert('Please enter a valid year (2000-2100) and amount (> 0)');\n      return;\n    }\n\n    setYearlyStartingCapital(year, amount);\n    setNewYear('');\n    setNewAmount('');\n  };\n\n  const handleEditYear = (year: number) => {\n    setEditingYear(year);\n    setEditingAmount(getYearlyStartingCapital(year).toString());\n  };\n\n  const handleSaveEdit = () => {\n    if (editingYear === null) return;\n\n    const amount = parseFloat(editingAmount);\n    if (isNaN(amount) || amount <= 0) {\n      alert('Please enter a valid amount (> 0)');\n      return;\n    }\n\n    setYearlyStartingCapital(editingYear, amount);\n    setEditingYear(null);\n    setEditingAmount('');\n  };\n\n  const handleCancelEdit = () => {\n    setEditingYear(null);\n    setEditingAmount('');\n  };\n\n  // Sort years in descending order\n  const sortedYears = [...yearlyStartingCapitals].sort((a, b) => b.year - a.year);\n\n  return (\n    <Modal\n      isOpen={isOpen}\n      onOpenChange={onOpenChange}\n      size=\"lg\"\n      scrollBehavior=\"inside\"\n      classNames={{\n        base: \"max-w-[90vw] max-h-[85vh] sm:max-w-lg\",\n        wrapper: \"items-center justify-center p-4\",\n        body: \"overflow-y-auto p-0\",\n        backdrop: \"bg-black/50\"\n      }}\n    >\n      <ModalContent className=\"bg-background/95 backdrop-blur-xl border border-divider/50 shadow-2xl\">\n        {(onClose) => (\n          <>\n            <ModalHeader className=\"flex items-center gap-3 px-6 py-4 border-b border-divider/50 bg-gradient-to-r from-primary/5 to-secondary/5\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"p-2 rounded-lg bg-primary/10\">\n                  <Icon icon=\"lucide:calendar\" className=\"text-primary text-lg\" />\n                </div>\n                <div>\n                  <span className=\"text-lg font-semibold tracking-tight\">Yearly Starting Capital</span>\n                  <p className=\"text-xs text-default-500 font-normal mt-0.5\">\n                    Set starting capital for January of each year\n                  </p>\n                </div>\n              </div>\n            </ModalHeader>\n            <ModalBody className=\"p-6 space-y-4\">\n              <div className=\"space-y-4\">\n                {/* Add New Year */}\n                <div className=\"bg-content1/50 rounded-xl p-4 border border-divider/30\">\n                  <h3 className=\"font-semibold text-base mb-3 flex items-center gap-2\">\n                    <Icon icon=\"lucide:plus-circle\" className=\"w-4 h-4 text-primary\" />\n                    Add New Year\n                  </h3>\n                  <div className=\"grid grid-cols-1 sm:grid-cols-[120px_1fr_auto] gap-3 items-end\">\n                    <div>\n                      <Input\n                        label=\"Year\"\n                        placeholder={`${nextYear}`}\n                        value={newYear}\n                        onChange={(e) => setNewYear(e.target.value)}\n                        type=\"number\"\n                        min=\"2000\"\n                        max=\"2100\"\n                        size=\"sm\"\n                        variant=\"bordered\"\n                        className=\"w-full\"\n                        classNames={{\n                          input: \"text-center\",\n                          inputWrapper: \"min-w-[100px]\"\n                        }}\n                      />\n                    </div>\n                    <div>\n                      <Input\n                        label=\"Starting Capital\"\n                        placeholder=\"100000\"\n                        value={newAmount}\n                        onChange={(e) => setNewAmount(e.target.value)}\n                        type=\"number\"\n                        min=\"0\"\n                        step=\"1000\"\n                        size=\"sm\"\n                        variant=\"bordered\"\n                        className=\"w-full\"\n                        startContent={<span className=\"text-default-400 text-sm\">₹</span>}\n                      />\n                    </div>\n                    <div>\n                      <Button\n                        color=\"primary\"\n                        onPress={handleAddYear}\n                        isDisabled={!newYear || !newAmount}\n                        isIconOnly\n                        size=\"sm\"\n                        className=\"w-10 h-10 rounded-lg\"\n                        aria-label=\"Add new year\"\n                      >\n                        <Icon icon=\"lucide:plus\" className=\"w-4 h-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Existing Years */}\n                <div className=\"bg-content1/50 rounded-xl p-4 border border-divider/30\">\n                  <h3 className=\"font-semibold text-base mb-3 flex items-center gap-2\">\n                    <Icon icon=\"lucide:calendar-check\" className=\"w-4 h-4 text-success\" />\n                    Existing Years\n                  </h3>\n                  {sortedYears.length === 0 ? (\n                    <div className=\"text-center py-6 text-default-500\">\n                      <Icon icon=\"lucide:calendar-x\" className=\"text-2xl mb-2 mx-auto opacity-50\" />\n                      <p className=\"text-sm\">No yearly capitals set</p>\n                      <p className=\"text-xs opacity-70\">Add your first year above</p>\n                    </div>\n                  ) : (\n                      <div className=\"space-y-2\">\n                        {sortedYears.map((yearData) => (\n                          <div\n                            key={yearData.year}\n                            className=\"flex items-center justify-between p-4 border border-divider/50 rounded-lg bg-background/50 hover:bg-content1/30 transition-colors\"\n                          >\n                            <div className=\"flex items-center gap-4 flex-1\">\n                              <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${\n                                yearData.year === currentYear\n                                  ? 'bg-primary/10 text-primary'\n                                  : 'bg-success/10 text-success'\n                              }`}>\n                                <Icon icon=\"lucide:calendar\" className=\"w-5 h-5\" />\n                              </div>\n                              <div className=\"flex-1\">\n                                <div className=\"flex items-center gap-2 mb-1\">\n                                  <span className=\"font-semibold text-base\">{yearData.year}</span>\n                                  {yearData.year === currentYear && (\n                                    <Chip size=\"sm\" color=\"primary\" variant=\"flat\" className=\"text-xs\">\n                                      Current\n                                    </Chip>\n                                  )}\n                                </div>\n                                <p className=\"text-xs text-default-500\">\n                                  Updated: {new Date(yearData.updatedAt).toLocaleDateString()}\n                                </p>\n                              </div>\n                              <div className=\"text-right\">\n                                {editingYear === yearData.year ? (\n                                  <Input\n                                    value={editingAmount}\n                                    onChange={(e) => setEditingAmount(e.target.value)}\n                                    type=\"number\"\n                                    min=\"0\"\n                                    step=\"1000\"\n                                    className=\"w-36\"\n                                    size=\"sm\"\n                                    variant=\"bordered\"\n                                    startContent={<span className=\"text-default-400 text-sm\">₹</span>}\n                                  />\n                                ) : (\n                                  <div>\n                                    <span className=\"font-bold text-base text-success-600\">\n                                      ₹{yearData.startingCapital.toLocaleString()}\n                                    </span>\n                                    <p className=\"text-xs text-default-500\">Starting Capital</p>\n                                  </div>\n                                )}\n                              </div>\n                            </div>\n                            <div className=\"flex items-center gap-1\">\n                              {editingYear === yearData.year ? (\n                                <>\n                                  <Button\n                                    size=\"sm\"\n                                    color=\"success\"\n                                    variant=\"flat\"\n                                    onPress={handleSaveEdit}\n                                    isIconOnly\n                                    className=\"min-w-8 w-8 h-8\"\n                                  >\n                                    <Icon icon=\"lucide:check\" className=\"w-3 h-3\" />\n                                  </Button>\n                                  <Button\n                                    size=\"sm\"\n                                    color=\"danger\"\n                                    variant=\"flat\"\n                                    onPress={handleCancelEdit}\n                                    isIconOnly\n                                    className=\"min-w-8 w-8 h-8\"\n                                  >\n                                    <Icon icon=\"lucide:x\" className=\"w-3 h-3\" />\n                                  </Button>\n                                </>\n                              ) : (\n                                <Button\n                                  size=\"sm\"\n                                  variant=\"flat\"\n                                  onPress={() => handleEditYear(yearData.year)}\n                                  isIconOnly\n                                  className=\"min-w-8 w-8 h-8\"\n                                >\n                                  <Icon icon=\"lucide:edit\" className=\"w-3 h-3\" />\n                                </Button>\n                              )}\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                </div>\n              </div>\n            </ModalBody>\n            <ModalFooter className=\"flex-shrink-0 border-t border-divider/50 px-6 py-3 bg-gradient-to-r from-background/50 to-content1/30\">\n              <Button\n                variant=\"flat\"\n                onPress={onClose}\n                size=\"sm\"\n                className=\"w-full sm:w-auto min-w-20\"\n                startContent={<Icon icon=\"lucide:x\" className=\"w-3 h-3\" />}\n              >\n                Close\n              </Button>\n            </ModalFooter>\n          </>\n        )}\n      </ModalContent>\n    </Modal>\n  );\n};\n","import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\r\n\r\nexport type AccountingMethod = 'accrual' | 'cash';\r\n\r\ninterface AccountingMethodContextType {\r\n  accountingMethod: AccountingMethod;\r\n  setAccountingMethod: (method: AccountingMethod) => void;\r\n  toggleAccountingMethod: () => void;\r\n  clearAccountingMethodData: () => void;\r\n}\r\n\r\nconst AccountingMethodContext = createContext<AccountingMethodContextType | undefined>(undefined);\r\n\r\ninterface AccountingMethodProviderProps {\r\n  children: ReactNode;\r\n}\r\n\r\nexport const AccountingMethodProvider: React.FC<AccountingMethodProviderProps> = ({ children }) => {\r\n  const [accountingMethod, setAccountingMethodState] = useState<AccountingMethod>('cash');\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  // Load accounting method from localStorage on mount\r\n  useEffect(() => {\r\n    try {\r\n      const stored = localStorage.getItem('accountingMethod');\r\n      if (stored && (stored === 'accrual' || stored === 'cash')) {\r\n        setAccountingMethodState(stored as AccountingMethod);\r\n      } else {\r\n        // If no stored preference, default to cash basis and save it\r\n        setAccountingMethodState('cash');\r\n        localStorage.setItem('accountingMethod', 'cash');\r\n      }\r\n    } catch (error) {\r\n      // Even if localStorage fails, ensure we default to cash basis\r\n      setAccountingMethodState('cash');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  // Memoized setter to prevent unnecessary re-renders\r\n  const setAccountingMethod = React.useCallback((method: AccountingMethod) => {\r\n    if (method === accountingMethod) return; // Prevent unnecessary updates\r\n\r\n    // Immediate state update for responsive UI\r\n    setAccountingMethodState(method);\r\n\r\n    // Async localStorage update to prevent blocking\r\n    requestIdleCallback(() => {\r\n      try {\r\n        localStorage.setItem('accountingMethod', method);\r\n      } catch (error) {\r\n        }\r\n    });\r\n  }, [accountingMethod]);\r\n\r\n  const toggleAccountingMethod = React.useCallback(() => {\r\n    const newMethod = accountingMethod === 'accrual' ? 'cash' : 'accrual';\r\n    setAccountingMethod(newMethod);\r\n  }, [accountingMethod, setAccountingMethod]);\r\n\r\n  const clearAccountingMethodData = React.useCallback(() => {\r\n    try {\r\n      localStorage.removeItem('accountingMethod');\r\n      setAccountingMethodState('cash'); // Reset to default\r\n      } catch (error) {\r\n      }\r\n  }, []);\r\n\r\n  // Memoize the context value to prevent unnecessary re-renders\r\n  const contextValue = React.useMemo(() => ({\r\n    accountingMethod,\r\n    setAccountingMethod,\r\n    toggleAccountingMethod,\r\n    clearAccountingMethodData\r\n  }), [accountingMethod, setAccountingMethod, toggleAccountingMethod, clearAccountingMethodData]);\r\n\r\n  // Always render children to prevent hook count mismatches\r\n  return (\r\n    <AccountingMethodContext.Provider value={contextValue}>\r\n      {children}\r\n    </AccountingMethodContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useAccountingMethod = (): AccountingMethodContextType => {\r\n  const context = useContext(AccountingMethodContext);\r\n  if (!context) {\r\n    throw new Error('useAccountingMethod must be used within an AccountingMethodProvider');\r\n  }\r\n  return context;\r\n};\r\n","import { useMemo } from 'react';\r\nimport { useTruePortfolio } from '../utils/TruePortfolioContext';\r\nimport { useAccountingMethod } from '../context/AccountingMethodContext';\r\n\r\n/**\r\n * Hook that provides true portfolio functionality with trades integration\r\n * This hook should be used by components that need portfolio size calculations\r\n */\r\nexport const useTruePortfolioWithTrades = (trades: any[] = []) => {\r\n  const truePortfolioContext = useTruePortfolio();\r\n  const { accountingMethod } = useAccountingMethod();\r\n  const useCashBasis = accountingMethod === 'cash';\r\n\r\n  // Memoize functions that depend on trades and accounting method\r\n  const getTruePortfolioSize = useMemo(() => {\r\n    return (month: string, year: number) => {\r\n      return truePortfolioContext.getTruePortfolioSize(month, year, trades, useCashBasis);\r\n    };\r\n  }, [truePortfolioContext.getTruePortfolioSize, trades, useCashBasis]);\r\n\r\n  const getLatestTruePortfolioSize = useMemo(() => {\r\n    return () => {\r\n      return truePortfolioContext.getLatestTruePortfolioSize(trades, useCashBasis);\r\n    };\r\n  }, [truePortfolioContext.getLatestTruePortfolioSize, trades, useCashBasis]);\r\n\r\n  const getMonthlyTruePortfolio = useMemo(() => {\r\n    return (month: string, year: number) => {\r\n      return truePortfolioContext.getMonthlyTruePortfolio(month, year, trades, useCashBasis);\r\n    };\r\n  }, [truePortfolioContext.getMonthlyTruePortfolio, trades, useCashBasis]);\r\n\r\n  const getAllMonthlyTruePortfolios = useMemo(() => {\r\n    return () => {\r\n      return truePortfolioContext.getAllMonthlyTruePortfolios(trades, useCashBasis);\r\n    };\r\n  }, [truePortfolioContext.getAllMonthlyTruePortfolios, trades, useCashBasis]);\r\n\r\n  // Current portfolio size for backward compatibility\r\n  const portfolioSize = useMemo(() => {\r\n    return getLatestTruePortfolioSize();\r\n  }, [getLatestTruePortfolioSize]);\r\n\r\n  return {\r\n    // Core functions with trades integration\r\n    getTruePortfolioSize,\r\n    getLatestTruePortfolioSize,\r\n    getMonthlyTruePortfolio,\r\n    getAllMonthlyTruePortfolios,\r\n\r\n    // Backward compatibility\r\n    portfolioSize,\r\n    getPortfolioSize: getTruePortfolioSize, // Alias for backward compatibility\r\n\r\n    // Pass through other functions that don't need trades\r\n    yearlyStartingCapitals: truePortfolioContext.yearlyStartingCapitals,\r\n    setYearlyStartingCapital: truePortfolioContext.setYearlyStartingCapital,\r\n    getYearlyStartingCapital: truePortfolioContext.getYearlyStartingCapital,\r\n    monthlyStartingCapitalOverrides: truePortfolioContext.monthlyStartingCapitalOverrides,\r\n    setMonthlyStartingCapitalOverride: truePortfolioContext.setMonthlyStartingCapitalOverride,\r\n    removeMonthlyStartingCapitalOverride: truePortfolioContext.removeMonthlyStartingCapitalOverride,\r\n    getMonthlyStartingCapitalOverride: truePortfolioContext.getMonthlyStartingCapitalOverride,\r\n    capitalChanges: truePortfolioContext.capitalChanges,\r\n    addCapitalChange: truePortfolioContext.addCapitalChange,\r\n    updateCapitalChange: truePortfolioContext.updateCapitalChange,\r\n    deleteCapitalChange: truePortfolioContext.deleteCapitalChange,\r\n  };\r\n};\r\n","import React, { createContext, useContext, useState, useMemo } from \"react\";\r\n\r\nexport type FilterType = \"all\" | \"week\" | \"month\" | \"fy\" | \"cy\" | \"custom\";\r\nexport interface GlobalFilter {\r\n  type: FilterType;\r\n  startDate?: Date;\r\n  endDate?: Date;\r\n  year?: number;\r\n  month?: number; // 0-11\r\n  fyStartYear?: number;\r\n}\r\n\r\nconst defaultFilter: GlobalFilter = { type: \"all\" };\r\n\r\n// localStorage helpers for global filter\r\nfunction loadGlobalFilterFromLocalStorage(): GlobalFilter {\r\n  if (typeof window === 'undefined') {\r\n    return defaultFilter;\r\n  }\r\n  try {\r\n    const stored = localStorage.getItem('globalFilter');\r\n    if (stored) {\r\n      const parsedFilter: GlobalFilter = JSON.parse(stored);\r\n      // Convert date strings back to Date objects\r\n      if (parsedFilter.startDate) {\r\n        parsedFilter.startDate = new Date(parsedFilter.startDate);\r\n      }\r\n      if (parsedFilter.endDate) {\r\n        parsedFilter.endDate = new Date(parsedFilter.endDate);\r\n      }\r\n      return parsedFilter;\r\n    }\r\n    return defaultFilter;\r\n  } catch (error) {\r\n    return defaultFilter;\r\n  }\r\n}\r\n\r\nfunction saveGlobalFilterToLocalStorage(filterObj: GlobalFilter) {\r\n  if (typeof window === 'undefined') {\r\n    return;\r\n  }\r\n  try {\r\n    // Create a mutable copy to modify before saving\r\n    const filterToSave = { ...filterObj };\r\n\r\n    // If the filter type is 'all', ensure startDate and endDate are not persisted\r\n    if (filterToSave.type === 'all') {\r\n      delete filterToSave.startDate;\r\n      delete filterToSave.endDate;\r\n    }\r\n\r\n    localStorage.setItem('globalFilter', JSON.stringify(filterToSave));\r\n  } catch (error) {\r\n    }\r\n}\r\n\r\nconst GlobalFilterContext = createContext<{\r\n  filter: GlobalFilter;\r\n  setFilter: React.Dispatch<React.SetStateAction<GlobalFilter>>;\r\n}>({\r\n  filter: defaultFilter,\r\n  setFilter: () => {},\r\n});\r\n\r\nexport const GlobalFilterProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  // Initialize state directly from localStorage\r\n  const [filter, setFilter] = useState<GlobalFilter>(loadGlobalFilterFromLocalStorage);\r\n\r\n  // Effect to save filter to localStorage whenever it changes\r\n  React.useEffect(() => {\r\n    // Only save if the filter is different from the default, to avoid saving empty state\r\n    // A more robust check for default filter state\r\n    const isEffectivelyDefault = filter.type === defaultFilter.type && !filter.startDate && !filter.endDate;\r\n\r\n    if (!isEffectivelyDefault) { // Save if it's not the default filter\r\n      saveGlobalFilterToLocalStorage(filter);\r\n    } else { // If it is effectively default, ensure it's cleared from localStorage\r\n      if (localStorage.getItem('globalFilter')) {\r\n        localStorage.removeItem('globalFilter');\r\n      }\r\n    }\r\n  }, [filter]);\r\n\r\n  // Memoize the context value to prevent unnecessary re-renders\r\n  const contextValue = useMemo(() => ({\r\n    filter,\r\n    setFilter\r\n  }), [filter]); // Remove setFilter from dependencies as it's stable\r\n\r\n  return (\r\n    <GlobalFilterContext.Provider value={contextValue}>\r\n      {children}\r\n    </GlobalFilterContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useGlobalFilter = () => useContext(GlobalFilterContext);","import { GlobalFilter } from \"../context/GlobalFilterContext\";\nimport { Trade } from \"../types/trade\";\nimport { getTradeDateForAccounting } from \"./accountingUtils\";\n\nexport function isInGlobalFilter(dateStr: string, filter: GlobalFilter): boolean {\n  const d = new Date(dateStr);\n  const now = new Date();\n  switch (filter.type) {\n    case \"all\":\n      return true;\n    case \"week\": {\n      const weekAgo = new Date(now);\n      weekAgo.setDate(now.getDate() - 7);\n      return d >= weekAgo && d <= now;\n    }\n    case \"month\": {\n      return d.getMonth() === (filter.month ?? now.getMonth()) && d.getFullYear() === (filter.year ?? now.getFullYear());\n    }\n    case \"fy\": {\n      // FY: 1 April to 31 March next year\n      let fyStartYear = filter.fyStartYear;\n      if (fyStartYear === undefined) {\n        // If not provided, infer from today\n        fyStartYear = now.getMonth() >= 3 ? now.getFullYear() : now.getFullYear() - 1;\n      }\n      const fyStart = new Date(fyStartYear, 3, 1); // 1 April\n      const fyEnd = new Date(fyStartYear + 1, 2, 31, 23, 59, 59, 999); // 31 March next year\n      return d >= fyStart && d <= fyEnd;\n    }\n    case \"cy\": {\n      // CY: 1 Jan to 31 Dec\n      const cyYear = filter.year ?? now.getFullYear();\n      const cyStart = new Date(cyYear, 0, 1);\n      const cyEnd = new Date(cyYear, 11, 31, 23, 59, 59, 999);\n      return d >= cyStart && d <= cyEnd;\n    }\n    case \"custom\": {\n      if (!filter.startDate || !filter.endDate) return true;\n      return d >= filter.startDate && d <= filter.endDate;\n    }\n    default:\n      return true;\n  }\n}\n\n/**\n * Accounting-aware trade filtering function\n * Uses the appropriate date based on accounting method\n */\nexport function isTradeInGlobalFilter(trade: Trade, filter: GlobalFilter, useCashBasis: boolean = false): boolean {\n  const relevantDate = getTradeDateForAccounting(trade, useCashBasis);\n  return isInGlobalFilter(relevantDate, filter);\n}","// Trade calculation utilities\r\n\r\nexport function calcAvgEntry(entries: { price: number, qty: number }[]) {\r\n  const totalQty = entries.reduce((sum, e) => sum + e.qty, 0);\r\n  const totalValue = entries.reduce((sum, e) => sum + e.price * e.qty, 0);\r\n  return totalQty ? totalValue / totalQty : 0;\r\n}\r\n\r\nexport function calcPositionSize(avgEntry: number, totalQty: number) {\r\n  return Math.round(avgEntry * totalQty);\r\n}\r\n\r\nexport function calcAllocation(positionSize: number, portfolioSize: number) {\r\n  return portfolioSize ? (positionSize / portfolioSize) * 100 : 0;\r\n}\r\n\r\nexport function calcSLPercent(sl: number, entry: number): number {\r\n  if (!entry || !sl) return 0;\r\n  return Math.abs(((entry - sl) / entry) * 100);\r\n}\r\n\r\nexport function calcOpenQty(initialQty: number, p1Qty: number, p2Qty: number, exitedQty: number) {\r\n  return initialQty + p1Qty + p2Qty - exitedQty;\r\n}\r\n\r\nexport function calcExitedQty(...exitQtys: number[]) {\r\n  return exitQtys.reduce((sum, qty) => sum + qty, 0);\r\n}\r\n\r\nexport function calcAvgExitPrice(exits: { price: number, qty: number }[]) {\r\n  const totalQty = exits.reduce((sum, e) => sum + e.qty, 0);\r\n  const totalValue = exits.reduce((sum, e) => sum + e.price * e.qty, 0);\r\n  return totalQty ? totalValue / totalQty : 0;\r\n}\r\n\r\nexport function calcStockMove(\r\n  avgEntry: number,\r\n  avgExit: number,\r\n  cmp: number,\r\n  openQty: number,\r\n  exitedQty: number,\r\n  positionStatus: 'Open' | 'Closed' | 'Partial',\r\n  buySell: 'Buy' | 'Sell' = 'Buy'\r\n): number {\r\n  // Edge case handling\r\n  if (!avgEntry || avgEntry <= 0) return 0;\r\n  if (typeof openQty !== 'number' || typeof exitedQty !== 'number') return 0;\r\n  if (openQty < 0 || exitedQty < 0) return 0; // Handle negative quantities\r\n\r\n  const totalQty = openQty + exitedQty;\r\n  if (totalQty === 0) return 0;\r\n\r\n  // Validate position status\r\n  if (!['Open', 'Closed', 'Partial'].includes(positionStatus)) return 0;\r\n\r\n  let movePercentage = 0;\r\n\r\n  if (positionStatus === 'Open') {\r\n    // For open positions, use CMP for the entire position\r\n    if (!cmp || cmp <= 0) return 0; // Enhanced edge case handling\r\n    movePercentage = ((cmp - avgEntry) / avgEntry) * 100;\r\n  } else if (positionStatus === 'Closed') {\r\n    // For closed positions, use actual exit prices\r\n    if (!avgExit || avgExit <= 0) return 0; // Enhanced edge case handling\r\n    movePercentage = ((avgExit - avgEntry) / avgEntry) * 100;\r\n  } else if (positionStatus === 'Partial') {\r\n    // For partial positions, calculate weighted average of realized and unrealized moves\r\n    if (!cmp || cmp <= 0 || !avgExit || avgExit <= 0) return 0; // Enhanced edge case handling\r\n\r\n    const realizedMove = ((avgExit - avgEntry) / avgEntry) * 100;\r\n    const unrealizedMove = ((cmp - avgEntry) / avgEntry) * 100;\r\n\r\n    // Calculate weighted average based on quantities\r\n    movePercentage = (\r\n      (realizedMove * exitedQty + unrealizedMove * openQty) / totalQty\r\n    );\r\n  }\r\n\r\n  // Invert the percentage for Sell trades\r\n  return buySell === 'Sell' ? -movePercentage : movePercentage;\r\n}\r\n\r\nexport function calcRewardRisk(\r\n  target: number,\r\n  entry: number,\r\n  sl: number,\r\n  positionStatus: 'Open' | 'Closed' | 'Partial',\r\n  avgExit: number = 0,\r\n  openQty: number = 0,\r\n  exitedQty: number = 0,\r\n  buySell: 'Buy' | 'Sell' = 'Buy'\r\n): number {\r\n  if (!entry || !sl) return 0;\r\n\r\n  const totalQty = openQty + exitedQty;\r\n  if (totalQty === 0) return 0;\r\n\r\n  // Calculate risk (always positive)\r\n  const risk = Math.abs(entry - sl);\r\n  if (risk === 0) return 0;\r\n\r\n  let reward = 0;\r\n\r\n  if (positionStatus === 'Open') {\r\n    // For open positions, use target price for potential reward\r\n    reward = buySell === 'Buy' ? target - entry : entry - target;\r\n  } else if (positionStatus === 'Closed') {\r\n    // For closed positions, use actual average exit price\r\n    reward = buySell === 'Buy' ? avgExit - entry : entry - avgExit;\r\n  } else if (positionStatus === 'Partial') {\r\n    // For partial positions, calculate weighted average of realized and potential reward\r\n    const realizedReward = buySell === 'Buy' ? avgExit - entry : entry - avgExit;\r\n    const potentialReward = buySell === 'Buy' ? target - entry : entry - target;\r\n\r\n    reward = (realizedReward * exitedQty + potentialReward * openQty) / totalQty;\r\n  }\r\n\r\n  // Return absolute R:R ratio\r\n  return Math.abs(reward / risk);\r\n}\r\n\r\ninterface TradeLeg {\r\n  entryDate: string;\r\n  exitDate?: string | null;\r\n  quantity: number;\r\n}\r\n\r\n/**\r\n * Calculate weighted average holding days for a trade with multiple entries and exits\r\n * @param trades - Array of trade legs with entryDate, exitDate, and quantity\r\n * @returns Weighted average holding days across all legs\r\n */\r\nfunction calculateWeightedHoldingDays(trades: TradeLeg[]): number {\r\n  if (!trades.length) return 0;\r\n\r\n  let totalDays = 0;\r\n  let totalQuantity = 0;\r\n\r\n  for (const trade of trades) {\r\n    if (!trade.entryDate) continue;\r\n\r\n    const entryDate = new Date(trade.entryDate);\r\n    if (isNaN(entryDate.getTime())) continue;\r\n\r\n    const exitDate = trade.exitDate ? new Date(trade.exitDate) : new Date();\r\n    if (trade.exitDate && isNaN(exitDate.getTime())) continue;\r\n\r\n    // Normalize dates to start of day\r\n    entryDate.setHours(0, 0, 0, 0);\r\n    exitDate.setHours(0, 0, 0, 0);\r\n\r\n    const daysHeld = Math.max(1, Math.ceil((exitDate.getTime() - entryDate.getTime()) / (1000 * 60 * 60 * 24)));\r\n    totalDays += daysHeld * trade.quantity;\r\n    totalQuantity += trade.quantity;\r\n  }\r\n\r\n  return totalQuantity > 0 ? Math.round(totalDays / totalQuantity) : 0;\r\n}\r\n\r\n/**\r\n * Calculate holding days between entry and exit dates, supporting multiple entries and exits\r\n * @param entryDate - Initial entry date in ISO format (YYYY-MM-DD)\r\n * @param exitDate - Final exit date in ISO format (YYYY-MM-DD) or null/undefined for open positions\r\n * @param pyramidDates - Array of additional entry dates (P1, P2, etc.) with quantities\r\n * @param exitDates - Array of exit dates (E1, E2, etc.) with quantities\r\n * @returns Weighted average holding days across all positions\r\n */\r\nexport function calcHoldingDays(\r\n  entryDate: string,\r\n  exitDate?: string | null,\r\n  pyramidDates: {date: string, qty: number}[] = [],\r\n  exitDates: {date: string, qty: number}[] = []\r\n): number {\r\n  try {\r\n    if (!entryDate) return 0;\r\n\r\n    // Create trade legs for initial entry\r\n    const tradeLegs: TradeLeg[] = [];\r\n\r\n    // Add initial entry\r\n    tradeLegs.push({\r\n      entryDate,\r\n      exitDate: exitDate || null,\r\n      quantity: 1 // Base quantity, will be adjusted by pyramid entries\r\n    });\r\n\r\n    // Add pyramid entries\r\n    for (const p of pyramidDates) {\r\n      if (!p.date) continue;\r\n      tradeLegs.push({\r\n        entryDate: p.date,\r\n        exitDate: exitDate || null,\r\n        quantity: p.qty || 1\r\n      });\r\n    }\r\n\r\n    // If we have exit dates, distribute them across the trade legs\r\n    if (exitDates.length > 0) {\r\n      // Sort exits by date to process first exit first\r\n      const sortedExits = [...exitDates].sort((a, b) =>\r\n        new Date(a.date).getTime() - new Date(b.date).getTime()\r\n      );\r\n\r\n      // Distribute exits to trade legs (FIFO - First In First Out)\r\n      let remainingExits = [...sortedExits];\r\n\r\n      for (const leg of tradeLegs) {\r\n        if (remainingExits.length === 0) break;\r\n\r\n        const exit = remainingExits[0];\r\n        leg.exitDate = exit.date;\r\n\r\n        // Reduce the exit quantity from this leg's quantity\r\n        const exitQty = Math.min(leg.quantity, exit.qty);\r\n        exit.qty -= exitQty;\r\n\r\n        // If this exit is fully used, remove it\r\n        if (exit.qty <= 0) {\r\n          remainingExits.shift();\r\n        }\r\n      }\r\n    }\r\n\r\n    return calculateWeightedHoldingDays(tradeLegs);\r\n  } catch (error) {\r\n    return 0;\r\n  }\r\n}\r\n\r\nexport function calcRealisedAmount(exitedQty: number, avgExit: number) {\r\n  return exitedQty * avgExit;\r\n}\r\n\r\nexport function calcPLRs(realisedAmount: number, positionSize: number) {\r\n  return realisedAmount - positionSize;\r\n}\r\n\r\nexport function calcPFImpact(plRs: number, portfolioValue: number) {\r\n  return portfolioValue ? (plRs / portfolioValue) * 100 : 0;\r\n}\r\n\r\nexport function calcCummPf(pfImpacts: number[]) {\r\n  return pfImpacts.reduce((sum, pf) => sum + pf, 0);\r\n}\r\n\r\nexport function calcOpenHeat(\r\n  trades: any[],\r\n  portfolioSize: number, // Keep for backward compatibility or default\r\n  getPortfolioSize?: (month: string, year: number) => number // Pass the getPortfolioSize function\r\n) {\r\n  if (!trades || trades.length === 0) {\r\n    return 0;\r\n  }\r\n\r\n  // Sum the individual Open Heat for each open/partial trade\r\n  const totalOpenHeatValue = trades\r\n    .filter(t => t.positionStatus === 'Open' || t.positionStatus === 'Partial')\r\n    .reduce((sum, trade) => {\r\n      // Use the existing calcTradeOpenHeat logic which correctly uses the date-specific portfolio size\r\n      const tradeHeat = calcTradeOpenHeat(trade, portfolioSize, getPortfolioSize);\r\n      return sum + tradeHeat;\r\n    }, 0);\r\n\r\n  return totalOpenHeatValue;\r\n}\r\n\r\n// Utility to calculate open heat for a single trade\r\nexport function calcTradeOpenHeat(trade, defaultPortfolioSize, getPortfolioSize) {\r\n  // Get the trade date and extract month/year\r\n  const tradeDate = new Date(trade.date);\r\n  const month = tradeDate.toLocaleString('default', { month: 'short' });\r\n  const year = tradeDate.getFullYear();\r\n\r\n  // Get the portfolio size for the specific month/year of the trade\r\n  const monthlyPortfolioSize = getPortfolioSize ? getPortfolioSize(month, year) : undefined;\r\n  const effectivePortfolioSize = monthlyPortfolioSize !== undefined ? monthlyPortfolioSize : defaultPortfolioSize;\r\n\r\n  const entryPrice = trade.avgEntry || trade.entry || 0;\r\n  const sl = trade.sl || 0;\r\n  const tsl = trade.tsl || 0;\r\n  const qty = trade.openQty || 0;\r\n  let stop = 0;\r\n  if (tsl > 0 && sl > 0) {\r\n    stop = tsl; // Both entered, use TSL\r\n  } else if (tsl > 0) {\r\n    stop = tsl; // Only TSL entered\r\n  } else if (sl > 0) {\r\n    stop = sl; // Only SL entered\r\n  } else {\r\n    stop = 0; // Neither entered\r\n  }\r\n\r\n  if (!entryPrice || !stop || !qty) {\r\n    return 0;\r\n  }\r\n\r\n  // For Buy trades, stop should be below entry price\r\n  // For Sell trades, stop should be above entry price\r\n  const buySell = trade.buySell || 'Buy';\r\n  let risk = 0;\r\n\r\n  if (buySell === 'Buy') {\r\n    if (stop >= entryPrice) {\r\n      return 0; // Invalid: stop loss should be below entry for Buy trades\r\n    }\r\n    risk = (entryPrice - stop) * qty;\r\n  } else {\r\n    if (stop <= entryPrice) {\r\n      return 0; // Invalid: stop loss should be above entry for Sell trades\r\n    }\r\n    risk = (stop - entryPrice) * qty;\r\n  }\r\n\r\n  const heat = effectivePortfolioSize > 0 ? (Math.max(0, risk) / effectivePortfolioSize) * 100 : 0;\r\n  return heat;\r\n}\r\n\r\n// XIRR calculation helper functions\r\nfunction daysToYears(days: number): number {\r\n  return days / 365;\r\n}\r\n\r\nfunction calculateNPV(rate: number, dates: Date[], cashFlows: number[]): number {\r\n  return cashFlows.reduce((npv, cashFlow, i) => {\r\n    const yearFraction = daysToYears((dates[i].getTime() - dates[0].getTime()) / (1000 * 60 * 60 * 24));\r\n    return npv + cashFlow / Math.pow(1 + rate, yearFraction);\r\n  }, 0);\r\n}\r\n\r\nfunction calculateXIRR(dates: Date[], cashFlows: number[], guess = 0.1): number {\r\n  const EPSILON = 0.0000001;\r\n  const MAX_ITERATIONS = 100;\r\n\r\n  // Check if we have valid inputs\r\n  if (dates.length !== cashFlows.length || dates.length < 2) {\r\n    return 0;\r\n  }\r\n\r\n  // Verify that we have at least one positive and one negative cash flow\r\n  const hasPositive = cashFlows.some(cf => cf > 0);\r\n  const hasNegative = cashFlows.some(cf => cf < 0);\r\n  if (!hasPositive || !hasNegative) {\r\n    return 0;\r\n  }\r\n\r\n  let rate = guess;\r\n\r\n  // Newton's method implementation\r\n  for (let i = 0; i < MAX_ITERATIONS; i++) {\r\n    const npv = calculateNPV(rate, dates, cashFlows);\r\n\r\n    if (Math.abs(npv) < EPSILON) {\r\n      return rate;\r\n    }\r\n\r\n    // Calculate derivative of NPV\r\n    const derivative = cashFlows.reduce((sum, cashFlow, j) => {\r\n      const yearFraction = daysToYears((dates[j].getTime() - dates[0].getTime()) / (1000 * 60 * 60 * 24));\r\n      return sum - yearFraction * cashFlow / Math.pow(1 + rate, yearFraction + 1);\r\n    }, 0);\r\n\r\n    // Update rate using Newton's method\r\n    const newRate = rate - npv / derivative;\r\n\r\n    if (Math.abs(newRate - rate) < EPSILON) {\r\n      return newRate;\r\n    }\r\n\r\n    rate = newRate;\r\n  }\r\n\r\n  return rate;\r\n}\r\n\r\nexport function calcXIRR(\r\n  startDate: Date,\r\n  startingCapital: number,\r\n  endDate: Date,\r\n  endingCapital: number,\r\n  capitalChanges: { date: Date; amount: number }[]\r\n): number {\r\n  // Sort all cash flows by date\r\n  const allFlows = [\r\n    { date: startDate, amount: -startingCapital }, // Initial investment is negative\r\n    ...capitalChanges,\r\n    { date: endDate, amount: endingCapital } // Final value is positive\r\n  ].sort((a, b) => a.date.getTime() - b.date.getTime());\r\n\r\n  const dates = allFlows.map(flow => flow.date);\r\n  const cashFlows = allFlows.map(flow => flow.amount);\r\n\r\n  return calculateXIRR(dates, cashFlows) * 100; // Convert to percentage\r\n}\r\n\r\n/**\r\n * Calculate unrealized P/L for the open quantity of a trade\r\n * @param avgEntry - average entry price\r\n * @param cmp - current market price\r\n * @param openQty - open quantity\r\n * @param buySell - 'Buy' or 'Sell'\r\n * @returns Unrealized P/L for the open quantity\r\n */\r\nexport function calcUnrealizedPL(avgEntry: number, cmp: number, openQty: number, buySell: 'Buy' | 'Sell'): number {\r\n  if (!openQty || !avgEntry || !cmp) return 0;\r\n  if (buySell === 'Buy') {\r\n    return (cmp - avgEntry) * openQty;\r\n  } else {\r\n    return (avgEntry - cmp) * openQty;\r\n  }\r\n}\r\n\r\n/**\r\n * Calculate realized P/L using FIFO logic for multiple entries and exits.\r\n * @param entries - Array of { price, qty } for each entry lot (in order)\r\n * @param exits - Array of { price, qty } for each exit lot (in order)\r\n * @param buySell - 'Buy' or 'Sell'\r\n * @returns Realized P/L for all exited quantity using FIFO\r\n */\r\nexport function calcRealizedPL_FIFO(\r\n  entries: { price: number, qty: number }[],\r\n  exits: { price: number, qty: number }[],\r\n  buySell: 'Buy' | 'Sell'\r\n): number {\r\n  let entryLots = entries.map(e => ({ ...e })); // clone to avoid mutation\r\n  let totalPL = 0;\r\n  for (const exit of exits) {\r\n    let remainingExitQty = exit.qty;\r\n    while (remainingExitQty > 0 && entryLots.length > 0) {\r\n      const lot = entryLots[0];\r\n      const qtyToUse = Math.min(lot.qty, remainingExitQty);\r\n      if (buySell === 'Buy') {\r\n        totalPL += qtyToUse * (exit.price - lot.price);\r\n      } else {\r\n        totalPL += qtyToUse * (lot.price - exit.price);\r\n      }\r\n      lot.qty -= qtyToUse;\r\n      remainingExitQty -= qtyToUse;\r\n      if (lot.qty === 0) entryLots.shift();\r\n    }\r\n  }\r\n  return totalPL;\r\n}\r\n\r\ninterface EntryMove {\r\n  entryPrice: number;\r\n  qty: number;\r\n  movePercent: number;\r\n  description: string;\r\n}\r\n\r\n  export function calcIndividualMoves(\r\n  entries: { price: number; qty: number; description?: string }[],\r\n  cmp: number,\r\n  avgExit: number,\r\n  positionStatus: 'Open' | 'Closed' | 'Partial',\r\n  buySell: 'Buy' | 'Sell' = 'Buy'\r\n): EntryMove[] {\r\n  // Filter out entries with no quantity or price\r\n  const validEntries = entries.filter(e => e.price > 0 && e.qty > 0);\r\n\r\n  return validEntries.map(entry => {\r\n    let comparePrice = positionStatus === 'Open' ? cmp : avgExit;\r\n    if (positionStatus === 'Partial') {\r\n      // For partial positions, use both CMP and avgExit\r\n      comparePrice = cmp || avgExit;\r\n    }\r\n\r\n    let movePercent = 0;\r\n    if (comparePrice && entry.price) {\r\n      movePercent = ((comparePrice - entry.price) / entry.price) * 100;\r\n      // Invert the percentage for Sell trades\r\n      if (buySell === 'Sell') {\r\n        movePercent = -movePercent;\r\n      }\r\n    }\r\n\r\n    return {\r\n      entryPrice: entry.price,\r\n      qty: entry.qty,\r\n      movePercent,\r\n      description: entry.description || `Entry at ₹${entry.price}`\r\n    };\r\n  });\r\n}\r\n\r\n/**\r\n * Calculate the weighted average Reward:Risk (R:R) for a trade, using per-entry breakdown and TSL/SL logic.\r\n * This matches the logic in trade-journal.tsx for consistency across analytics.\r\n */\r\nimport { Trade } from '../types/trade';\r\nimport { calculateTradePL } from './accountingUtils';\r\nexport function calcWeightedRewardRisk(trade: Trade): number {\r\n  const entry = Number(trade.entry);\r\n  const sl = Number(trade.sl);\r\n  const tsl = Number(trade.tsl);\r\n  const cmp = Number(trade.cmp);\r\n  const avgExit = Number(trade.avgExitPrice);\r\n  const buySell = trade.buySell;\r\n  const positionStatus = trade.positionStatus;\r\n  const exitedQty = Number(trade.exitedQty);\r\n  const openQty = Number(trade.openQty);\r\n  // Gather all entry lots\r\n  const entries = [\r\n    { label: 'Initial Entry', price: Number(trade.entry), qty: Number(trade.initialQty) },\r\n    { label: 'Pyramid 1', price: Number(trade.pyramid1Price), qty: Number(trade.pyramid1Qty) },\r\n    { label: 'Pyramid 2', price: Number(trade.pyramid2Price), qty: Number(trade.pyramid2Qty) }\r\n  ].filter(e => e.price > 0 && e.qty > 0);\r\n  const totalQtyAll = entries.reduce((sum, e) => sum + (e.qty || 0), 0);\r\n  const entryBreakdown = entries.map(e => {\r\n    // For initial entry, always use SL; for pyramids, use TSL if set and > 0, otherwise SL\r\n    let stop;\r\n    if (e.label === 'Initial Entry') {\r\n      stop = sl;\r\n    } else {\r\n      stop = tsl > 0 ? tsl : sl;\r\n    }\r\n    const rawRisk = e.price - stop; // For Buy\r\n    const risk = Math.abs(rawRisk); // For R:R calculation\r\n    let reward = 0;\r\n    if (positionStatus === 'Open') {\r\n      reward = buySell === 'Buy' ? cmp - e.price : e.price - cmp;\r\n    } else if (positionStatus === 'Closed') {\r\n      reward = buySell === 'Buy' ? avgExit - e.price : e.price - avgExit;\r\n    } else if (positionStatus === 'Partial') {\r\n      const realizedReward = buySell === 'Buy' ? avgExit - e.price : e.price - avgExit;\r\n      const potentialReward = buySell === 'Buy' ? cmp - e.price : e.price - cmp;\r\n      reward = totalQtyAll > 0 ? ((realizedReward * exitedQty + potentialReward * openQty) / totalQtyAll) : 0;\r\n    }\r\n    const rrValue = risk !== 0 ? Math.abs(reward / risk) : 0;\r\n    return {\r\n      rrValue,\r\n      qty: e.qty\r\n    };\r\n  });\r\n  const weightedRR = totalQtyAll > 0\r\n    ? entryBreakdown.reduce((sum, e) => sum + (e.rrValue * (e.qty || 0)), 0) / totalQtyAll\r\n    : 0;\r\n  return weightedRR;\r\n}\r\n\r\n// Function to get a sorted list of unique dates from trades\r\nexport function getUniqueSortedDates(trades: any[]): Date[] {\r\n  const dates = new Set<number>(); // Use Set to store unique timestamps\r\n\r\n  trades.forEach(trade => {\r\n    // Add trade entry date\r\n    if (trade.date) {\r\n      const d = new Date(trade.date);\r\n      d.setHours(0, 0, 0, 0); // Normalize to start of day\r\n      dates.add(d.getTime());\r\n    }\r\n\r\n    // Add pyramid dates\r\n    if (trade.pyramid1Date) {\r\n      const d = new Date(trade.pyramid1Date);\r\n      d.setHours(0, 0, 0, 0);\r\n      dates.add(d.getTime());\r\n    }\r\n    if (trade.pyramid2Date) {\r\n      const d = new Date(trade.pyramid2Date);\r\n      d.setHours(0, 0, 0, 0);\r\n      dates.add(d.getTime());\r\n    }\r\n\r\n    // Add exit dates\r\n    if (trade.exit1Date) {\r\n      const d = new Date(trade.exit1Date);\r\n      d.setHours(0, 0, 0, 0);\r\n      dates.add(d.getTime());\r\n    }\r\n    if (trade.exit2Date) {\r\n      const d = new Date(trade.exit2Date);\r\n      d.setHours(0, 0, 0, 0);\r\n      dates.add(d.getTime());\r\n    }\r\n    if (trade.exit3Date) {\r\n      const d = new Date(trade.exit3Date);\r\n      d.setHours(0, 0, 0, 0);\r\n      dates.add(d.getTime());\r\n    }\r\n  });\r\n\r\n  // Convert timestamps back to Date objects and sort them\r\n  const sortedDates = Array.from(dates)\r\n    .map(timestamp => new Date(timestamp))\r\n    .sort((a, b) => a.getTime() - b.getTime());\r\n\r\n  return sortedDates;\r\n}\r\n\r\n// Function to calculate daily portfolio values\r\nexport function calculateDailyPortfolioValues(trades: any[], capitalChanges: any[], useCashBasis: boolean = false): Map<number, number> {\r\n  const dailyValues = new Map<number, number>(); // Map: timestamp -> portfolio value\r\n  const allRelevantDates = getUniqueSortedDates(trades).concat(capitalChanges.map(cc => {\r\n    const d = new Date(cc.date);\r\n    d.setHours(0, 0, 0, 0);\r\n    return d;\r\n  })).sort((a, b) => a.getTime() - b.getTime());\r\n\r\n  if (allRelevantDates.length === 0) {\r\n    dailyValues.set(new Date().setHours(0,0,0,0), 1000); // Default non-zero value for empty portfolio\r\n    return dailyValues;\r\n  }\r\n\r\n  let currentCashComponent = 0; // Represents the cash portion of the portfolio (cash + realized P/L)\r\n\r\n  // Determine initial cash component from the earliest capital change or a default base\r\n  const initialDate = allRelevantDates[0];\r\n  const initialChange = capitalChanges.find(cc => {\r\n    const d = new Date(cc.date);\r\n    d.setHours(0,0,0,0);\r\n    return d.getTime() === initialDate.getTime();\r\n  });\r\n  if (initialChange) {\r\n    currentCashComponent = initialChange.type === 'deposit' ? initialChange.amount : -initialChange.amount;\r\n  } else {\r\n    // If no initial capital change on the first date, assume a sensible starting point.\r\n    // This helps avoid zero division issues in later calculations if no explicit starting capital is provided.\r\n    currentCashComponent = 1000;\r\n  }\r\n\r\n  // Process each date in chronological order\r\n  for (const date of allRelevantDates) {\r\n    const timestamp = date.getTime();\r\n\r\n    // Apply capital changes for this specific date\r\n    capitalChanges.filter(cc => {\r\n      const d = new Date(cc.date);\r\n      d.setHours(0,0,0,0);\r\n      return d.getTime() === timestamp;\r\n    }).forEach(cc => {\r\n      currentCashComponent += cc.type === 'deposit' ? cc.amount : -cc.amount;\r\n    });\r\n\r\n    // Apply P/L from closed and partially closed trades on this date\r\n    const tradesOnDate = trades.filter(trade => {\r\n      if (trade.positionStatus === 'Closed' || trade.positionStatus === 'Partial') {\r\n        // Use the same fallback logic as other parts of the app\r\n        const exitDates = [\r\n          trade.exit1Date,\r\n          trade.exit2Date,\r\n          trade.exit3Date\r\n        ].filter(date => date && date.trim() !== '');\r\n\r\n        const exitDate = exitDates.length > 0\r\n          ? exitDates.sort((a, b) => new Date(b).getTime() - new Date(a).getTime())[0]\r\n          : trade.date; // Fallback to trade date\r\n\r\n        const d = new Date(exitDate);\r\n        d.setHours(0,0,0,0);\r\n        return d.getTime() === timestamp;\r\n      }\r\n      return false;\r\n    });\r\n\r\n    // For cash basis, deduplicate trades to avoid double counting\r\n    let uniqueTradesForDate = tradesOnDate;\r\n    if (useCashBasis) {\r\n      const seenTradeIds = new Set();\r\n      uniqueTradesForDate = tradesOnDate.filter(trade => {\r\n        const originalId = trade.id.split('_exit_')[0];\r\n        if (seenTradeIds.has(originalId)) return false;\r\n        seenTradeIds.add(originalId);\r\n        return true;\r\n      });\r\n    }\r\n\r\n    uniqueTradesForDate.forEach(trade => {\r\n      // Use accounting-aware P/L calculation instead of direct plRs\r\n      const accountingPL = calculateTradePL(trade, useCashBasis);\r\n      currentCashComponent += accountingPL;\r\n    });\r\n\r\n    // Calculate the total market value of *all open positions* on this date\r\n    dailyValues.set(timestamp, currentCashComponent);\r\n  }\r\n\r\n  return dailyValues;\r\n}\r\n\r\n// Function to calculate daily returns from portfolio values\r\nexport function calculateDailyReturns(dailyPortfolioValues: Map<number, number>): Map<number, number> {\r\n  const dailyReturns = new Map<number, number>();\r\n  const sortedDates = Array.from(dailyPortfolioValues.keys()).sort((a, b) => a - b);\r\n\r\n  if (sortedDates.length <= 1) return dailyReturns;\r\n\r\n  let prevValue = dailyPortfolioValues.get(sortedDates[0]) || 0;\r\n\r\n  for (let i = 1; i < sortedDates.length; i++) {\r\n    const currentDate = sortedDates[i];\r\n    const currentValue = dailyPortfolioValues.get(currentDate) || 0;\r\n\r\n    if (prevValue !== 0) {\r\n      const returns = (currentValue - prevValue) / prevValue;\r\n      dailyReturns.set(currentDate, returns);\r\n    } else {\r\n      dailyReturns.set(currentDate, 0); // Handle division by zero\r\n    }\r\n    prevValue = currentValue;\r\n  }\r\n  return dailyReturns;\r\n}\r\n\r\n// Function to calculate Standard Deviation of returns\r\nexport function calculateStandardDeviation(returns: number[]): number {\r\n  if (returns.length < 2) return 0; // Need at least 2 data points for std dev\r\n\r\n  const mean = returns.reduce((sum, r) => sum + r, 0) / returns.length;\r\n  const variance = returns.reduce((sum, r) => sum + Math.pow(r - mean, 2), 0) / (returns.length - 1);\r\n  return Math.sqrt(variance);\r\n}\r\n\r\n// Function to calculate Max Drawdown\r\nexport function calculateMaxDrawdown(dailyPortfolioValues: Map<number, number>): number {\r\n  const sortedDates = Array.from(dailyPortfolioValues.keys()).sort((a, b) => a - b);\r\n  if (sortedDates.length === 0) return 0;\r\n\r\n  let peak = dailyPortfolioValues.get(sortedDates[0]) || 0;\r\n  let maxDrawdown = 0;\r\n\r\n  for (const dateTimestamp of sortedDates) {\r\n    const value = dailyPortfolioValues.get(dateTimestamp) || 0;\r\n    if (value > peak) {\r\n      peak = value;\r\n    }\r\n\r\n    // Only calculate drawdown if peak is positive\r\n    if (peak > 0) {\r\n      const drawdown = (peak - value) / peak;\r\n      if (drawdown > maxDrawdown) {\r\n        maxDrawdown = drawdown;\r\n      }\r\n    }\r\n  }\r\n  return maxDrawdown; // Returns as a percentage (e.g., 0.10 for 10%)\r\n}\r\n\r\n// Function to calculate Downside Deviation (for Sortino Ratio)\r\nexport function calculateDownsideDeviation(returns: number[], targetReturn: number = 0): number {\r\n  if (returns.length === 0) return 0;\r\n\r\n  // Calculate downside deviation using all returns, but only penalize negative deviations\r\n  const sumOfSquaredDownsideDeviations = returns.reduce((sum, r) => {\r\n    if (r < targetReturn) {\r\n      return sum + Math.pow(r - targetReturn, 2);\r\n    }\r\n    return sum;\r\n  }, 0);\r\n\r\n  if (sumOfSquaredDownsideDeviations === 0) return 0;\r\n\r\n  // Use total number of observations for denominator (standard approach)\r\n  const downsideVariance = sumOfSquaredDownsideDeviations / returns.length;\r\n  return Math.sqrt(downsideVariance);\r\n}\r\n\r\n// Sharpe Ratio\r\nexport function calculateSharpeRatio(\r\n  annualizedReturn: number,\r\n  riskFreeRate: number, // Annualized risk-free rate\r\n  portfolioStdDev: number // Annualized standard deviation of portfolio returns\r\n): number {\r\n  const EPSILON = 1e-9; // Define a small epsilon for near-zero checks\r\n  if (Math.abs(portfolioStdDev) < EPSILON) return 0; // Return 0 if std dev is practically zero\r\n  return (annualizedReturn - riskFreeRate) / portfolioStdDev;\r\n}\r\n\r\n// Calmar Ratio\r\nexport function calculateCalmarRatio(\r\n  annualizedReturn: number,\r\n  maxDrawdown: number // As a decimal, e.g., 0.10 for 10%\r\n): number {\r\n  const EPSILON = 1e-9; // Define a small epsilon for near-zero checks\r\n  if (Math.abs(maxDrawdown) < EPSILON) {\r\n    // If there's no drawdown, return a high value if returns are positive, 0 otherwise\r\n    return annualizedReturn > 0 ? 999 : 0;\r\n  }\r\n  return annualizedReturn / maxDrawdown;\r\n}\r\n\r\n// Sortino Ratio\r\nexport function calculateSortinoRatio(\r\n  annualizedReturn: number,\r\n  riskFreeRate: number, // Annualized risk-free rate\r\n  downsideDeviation: number // Annualized downside deviation\r\n): number {\r\n  const EPSILON = 1e-9; // Define a small epsilon for near-zero checks\r\n  if (Math.abs(downsideDeviation) < EPSILON) return 0; // Return 0 if downside dev is practically zero\r\n  return (annualizedReturn - riskFreeRate) / downsideDeviation;\r\n}\r\n\r\n// Helper to annualize daily return metrics\r\nexport function annualizeMetric(dailyMetric: number, numPeriods: number = 252): number {\r\n  // For standard deviation and downside deviation, multiply by sqrt(numPeriods)\r\n  // For returns, multiply by numPeriods\r\n  // This function is generally for converting daily volatility to annual volatility\r\n  return dailyMetric * Math.sqrt(numPeriods);\r\n}","import { supabase } from '../lib/supabase'\r\nimport { AuthService } from './authService'\r\nimport type { Trade, ChartImage, CapitalChange } from '../types/trade'\r\nimport { v4 as uuidv4 } from 'uuid'\r\n\r\n// Simple hash function for browser compatibility\r\nconst simpleHash = (str: string): string => {\r\n  let hash = 0\r\n  for (let i = 0; i < str.length; i++) {\r\n    const char = str.charCodeAt(i)\r\n    hash = ((hash << 5) - hash) + char\r\n    hash = hash & hash // Convert to 32bit integer\r\n  }\r\n  return Math.abs(hash).toString(16).padStart(8, '0')\r\n}\r\n\r\n// Helper function to convert legacy trade IDs to UUIDs\r\nconst convertToUUID = (id: string): string => {\r\n  // If it's already a valid UUID, return it\r\n  const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i\r\n  if (uuidRegex.test(id)) {\r\n    return id\r\n  }\r\n\r\n  // For legacy IDs, create a deterministic UUID based on the original ID\r\n  // This ensures the same legacy ID always maps to the same UUID\r\n  const hash1 = simpleHash(id)\r\n  const hash2 = simpleHash(id + '_salt1')\r\n  const hash3 = simpleHash(id + '_salt2')\r\n  const hash4 = simpleHash(id + '_salt3')\r\n\r\n  // Format as UUID v4\r\n  return [\r\n    hash1.substr(0, 8),\r\n    hash2.substr(0, 4),\r\n    '4' + hash3.substr(0, 3), // Version 4\r\n    ((parseInt(hash4.substr(0, 1), 16) & 0x3) | 0x8).toString(16) + hash4.substr(1, 3), // Variant bits\r\n    (hash1 + hash2).substr(0, 12)\r\n  ].join('-')\r\n}\r\n\r\n// Map to store legacy ID to UUID conversions\r\nconst idMappings = new Map<string, string>()\r\n\r\n// Helper function to convert database row to Trade object\r\nconst dbRowToTrade = (row: any): Trade => {\r\n  // Convert UUID back to original ID if it was mapped\r\n  let originalId = row.id\r\n  for (const [legacyId, uuid] of idMappings.entries()) {\r\n    if (uuid === row.id) {\r\n      originalId = legacyId\r\n      break\r\n    }\r\n  }\r\n\r\n  return {\r\n    id: originalId,\r\n    tradeNo: row.trade_no,\r\n    date: row.date,\r\n    name: row.name,\r\n    entry: Number(row.entry || 0),\r\n    avgEntry: Number(row.avg_entry || 0),\r\n    sl: Number(row.sl || 0),\r\n    tsl: Number(row.tsl || 0),\r\n    buySell: row.buy_sell as 'Buy' | 'Sell',\r\n    cmp: Number(row.cmp || 0),\r\n    setup: row.setup || '',\r\n    baseDuration: row.base_duration || '',\r\n    initialQty: Number(row.initial_qty || 0),\r\n    pyramid1Price: Number(row.pyramid1_price || 0),\r\n    pyramid1Qty: Number(row.pyramid1_qty || 0),\r\n    pyramid1Date: row.pyramid1_date || '',\r\n    pyramid2Price: Number(row.pyramid2_price || 0),\r\n    pyramid2Qty: Number(row.pyramid2_qty || 0),\r\n    pyramid2Date: row.pyramid2_date || '',\r\n    positionSize: Number(row.position_size || 0),\r\n    allocation: Number(row.allocation || 0),\r\n    slPercent: Number(row.sl_percent || 0),\r\n    exit1Price: Number(row.exit1_price || 0),\r\n    exit1Qty: Number(row.exit1_qty || 0),\r\n    exit1Date: row.exit1_date || '',\r\n    exit2Price: Number(row.exit2_price || 0),\r\n    exit2Qty: Number(row.exit2_qty || 0),\r\n    exit2Date: row.exit2_date || '',\r\n    exit3Price: Number(row.exit3_price || 0),\r\n    exit3Qty: Number(row.exit3_qty || 0),\r\n    exit3Date: row.exit3_date || '',\r\n    openQty: Number(row.open_qty || 0),\r\n    exitedQty: Number(row.exited_qty || 0),\r\n    avgExitPrice: Number(row.avg_exit_price || 0),\r\n    stockMove: Number(row.stock_move || 0),\r\n    rewardRisk: Number(row.reward_risk || 0),\r\n    holdingDays: Number(row.holding_days || 0),\r\n    positionStatus: row.position_status as 'Open' | 'Closed' | 'Partial',\r\n    realisedAmount: Number(row.realised_amount || 0),\r\n    plRs: Number(row.pl_rs || 0),\r\n    pfImpact: Number(row.pf_impact || 0),\r\n    cummPf: Number(row.cumm_pf || 0),\r\n    planFollowed: Boolean(row.plan_followed),\r\n    exitTrigger: row.exit_trigger || '',\r\n    proficiencyGrowthAreas: row.proficiency_growth_areas || '',\r\n    sector: row.sector || '',\r\n    openHeat: Number(row.open_heat || 0),\r\n    notes: row.notes || '',\r\n    chartAttachments: row.chart_attachments || {},\r\n    _userEditedFields: row.user_edited_fields || [],\r\n    _cmpAutoFetched: Boolean(row.cmp_auto_fetched),\r\n    _needsRecalculation: Boolean(row.needs_recalculation),\r\n  }\r\n}\r\n\r\n// Helper function to convert Trade object to database insert/update format\r\nconst tradeToDbRow = (trade: Trade, userId: string) => {\r\n  // Convert legacy ID to UUID and store mapping\r\n  const uuid = convertToUUID(trade.id)\r\n  idMappings.set(trade.id, uuid)\r\n\r\n  return {\r\n    id: uuid,\r\n    user_id: userId,\r\n    trade_no: trade.tradeNo,\r\n    date: trade.date,\r\n    name: trade.name,\r\n    entry: trade.entry,\r\n    avg_entry: trade.avgEntry,\r\n    sl: trade.sl,\r\n    tsl: trade.tsl,\r\n    buy_sell: trade.buySell,\r\n    cmp: trade.cmp,\r\n    setup: trade.setup,\r\n    base_duration: trade.baseDuration,\r\n    initial_qty: trade.initialQty,\r\n    pyramid1_price: trade.pyramid1Price,\r\n    pyramid1_qty: trade.pyramid1Qty,\r\n    pyramid1_date: trade.pyramid1Date || null,\r\n    pyramid2_price: trade.pyramid2Price,\r\n    pyramid2_qty: trade.pyramid2Qty,\r\n    pyramid2_date: trade.pyramid2Date || null,\r\n    position_size: trade.positionSize,\r\n    allocation: trade.allocation,\r\n    sl_percent: trade.slPercent,\r\n    exit1_price: trade.exit1Price,\r\n    exit1_qty: trade.exit1Qty,\r\n    exit1_date: trade.exit1Date || null,\r\n    exit2_price: trade.exit2Price,\r\n    exit2_qty: trade.exit2Qty,\r\n    exit2_date: trade.exit2Date || null,\r\n    exit3_price: trade.exit3Price,\r\n    exit3_qty: trade.exit3Qty,\r\n    exit3_date: trade.exit3Date || null,\r\n    open_qty: trade.openQty,\r\n    exited_qty: trade.exitedQty,\r\n    avg_exit_price: trade.avgExitPrice,\r\n    stock_move: trade.stockMove,\r\n    reward_risk: trade.rewardRisk,\r\n    holding_days: trade.holdingDays,\r\n    position_status: trade.positionStatus,\r\n    realised_amount: trade.realisedAmount,\r\n    pl_rs: trade.plRs,\r\n    pf_impact: trade.pfImpact,\r\n    cumm_pf: trade.cummPf,\r\n    plan_followed: trade.planFollowed,\r\n    exit_trigger: trade.exitTrigger,\r\n    proficiency_growth_areas: trade.proficiencyGrowthAreas,\r\n    sector: trade.sector,\r\n    open_heat: trade.openHeat,\r\n    notes: trade.notes,\r\n    chart_attachments: trade.chartAttachments || {},\r\n    user_edited_fields: trade._userEditedFields || [],\r\n    cmp_auto_fetched: trade._cmpAutoFetched || false,\r\n    needs_recalculation: trade._needsRecalculation || false,\r\n  }\r\n}\r\n\r\nexport class SupabaseService {\r\n  // ===== TRADES =====\r\n  \r\n  // Performance cache for trades\r\n  private static tradesCache = new Map<string, { data: Trade[], timestamp: number }>();\r\n  private static CACHE_DURATION = 30000; // 30 seconds\r\n\r\n  static async getAllTrades(): Promise<Trade[]> {\r\n    const startTime = performance.now();\r\n\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) {\r\n        // User not authenticated - return empty array silently for guest mode\r\n        return []\r\n      }\r\n\r\n      // Check cache first for lightning-fast subsequent loads\r\n      const cacheKey = `trades_${userId}`;\r\n      const cached = this.tradesCache.get(cacheKey);\r\n      if (cached && (Date.now() - cached.timestamp) < this.CACHE_DURATION) {\r\n        console.log(`⚡ Trades loaded from cache in ${Math.round(performance.now() - startTime)}ms`);\r\n        return cached.data;\r\n      }\r\n\r\n      // Complete query with all required fields matching database schema\r\n      const { data, error } = await supabase\r\n        .from('trades')\r\n        .select(`\r\n          id, user_id, trade_no, name, date, entry, avg_entry, sl, tsl, buy_sell, cmp,\r\n          setup, base_duration, initial_qty,\r\n          pyramid1_price, pyramid1_qty, pyramid1_date,\r\n          pyramid2_price, pyramid2_qty, pyramid2_date,\r\n          position_size, allocation, sl_percent,\r\n          exit1_price, exit1_qty, exit1_date,\r\n          exit2_price, exit2_qty, exit2_date,\r\n          exit3_price, exit3_qty, exit3_date,\r\n          open_qty, exited_qty, avg_exit_price, stock_move, reward_risk, holding_days,\r\n          position_status, realised_amount, pl_rs, pf_impact, cumm_pf,\r\n          plan_followed, exit_trigger, proficiency_growth_areas, sector, open_heat,\r\n          notes, chart_attachments, user_edited_fields, cmp_auto_fetched, needs_recalculation,\r\n          created_at, updated_at\r\n        `)\r\n        .eq('user_id', userId)\r\n        .order('trade_no', { ascending: true })\r\n\r\n      if (error) throw error\r\n\r\n      const trades = data.map(dbRowToTrade);\r\n\r\n      // Cache the result for future requests\r\n      this.tradesCache.set(cacheKey, {\r\n        data: trades,\r\n        timestamp: Date.now()\r\n      });\r\n\r\n      const endTime = performance.now();\r\n      console.log(`⚡ Trades loaded from Supabase in ${Math.round(endTime - startTime)}ms`);\r\n\r\n      return trades;\r\n    } catch (error) {\r\n      console.error('❌ Failed to get trades from Supabase:', error)\r\n      return []\r\n    }\r\n  }\r\n\r\n  // Clear cache when trades are updated\r\n  static clearTradesCache(userId?: string): void {\r\n    if (userId) {\r\n      this.tradesCache.delete(`trades_${userId}`);\r\n    } else {\r\n      this.tradesCache.clear();\r\n    }\r\n  }\r\n\r\n  static async getTrade(id: string): Promise<Trade | null> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) {\r\n        // User not authenticated - return null silently for guest mode\r\n        return null\r\n      }\r\n\r\n      // Convert legacy ID to UUID for lookup\r\n      const uuid = convertToUUID(id)\r\n      idMappings.set(id, uuid)\r\n\r\n      const { data, error } = await supabase\r\n        .from('trades')\r\n        .select('*')\r\n        .eq('id', uuid)\r\n        .eq('user_id', userId)\r\n        .single()\r\n\r\n      if (error) throw error\r\n\r\n      return data ? dbRowToTrade(data) : null\r\n    } catch (error) {\r\n      console.error('❌ Failed to get trade from Supabase:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get trade directly from Supabase only (no local fallback)\r\n   * Used for verifying trade exists in Supabase for foreign key constraints\r\n   */\r\n  static async getTradeFromSupabaseOnly(id: string): Promise<Trade | null> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) {\r\n        // User not authenticated - return null silently for guest mode\r\n        return null\r\n      }\r\n\r\n      const { data, error } = await supabase\r\n        .from('trades')\r\n        .select('*')\r\n        .eq('id', id)\r\n        .eq('user_id', userId)\r\n        .single()\r\n\r\n      if (error && error.code !== 'PGRST116') throw error\r\n\r\n      return data ? dbRowToTrade(data) : null\r\n    } catch (error) {\r\n      console.error('❌ Failed to get trade from Supabase only:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  static async saveTrade(trade: Trade): Promise<boolean> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) {\r\n        console.warn('⚠️ Cannot save trade - user not authenticated')\r\n        return false\r\n      }\r\n\r\n      console.log('💾 Saving trade to Supabase:', trade.name, 'User ID:', userId)\r\n\r\n      const dbRow = tradeToDbRow(trade, userId)\r\n      const uuid = dbRow.id\r\n\r\n      // Check if trade exists using UUID\r\n      const { data: existingTrade } = await supabase\r\n        .from('trades')\r\n        .select('id')\r\n        .eq('id', uuid)\r\n        .eq('user_id', userId)\r\n        .single()\r\n\r\n      if (existingTrade) {\r\n        // Update existing trade\r\n        console.log('🔄 Updating existing trade:', trade.name)\r\n        const { error } = await supabase\r\n          .from('trades')\r\n          .update(dbRow)\r\n          .eq('id', uuid)\r\n          .eq('user_id', userId)\r\n\r\n        if (error) {\r\n          console.error('❌ Error updating trade:', error)\r\n          throw error\r\n        }\r\n        console.log('✅ Trade updated successfully:', trade.name)\r\n      } else {\r\n        // Insert new trade\r\n        console.log('➕ Inserting new trade:', trade.name)\r\n        const { error } = await supabase\r\n          .from('trades')\r\n          .insert(dbRow)\r\n\r\n        if (error) {\r\n          console.error('❌ Error inserting trade:', error)\r\n          throw error\r\n        }\r\n        console.log('✅ Trade inserted successfully:', trade.name)\r\n      }\r\n\r\n      // Clear cache after successful save\r\n      this.clearTradesCache(userId)\r\n\r\n      return true\r\n    } catch (error) {\r\n      console.error('❌ Failed to save trade to Supabase:', error)\r\n      return false\r\n    }\r\n  }\r\n\r\n  static async saveAllTrades(trades: Trade[]): Promise<boolean> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) {\r\n        console.warn('⚠️ Cannot save trades - user not authenticated')\r\n        return false\r\n      }\r\n\r\n      console.log(`💾 Saving ${trades.length} trades to Supabase for user:`, userId)\r\n\r\n      // Delete all existing trades for the user\r\n      console.log('🗑️ Clearing existing trades...')\r\n      const { error: deleteError } = await supabase\r\n        .from('trades')\r\n        .delete()\r\n        .eq('user_id', userId)\r\n\r\n      if (deleteError) {\r\n        console.error('❌ Error deleting existing trades:', deleteError)\r\n        throw deleteError\r\n      }\r\n      console.log('✅ Existing trades cleared')\r\n\r\n      if (trades.length === 0) {\r\n        console.log('ℹ️ No trades to save')\r\n        this.clearTradesCache(userId)\r\n        return true\r\n      }\r\n\r\n      // Convert all trades to database format with UUID conversion\r\n      const dbRows = trades.map(trade => tradeToDbRow(trade, userId))\r\n      console.log('📝 Converted trades to DB format:', dbRows.length)\r\n\r\n      // Insert all new trades in batches to avoid payload size limits\r\n      const batchSize = 100\r\n      for (let i = 0; i < dbRows.length; i += batchSize) {\r\n        const batch = dbRows.slice(i, i + batchSize)\r\n        console.log(`📤 Inserting batch ${Math.floor(i/batchSize) + 1}/${Math.ceil(dbRows.length/batchSize)} (${batch.length} trades)`)\r\n\r\n        const { error: insertError } = await supabase\r\n          .from('trades')\r\n          .insert(batch)\r\n\r\n        if (insertError) {\r\n          console.error('❌ Error inserting batch:', insertError)\r\n          throw insertError\r\n        }\r\n      }\r\n\r\n      console.log('✅ All trades saved successfully to Supabase')\r\n\r\n      // Clear cache after successful save\r\n      this.clearTradesCache(userId)\r\n\r\n      return true\r\n    } catch (error) {\r\n      console.error('❌ Failed to save all trades to Supabase:', error)\r\n      return false\r\n    }\r\n  }\r\n\r\n  static async deleteTrade(id: string): Promise<boolean> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) throw new Error('User not authenticated')\r\n\r\n      // Convert legacy ID to UUID for deletion\r\n      const uuid = convertToUUID(id)\r\n\r\n      const { error } = await supabase\r\n        .from('trades')\r\n        .delete()\r\n        .eq('id', uuid)\r\n        .eq('user_id', userId)\r\n\r\n      if (error) throw error\r\n\r\n      // Remove from mapping\r\n      idMappings.delete(id)\r\n\r\n\r\n      return true\r\n    } catch (error) {\r\n      console.error('❌ Failed to delete trade from Supabase:', error)\r\n      return false\r\n    }\r\n  }\r\n\r\n  // ===== USER PREFERENCES =====\r\n  \r\n  static async getUserPreferences(): Promise<any | null> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) throw new Error('User not authenticated')\r\n\r\n      const { data, error } = await supabase\r\n        .from('user_preferences')\r\n        .select('*')\r\n        .eq('user_id', userId)\r\n        .single()\r\n\r\n      if (error && error.code !== 'PGRST116') throw error // PGRST116 = no rows returned\r\n\r\n      return data || null\r\n    } catch (error) {\r\n      console.error('❌ Failed to get user preferences from Supabase:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  static async saveUserPreferences(preferences: any): Promise<boolean> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) throw new Error('User not authenticated')\r\n\r\n      const { error } = await supabase\r\n        .from('user_preferences')\r\n        .upsert({\r\n          ...preferences,\r\n          user_id: userId\r\n        }, {\r\n          onConflict: 'user_id'\r\n        })\r\n\r\n      if (error) throw error\r\n\r\n      return true\r\n    } catch (error) {\r\n      console.error('❌ Failed to save user preferences to Supabase:', error)\r\n      return false\r\n    }\r\n  }\r\n\r\n  // ===== PORTFOLIO DATA =====\r\n  \r\n  static async getPortfolioData(): Promise<any[]> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) throw new Error('User not authenticated')\r\n\r\n      const { data, error } = await supabase\r\n        .from('portfolio_data')\r\n        .select('*')\r\n        .eq('user_id', userId)\r\n\r\n      if (error) throw error\r\n\r\n      return data || []\r\n    } catch (error) {\r\n      console.error('❌ Failed to get portfolio data from Supabase:', error)\r\n      return []\r\n    }\r\n  }\r\n\r\n  static async savePortfolioData(data: any[]): Promise<boolean> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) throw new Error('User not authenticated')\r\n\r\n      // Delete existing portfolio data\r\n      const { error: deleteError } = await supabase\r\n        .from('portfolio_data')\r\n        .delete()\r\n        .eq('user_id', userId)\r\n\r\n      if (deleteError) throw deleteError\r\n\r\n      // Insert new portfolio data\r\n      const dataWithUserId = data.map(item => ({ ...item, user_id: userId }))\r\n\r\n      const { error: insertError } = await supabase\r\n        .from('portfolio_data')\r\n        .insert(dataWithUserId)\r\n\r\n      if (insertError) throw insertError\r\n\r\n\r\n      return true\r\n    } catch (error) {\r\n      console.error('❌ Failed to save portfolio data to Supabase:', error)\r\n      return false\r\n    }\r\n  }\r\n\r\n  // ===== TRADE SETTINGS =====\r\n\r\n  static async getTradeSettings(): Promise<any | null> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) {\r\n        // User not authenticated - return null silently for guest mode\r\n        return null\r\n      }\r\n\r\n      const { data, error } = await supabase\r\n        .from('trade_settings')\r\n        .select('*')\r\n        .eq('user_id', userId)\r\n        .single()\r\n\r\n      if (error && error.code !== 'PGRST116') throw error\r\n\r\n      return data || null\r\n    } catch (error) {\r\n      console.error('❌ Failed to get trade settings from Supabase:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  static async saveTradeSettings(settings: any): Promise<boolean> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) {\r\n        // User not authenticated - return false silently for guest mode\r\n        return false\r\n      }\r\n\r\n      const { error } = await supabase\r\n        .from('trade_settings')\r\n        .upsert({\r\n          ...settings,\r\n          user_id: userId\r\n        }, {\r\n          onConflict: 'user_id'\r\n        })\r\n\r\n      if (error) throw error\r\n\r\n      return true\r\n    } catch (error) {\r\n      console.error('❌ Failed to save trade settings to Supabase:', error)\r\n      return false\r\n    }\r\n  }\r\n\r\n  // ===== TAX DATA =====\r\n\r\n  static async getTaxData(year: number): Promise<any | null> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) throw new Error('User not authenticated')\r\n\r\n      const { data, error } = await supabase\r\n        .from('tax_data')\r\n        .select('*')\r\n        .eq('user_id', userId)\r\n        .eq('year', year)\r\n        .single()\r\n\r\n      if (error && error.code !== 'PGRST116') throw error\r\n\r\n      return data || null\r\n    } catch (error) {\r\n      console.error('❌ Failed to get tax data from Supabase:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  static async saveTaxData(year: number, data: any): Promise<boolean> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) throw new Error('User not authenticated')\r\n\r\n      const { error } = await supabase\r\n        .from('tax_data')\r\n        .upsert({\r\n          user_id: userId,\r\n          year,\r\n          data\r\n        }, {\r\n          onConflict: 'user_id,year'\r\n        })\r\n\r\n      if (error) throw error\r\n\r\n\r\n      return true\r\n    } catch (error) {\r\n      console.error('❌ Failed to save tax data to Supabase:', error)\r\n      return false\r\n    }\r\n  }\r\n\r\n  // ===== MILESTONES DATA =====\r\n\r\n  static async getMilestonesData(): Promise<any | null> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) {\r\n        // User not authenticated - return null silently for guest mode\r\n        return null\r\n      }\r\n\r\n      const { data, error } = await supabase\r\n        .from('milestones_data')\r\n        .select('*')\r\n        .eq('user_id', userId)\r\n        .single()\r\n\r\n      if (error && error.code !== 'PGRST116') throw error\r\n\r\n      return data || null\r\n    } catch (error) {\r\n      console.error('❌ Failed to get milestones data from Supabase:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  static async saveMilestonesData(achievements: any[]): Promise<boolean> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) {\r\n        // User not authenticated - return false silently for guest mode\r\n        return false\r\n      }\r\n\r\n      const { error } = await supabase\r\n        .from('milestones_data')\r\n        .upsert({\r\n          user_id: userId,\r\n          achievements\r\n        }, {\r\n          onConflict: 'user_id'\r\n        })\r\n\r\n      if (error) throw error\r\n\r\n      console.log('✅ Saved milestones data to Supabase')\r\n      return true\r\n    } catch (error) {\r\n      console.error('❌ Failed to save milestones data to Supabase:', error)\r\n      return false\r\n    }\r\n  }\r\n\r\n  // ===== MISC DATA =====\r\n\r\n  static async getMiscData(key: string): Promise<any> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) {\r\n        // User not authenticated - return null silently for guest mode\r\n        return null\r\n      }\r\n\r\n      console.log('🔍 Getting misc data for key:', key, 'user:', userId)\r\n\r\n      const { data, error } = await supabase\r\n        .from('misc_data')\r\n        .select('value')\r\n        .eq('user_id', userId)\r\n        .eq('key', key)\r\n        .maybeSingle() // Use maybeSingle instead of single to avoid errors when no data exists\r\n\r\n      if (error) {\r\n        console.error('❌ Error getting misc data:', error)\r\n        throw error\r\n      }\r\n\r\n      console.log('✅ Got misc data:', data?.value || 'null')\r\n      return data?.value || null\r\n    } catch (error) {\r\n      console.error('❌ Failed to get misc data from Supabase:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  static async saveMiscData(key: string, value: any): Promise<boolean> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) {\r\n        // User not authenticated - return false silently for guest mode\r\n        return false\r\n      }\r\n\r\n      const { error } = await supabase\r\n        .from('misc_data')\r\n        .upsert({\r\n          user_id: userId,\r\n          key,\r\n          value\r\n        }, {\r\n          onConflict: 'user_id,key'\r\n        })\r\n\r\n      if (error) throw error\r\n\r\n      return true\r\n    } catch (error) {\r\n      console.error('❌ Failed to save misc data to Supabase:', error)\r\n      return false\r\n    }\r\n  }\r\n\r\n  static async deleteMiscData(key: string): Promise<boolean> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) {\r\n        // User not authenticated - return false silently for guest mode\r\n        return false\r\n      }\r\n\r\n      const { error } = await supabase\r\n        .from('misc_data')\r\n        .delete()\r\n        .eq('user_id', userId)\r\n        .eq('key', key)\r\n\r\n      if (error) throw error\r\n\r\n      return true\r\n    } catch (error) {\r\n      console.error('❌ Failed to delete misc data from Supabase:', error)\r\n      return false\r\n    }\r\n  }\r\n\r\n  // ===== CHART IMAGE BLOBS =====\r\n\r\n  static async saveChartImageBlob(imageBlob: any): Promise<boolean> {\r\n\r\n\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) {\r\n\r\n        throw new Error('User not authenticated')\r\n      }\r\n\r\n\r\n\r\n      // Convert base64 to binary for bytea storage\r\n      let binaryData: Uint8Array;\r\n      try {\r\n        binaryData = Uint8Array.from(atob(imageBlob.data), c => c.charCodeAt(0))\r\n      } catch (conversionError) {\r\n        throw new Error('Failed to convert base64 data')\r\n      }\r\n\r\n      const insertData = {\r\n        id: imageBlob.id,\r\n        user_id: userId,\r\n        trade_id: imageBlob.trade_id,\r\n        image_type: imageBlob.image_type,\r\n        filename: imageBlob.filename,\r\n        mime_type: imageBlob.mime_type,\r\n        size_bytes: imageBlob.size_bytes,\r\n        data: binaryData,\r\n        uploaded_at: imageBlob.uploaded_at,\r\n        compressed: imageBlob.compressed || false,\r\n        original_size: imageBlob.original_size\r\n      };\r\n\r\n\r\n\r\n      const { data: insertResult, error } = await supabase\r\n        .from('chart_image_blobs')\r\n        .insert(insertData)\r\n        .select()\r\n\r\n      if (error) {\r\n\r\n        throw error\r\n      }\r\n\r\n\r\n      return true\r\n    } catch (error) {\r\n      console.error('❌ Failed to save chart image blob to Supabase:', error)\r\n      return false\r\n    }\r\n  }\r\n\r\n  static async getChartImageBlob(blobId: string): Promise<any | null> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) throw new Error('User not authenticated')\r\n\r\n\r\n\r\n      // First, get metadata without the binary data to avoid 406 errors\r\n      const { data: metadata, error: metadataError } = await supabase\r\n        .from('chart_image_blobs')\r\n        .select('id, user_id, trade_id, image_type, filename, mime_type, size_bytes, uploaded_at, compressed, original_size, created_at, updated_at')\r\n        .eq('user_id', userId)\r\n        .eq('id', blobId)\r\n        .single()\r\n\r\n      if (metadataError) {\r\n        if (metadataError.code === 'PGRST116') {\r\n          // No rows returned\r\n          return null\r\n        }\r\n        throw metadataError\r\n      }\r\n\r\n\r\n\r\n      // Now get the binary data separately\r\n      const { data: binaryData, error: binaryError } = await supabase\r\n        .from('chart_image_blobs')\r\n        .select('data')\r\n        .eq('user_id', userId)\r\n        .eq('id', blobId)\r\n        .single()\r\n\r\n      if (binaryError) {\r\n\r\n        throw binaryError\r\n      }\r\n\r\n\r\n\r\n      // Combine metadata and binary data\r\n      const result = {\r\n        ...metadata,\r\n        data: binaryData.data\r\n      }\r\n\r\n\r\n      return result\r\n    } catch (error) {\r\n      console.error('❌ Failed to get chart image blob:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  static async getAllChartImageBlobs(): Promise<any[]> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) throw new Error('User not authenticated')\r\n\r\n\r\n\r\n      // Get metadata only (without binary data) for listing\r\n      // Binary data will be fetched individually when needed\r\n      const { data, error } = await supabase\r\n        .from('chart_image_blobs')\r\n        .select('id, user_id, trade_id, image_type, filename, mime_type, size_bytes, uploaded_at, compressed, original_size, created_at, updated_at')\r\n        .eq('user_id', userId)\r\n        .order('uploaded_at', { ascending: false })\r\n\r\n      if (error) throw error\r\n\r\n\r\n      return data || []\r\n    } catch (error) {\r\n      console.error('❌ Failed to get all chart image blobs:', error)\r\n      return []\r\n    }\r\n  }\r\n\r\n  static async deleteChartImageBlob(blobId: string): Promise<boolean> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) throw new Error('User not authenticated')\r\n\r\n\r\n\r\n      const { error } = await supabase\r\n        .from('chart_image_blobs')\r\n        .delete()\r\n        .eq('user_id', userId)\r\n        .eq('id', blobId)\r\n\r\n      if (error) throw error\r\n\r\n\r\n      return true\r\n    } catch (error) {\r\n      console.error('❌ Failed to delete chart image blob:', error)\r\n      return false\r\n    }\r\n  }\r\n\r\n  static async getTradeChartImageBlobs(tradeId: string): Promise<any[]> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) throw new Error('User not authenticated')\r\n\r\n      // NEW: Check if tradeId is a valid UUID format\r\n      const isUUID = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(tradeId);\r\n\r\n      if (!isUUID) {\r\n        console.log(`📦 [SUPABASE] Trade ID is not UUID format, skipping chart blob query: ${tradeId}`);\r\n        return [];\r\n      }\r\n\r\n      const { data, error } = await supabase\r\n        .from('chart_image_blobs')\r\n        .select('*')\r\n        .eq('trade_id', tradeId)\r\n        .eq('user_id', userId)\r\n\r\n      if (error) throw error\r\n\r\n      return data || []\r\n    } catch (error) {\r\n      console.error('❌ Failed to get trade chart image blobs:', error)\r\n      return []\r\n    }\r\n  }\r\n\r\n\r\n\r\n  static async deleteTradeChartImageBlobs(tradeId: string): Promise<boolean> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) throw new Error('User not authenticated')\r\n\r\n      // NEW: Check if tradeId is a valid UUID format\r\n      const isUUID = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(tradeId);\r\n\r\n      if (!isUUID) {\r\n        console.log(`📦 [SUPABASE] Trade ID is not UUID format, skipping chart blob deletion: ${tradeId}`);\r\n        return true; // Return true since there's nothing to delete for non-UUID trades\r\n      }\r\n\r\n      const { error } = await supabase\r\n        .from('chart_image_blobs')\r\n        .delete()\r\n        .eq('trade_id', tradeId)\r\n        .eq('user_id', userId)\r\n\r\n      if (error) throw error\r\n\r\n      return true\r\n    } catch (error) {\r\n      console.error('❌ Failed to delete trade chart image blobs:', error)\r\n      return false\r\n    }\r\n  }\r\n\r\n  static async updateChartImageBlobTradeId(blobId: string, newTradeId: string): Promise<boolean> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) throw new Error('User not authenticated')\r\n\r\n      const { error } = await supabase\r\n        .from('chart_image_blobs')\r\n        .update({ trade_id: newTradeId })\r\n        .eq('id', blobId)\r\n        .eq('user_id', userId)\r\n\r\n      if (error) throw error\r\n\r\n\r\n      return true\r\n    } catch (error) {\r\n      console.error('❌ Failed to update chart image blob trade ID:', error)\r\n      return false\r\n    }\r\n  }\r\n\r\n  // ===== DASHBOARD CONFIG =====\r\n\r\n  static async getDashboardConfig(): Promise<any | null> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) throw new Error('User not authenticated')\r\n\r\n      const { data, error } = await supabase\r\n        .from('dashboard_config')\r\n        .select('*')\r\n        .eq('user_id', userId)\r\n        .single()\r\n\r\n      if (error && error.code !== 'PGRST116') throw error\r\n\r\n      return data || null\r\n    } catch (error) {\r\n      console.error('❌ Failed to get dashboard config from Supabase:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  static async saveDashboardConfig(config: any): Promise<boolean> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) throw new Error('User not authenticated')\r\n\r\n      const { error } = await supabase\r\n        .from('dashboard_config')\r\n        .upsert({\r\n          user_id: userId,\r\n          config\r\n        }, {\r\n          onConflict: 'user_id'\r\n        })\r\n\r\n      if (error) throw error\r\n\r\n      console.log('✅ Saved dashboard config to Supabase')\r\n      return true\r\n    } catch (error) {\r\n      console.error('❌ Failed to save dashboard config to Supabase:', error)\r\n      return false\r\n    }\r\n  }\r\n\r\n  // ===== COMMENTARY DATA =====\r\n\r\n  static async getCommentaryData(year: string): Promise<any | null> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) throw new Error('User not authenticated')\r\n\r\n      const { data, error } = await supabase\r\n        .from('commentary_data')\r\n        .select('*')\r\n        .eq('user_id', userId)\r\n        .eq('year', year)\r\n        .single()\r\n\r\n      if (error && error.code !== 'PGRST116') throw error\r\n\r\n      return data || null\r\n    } catch (error) {\r\n      console.error('❌ Failed to get commentary data from Supabase:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  static async saveCommentaryData(year: string, data: any): Promise<boolean> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) throw new Error('User not authenticated')\r\n\r\n      const { error } = await supabase\r\n        .from('commentary_data')\r\n        .upsert({\r\n          user_id: userId,\r\n          year,\r\n          data\r\n        }, {\r\n          onConflict: 'user_id,year'\r\n        })\r\n\r\n      if (error) throw error\r\n\r\n\r\n      return true\r\n    } catch (error) {\r\n      console.error('❌ Failed to save commentary data to Supabase:', error)\r\n      return false\r\n    }\r\n  }\r\n\r\n  // ===== UTILITIES =====\r\n\r\n  static async clearAllData(): Promise<boolean> {\r\n    try {\r\n      const userId = await AuthService.getUserId()\r\n      if (!userId) throw new Error('User not authenticated')\r\n\r\n      // Delete all user data from all tables\r\n      const tables = [\r\n        'trades',\r\n        'chart_image_blobs',\r\n        'user_preferences',\r\n        'portfolio_data',\r\n        'tax_data',\r\n        'milestones_data',\r\n        'misc_data',\r\n        'trade_settings',\r\n        'dashboard_config',\r\n        'commentary_data'\r\n      ]\r\n\r\n      for (const table of tables) {\r\n        const { error } = await supabase\r\n          .from(table)\r\n          .delete()\r\n          .eq('user_id', userId)\r\n\r\n        if (error) throw error\r\n      }\r\n\r\n      console.log('✅ Cleared all user data from Supabase')\r\n      return true\r\n    } catch (error) {\r\n      console.error('❌ Failed to clear all data from Supabase:', error)\r\n      return false\r\n    }\r\n  }\r\n}\r\n","import React from \"react\";\r\nimport { Trade } from \"../types/trade\";\r\nimport { mockTrades } from \"../data/mock-trades\";\r\nimport { useTruePortfolioWithTrades } from \"./use-true-portfolio-with-trades\";\r\nimport { useGlobalFilter } from \"../context/GlobalFilterContext\";\r\nimport { isInGlobalFilter } from \"../utils/dateFilterUtils\";\r\nimport { useAccountingMethod } from \"../context/AccountingMethodContext\";\r\nimport { getTradeDateForAccounting, getExitDatesWithFallback } from \"../utils/accountingUtils\";\r\nimport {\r\n  calcAvgEntry,\r\n  calcPositionSize,\r\n  calcAllocation,\r\n  calcSLPercent,\r\n  calcOpenQty,\r\n  calcExitedQty,\r\n  calcAvgExitPrice,\r\n  calcStockMove,\r\n  calcRewardRisk,\r\n  calcHoldingDays,\r\n  calcRealisedAmount,\r\n  calcPFImpact,\r\n  calcRealizedPL_FIFO\r\n} from \"../utils/tradeCalculations\";\r\nimport { calculateTradePL } from \"../utils/accountingUtils\";\r\nimport { SupabaseService } from \"../services/supabaseService\";\r\n// Migrated from IndexedDB to Supabase with authentication\r\n\r\n// Define SortDirection type compatible with HeroUI Table\r\ntype SortDirection = \"ascending\" | \"descending\";\r\n\r\nexport interface SortDescriptor {\r\n  column: string;\r\n  direction: SortDirection;\r\n}\r\n\r\n// Key for localStorage - Standardized to 'trades_data'\r\nconst STORAGE_KEY = 'trades_data';\r\nconst TRADE_SETTINGS_KEY = 'tradeSettings';\r\nconst MISC_DATA_PREFIX = 'misc_';\r\n\r\n// Supabase helpers\r\nasync function getTradesFromSupabase(): Promise<Trade[]> {\r\n  if (typeof window === 'undefined') return []; // In a server-side environment, return empty array\r\n\r\n  try {\r\n    console.log('📥 Loading trades from Supabase...')\r\n    const trades = await SupabaseService.getAllTrades();\r\n    console.log(`✅ Loaded ${trades.length} trades from Supabase`)\r\n    return trades;\r\n  } catch (error) {\r\n    console.error('❌ Error loading trades from Supabase:', error)\r\n    return []; // Always return empty array on error to prevent mock data\r\n  }\r\n}\r\n\r\nasync function saveTradesToSupabase(trades: Trade[]): Promise<boolean> {\r\n  if (typeof window === 'undefined') return false;\r\n\r\n  try {\r\n    console.log('🚀 Attempting to save trades to Supabase:', trades.length)\r\n    const success = await SupabaseService.saveAllTrades(trades);\r\n\r\n    if (success) {\r\n      console.log('✅ Trades saved successfully to Supabase')\r\n    } else {\r\n      console.error('❌ Failed to save trades to Supabase')\r\n    }\r\n\r\n    return success;\r\n  } catch (error) {\r\n    console.error('❌ Error in saveTradesToSupabase:', error)\r\n    return false;\r\n  }\r\n}\r\n\r\nasync function getTradeSettings() {\r\n  if (typeof window === 'undefined') return null;\r\n  try {\r\n    const settings = await SupabaseService.getTradeSettings();\r\n    return settings;\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n}\r\n\r\nasync function saveTradeSettings(settings: any): Promise<boolean> {\r\n  if (typeof window === 'undefined') return false;\r\n  try {\r\n    return await SupabaseService.saveTradeSettings(settings);\r\n  } catch (error) {\r\n    return false;\r\n  }\r\n}\r\n\r\nasync function clearAllTradeAndSettingsData(): Promise<boolean> {\r\n  if (typeof window === 'undefined') return false;\r\n  try {\r\n    // Clear all Supabase data\r\n    const success = await SupabaseService.clearAllData();\r\n\r\n    // Also clear any remaining localStorage data for legacy cleanup\r\n    const keysToRemove = [];\r\n    for (let i = 0; i < localStorage.length; i++) {\r\n      const key = localStorage.key(i);\r\n      if (key) {\r\n        keysToRemove.push(key);\r\n      }\r\n    }\r\n\r\n    // Remove keys that match our patterns\r\n    keysToRemove.forEach(key => {\r\n      if (key.startsWith(MISC_DATA_PREFIX) ||\r\n          key.startsWith('tradeBackup_') ||\r\n          key.startsWith('tradeModal_') ||\r\n          key === 'yearlyStartingCapitals' ||\r\n          key === 'capitalChanges' ||\r\n          key === 'monthlyStartingCapitalOverrides' ||\r\n          key === 'globalFilter' ||\r\n          key === 'heroui-theme' ||\r\n          key === 'userPreferences' ||\r\n          key === 'accountingMethod' ||\r\n          key === 'dashboardConfig' ||\r\n          key === 'milestones' ||\r\n          key === 'achievements' ||\r\n          key.includes('trade') ||\r\n          key.includes('portfolio') ||\r\n          key.includes('settings') ||\r\n          key.includes('config')) {\r\n        try {\r\n          localStorage.removeItem(key);\r\n        } catch (error) {\r\n          // Silent cleanup\r\n        }\r\n      }\r\n    });\r\n\r\n    // Clear sessionStorage as well\r\n    try {\r\n      sessionStorage.clear();\r\n    } catch (error) {\r\n      // Silent cleanup\r\n    }\r\n\r\n    return success;\r\n  } catch (error) {\r\n    return false;\r\n  }\r\n}\r\n\r\n// Utility to recalculate all calculated fields for all trades\r\n// This function is now a pure function and takes getTruePortfolioSize and accounting method as explicit arguments.\r\n// Added skipExpensiveCalculations flag to optimize bulk imports\r\nfunction recalculateAllTrades(\r\n  trades: Trade[],\r\n  getTruePortfolioSize: (month: string, year: number) => number,\r\n  useCashBasis: boolean = false,\r\n  skipExpensiveCalculations: boolean = false\r\n): Trade[] {\r\n  // Sort trades by date (or tradeNo as fallback) for cummPf calculation\r\n  const sorted = [...trades].sort((a, b) => {\r\n    if (a.date && b.date) {\r\n      return new Date(a.date).getTime() - new Date(b.date).getTime();\r\n    }\r\n    return (a.tradeNo || '').localeCompare(b.tradeNo || '');\r\n  });\r\n\r\n  let runningCummPf = 0;\r\n\r\n  // If skipping expensive calculations, return trades with minimal processing\r\n  if (skipExpensiveCalculations) {\r\n    return sorted.map(trade => ({\r\n      ...trade,\r\n      name: (trade.name || '').toUpperCase(),\r\n      // Keep existing calculated values or set minimal defaults\r\n      avgEntry: trade.avgEntry || trade.entry || 0,\r\n      positionSize: trade.positionSize || 0,\r\n      allocation: trade.allocation || 0,\r\n      slPercent: trade.slPercent || 0,\r\n      openQty: trade.openQty || trade.initialQty || 0,\r\n      exitedQty: trade.exitedQty || 0,\r\n      avgExitPrice: trade.avgExitPrice || 0,\r\n      stockMove: trade.stockMove || 0,\r\n      holdingDays: trade.holdingDays || 0,\r\n      realisedAmount: trade.realisedAmount || 0,\r\n      plRs: trade.plRs || 0,\r\n      pfImpact: trade.pfImpact || 0,\r\n      cummPf: trade.cummPf || 0,\r\n      // Mark as needing recalculation\r\n      _needsRecalculation: true\r\n    }));\r\n  }\r\n\r\n  // First pass for individual trade calculations\r\n  const calculatedTrades = sorted.map((trade) => {\r\n    // Original entry and pyramid entries for calculations\r\n    const allEntries = [\r\n      { price: Number(trade.entry || 0), qty: Number(trade.initialQty || 0) },\r\n      { price: Number(trade.pyramid1Price || 0), qty: Number(trade.pyramid1Qty || 0) },\r\n      { price: Number(trade.pyramid2Price || 0), qty: Number(trade.pyramid2Qty || 0) }\r\n    ].filter(e => e.qty > 0 && e.price > 0); // Filter out entries with 0 qty or price\r\n\r\n    const avgEntry = calcAvgEntry(allEntries);\r\n    const totalInitialQty = allEntries.reduce((sum, e) => sum + e.qty, 0);\r\n    const positionSize = calcPositionSize(avgEntry, totalInitialQty);\r\n\r\n    // Get the true portfolio size for the trade's entry date (for allocation calculation)\r\n    let tradePortfolioSize = 100000; // Default fallback\r\n    if (trade.date && getTruePortfolioSize) { // Use the passed getTruePortfolioSize\r\n      const tradeDate = new Date(trade.date);\r\n      const month = tradeDate.toLocaleString('default', { month: 'short' });\r\n      const year = tradeDate.getFullYear();\r\n      try {\r\n        tradePortfolioSize = getTruePortfolioSize(month, year) || 100000;\r\n      } catch (error) {\r\n        tradePortfolioSize = 100000; // Fallback\r\n      }\r\n    }\r\n\r\n    const allocation = calcAllocation(positionSize, tradePortfolioSize);\r\n    const slPercent = calcSLPercent(trade.sl, trade.entry);\r\n\r\n    // Exit legs\r\n    const allExits = [\r\n      { price: Number(trade.exit1Price || 0), qty: Number(trade.exit1Qty || 0) },\r\n      { price: Number(trade.exit2Price || 0), qty: Number(trade.exit2Qty || 0) },\r\n      { price: Number(trade.exit3Price || 0), qty: Number(trade.exit3Qty || 0) }\r\n    ].filter(e => e.qty > 0 && e.price > 0); // Filter out exits with 0 qty or price\r\n\r\n    const exitedQty = allExits.reduce((sum, e) => sum + e.qty, 0);\r\n    const openQty = totalInitialQty - exitedQty;\r\n    const avgExitPrice = calcAvgExitPrice(allExits); // Avg price of actual exits\r\n\r\n    const stockMove = calcStockMove(\r\n      avgEntry,\r\n      avgExitPrice,\r\n      trade.cmp,\r\n      openQty,\r\n      exitedQty,\r\n      trade.positionStatus,\r\n      trade.buySell\r\n    );\r\n\r\n    const rewardRisk = calcRewardRisk(\r\n      trade.cmp || avgExitPrice || trade.entry,\r\n      trade.entry,\r\n      trade.sl,\r\n      trade.positionStatus,\r\n      avgExitPrice,\r\n      openQty,\r\n      exitedQty,\r\n      trade.buySell\r\n    );\r\n\r\n    const pyramidDates = [];\r\n    if (trade.pyramid1Date && trade.pyramid1Qty) pyramidDates.push({ date: trade.pyramid1Date, qty: trade.pyramid1Qty });\r\n    if (trade.pyramid2Date && trade.pyramid2Qty) pyramidDates.push({ date: trade.pyramid2Date, qty: trade.pyramid2Qty });\r\n\r\n    const exitDatesForHolding = [];\r\n    if (trade.exit1Date && trade.exit1Qty) exitDatesForHolding.push({ date: trade.exit1Date, qty: trade.exit1Qty });\r\n    if (trade.exit2Date && trade.exit2Qty) exitDatesForHolding.push({ date: trade.exit2Date, qty: trade.exit2Qty });\r\n    if (trade.exit3Date && trade.exit3Qty) exitDatesForHolding.push({ date: trade.exit3Date, qty: trade.exit3Qty });\r\n\r\n    let primaryExitDateForHolding: string | null = null;\r\n    if (allExits.length > 0) {\r\n        const validExitDates = [trade.exit1Date, trade.exit2Date, trade.exit3Date].filter(Boolean) as string[];\r\n        if (validExitDates.length > 0) {\r\n            primaryExitDateForHolding = validExitDates.sort((a,b) => new Date(a).getTime() - new Date(b).getTime())[0];\r\n        }\r\n    }\r\n    if (trade.positionStatus !== \"Open\" && !primaryExitDateForHolding && allExits.length > 0) {\r\n        primaryExitDateForHolding = trade.date;\r\n    }\r\n\r\n    const holdingDays = calcHoldingDays(\r\n        trade.date,\r\n        primaryExitDateForHolding,\r\n        pyramidDates,\r\n        exitDatesForHolding\r\n    );\r\n\r\n    const realisedAmount = calcRealisedAmount(exitedQty, avgExitPrice);\r\n\r\n    const entryLotsForFifo = allEntries.map(e => ({ price: e.price, qty: e.qty }));\r\n    const exitLotsForFifo = allExits.map(e => ({ price: e.price, qty: e.qty }));\r\n\r\n    const plRs = exitedQty > 0 ? calcRealizedPL_FIFO(entryLotsForFifo, exitLotsForFifo, trade.buySell as 'Buy' | 'Sell') : 0;\r\n\r\n    // Calculate accounting-aware P/L and PF Impact using correct portfolio size\r\n    const accountingAwarePL = calculateTradePL({...trade, plRs}, useCashBasis);\r\n    const accountingAwarePortfolioSize = getTruePortfolioSize ?\r\n      (() => {\r\n        try {\r\n          const relevantDate = getTradeDateForAccounting(trade, useCashBasis);\r\n          const date = new Date(relevantDate);\r\n          const month = date.toLocaleString('default', { month: 'short' });\r\n          const year = date.getFullYear();\r\n          return getTruePortfolioSize(month, year) || 100000;\r\n        } catch {\r\n          return 100000;\r\n        }\r\n      })() : 100000;\r\n    const pfImpact = calcPFImpact(accountingAwarePL, accountingAwarePortfolioSize);\r\n\r\n    const finalOpenQty = Math.max(0, openQty);\r\n\r\n    // Destructure to omit openHeat if it exists on the trade object from localStorage\r\n    const { openHeat, ...restOfTrade } = trade as any; // Use 'as any' for robust destructuring if openHeat might not exist\r\n\r\n    // Calculate position status based on quantities ONLY if user has never manually set it\r\n    let calculatedPositionStatus = restOfTrade.positionStatus; // Keep existing by default\r\n\r\n    const hasUserEditedPositionStatus = restOfTrade._userEditedFields?.includes('positionStatus');\r\n    if (!hasUserEditedPositionStatus) {\r\n      // Auto-calculate position status only if user hasn't manually set it\r\n      if (finalOpenQty <= 0 && exitedQty > 0) {\r\n        calculatedPositionStatus = 'Closed';\r\n      } else if (exitedQty > 0 && finalOpenQty > 0) {\r\n        calculatedPositionStatus = 'Partial';\r\n      } else {\r\n        calculatedPositionStatus = 'Open';\r\n      }\r\n\r\n    }\r\n\r\n    // Preserve user-controlled fields that should not be auto-updated\r\n    const userControlledFields = ['positionStatus', 'buySell', 'setup', 'exitTrigger', 'proficiencyGrowthAreas', 'planFollowed', 'notes', 'tradeNo'];\r\n    const preservedFields: Record<string, any> = {};\r\n\r\n    userControlledFields.forEach(field => {\r\n      if (restOfTrade._userEditedFields?.includes(field) && restOfTrade[field as keyof Trade] !== undefined) {\r\n        preservedFields[field] = restOfTrade[field as keyof Trade];\r\n      }\r\n    });\r\n\r\n    return {\r\n      ...restOfTrade,\r\n      // Apply calculated fields\r\n      name: (restOfTrade.name || '').toUpperCase(),\r\n      avgEntry,\r\n      positionSize,\r\n      allocation,\r\n      slPercent,\r\n      openQty: finalOpenQty,\r\n      exitedQty,\r\n      avgExitPrice,\r\n      stockMove,\r\n      holdingDays,\r\n      realisedAmount,\r\n      plRs,\r\n      pfImpact,\r\n      positionStatus: calculatedPositionStatus, // Use calculated or preserved status\r\n      cummPf: 0, // Placeholder, will be updated in second pass\r\n      // Preserve user-edited fields\r\n      ...preservedFields,\r\n      // Always preserve the user edit tracking\r\n      _userEditedFields: restOfTrade._userEditedFields || []\r\n    };\r\n  });\r\n\r\n  // Second pass for cumulative calculations like cummPf\r\n  // Note: We'll calculate accounting-aware values at display time to improve performance\r\n  return calculatedTrades.map((trade, idx) => {\r\n    if (idx === 0) runningCummPf = 0; // Reset for each fresh calculation run\r\n\r\n    // For cumulative PF, we still need to calculate based on accounting method\r\n    // but we'll store both accrual and cash basis values to avoid recalculation\r\n    const accrualPL = trade.plRs || 0;\r\n    const cashPL = calculateTradePL(trade, true); // Cash basis P/L\r\n\r\n    // Helper function to get portfolio size based on accounting method\r\n    const getPortfolioSizeForAccounting = (useCashBasisForCalc: boolean) => {\r\n      if (!getTruePortfolioSize) return 100000;\r\n\r\n      try {\r\n        const relevantDate = getTradeDateForAccounting(trade, useCashBasisForCalc);\r\n        const date = new Date(relevantDate);\r\n        const month = date.toLocaleString('default', { month: 'short' });\r\n        const year = date.getFullYear();\r\n        return getTruePortfolioSize(month, year) || 100000;\r\n      } catch {\r\n        return 100000;\r\n      }\r\n    };\r\n\r\n    // Get portfolio sizes for both accounting methods\r\n    const accrualPortfolioSize = getPortfolioSizeForAccounting(false); // Entry date portfolio\r\n    const cashPortfolioSize = getPortfolioSizeForAccounting(true);     // Exit date portfolio\r\n\r\n    // Calculate PF impact using correct portfolio size for each method\r\n    const accrualPfImpact = trade.positionStatus !== 'Open' ?\r\n      calcPFImpact(accrualPL, accrualPortfolioSize) : 0;\r\n    const cashPfImpact = trade.positionStatus !== 'Open' ?\r\n      calcPFImpact(cashPL, cashPortfolioSize) : 0;\r\n\r\n    // Use the appropriate method for cumulative calculation\r\n    const currentPfImpact = useCashBasis ? cashPfImpact : accrualPfImpact;\r\n    runningCummPf += currentPfImpact;\r\n\r\n    // Store both values to avoid recalculation at display time\r\n    return {\r\n      ...trade,\r\n      // Store both accounting method values\r\n      _accrualPL: accrualPL,\r\n      _cashPL: cashPL,\r\n      _accrualPfImpact: accrualPfImpact,\r\n      _cashPfImpact: cashPfImpact,\r\n      cummPf: runningCummPf,\r\n    };\r\n  });\r\n}\r\n\r\n// Define ALL_COLUMNS here, as it's closely tied to the hook's state\r\nconst ALL_COLUMNS = [\r\n  'tradeNo', 'date', 'name', 'setup', 'buySell', 'entry', 'sl', 'slPercent', 'tsl', 'cmp',\r\n  'initialQty', 'pyramid1Price', 'pyramid1Qty', 'pyramid1Date', 'pyramid2Price', 'pyramid2Qty', 'pyramid2Date',\r\n  'positionSize', 'allocation', 'exit1Price', 'exit1Qty', 'exit1Date', 'exit2Price', 'exit2Qty', 'exit2Date',\r\n  'exit3Price', 'exit3Qty', 'exit3Date', 'openQty', 'exitedQty', 'avgExitPrice', 'stockMove', 'openHeat',\r\n  'rewardRisk', 'holdingDays', 'positionStatus', 'realisedAmount', 'plRs', 'pfImpact', 'cummPf',\r\n  'planFollowed', 'exitTrigger', 'proficiencyGrowthAreas', 'unrealizedPL', 'actions', 'notes'\r\n];\r\n\r\n// All columns enabled by default as requested\r\nconst DEFAULT_VISIBLE_COLUMNS = [\r\n  'tradeNo', 'date', 'name', 'setup', 'buySell', 'entry', 'avgEntry', 'sl', 'slPercent', 'tsl', 'cmp',\r\n  'initialQty', 'pyramid1Price', 'pyramid1Qty', 'pyramid1Date', 'pyramid2Price', 'pyramid2Qty', 'pyramid2Date',\r\n  'positionSize', 'allocation', 'exit1Price', 'exit1Qty', 'exit1Date', 'exit2Price', 'exit2Qty', 'exit2Date',\r\n  'exit3Price', 'exit3Qty', 'exit3Date', 'openQty', 'exitedQty', 'avgExitPrice', 'stockMove', 'openHeat',\r\n  'rewardRisk', 'holdingDays', 'positionStatus', 'realisedAmount', 'plRs', 'pfImpact', 'cummPf',\r\n  'planFollowed', 'exitTrigger', 'proficiencyGrowthAreas', 'chartAttachments', 'actions', 'unrealizedPL', 'notes'\r\n];\r\n\r\nexport const useTrades = () => {\r\n  const [trades, setTrades] = React.useState<Trade[]>([]);\r\n  const [isLoading, setIsLoading] = React.useState(true);\r\n  const [isRecalculating, setIsRecalculating] = React.useState(false);\r\n  const [searchQuery, setSearchQuery] = React.useState('');\r\n  const [statusFilter, setStatusFilter] = React.useState('');\r\n  const [sortDescriptor, setSortDescriptor] = React.useState<SortDescriptor>({ column: 'tradeNo', direction: 'ascending' });\r\n  const [visibleColumns, setVisibleColumns] = React.useState<string[]>(DEFAULT_VISIBLE_COLUMNS);\r\n  const { filter: globalFilter } = useGlobalFilter();\r\n  const { accountingMethod } = useAccountingMethod();\r\n  const useCashBasis = accountingMethod === 'cash';\r\n\r\n  // Track previous accounting method to avoid unnecessary recalculations\r\n  const prevAccountingMethodRef = React.useRef<string>(accountingMethod);\r\n\r\n  // Get true portfolio functions - use empty array to avoid circular dependency\r\n  const { portfolioSize, getPortfolioSize } = useTruePortfolioWithTrades([]);\r\n\r\n  // Memoize the recalculation helper that wraps the pure `recalculateAllTrades` function.\r\n  // Use a stable reference to getPortfolioSize to prevent infinite loops\r\n  const stableGetPortfolioSize = React.useCallback((month: string, year: number) => {\r\n    return getPortfolioSize(month, year);\r\n  }, [getPortfolioSize]);\r\n\r\n  const recalculateTradesWithCurrentPortfolio = React.useCallback((tradesToRecalculate: Trade[], skipExpensiveCalculations: boolean = false) => {\r\n    return recalculateAllTrades(tradesToRecalculate, stableGetPortfolioSize, useCashBasis, skipExpensiveCalculations);\r\n  }, [stableGetPortfolioSize, useCashBasis]);\r\n\r\n  // Performance optimization: Cache expensive calculations\r\n  const calculationCache = React.useRef(new Map<string, any>());\r\n  const lastCalculationHash = React.useRef<string>('');\r\n\r\n  // PERFORMANCE OPTIMIZATION: Smart memoization with incremental updates\r\n  const processedTrades = React.useMemo(() => {\r\n    const startTime = performance.now();\r\n\r\n    // Create a lightweight hash for change detection\r\n    const currentHash = `${trades.length}-${searchQuery}-${statusFilter}-${sortDescriptor.column}-${sortDescriptor.direction}-${globalFilter}-${accountingMethod}`;\r\n\r\n    // Return cached result if nothing changed\r\n    if (currentHash === lastCalculationHash.current && calculationCache.current.has('processedTrades')) {\r\n      const cached = calculationCache.current.get('processedTrades');\r\n      console.log(`⚡ Processed trades from cache in ${Math.round(performance.now() - startTime)}ms`);\r\n      return cached;\r\n    }\r\n\r\n    let filtered = trades;\r\n\r\n    // Optimized search filter with early termination\r\n    if (searchQuery) {\r\n      const query = searchQuery.toLowerCase();\r\n      filtered = filtered.filter(trade => {\r\n        // Check most common fields first for early termination\r\n        return trade.name?.toLowerCase().includes(query) ||\r\n               trade.tradeNo?.toLowerCase().includes(query) ||\r\n               trade.setup?.toLowerCase().includes(query) ||\r\n               trade.notes?.toLowerCase().includes(query);\r\n      });\r\n    }\r\n\r\n    // Apply status filter (most selective first)\r\n    if (statusFilter) {\r\n      filtered = filtered.filter(trade => trade.positionStatus === statusFilter);\r\n    }\r\n\r\n    // Apply global date filter with optimized date checking\r\n    if (globalFilter && (globalFilter as any) !== 'all') {\r\n      filtered = filtered.filter(trade => isInGlobalFilter(trade as any, globalFilter as any));\r\n    }\r\n\r\n    // Optimized sorting with stable sort\r\n    if (sortDescriptor.column) {\r\n      const column = sortDescriptor.column as keyof Trade;\r\n      const isDescending = sortDescriptor.direction === 'descending';\r\n\r\n      filtered = [...filtered].sort((a, b) => {\r\n        const aValue = a[column];\r\n        const bValue = b[column];\r\n\r\n        // Handle null/undefined values\r\n        if (aValue == null && bValue == null) return 0;\r\n        if (aValue == null) return isDescending ? 1 : -1;\r\n        if (bValue == null) return isDescending ? -1 : 1;\r\n\r\n        // Optimized comparison\r\n        let result = 0;\r\n        if (typeof aValue === 'number' && typeof bValue === 'number') {\r\n          result = aValue - bValue;\r\n        } else {\r\n          result = String(aValue).localeCompare(String(bValue));\r\n        }\r\n\r\n        return isDescending ? -result : result;\r\n      });\r\n    }\r\n\r\n    // Cache the result\r\n    calculationCache.current.set('processedTrades', filtered);\r\n    lastCalculationHash.current = currentHash;\r\n\r\n    const endTime = performance.now();\r\n    console.log(`⚡ Processed ${filtered.length} trades in ${Math.round(endTime - startTime)}ms`);\r\n\r\n    return filtered;\r\n  }, [trades, searchQuery, statusFilter, sortDescriptor, globalFilter, accountingMethod]);\r\n\r\n  // Memory usage monitor\r\n  React.useEffect(() => {\r\n    const checkMemoryUsage = () => {\r\n      if ('memory' in performance) {\r\n        const memInfo = (performance as any).memory;\r\n        const usedMB = memInfo.usedJSHeapSize / 1024 / 1024;\r\n        const limitMB = memInfo.jsHeapSizeLimit / 1024 / 1024;\r\n\r\n        if (usedMB > limitMB * 0.8) { // If using more than 80% of available memory\r\n\r\n          // Force garbage collection if available\r\n          if (window.gc) {\r\n            try {\r\n              window.gc();\r\n\r\n            } catch (error) {\r\n\r\n            }\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    const interval = setInterval(checkMemoryUsage, 30000); // Check every 30 seconds\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  // Performance optimization: Cache for expensive calculations\r\n  const tradesCache = React.useRef(new Map<string, Trade[]>());\r\n  const settingsCache = React.useRef<any>(null);\r\n  const lastLoadTime = React.useRef<number>(0);\r\n\r\n  // Load from Supabase with aggressive caching and background processing\r\n  React.useEffect(() => {\r\n    const loadData = async () => {\r\n      const startTime = performance.now();\r\n\r\n      // Check if we have recent cached data (within 30 seconds)\r\n      const now = Date.now();\r\n      if (now - lastLoadTime.current < 30000 && tradesCache.current.has('trades')) {\r\n        const cachedTrades = tradesCache.current.get('trades')!;\r\n        setTrades(cachedTrades);\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      setIsLoading(true);\r\n\r\n      try {\r\n        // Load data in parallel for maximum speed\r\n        const [loadedTrades, settings] = await Promise.all([\r\n          getTradesFromSupabase(),\r\n          settingsCache.current || getTradeSettings()\r\n        ]);\r\n\r\n        // Cache settings for future use\r\n        if (settings) {\r\n          settingsCache.current = settings;\r\n        }\r\n\r\n        // CRITICAL PERFORMANCE OPTIMIZATION:\r\n        // Skip expensive calculations on initial load - do them in background\r\n        const quickTrades = loadedTrades.length > 0 ?\r\n          recalculateTradesWithCurrentPortfolio(loadedTrades, true) : []; // Skip expensive calculations\r\n\r\n        // Extract settings values\r\n        const savedSearchQuery = settings?.search_query || '';\r\n        const savedStatusFilter = settings?.status_filter || '';\r\n\r\n        // Set state immediately with quick calculations for instant UI\r\n        setTrades(quickTrades);\r\n        setSearchQuery(savedSearchQuery);\r\n        setStatusFilter(savedStatusFilter);\r\n        setSortDescriptor(settings?.sort_descriptor || { column: 'tradeNo', direction: 'ascending' });\r\n        setVisibleColumns(settings?.visible_columns || DEFAULT_VISIBLE_COLUMNS);\r\n\r\n        // Cache the data\r\n        tradesCache.current.set('trades', quickTrades);\r\n        lastLoadTime.current = now;\r\n\r\n        // Mark as loaded immediately for fast UI\r\n        setIsLoading(false);\r\n\r\n        // BACKGROUND PROCESSING: Do full calculations after UI is ready\r\n        setTimeout(async () => {\r\n          if (loadedTrades.length > 0) {\r\n            const fullyCalculatedTrades = recalculateTradesWithCurrentPortfolio(loadedTrades, false);\r\n            setTrades(fullyCalculatedTrades);\r\n            tradesCache.current.set('trades', fullyCalculatedTrades);\r\n          }\r\n        }, 100); // Small delay to let UI render first\r\n\r\n      } catch (error) {\r\n        console.error('Failed to load trades:', error);\r\n        setTrades([]);\r\n      } finally {\r\n        const endTime = performance.now();\r\n        console.log(`⚡ Trade loading completed in ${Math.round(endTime - startTime)}ms`);\r\n      }\r\n    };\r\n\r\n    loadData();\r\n  }, []); // Empty dependency array means it runs only once on mount.\r\n\r\n  // Save trade settings to IndexedDB\r\n  React.useEffect(() => {\r\n    if (!isLoading) {\r\n      const settings = {\r\n        search_query: searchQuery,\r\n        status_filter: statusFilter,\r\n        sort_descriptor: sortDescriptor,\r\n        visible_columns: visibleColumns\r\n      };\r\n      saveTradeSettings(settings);\r\n    }\r\n  }, [searchQuery, statusFilter, sortDescriptor, visibleColumns, isLoading]);\r\n\r\n  // DISABLED: This effect was causing race conditions with user input\r\n  // localStorage saving is now handled directly in updateTrade, addTrade, deleteTrade functions\r\n  // React.useEffect(() => {\r\n  //   if (trades.length > 0 || !isLoading) {\r\n  //     const timeoutId = setTimeout(() => {\r\n  //       saveTradesToLocalStorage(trades);\r\n  //     }, 100);\r\n  //     return () => clearTimeout(timeoutId);\r\n  //   }\r\n  // }, [trades, isLoading]);\r\n\r\n  // Recalculate trades when accounting method changes (optimized to prevent excessive re-renders)\r\n  React.useEffect(() => {\r\n    // Only recalculate if accounting method actually changed\r\n    if (prevAccountingMethodRef.current !== accountingMethod && !isLoading && trades.length > 0) {\r\n\r\n      // Debounce the recalculation to prevent rapid successive calls\r\n      const timeoutId = setTimeout(() => {\r\n        // Use the pure function directly to avoid circular dependency\r\n        const recalculatedTrades = recalculateAllTrades(trades, stableGetPortfolioSize, useCashBasis, false);\r\n        setTrades(recalculatedTrades);\r\n      }, 100); // Small delay to batch any rapid changes\r\n\r\n      // Update the ref to track the new accounting method\r\n      prevAccountingMethodRef.current = accountingMethod;\r\n\r\n      return () => clearTimeout(timeoutId);\r\n    }\r\n  }, [accountingMethod]); // Only depend on accounting method to avoid circular dependencies\r\n\r\n  const addTrade = React.useCallback(async (trade: Trade) => {\r\n    // CRITICAL FIX: Update chart blob tradeIds if this trade has chart attachments\r\n    if (trade.chartAttachments && (trade.chartAttachments.beforeEntry || trade.chartAttachments.afterExit)) {\r\n      try {\r\n        // Update beforeEntry blob if exists\r\n        if (trade.chartAttachments.beforeEntry?.storage === 'blob' && trade.chartAttachments.beforeEntry.blobId) {\r\n          await SupabaseService.updateChartImageBlobTradeId(trade.chartAttachments.beforeEntry.blobId, trade.id);\r\n          }\r\n\r\n        // Update afterExit blob if exists\r\n        if (trade.chartAttachments.afterExit?.storage === 'blob' && trade.chartAttachments.afterExit.blobId) {\r\n          await SupabaseService.updateChartImageBlobTradeId(trade.chartAttachments.afterExit.blobId, trade.id);\r\n          }\r\n      } catch (error) {\r\n        }\r\n    }\r\n\r\n    setTrades(prev => {\r\n      // Add new trade to the array\r\n      const combinedTrades = [...prev, trade];\r\n\r\n      // Sort all trades by date to ensure proper chronological order (with safe date parsing)\r\n      combinedTrades.sort((a, b) => {\r\n        const dateA = new Date(a.date);\r\n        const dateB = new Date(b.date);\r\n\r\n        // Handle invalid dates by putting them at the end\r\n        if (isNaN(dateA.getTime()) && isNaN(dateB.getTime())) return 0;\r\n        if (isNaN(dateA.getTime())) return 1;\r\n        if (isNaN(dateB.getTime())) return -1;\r\n\r\n        return dateA.getTime() - dateB.getTime();\r\n      });\r\n\r\n      // Reassign sequential trade numbers based on chronological order\r\n      combinedTrades.forEach((t, index) => {\r\n        t.tradeNo = String(index + 1);\r\n      });\r\n\r\n      // Use the memoized recalculation helper\r\n      const newTrades = recalculateTradesWithCurrentPortfolio(combinedTrades);\r\n      // Persist to Supabase asynchronously\r\n      saveTradesToSupabase(newTrades).then(success => {\r\n        if (!success) {\r\n          }\r\n      }).catch(error => {\r\n        });\r\n\r\n      return newTrades;\r\n    });\r\n  }, [recalculateTradesWithCurrentPortfolio]); // Dependency on the memoized helper\r\n\r\n  // Debounced update function to prevent excessive recalculations\r\n  const debouncedRecalculateRef = React.useRef<NodeJS.Timeout | null>(null);\r\n  const pendingUpdatesRef = React.useRef<Map<string, Trade>>(new Map());\r\n  const updateCallbacksRef = React.useRef<Map<string, () => void>>(new Map());\r\n\r\n  const updateTrade = React.useCallback(async (updatedTrade: Trade, onComplete?: () => void) => {\r\n    // CRITICAL FIX: Update chart blob tradeIds if this trade has chart attachments\r\n    if (updatedTrade.chartAttachments && (updatedTrade.chartAttachments.beforeEntry || updatedTrade.chartAttachments.afterExit)) {\r\n      try {\r\n        // Update beforeEntry blob if exists\r\n        if (updatedTrade.chartAttachments.beforeEntry?.storage === 'blob' && updatedTrade.chartAttachments.beforeEntry.blobId) {\r\n          await SupabaseService.updateChartImageBlobTradeId(updatedTrade.chartAttachments.beforeEntry.blobId, updatedTrade.id);\r\n          }\r\n\r\n        // Update afterExit blob if exists\r\n        if (updatedTrade.chartAttachments.afterExit?.storage === 'blob' && updatedTrade.chartAttachments.afterExit.blobId) {\r\n          await SupabaseService.updateChartImageBlobTradeId(updatedTrade.chartAttachments.afterExit.blobId, updatedTrade.id);\r\n          }\r\n      } catch (error) {\r\n        }\r\n    }\r\n\r\n    // Store pending update\r\n    pendingUpdatesRef.current.set(updatedTrade.id, updatedTrade);\r\n    // Store callback if provided\r\n    if (onComplete) {\r\n      updateCallbacksRef.current.set(updatedTrade.id, onComplete);\r\n    }\r\n\r\n    // Clear existing debounce timer\r\n    if (debouncedRecalculateRef.current) {\r\n      clearTimeout(debouncedRecalculateRef.current);\r\n      }\r\n\r\n    // Schedule debounced recalculation\r\n    debouncedRecalculateRef.current = setTimeout(() => {\r\n      // Get all pending updates and callbacks\r\n      const pendingUpdates = Array.from(pendingUpdatesRef.current.values());\r\n      const callbacks = Array.from(updateCallbacksRef.current.values());\r\n      // Clear pending updates and callbacks\r\n      pendingUpdatesRef.current.clear();\r\n      updateCallbacksRef.current.clear();\r\n\r\n      // Apply all pending updates and recalculate\r\n      setTrades(currentTrades => {\r\n        const updatedTrades = currentTrades.map(trade => {\r\n          // CRITICAL FIX: Handle cash basis expanded trade IDs\r\n          // Find pending updates by checking both exact ID match and original ID match\r\n          const pendingUpdate = pendingUpdates.find(update => {\r\n            // Direct match (for accrual basis or exact expanded trade match)\r\n            if (update.id === trade.id) return true;\r\n\r\n            // Original ID match (for cash basis expanded trades)\r\n            const originalUpdateId = update.id.includes('_exit_') ? update.id.split('_exit_')[0] : update.id;\r\n            const originalTradeId = trade.id.includes('_exit_') ? trade.id.split('_exit_')[0] : trade.id;\r\n\r\n            // Match if both resolve to the same original trade ID\r\n            return originalUpdateId === originalTradeId;\r\n          });\r\n\r\n          if (pendingUpdate) {\r\n            // CRITICAL: For cash basis updates, we need to merge the changes into the original tradeiginal trade\r\n            // but preserve the original trade ID (not the expanded ID)\r\n            const updatedTrade = { ...pendingUpdate, id: trade.id };\r\n            return updatedTrade;\r\n          }\r\n          return trade;\r\n        });\r\n\r\n        const recalculatedTrades = recalculateTradesWithCurrentPortfolio(updatedTrades);\r\n\r\n        saveTradesToSupabase(recalculatedTrades).then(saveSuccess => {\r\n          });\r\n\r\n        // Execute all callbacks after update is complete\r\n        callbacks.forEach(callback => {\r\n          try {\r\n            callback();\r\n          } catch (error) {\r\n            }\r\n        });\r\n\r\n        return recalculatedTrades;\r\n      });\r\n    }, 200); // Reduced to 200ms to prevent race conditions with user input\r\n  }, [recalculateTradesWithCurrentPortfolio]);\r\n\r\n  const deleteTrade = React.useCallback(async (id: string) => {\r\n    // CRITICAL FIX: Handle cash basis expanded trade IDs\r\n    // Extract original trade ID from expanded IDs like \"original_id_exit_0\"\r\n    const originalTradeId = id.includes('_exit_') ? id.split('_exit_')[0] : id;\r\n\r\n    // First, delete associated chart images\r\n    try {\r\n      const { ChartImageService } = await import('../services/chartImageService');\r\n      const chartImagesDeleted = await ChartImageService.deleteTradeChartImages(originalTradeId);\r\n      } catch (error) {\r\n      // Continue with trade deletion even if chart deletion fails\r\n    }\r\n\r\n    setTrades(prev => {\r\n      // Find the trade to delete using the original ID\r\n      const tradeToDelete = prev.find(trade => trade.id === originalTradeId);\r\n      if (!tradeToDelete) {\r\n        console.warn('Trade not found for deletion:', originalTradeId);\r\n        return prev; // Return unchanged if trade not found\r\n      }\r\n\r\n      // Filter out the trade using the original ID\r\n      const filteredTrades = prev.filter(trade => trade.id !== originalTradeId);\r\n      // Use the memoized recalculation helper\r\n      const newTrades = recalculateTradesWithCurrentPortfolio(filteredTrades);\r\n      // Persist to Supabase\r\n      saveTradesToSupabase(newTrades).then(saveSuccess => {\r\n        });\r\n\r\n      return newTrades;\r\n    });\r\n  }, [recalculateTradesWithCurrentPortfolio]);\r\n\r\n  // Bulk import function for better performance with optimized calculations\r\n  const bulkImportTrades = React.useCallback((importedTrades: Trade[]) => {\r\n    const startTime = performance.now();\r\n\r\n    setTrades(prev => {\r\n      // Combine existing trades with imported trades\r\n      const combinedTrades = [...importedTrades, ...prev];\r\n\r\n      // Sort all trades by date to ensure proper chronological order (with safe date parsing)\r\n      combinedTrades.sort((a, b) => {\r\n        const dateA = new Date(a.date);\r\n        const dateB = new Date(b.date);\r\n\r\n        // Handle invalid dates by putting them at the end\r\n        if (isNaN(dateA.getTime()) && isNaN(dateB.getTime())) return 0;\r\n        if (isNaN(dateA.getTime())) return 1;\r\n        if (isNaN(dateB.getTime())) return -1;\r\n\r\n        return dateA.getTime() - dateB.getTime();\r\n      });\r\n\r\n      // Reassign sequential trade numbers based on chronological order\r\n      combinedTrades.forEach((trade, index) => {\r\n        trade.tradeNo = String(index + 1);\r\n      });\r\n\r\n      // First pass: Skip expensive calculations for faster import\r\n      const quickProcessedTrades = recalculateTradesWithCurrentPortfolio(combinedTrades, true);\r\n      // Save to Supabase asynchronously\r\n      saveTradesToSupabase(quickProcessedTrades).then(success => {\r\n        });\r\n\r\n      const endTime = performance.now();\r\n      // Schedule full recalculation in the background after a short delay\r\n      setTimeout(() => {\r\n        const recalcStartTime = performance.now();\r\n        setIsRecalculating(true);\r\n\r\n        setTrades(currentTrades => {\r\n          const fullyCalculatedTrades = recalculateTradesWithCurrentPortfolio(currentTrades, false);\r\n          // Save fully calculated trades to Supabase\r\n          saveTradesToSupabase(fullyCalculatedTrades).then(success => {\r\n            });\r\n\r\n          const recalcEndTime = performance.now();\r\n\r\n          setIsRecalculating(false);\r\n          return fullyCalculatedTrades;\r\n        });\r\n      }, 100); // Small delay to allow UI to update\r\n\r\n      return quickProcessedTrades;\r\n    });\r\n  }, [recalculateTradesWithCurrentPortfolio]);\r\n\r\n  const clearAllTrades = React.useCallback(async () => {\r\n    const success = await clearAllTradeAndSettingsData();\r\n\r\n    if (success) {\r\n      // Reset all React state to initial values\r\n      setTrades([]);\r\n      setSearchQuery('');\r\n      setStatusFilter('');\r\n      setSortDescriptor({ column: 'tradeNo', direction: 'ascending' });\r\n      setVisibleColumns(DEFAULT_VISIBLE_COLUMNS);\r\n      setIsLoading(false);\r\n\r\n      // Force garbage collection if available (Chrome DevTools)\r\n      if (window.gc) {\r\n        try {\r\n          window.gc();\r\n          } catch (error) {\r\n          }\r\n      }\r\n\r\n      // Clear any cached data in memory\r\n      if (typeof window !== 'undefined') {\r\n        // Clear any global variables that might hold trade data\r\n        (window as any).tradeCache = undefined;\r\n        (window as any).portfolioCache = undefined;\r\n        (window as any).settingsCache = undefined;\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }, []);\r\n\r\n  // Helper function to get accounting-aware values for display (FIXED - always calculate)\r\n  const getAccountingAwareValues = React.useCallback((trade: Trade) => {\r\n    // CRITICAL FIX: For cash basis, properly handle expanded trades to get total P/L\r\n    let plRs = 0;\r\n    let realisedAmount = 0;\r\n\r\n    if (useCashBasis && trade._expandedTrades && trade._expandedTrades.length > 0) {\r\n      // For cash basis with expanded trades, sum up all exit P/L and values\r\n      plRs = trade._expandedTrades.reduce((sum, expandedTrade) => {\r\n        return sum + calculateTradePL(expandedTrade, true);\r\n      }, 0);\r\n\r\n      realisedAmount = trade._expandedTrades.reduce((sum, expandedTrade) => {\r\n        if (expandedTrade._cashBasisExit) {\r\n          const exitValue = expandedTrade._cashBasisExit.qty * expandedTrade._cashBasisExit.price;\r\n          return sum + exitValue;\r\n        }\r\n        return sum;\r\n      }, 0);\r\n    } else {\r\n      // For accrual basis or trades without expanded data, use the standard calculation\r\n      plRs = calculateTradePL(trade, useCashBasis);\r\n      realisedAmount = trade.realisedAmount || (trade.exitedQty * trade.avgExitPrice) || 0;\r\n    }\r\n\r\n    // Calculate portfolio impact based on the calculated P/L\r\n    const currentPortfolioSize = getPortfolioSize ?\r\n      (() => {\r\n        const tradeDate = new Date(trade.date);\r\n        const month = tradeDate.toLocaleString('default', { month: 'short' });\r\n        const year = tradeDate.getFullYear();\r\n        return getPortfolioSize(month, year);\r\n      })() : portfolioSize;\r\n\r\n    const pfImpact = currentPortfolioSize > 0 ? (plRs / currentPortfolioSize) * 100 : 0;\r\n\r\n    return {\r\n      plRs,\r\n      realisedAmount,\r\n      pfImpact,\r\n    };\r\n  }, [useCashBasis, calculateTradePL, getPortfolioSize, portfolioSize]);\r\n\r\n  // Helper function to group expanded trades for display\r\n  const groupTradesForDisplay = React.useCallback((expandedTrades: Trade[]) => {\r\n    if (!useCashBasis) return expandedTrades;\r\n\r\n    const groupedMap = new Map<string, Trade>();\r\n    const expandedTradesMap = new Map<string, Trade[]>();\r\n\r\n    expandedTrades.forEach(trade => {\r\n      const originalId = trade.id.split('_exit_')[0];\r\n\r\n      if (trade._cashBasisExit) {\r\n        // This is an expanded trade for cash basis\r\n        if (!expandedTradesMap.has(originalId)) {\r\n          expandedTradesMap.set(originalId, []);\r\n        }\r\n        expandedTradesMap.get(originalId)!.push(trade);\r\n      } else {\r\n        // This is an original trade (open position or single exit)\r\n        groupedMap.set(originalId, trade);\r\n      }\r\n    });\r\n\r\n    // Merge expanded trades back into single display entries\r\n    expandedTradesMap.forEach((expandedTrades, originalId) => {\r\n      if (expandedTrades.length === 0) return;\r\n\r\n      // Use the first expanded trade as base and aggregate the cash basis data\r\n      const baseTrade = expandedTrades[0];\r\n      const aggregatedTrade: Trade = {\r\n        ...baseTrade,\r\n        id: originalId, // Use original ID for display\r\n        // Aggregate P/L from all exits for display\r\n        plRs: expandedTrades.reduce((sum, t) => sum + (calculateTradePL(t, true) || 0), 0),\r\n        // Keep the latest exit date for sorting\r\n        _cashBasisExit: expandedTrades.reduce((latest, current) => {\r\n          if (!latest || !current._cashBasisExit) return current._cashBasisExit;\r\n          if (!latest.date || !current._cashBasisExit.date) return latest;\r\n          return new Date(current._cashBasisExit.date) > new Date(latest.date) ? current._cashBasisExit : latest;\r\n        }, expandedTrades[0]._cashBasisExit),\r\n        // Store expanded trades for backend calculations\r\n        _expandedTrades: expandedTrades\r\n      };\r\n\r\n      groupedMap.set(originalId, aggregatedTrade);\r\n    });\r\n\r\n    return Array.from(groupedMap.values());\r\n  }, [useCashBasis, calculateTradePL]);\r\n\r\n  const filteredTrades = React.useMemo(() => {\r\n    let result = [...trades];\r\n\r\n    // For cash basis, we need to handle trade filtering differently\r\n    // Instead of filtering trades, we need to expand trades with multiple exits\r\n    if (useCashBasis) {\r\n      // Expand trades with multiple exits into separate entries for cash basis\r\n      const expandedTrades: Trade[] = [];\r\n      const debugExpandedMap: Record<string, Trade[]> = {};\r\n\r\n      result.forEach(trade => {\r\n        if (trade.positionStatus === 'Closed' || trade.positionStatus === 'Partial') {\r\n          // Get all exits for this trade\r\n          const exits = [\r\n            { date: trade.exit1Date, qty: trade.exit1Qty || 0, price: trade.exit1Price || 0 },\r\n            { date: trade.exit2Date, qty: trade.exit2Qty || 0, price: trade.exit2Price || 0 },\r\n            { date: trade.exit3Date, qty: trade.exit3Qty || 0, price: trade.exit3Price || 0 }\r\n          ].filter(exit => exit.date && exit.date.trim() !== '' && exit.qty > 0);\r\n\r\n          if (exits.length > 0) {\r\n            // Create a trade entry for each exit (for cash basis)\r\n            exits.forEach((exit, exitIndex) => {\r\n              const expandedTrade: Trade = {\r\n                ...trade,\r\n                id: trade.id + '_exit_' + exitIndex,\r\n                _cashBasisExit: {\r\n                  date: exit.date,\r\n                  qty: exit.qty,\r\n                  price: exit.price\r\n                }\r\n              };\r\n              expandedTrades.push(expandedTrade);\r\n              if (!debugExpandedMap[trade.id]) debugExpandedMap[trade.id] = [];\r\n              debugExpandedMap[trade.id].push(expandedTrade);\r\n            });\r\n          } else {\r\n\r\n            // Fallback: if no individual exit data, use the original trade\r\n            expandedTrades.push(trade);\r\n            if (!debugExpandedMap[trade.id]) debugExpandedMap[trade.id] = [];\r\n            debugExpandedMap[trade.id].push(trade);\r\n          }\r\n        } else {\r\n          // For open positions, include as-is\r\n          expandedTrades.push(trade);\r\n        }\r\n      });\r\n\r\n      // CRITICAL FIX: Apply global filter to expanded trades BEFORE grouping\r\n      // This ensures trades with multiple exits are properly filtered by each exit date\r\n      const filteredExpandedTrades = expandedTrades.filter(trade => {\r\n        const relevantDate = getTradeDateForAccounting(trade, useCashBasis);\r\n        return isInGlobalFilter(relevantDate, globalFilter);\r\n      });\r\n\r\n      // Group filtered expanded trades for display while preserving backend calculations\r\n      result = groupTradesForDisplay(filteredExpandedTrades);\r\n    } else {\r\n      // Apply global filter using accounting method-aware date for accrual basis\r\n      result = result.filter(trade => {\r\n        const relevantDate = getTradeDateForAccounting(trade, useCashBasis);\r\n        return isInGlobalFilter(relevantDate, globalFilter);\r\n      });\r\n    }\r\n\r\n    // Apply search filter\r\n    if (searchQuery) {\r\n      const lowerQuery = searchQuery.toLowerCase();\r\n      result = result.filter(trade =>\r\n        trade.name.toLowerCase().includes(lowerQuery) ||\r\n        trade.setup.toLowerCase().includes(lowerQuery) ||\r\n        trade.tradeNo.toLowerCase().includes(lowerQuery)\r\n      );\r\n    }\r\n\r\n    // Apply status filter\r\n    if (statusFilter) {\r\n      result = result.filter(trade => trade.positionStatus === statusFilter);\r\n    }\r\n\r\n    // Apply sorting\r\n    if (sortDescriptor.column && sortDescriptor.direction) {\r\n      result.sort((a, b) => {\r\n        const aValue = a[sortDescriptor.column as keyof Trade];\r\n        const bValue = b[sortDescriptor.column as keyof Trade];\r\n\r\n        let comparison = 0;\r\n        // Handle different data types for sorting\r\n        if (typeof aValue === 'number' && typeof bValue === 'number') {\r\n          comparison = aValue - bValue;\r\n        } else if (typeof aValue === 'string' && typeof bValue === 'string') {\r\n          // Special handling for date strings if your date format is sortable as string\r\n          if (sortDescriptor.column === 'date' || String(sortDescriptor.column).endsWith('Date')) {\r\n            comparison = new Date(aValue).getTime() - new Date(bValue).getTime();\r\n          } else {\r\n            comparison = aValue.localeCompare(bValue);\r\n          }\r\n        } else if (typeof aValue === 'boolean' && typeof bValue === 'boolean') {\r\n          comparison = (aValue === bValue) ? 0 : aValue ? -1 : 1;\r\n        } else {\r\n          // Fallback for other types or mixed types (treat as strings)\r\n          const StringA = String(aValue !== null && aValue !== undefined ? aValue : \"\");\r\n          const StringB = String(bValue !== null && bValue !== undefined ? bValue : \"\");\r\n          comparison = StringA.localeCompare(StringB);\r\n        }\r\n\r\n        // For cash basis, add secondary sorting to handle expanded trades properly\r\n        if (useCashBasis && comparison === 0) {\r\n          // If primary sort values are equal, sort by exit date for cash basis\r\n          const aExitDate = a._cashBasisExit?.date || a.date || '';\r\n          const bExitDate = b._cashBasisExit?.date || b.date || '';\r\n\r\n          if (aExitDate && bExitDate) {\r\n            const aTime = new Date(aExitDate).getTime();\r\n            const bTime = new Date(bExitDate).getTime();\r\n            comparison = aTime - bTime;\r\n          }\r\n        }\r\n\r\n        return sortDescriptor.direction === \"ascending\" ? comparison : -comparison;\r\n      });\r\n    }\r\n\r\n    // CRITICAL FIX: Recalculate cumulative PF based on display order\r\n    // This ensures cumulative values make sense based on how trades are actually shown\r\n    let runningDisplayCummPf = 0;\r\n    result = result.map((trade) => {\r\n      // For cash basis grouped trades, recalculate PF impact from expanded trades if available\r\n      let currentPfImpact = 0;\r\n      if (useCashBasis && trade._expandedTrades && trade._expandedTrades.length > 0) {\r\n        // Calculate total PF impact from all expanded trades\r\n        const totalPL = trade._expandedTrades.reduce((sum, expandedTrade) => {\r\n          return sum + calculateTradePL(expandedTrade, true);\r\n        }, 0);\r\n        // Get portfolio size for PF impact calculation\r\n        const tradeDate = new Date(trade.date);\r\n        const month = tradeDate.toLocaleString('default', { month: 'short' });\r\n        const year = tradeDate.getFullYear();\r\n        const portfolioSize = getPortfolioSize ? getPortfolioSize(month, year) : 100000;\r\n        currentPfImpact = portfolioSize > 0 ? (totalPL / portfolioSize) * 100 : 0;\r\n      } else {\r\n        // Use cached values or fallback calculation\r\n        currentPfImpact = useCashBasis\r\n          ? (trade._cashPfImpact ?? 0)\r\n          : (trade._accrualPfImpact ?? trade.pfImpact ?? 0);\r\n      }\r\n\r\n      // Only include PF Impact from closed/partial trades in cumulative calculation\r\n      if (trade.positionStatus !== 'Open') {\r\n        runningDisplayCummPf += currentPfImpact;\r\n      }\r\n\r\n      return {\r\n        ...trade,\r\n        cummPf: runningDisplayCummPf // Update with display-order cumulative PF\r\n      };\r\n    });\r\n\r\n    return result;\r\n  }, [trades, globalFilter, searchQuery, statusFilter, sortDescriptor, useCashBasis]);\r\n\r\n  return {\r\n    trades: filteredTrades, // Filtered and expanded trades for display\r\n    originalTrades: trades, // Original trades for unrealized P/L calculation\r\n    addTrade,\r\n    updateTrade,\r\n    deleteTrade,\r\n    bulkImportTrades,\r\n    isLoading,\r\n    isRecalculating,\r\n    searchQuery,\r\n    setSearchQuery,\r\n    statusFilter,\r\n    setStatusFilter,\r\n    sortDescriptor,\r\n    setSortDescriptor,\r\n    visibleColumns,\r\n    setVisibleColumns,\r\n    clearAllTrades,\r\n    getAccountingAwareValues // Helper for getting accounting-aware display values\r\n  };\r\n};\r\n","import { Trade } from \"../types/trade\";\r\nimport { MonthlyTruePortfolio } from \"./TruePortfolioContext\";\r\nimport { calculateTradePL } from \"./accountingUtils\";\r\n\r\nexport interface Milestone {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  icon: string;\r\n  level: number; // For tiered milestones, e.g., 10 trades, 100 trades\r\n  criteria: (\r\n    trades: Trade[],\r\n    monthlyPortfolios: MonthlyTruePortfolio[],\r\n    currentPortfolioSize: number,\r\n    yearlyStartingCapitals: { year: number; startingCapital: number; updatedAt: string; }[],\r\n    useCashBasis?: boolean\r\n  ) => boolean;\r\n}\r\n\r\nexport const ALL_MILESTONES: Milestone[] = [\r\n  {\r\n    id: \"first-trade\",\r\n    name: \"First Trade!\",\r\n    description: \"You've recorded your very first trade. The journey begins!\",\r\n    icon: \"lucide:dollar-sign\",\r\n    level: 1,\r\n    criteria: (trades) => trades.length >= 1,\r\n  },\r\n  {\r\n    id: \"profitable-trade\",\r\n    name: \"First Win!\",\r\n    description: \"You've successfully closed your first profitable trade.\",\r\n    icon: \"lucide:trending-up\",\r\n    level: 1,\r\n    criteria: (trades, monthlyPortfolios, currentPortfolioSize, yearlyStartingCapitals, useCashBasis = false) =>\r\n      trades.some((trade) => calculateTradePL(trade, useCashBasis) > 0),\r\n  },\r\n  {\r\n    id: \"ten-trades\",\r\n    name: \"Getting Started\",\r\n    description: \"You've completed 10 trades. Keep learning!\",\r\n    icon: \"lucide:number-ten\",\r\n    level: 1,\r\n    criteria: (trades) => trades.length >= 10,\r\n  },\r\n  {\r\n    id: \"hundred-trades\",\r\n    name: \"Centurion Trader\",\r\n    description: \"You've completed 100 trades. You're building serious experience.\",\r\n    icon: \"lucide:bar-chart-2\",\r\n    level: 2,\r\n    criteria: (trades) => trades.length >= 100,\r\n  },\r\n  {\r\n    id: \"five-hundred-trades\",\r\n    name: \"Veteran Volume\",\r\n    description: \"You've completed 500 trades! A true market participant.\",\r\n    icon: \"lucide:rocket\",\r\n    level: 3,\r\n    criteria: (trades) => trades.length >= 500,\r\n  },\r\n  {\r\n    id: \"first-profitable-month\",\r\n    name: \"Monthly Maestro\",\r\n    description: \"You've finished a calendar month with a positive overall P&L.\",\r\n    icon: \"lucide:calendar-check\",\r\n    level: 1,\r\n    criteria: (trades, monthlyPortfolios, currentPortfolioSize, yearlyStartingCapitals, useCashBasis = false) =>\r\n      monthlyPortfolios.some((month) => month.pl > 0),\r\n  },\r\n  {\r\n    id: \"portfolio-growth-initial\",\r\n    name: \"Growth Sprout\",\r\n    description: \"Your portfolio has grown 10% beyond your initial starting capital.\",\r\n    icon: \"lucide:leaf\",\r\n    level: 1,\r\n    criteria: (trades, monthlyPortfolios, currentPortfolioSize, yearlyStartingCapitals) => {\r\n      const initialCapital = yearlyStartingCapitals[0]?.startingCapital || 0;\r\n      return initialCapital > 0 && currentPortfolioSize >= initialCapital * 1.10;\r\n    },\r\n  },\r\n  {\r\n    id: \"portfolio-growth-substantial\",\r\n    name: \"Steady Progress\",\r\n    description: \"Your portfolio has grown 25% beyond your initial starting capital.\",\r\n    icon: \"lucide:dollar-sign\",\r\n    level: 2,\r\n    criteria: (trades, monthlyPortfolios, currentPortfolioSize, yearlyStartingCapitals) => {\r\n      const initialCapital = yearlyStartingCapitals[0]?.startingCapital || 0;\r\n      return initialCapital > 0 && currentPortfolioSize >= initialCapital * 1.25;\r\n    },\r\n  },\r\n  {\r\n    id: \"portfolio-growth-significant\",\r\n    name: \"Market Mover\",\r\n    description: \"Your portfolio has grown 50% beyond your initial starting capital.\",\r\n    icon: \"lucide:trending-up\",\r\n    level: 3,\r\n    criteria: (trades, monthlyPortfolios, currentPortfolioSize, yearlyStartingCapitals) => {\r\n      const initialCapital = yearlyStartingCapitals[0]?.startingCapital || 0;\r\n      return initialCapital > 0 && currentPortfolioSize >= initialCapital * 1.50;\r\n    },\r\n  },\r\n  {\r\n    id: \"portfolio-growth-double\",\r\n    name: \"Double Trouble!\",\r\n    description: \"Your portfolio has doubled in size (100% growth) from your initial starting capital.\",\r\n    icon: \"lucide:trophy\",\r\n    level: 4,\r\n    criteria: (trades, monthlyPortfolios, currentPortfolioSize, yearlyStartingCapitals) => {\r\n      const initialCapital = yearlyStartingCapitals[0]?.startingCapital || 0;\r\n      return initialCapital > 0 && currentPortfolioSize >= initialCapital * 2.00;\r\n    },\r\n  },\r\n  {\r\n    id: \"high-win-rate\",\r\n    name: \"Consistent Winner\",\r\n    description: \"Achieved a 60% win rate over at least 50 closed trades.\",\r\n    icon: \"lucide:award\",\r\n    level: 1,\r\n    criteria: (trades, monthlyPortfolios, currentPortfolioSize, yearlyStartingCapitals, useCashBasis = false) => {\r\n      const closedTrades = trades.filter(trade => trade.positionStatus === 'Closed');\r\n      if (closedTrades.length < 50) return false;\r\n      const profitableTrades = closedTrades.filter(trade => calculateTradePL(trade, useCashBasis) > 0);\r\n      return (profitableTrades.length / closedTrades.length) >= 0.60;\r\n    },\r\n  },\r\n  {\r\n    id: \"five-consecutive-wins\",\r\n    name: \"Winning Streak!\",\r\n    description: \"Achieved 5 consecutive profitable closed trades.\",\r\n    icon: \"lucide:zap\",\r\n    level: 1,\r\n    criteria: (trades, monthlyPortfolios, currentPortfolioSize, yearlyStartingCapitals, useCashBasis = false) => {\r\n      const closedTrades = trades.filter(trade => trade.positionStatus === 'Closed');\r\n      if (closedTrades.length < 5) return false; // Need at least 5 trades to check for a streak\r\n      let consecutiveWins = 0;\r\n      for (let i = closedTrades.length - 1; i >= 0; i--) {\r\n        if (calculateTradePL(closedTrades[i], useCashBasis) > 0) {\r\n          consecutiveWins++;\r\n        } else {\r\n          consecutiveWins = 0;\r\n        }\r\n        if (consecutiveWins >= 5) return true;\r\n      }\r\n      return false;\r\n    },\r\n  },\r\n  {\r\n    id: \"below-ten-percent-drawdown\",\r\n    name: \"Risk Manager\",\r\n    description: \"Maintained overall portfolio drawdown below 10% for any given month.\",\r\n    icon: \"lucide:shield\",\r\n    level: 1,\r\n    criteria: (trades, monthlyPortfolios, currentPortfolioSize, yearlyStartingCapitals, useCashBasis = false) => {\r\n      return monthlyPortfolios.every(month => {\r\n        let runningMax = monthlyPortfolios[0]?.startingCapital || 0;\r\n        // Find the running max up to this month\r\n        for (const m of monthlyPortfolios) {\r\n          if (m.year < month.year || (m.year === month.year && m.month <= month.month)) {\r\n            if (m.finalCapital > runningMax) {\r\n              runningMax = m.finalCapital;\r\n            }\r\n          }\r\n        }\r\n        const drawdown = runningMax !== 0 ? ((runningMax - month.finalCapital) / runningMax) * 100 : 0;\r\n        return drawdown < 10;\r\n      });\r\n    },\r\n  },\r\n  {\r\n    id: \"diversified-trader-5-sectors\",\r\n    name: \"Sector Explorer\",\r\n    description: \"Traded in at least 5 unique sectors.\",\r\n    icon: \"lucide:map\",\r\n    level: 1,\r\n    criteria: (trades) => {\r\n      const uniqueSectors = new Set(trades.map(trade => trade.sector).filter(sector => sector));\r\n      return uniqueSectors.size >= 5;\r\n    },\r\n  },\r\n  {\r\n    id: \"diversified-trader-10-sectors\",\r\n    name: \"Market Mapper\",\r\n    description: \"Traded in at least 10 unique sectors.\",\r\n    icon: \"lucide:globe\",\r\n    level: 2,\r\n    criteria: (trades) => {\r\n      const uniqueSectors = new Set(trades.map(trade => trade.sector).filter(sector => sector));\r\n      return uniqueSectors.size >= 10;\r\n    },\r\n  },\r\n  {\r\n    id: \"first-hundred-k-profit\",\r\n    name: \"Six-Figure Earner\",\r\n    description: \"Achieved a cumulative realized profit of ₹1,00,000.\",\r\n    icon: \"lucide:wallet\",\r\n    level: 1,\r\n    criteria: (trades, monthlyPortfolios, currentPortfolioSize, yearlyStartingCapitals, useCashBasis = false) => {\r\n      const totalRealizedPL = trades.reduce((sum, trade) => sum + calculateTradePL(trade, useCashBasis), 0);\r\n      return totalRealizedPL >= 100000;\r\n    },\r\n  },\r\n  {\r\n    id: \"first-million-profit\",\r\n    name: \"Millionaire Mindset\",\r\n    description: \"Achieved a cumulative realized profit of ₹1,000,000.\",\r\n    icon: \"lucide:banknote\",\r\n    level: 2,\r\n    criteria: (trades, monthlyPortfolios, currentPortfolioSize, yearlyStartingCapitals, useCashBasis = false) => {\r\n      const totalRealizedPL = trades.reduce((sum, trade) => sum + calculateTradePL(trade, useCashBasis), 0);\r\n      return totalRealizedPL >= 1000000;\r\n    },\r\n  },\r\n];","import React, { useState, useEffect } from \"react\";\r\nimport {\r\n  Modal,\r\n  ModalContent,\r\n  ModalHeader,\r\n  ModalBody,\r\n  ModalFooter,\r\n  Button,\r\n  Input,\r\n  Table,\r\n  TableHeader,\r\n  TableColumn,\r\n  TableBody,\r\n  TableRow,\r\n  TableCell,\r\n  Select,\r\n  SelectItem,\r\n  Tooltip,\r\n  Tabs,\r\n  Tab,\r\n  Chip,\r\n  Switch,\r\n  Card,\r\n  CardBody\r\n} from \"@heroui/react\";\r\nimport { Icon } from \"@iconify/react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { useTruePortfolio } from \"../utils/TruePortfolioContext\";\r\nimport { YearlyStartingCapitalModal } from \"./YearlyStartingCapitalModal\";\r\nimport { generateId } from \"../utils/helpers\";\r\nimport { useTrades } from \"../hooks/use-trades\";\r\nimport { useMilestones } from \"../hooks/use-milestones\";\r\nimport { useAccountingMethod } from \"../context/AccountingMethodContext\";\r\nimport \"../styles/smooth-animations.css\";\r\n\r\nconst months = [\r\n  'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',\r\n  'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'\r\n];\r\n\r\nconst currentYear = new Date().getFullYear();\r\nconst startYear = 2000;\r\nconst endYear = currentYear + 1; // Allow selecting up to one year in the future\r\nconst years = Array.from({ length: endYear - startYear + 1 }, (_, i) => startYear + i);\r\n\r\ninterface ProfileSettingsModalProps {\r\n  isOpen: boolean;\r\n  onOpenChange: (isOpen: boolean) => void;\r\n  userName: string;\r\n  setUserName: (name: string) => void;\r\n  isFullWidthEnabled: boolean;\r\n  setIsFullWidthEnabled: (enabled: boolean) => void;\r\n}\r\n\r\nexport const ProfileSettingsModal: React.FC<ProfileSettingsModalProps> = ({ isOpen, onOpenChange, userName, setUserName, isFullWidthEnabled, setIsFullWidthEnabled }) => {\r\n  const {\r\n    yearlyStartingCapitals,\r\n    setYearlyStartingCapital,\r\n    getYearlyStartingCapital,\r\n    monthlyStartingCapitalOverrides,\r\n    setMonthlyStartingCapitalOverride,\r\n    removeMonthlyStartingCapitalOverride,\r\n    getMonthlyStartingCapitalOverride,\r\n    capitalChanges,\r\n    addCapitalChange,\r\n    updateCapitalChange,\r\n    deleteCapitalChange,\r\n    portfolioSize\r\n  } = useTruePortfolio();\r\n\r\n  const { trades } = useTrades();\r\n  const { achievedMilestones, ALL_MILESTONES } = useMilestones();\r\n  const { accountingMethod, setAccountingMethod } = useAccountingMethod();\r\n\r\n  const [selectedTab, setSelectedTab] = useState('yearly');\r\n  const [isYearlyCapitalModalOpen, setIsYearlyCapitalModalOpen] = useState(false);\r\n  const [selectedMonth, setSelectedMonth] = useState(months[new Date().getMonth()]);\r\n  const [selectedYear, setSelectedYear] = useState(currentYear);\r\n  const [editingCell, setEditingCell] = useState<{month: string, year: number} | null>(null);\r\n  const [editValue, setEditValue] = useState('');\r\n  const [newCapitalAmount, setNewCapitalAmount] = useState('');\r\n  const [newCapitalType, setNewCapitalType] = useState<'deposit' | 'withdrawal'>('deposit');\r\n  const [newCapitalDescription, setNewCapitalDescription] = useState('');\r\n\r\n  // Monthly overrides state\r\n  const [overrideMonth, setOverrideMonth] = useState(months[new Date().getMonth()]);\r\n  const [overrideYear, setOverrideYear] = useState(currentYear);\r\n  const [overrideAmount, setOverrideAmount] = useState('');\r\n\r\n  const handleAddCapitalChange = () => {\r\n    const amount = parseFloat(newCapitalAmount);\r\n    if (isNaN(amount) || amount <= 0) {\r\n      alert('Please enter a valid amount');\r\n      return;\r\n    }\r\n\r\n    const monthIndex = months.indexOf(selectedMonth);\r\n    const date = new Date(selectedYear, monthIndex, 1).toISOString();\r\n\r\n    addCapitalChange({\r\n      amount: newCapitalType === 'deposit' ? amount : -amount,\r\n      type: newCapitalType,\r\n      date,\r\n      description: newCapitalDescription || `${newCapitalType === 'deposit' ? 'Deposit' : 'Withdrawal'} for ${selectedMonth} ${selectedYear}`\r\n    });\r\n\r\n    setNewCapitalAmount('');\r\n    setNewCapitalDescription('');\r\n  };\r\n\r\n  const handleEditCapitalChange = (changeId: string) => {\r\n    const change = capitalChanges.find(c => c.id === changeId);\r\n    if (change) {\r\n      const date = new Date(change.date);\r\n      const month = date.toLocaleString('default', { month: 'short' });\r\n      const year = date.getFullYear();\r\n      setEditingCell({ month, year });\r\n      setEditValue((change.type === 'deposit' ? change.amount : -change.amount).toString());\r\n    }\r\n  };\r\n\r\n  const handleSaveCapitalChange = () => {\r\n    if (!editingCell) return;\r\n\r\n    const value = Number(editValue);\r\n    if (isNaN(value)) return;\r\n\r\n    const monthIndex = months.indexOf(editingCell.month);\r\n    const date = new Date(editingCell.year, monthIndex, 1).toISOString();\r\n\r\n    // Find existing change for this month/year\r\n    const existingChange = capitalChanges.find(change => {\r\n      const changeDate = new Date(change.date);\r\n      return changeDate.getFullYear() === editingCell.year &&\r\n             changeDate.getMonth() === monthIndex;\r\n    });\r\n\r\n    if (value === 0) {\r\n      // If value is 0, remove the change if it exists\r\n      if (existingChange) {\r\n        deleteCapitalChange(existingChange.id);\r\n      }\r\n    } else {\r\n      const type = value > 0 ? 'deposit' : 'withdrawal';\r\n      const amount = Math.abs(value);\r\n\r\n      if (existingChange) {\r\n        // Update existing change\r\n        updateCapitalChange({\r\n          ...existingChange,\r\n          amount,\r\n          type,\r\n          description: existingChange.description || 'Updated from settings'\r\n        });\r\n      } else {\r\n        // Add new change\r\n        addCapitalChange({\r\n          amount,\r\n          type,\r\n          date,\r\n          description: 'Added from settings'\r\n        });\r\n      }\r\n    }\r\n\r\n    setEditingCell(null);\r\n    setEditValue('');\r\n  };\r\n\r\n  const handleAddMonthlyOverride = () => {\r\n    const amount = parseFloat(overrideAmount);\r\n    if (isNaN(amount) || amount <= 0) {\r\n      alert('Please enter a valid amount');\r\n      return;\r\n    }\r\n\r\n    setMonthlyStartingCapitalOverride(overrideMonth, overrideYear, amount);\r\n    setOverrideAmount('');\r\n  };\r\n\r\n  const handleRemoveMonthlyOverride = (month: string, year: number) => {\r\n    removeMonthlyStartingCapitalOverride(month, year);\r\n  };\r\n\r\n  // Memoize sorted arrays to prevent unnecessary re-renders\r\n  const sortedCapitalChanges = React.useMemo(() =>\r\n    [...capitalChanges].sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()),\r\n    [capitalChanges]\r\n  );\r\n\r\n  const sortedYearlyCapitals = React.useMemo(() =>\r\n    [...yearlyStartingCapitals].sort((a, b) => b.year - a.year),\r\n    [yearlyStartingCapitals]\r\n  );\r\n\r\n  const sortedMonthlyOverrides = React.useMemo(() =>\r\n    [...monthlyStartingCapitalOverrides].sort((a, b) => {\r\n      if (a.year !== b.year) return b.year - a.year;\r\n      return months.indexOf(b.month) - months.indexOf(a.month);\r\n    }),\r\n    [monthlyStartingCapitalOverrides, months]\r\n  );\r\n\r\n  return (\r\n    <Modal\r\n      isOpen={isOpen}\r\n      onOpenChange={onOpenChange}\r\n      size=\"2xl\"\r\n      scrollBehavior=\"inside\"\r\n      classNames={{\r\n        base: \"max-w-[90vw] max-h-[85vh] sm:max-w-2xl\",\r\n        wrapper: \"items-center justify-center p-4\",\r\n        body: \"overflow-y-auto p-0\",\r\n        backdrop: \"bg-black/50\"\r\n      }}\r\n    >\r\n      <ModalContent className=\"bg-background/95 backdrop-blur-xl border border-divider/50 shadow-2xl\">\r\n        {(onClose) => (\r\n          <>\r\n            <ModalHeader className=\"flex items-center gap-3 px-6 py-4 border-b border-divider/50 bg-gradient-to-r from-primary/5 to-secondary/5\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"p-2 rounded-lg bg-primary/10\">\r\n                  <Icon icon=\"lucide:settings\" className=\"text-primary text-lg\" />\r\n                </div>\r\n                <span className=\"text-lg font-semibold tracking-tight\">Portfolio Settings</span>\r\n              </div>\r\n            </ModalHeader>\r\n            <ModalBody className=\"p-6 space-y-4\">\r\n              {/* Feature Development Banner */}\r\n              <Card className=\"border-warning/50 bg-warning/5\">\r\n                <CardBody className=\"p-3\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <Icon icon=\"lucide:construction\" className=\"text-warning w-5 h-5 flex-shrink-0\" />\r\n                    <div className=\"flex-1\">\r\n                      <h3 className=\"text-sm font-medium text-warning-700 dark:text-warning-300\">\r\n                        Advanced Features Under Development\r\n                      </h3>\r\n                      <p className=\"text-xs text-warning-600 dark:text-warning-400 mt-1\">\r\n                        Capital Changes, Monthly Overrides, and Milestones features are being enhanced. Basic portfolio settings are fully functional.\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </CardBody>\r\n              </Card>\r\n              <div className=\"bg-content1/50 rounded-xl p-4 border border-divider/30\">\r\n                <Input\r\n                  label=\"Your Name\"\r\n                  labelPlacement=\"outside\"\r\n                  placeholder=\"Enter your name\"\r\n                  value={userName}\r\n                  onValueChange={setUserName}\r\n                  className=\"w-full\"\r\n                  size=\"sm\"\r\n                  variant=\"bordered\"\r\n                  startContent={<Icon icon=\"lucide:user\" className=\"text-default-400 text-base\" />}\r\n                />\r\n              </div>\r\n              <div className=\"bg-content1/50 rounded-xl p-4 border border-divider/30\">\r\n                <h4 className=\"font-semibold text-base mb-3 flex items-center gap-2\">\r\n                  <Icon icon=\"lucide:monitor\" className=\"text-primary text-base\" />\r\n                  Display Settings\r\n                </h4>\r\n                <div className=\"flex items-center justify-between p-3 border border-divider/50 rounded-lg bg-background/50\">\r\n                  <div>\r\n                    <p className=\"font-medium text-sm text-foreground\">Full Width Layout</p>\r\n                    <p className=\"text-xs text-default-500\">Expand content to fill screen width</p>\r\n                  </div>\r\n                  <Switch\r\n                    isSelected={isFullWidthEnabled}\r\n                    onValueChange={setIsFullWidthEnabled}\r\n                    size=\"sm\"\r\n                    aria-label=\"Toggle full width layout\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"bg-content1/50 rounded-xl p-4 border border-divider/30\">\r\n                <h4 className=\"font-semibold text-base mb-3 flex items-center gap-2\">\r\n                  <Icon icon=\"lucide:calculator\" className=\"text-primary text-base\" />\r\n                  P&L Accounting Method\r\n                </h4>\r\n                <div className=\"accounting-method-container flex flex-col sm:flex-row sm:items-center justify-between p-3 border border-divider/50 rounded-lg bg-background/50 gap-3\">\r\n                  <div className=\"flex-1\">\r\n                    <AnimatePresence mode=\"wait\">\r\n                      <motion.p\r\n                        className=\"font-medium text-sm text-foreground\"\r\n                        key={accountingMethod}\r\n                        initial={{ opacity: 0, y: -5 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        exit={{ opacity: 0, y: 5 }}\r\n                        transition={{\r\n                          duration: 0.15,\r\n                          ease: [0.4, 0, 0.2, 1],\r\n                          type: \"tween\"\r\n                        }}\r\n                      >\r\n                        {accountingMethod === 'cash' ? 'Cash Basis Accounting' : 'Accrual Basis Accounting'}\r\n                      </motion.p>\r\n                    </AnimatePresence>\r\n                    <AnimatePresence mode=\"wait\">\r\n                      <motion.p\r\n                        className=\"text-xs text-default-500 mt-1\"\r\n                        key={`${accountingMethod}-desc`}\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        transition={{\r\n                          duration: 0.2,\r\n                          delay: 0.05,\r\n                          ease: [0.4, 0, 0.2, 1]\r\n                        }}\r\n                      >\r\n                        {accountingMethod === 'cash'\r\n                          ? 'P&L attributed to exit dates'\r\n                          : 'P&L attributed to entry dates'\r\n                        }\r\n                      </motion.p>\r\n                    </AnimatePresence>\r\n                    <div className=\"mt-2 text-xs text-success-600 flex items-center gap-1\">\r\n                      <Icon icon=\"lucide:lightbulb\" className=\"w-3 h-3\" />\r\n                      Cash Basis is recommended for most traders\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"accounting-toggle-wrapper flex items-center justify-center sm:justify-end gap-2 flex-shrink-0\">\r\n                    <motion.span\r\n                      className=\"text-xs font-medium smooth-text-transition gpu-accelerated\"\r\n                      animate={{\r\n                        scale: accountingMethod === 'accrual' ? 1.05 : 1,\r\n                        color: accountingMethod === 'accrual' ? '#3b82f6' : '#71717a',\r\n                        fontWeight: accountingMethod === 'accrual' ? 600 : 500\r\n                      }}\r\n                      transition={{\r\n                        duration: 0.2,\r\n                        ease: [0.4, 0, 0.2, 1],\r\n                        type: \"tween\"\r\n                      }}\r\n                    >\r\n                      Accrual\r\n                    </motion.span>\r\n                    <motion.div\r\n                      whileTap={{ scale: 0.96 }}\r\n                      whileHover={{ scale: 1.02 }}\r\n                      transition={{\r\n                        duration: 0.1,\r\n                        ease: [0.4, 0, 0.2, 1]\r\n                      }}\r\n                      className=\"switch-press-feedback\"\r\n                    >\r\n                      <Switch\r\n                        isSelected={accountingMethod === 'cash'}\r\n                        onValueChange={(isSelected) => {\r\n                          // Add subtle haptic feedback simulation\r\n                          if (navigator.vibrate) {\r\n                            navigator.vibrate(10);\r\n                          }\r\n                          setAccountingMethod(isSelected ? 'cash' : 'accrual');\r\n                        }}\r\n                        color=\"success\"\r\n                        size=\"sm\"\r\n                        thumbIcon={({ isSelected, className }) =>\r\n                          <AnimatePresence mode=\"wait\">\r\n                            <motion.div\r\n                              key={isSelected ? 'cash' : 'accrual'}\r\n                              initial={{ scale: 0, rotate: -90, opacity: 0 }}\r\n                              animate={{ scale: 1, rotate: 0, opacity: 1 }}\r\n                              exit={{ scale: 0, rotate: 90, opacity: 0 }}\r\n                              transition={{\r\n                                duration: 0.2,\r\n                                ease: [0.4, 0, 0.2, 1],\r\n                                type: \"tween\"\r\n                              }}\r\n                              className=\"smooth-icon gpu-accelerated\"\r\n                            >\r\n                              <Icon\r\n                                icon={isSelected ? \"lucide:banknote\" : \"lucide:calendar-clock\"}\r\n                                className={`${className} transition-colors duration-150 ease-out`}\r\n                              />\r\n                            </motion.div>\r\n                          </AnimatePresence>\r\n                        }\r\n                        classNames={{\r\n                          wrapper: \"smooth-switch group-data-[selected=true]:bg-success group-data-[selected=false]:bg-default-200\",\r\n                          thumb: \"smooth-switch-thumb bg-white shadow-lg group-data-[selected=true]:ml-6 group-data-[pressed=true]:w-7 group-data-[selected]:group-data-[pressed]:ml-4\",\r\n                          thumbIcon: \"text-default-600 group-data-[selected=true]:text-success-600 transition-colors duration-150\"\r\n                        }}\r\n                        aria-label=\"Toggle accounting method\"\r\n                      />\r\n                    </motion.div>\r\n                    <motion.span\r\n                      className=\"text-xs font-medium smooth-text-transition gpu-accelerated\"\r\n                      animate={{\r\n                        scale: accountingMethod === 'cash' ? 1.05 : 1,\r\n                        color: accountingMethod === 'cash' ? '#22c55e' : '#71717a',\r\n                        fontWeight: accountingMethod === 'cash' ? 600 : 500\r\n                      }}\r\n                      transition={{\r\n                        duration: 0.2,\r\n                        ease: [0.4, 0, 0.2, 1],\r\n                        type: \"tween\"\r\n                      }}\r\n                    >\r\n                      Cash\r\n                    </motion.span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <Tabs\r\n                selectedKey={selectedTab}\r\n                onSelectionChange={(key) => {\r\n                  // Only allow selection of \"yearly\" tab, disable others\r\n                  if (key === \"yearly\") {\r\n                    setSelectedTab(key as string);\r\n                  }\r\n                }}\r\n                aria-label=\"Portfolio settings tabs\"\r\n                size=\"sm\"\r\n                variant=\"underlined\"\r\n                classNames={{\r\n                  tabList: \"gap-6 w-full relative rounded-none p-0 border-b border-divider/50\",\r\n                  cursor: \"w-full bg-primary\",\r\n                  tab: \"max-w-fit px-0 h-10\",\r\n                  tabContent: \"group-data-[selected=true]:text-primary text-default-500 font-medium\"\r\n                }}\r\n              >\r\n                <Tab key=\"yearly\" title=\"Yearly Starting Capital\">\r\n                  <AnimatePresence mode=\"wait\">\r\n                    {selectedTab === \"yearly\" && (\r\n                      <motion.div\r\n                        key=\"yearly-content\"\r\n                        initial={{ opacity: 0, y: 10 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        exit={{ opacity: 0, y: 10 }}\r\n                        transition={{ duration: 0.2 }}\r\n                      >\r\n                        <div className=\"py-3 space-y-3\">\r\n                          <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-3 p-3 bg-content1/30 rounded-lg border border-divider/30\">\r\n                            <div className=\"flex-1\">\r\n                              <p className=\"text-xs text-foreground-500\">\r\n                                Set starting capital for January of each year\r\n                              </p>\r\n                            </div>\r\n                            <Button\r\n                              color=\"primary\"\r\n                              onPress={() => setIsYearlyCapitalModalOpen(true)}\r\n                              startContent={<Icon icon=\"lucide:plus\" className=\"w-3 h-3\" />}\r\n                              size=\"sm\"\r\n                              variant=\"flat\"\r\n                              className=\"w-full sm:w-auto flex-shrink-0 text-xs\"\r\n                            >\r\n                              Manage Years\r\n                            </Button>\r\n                          </div>\r\n\r\n                          {sortedYearlyCapitals.length === 0 ? (\r\n                            <div className=\"text-center py-6 text-default-500\">\r\n                              <Icon icon=\"lucide:calendar-x\" className=\"text-2xl mb-2 mx-auto opacity-50\" />\r\n                              <p className=\"text-sm\">No yearly capitals set</p>\r\n                              <p className=\"text-xs opacity-70\">Click \"Manage Years\" to start</p>\r\n                            </div>\r\n                          ) : (\r\n                            <div className=\"space-y-2\">\r\n                              {sortedYearlyCapitals.map((yearData) => (\r\n                                <div\r\n                                  key={yearData.year}\r\n                                  className=\"flex items-center justify-between p-3 border border-divider/50 rounded-lg bg-background/50 hover:bg-content1/30 transition-colors\"\r\n                                >\r\n                                  <div className=\"flex items-center gap-3\">\r\n                                    <div className=\"w-8 h-8 rounded-lg bg-success/10 flex items-center justify-center\">\r\n                                      <Icon icon=\"lucide:calendar\" className=\"w-4 h-4 text-success\" />\r\n                                    </div>\r\n                                    <div>\r\n                                      <p className=\"font-semibold text-sm text-foreground\">{yearData.year}</p>\r\n                                      <p className=\"text-xs text-default-500\">{new Date(yearData.updatedAt).toLocaleDateString()}</p>\r\n                                    </div>\r\n                                  </div>\r\n                                  <div className=\"text-right\">\r\n                                    <p className=\"font-bold text-sm text-success-600\">₹{yearData.startingCapital.toLocaleString()}</p>\r\n                                    <p className=\"text-xs text-default-500\">Starting Capital</p>\r\n                                  </div>\r\n                                </div>\r\n                              ))}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </motion.div>\r\n                    )}\r\n                  </AnimatePresence>\r\n                </Tab>\r\n                <Tab\r\n                  key=\"capital\"\r\n                  title={\r\n                    <div className=\"flex items-center gap-2 opacity-75 cursor-not-allowed text-default-600\">\r\n                      <span>Capital Changes</span>\r\n                      <Icon icon=\"lucide:lock\" className=\"w-3 h-3\" />\r\n                    </div>\r\n                  }\r\n                  isDisabled={true}\r\n                >\r\n                  <AnimatePresence mode=\"wait\">\r\n                    {selectedTab === \"capital\" && (\r\n                      <motion.div\r\n                        key=\"capital-content\"\r\n                        initial={{ opacity: 0, y: 10 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        exit={{ opacity: 0, y: 10 }}\r\n                        transition={{ duration: 0.2 }}\r\n                      >\r\n                        <div className=\"py-3 space-y-3\">\r\n                          <p className=\"text-xs text-foreground-500 p-3 bg-content1/30 rounded-lg border border-divider/30\">\r\n                            Add deposits and withdrawals to track capital changes\r\n                          </p>\r\n\r\n                          {/* Add New Capital Change */}\r\n                          <div className=\"border border-divider/50 rounded-lg p-3 bg-background/50\">\r\n                            <h4 className=\"font-medium text-sm mb-3 flex items-center gap-2\">\r\n                              <Icon icon=\"lucide:plus-circle\" className=\"w-4 h-4 text-primary\" />\r\n                              Add Capital Change\r\n                            </h4>\r\n                            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\r\n                              <Select\r\n                                label=\"Month\"\r\n                                selectedKeys={[selectedMonth]}\r\n                                onSelectionChange={(keys) => setSelectedMonth(Array.from(keys)[0] as string)}\r\n                                className=\"w-full\"\r\n                                size=\"sm\"\r\n                                variant=\"bordered\"\r\n                                aria-label=\"Select month for capital change\"\r\n                              >\r\n                                {months.map((month) => (\r\n                                  <SelectItem key={month}>\r\n                                    {month}\r\n                                  </SelectItem>\r\n                                ))}\r\n                              </Select>\r\n                              <Select\r\n                                label=\"Year\"\r\n                                selectedKeys={[selectedYear.toString()]}\r\n                                onSelectionChange={(keys) => setSelectedYear(parseInt(Array.from(keys)[0] as string))}\r\n                                className=\"w-full\"\r\n                                size=\"sm\"\r\n                                variant=\"bordered\"\r\n                                aria-label=\"Select year for capital change\"\r\n                              >\r\n                                {years.map((year) => (\r\n                                  <SelectItem key={year}>\r\n                                    {year}\r\n                                  </SelectItem>\r\n                                ))}\r\n                              </Select>\r\n                              <Select\r\n                                label=\"Capital Type\"\r\n                                selectedKeys={[newCapitalType]}\r\n                                onSelectionChange={(keys) => setNewCapitalType(Array.from(keys)[0] as 'deposit' | 'withdrawal')}\r\n                                className=\"w-full\"\r\n                                size=\"sm\"\r\n                                variant=\"bordered\"\r\n                                aria-label=\"Select capital change type\"\r\n                              >\r\n                                <SelectItem key=\"deposit\">Deposit</SelectItem>\r\n                                <SelectItem key=\"withdrawal\">Withdrawal</SelectItem>\r\n                              </Select>\r\n                              <Input\r\n                                label=\"Description (optional)\"\r\n                                placeholder=\"e.g., Q1 bonus, new investment\"\r\n                                value={newCapitalDescription}\r\n                                onValueChange={setNewCapitalDescription}\r\n                                className=\"w-full\"\r\n                                size=\"sm\"\r\n                                variant=\"bordered\"\r\n                              />\r\n                              <Input\r\n                                label=\"Amount\"\r\n                                placeholder=\"e.g., 100000\"\r\n                                value={newCapitalAmount}\r\n                                onValueChange={setNewCapitalAmount}\r\n                                type=\"number\"\r\n                                min=\"0\"\r\n                                step=\"1000\"\r\n                                startContent={<span className=\"text-default-400 text-lg\">₹</span>}\r\n                                className=\"w-full\"\r\n                                size=\"sm\"\r\n                                variant=\"bordered\"\r\n                              />\r\n                              <Button\r\n                                color=\"primary\"\r\n                                onPress={handleAddCapitalChange}\r\n                                isDisabled={isNaN(parseFloat(newCapitalAmount)) || parseFloat(newCapitalAmount) <= 0}\r\n                                startContent={<Icon icon=\"lucide:plus\" />}\r\n                                className=\"w-full\"\r\n                                size=\"sm\"\r\n                              >\r\n                                Add Capital Change\r\n                              </Button>\r\n                            </div>\r\n\r\n                            <h4 className=\"font-semibold text-lg mb-2\">Capital Change History</h4>\r\n                            {sortedCapitalChanges.length === 0 ? (\r\n                              <div className=\"text-center py-8 text-default-500\">\r\n                                <Icon icon=\"lucide:dollar-sign\" className=\"text-4xl mb-2 mx-auto\" />\r\n                                <p>No capital changes recorded yet.</p>\r\n                                <p className=\"text-sm\">Add a capital change above.</p>\r\n                              </div>\r\n                            ) : (\r\n                              <Table\r\n                                aria-label=\"Capital Changes Table\"\r\n                                selectionMode=\"single\"\r\n                                // onRowAction={(key) => handleEditCapitalChange(key as string)}\r\n                                classNames={{\r\n                                  wrapper: \"min-h-[200px]\",\r\n                                  th: \"bg-transparent border-b border-divider text-xs font-medium text-default-500 dark:text-default-300 uppercase tracking-wider\",\r\n                                  td: \"py-2.5 text-sm\"\r\n                                }}\r\n                              >\r\n                                <TableHeader>\r\n                                  <TableColumn key=\"date\" allowsSorting={true}>Date</TableColumn>\r\n                                  <TableColumn key=\"type\" allowsSorting={true}>Type</TableColumn>\r\n                                  <TableColumn key=\"amount\" allowsSorting={true}>Amount</TableColumn>\r\n                                  <TableColumn key=\"description\">Description</TableColumn>\r\n                                  <TableColumn key=\"actions\">Actions</TableColumn>\r\n                                </TableHeader>\r\n                                <TableBody items={sortedCapitalChanges}>\r\n                                  {(item) => (\r\n                                    <TableRow key={item.id}>\r\n                                      <TableCell>{new Date(item.date).toLocaleDateString()}</TableCell>\r\n                                      <TableCell>\r\n                                        <Chip color={item.type === 'deposit' ? 'success' : 'danger'} size=\"sm\">\r\n                                          {item.type === 'deposit' ? 'Deposit' : 'Withdrawal'}\r\n                                        </Chip>\r\n                                      </TableCell>\r\n                                      <TableCell>{new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(item.amount)}</TableCell>\r\n                                      <TableCell>{item.description}</TableCell>\r\n                                      <TableCell>\r\n                                        <div className=\"relative flex items-center gap-2\">\r\n                                          <Tooltip content=\"Delete capital change\">\r\n                                            <Button isIconOnly size=\"sm\" variant=\"light\" color=\"danger\" onPress={() => deleteCapitalChange(item.id)}>\r\n                                              <Icon icon=\"lucide:trash-2\" className=\"w-4 h-4\" />\r\n                                            </Button>\r\n                                          </Tooltip>\r\n                                        </div>\r\n                                      </TableCell>\r\n                                    </TableRow>\r\n                                  )}\r\n                                </TableBody>\r\n                              </Table>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </motion.div>\r\n                    )}\r\n                  </AnimatePresence>\r\n                </Tab>\r\n                <Tab\r\n                  key=\"monthly\"\r\n                  title={\r\n                    <div className=\"flex items-center gap-2 opacity-75 cursor-not-allowed text-default-600\">\r\n                      <span>Monthly Overrides</span>\r\n                      <Icon icon=\"lucide:lock\" className=\"w-3 h-3\" />\r\n                    </div>\r\n                  }\r\n                  isDisabled={true}\r\n                >\r\n                  <AnimatePresence mode=\"wait\">\r\n                    {selectedTab === \"monthly\" && (\r\n                      <motion.div\r\n                        key=\"monthly-content\"\r\n                        initial={{ opacity: 0, y: 10 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        exit={{ opacity: 0, y: 10 }}\r\n                        transition={{ duration: 0.2 }}\r\n                      >\r\n                        <div className=\"py-4 space-y-4\">\r\n                          <p className=\"text-sm text-foreground-500\">\r\n                            Override starting capital for specific months. This allows you to manually set the starting capital for any month, overriding the automatic calculation.\r\n                          </p>\r\n\r\n                          {/* Add New Monthly Override */}\r\n                          <div className=\"border border-divider rounded-lg p-4 bg-default-50 dark:bg-default-100\">\r\n                            <h4 className=\"font-semibold mb-3\">Add Monthly Override</h4>\r\n                            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3\">\r\n                              <Select\r\n                                label=\"Month\"\r\n                                selectedKeys={[overrideMonth]}\r\n                                onSelectionChange={(keys) => setOverrideMonth(Array.from(keys)[0] as string)}\r\n                                className=\"w-full\"\r\n                                size=\"sm\"\r\n                                variant=\"bordered\"\r\n                                aria-label=\"Select month for override\"\r\n                              >\r\n                                {months.map((month) => (\r\n                                  <SelectItem key={month}>\r\n                                    {month}\r\n                                  </SelectItem>\r\n                                ))}\r\n                              </Select>\r\n                              <Select\r\n                                label=\"Year\"\r\n                                selectedKeys={[overrideYear.toString()]}\r\n                                onSelectionChange={(keys) => setOverrideYear(parseInt(Array.from(keys)[0] as string))}\r\n                                className=\"w-full\"\r\n                                size=\"sm\"\r\n                                variant=\"bordered\"\r\n                                aria-label=\"Select year for override\"\r\n                              >\r\n                                {years.map((year) => (\r\n                                  <SelectItem key={year}>\r\n                                    {year}\r\n                                  </SelectItem>\r\n                                ))}\r\n                              </Select>\r\n                              <Input\r\n                                label=\"Starting Capital\"\r\n                                type=\"number\"\r\n                                value={overrideAmount}\r\n                                onValueChange={setOverrideAmount}\r\n                                min=\"0\"\r\n                                step=\"1000\"\r\n                                startContent={<span className=\"text-default-400\">₹</span>}\r\n                              />\r\n                              <div className=\"sm:col-span-2 lg:col-span-3\">\r\n                                <Button\r\n                                  color=\"primary\"\r\n                                  onPress={handleAddMonthlyOverride}\r\n                                  isDisabled={!overrideAmount}\r\n                                  startContent={<Icon icon=\"lucide:calendar-plus\" />}\r\n                                >\r\n                                  Set Monthly Override\r\n                                </Button>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n\r\n                          {/* Existing Monthly Overrides */}\r\n                          <div>\r\n                            <h4 className=\"font-semibold mb-3\">Monthly Overrides</h4>\r\n                            {sortedMonthlyOverrides.length === 0 ? (\r\n                              <div className=\"text-center py-8 text-default-500\">\r\n                                <Icon icon=\"lucide:calendar-check\" className=\"text-4xl mb-2 mx-auto\" />\r\n                                <p>No monthly overrides set yet.</p>\r\n                                <p className=\"text-sm\">Add an override above to manually set starting capital for specific months.</p>\r\n                              </div>\r\n                            ) : (\r\n                              <div className=\"space-y-3\">\r\n                                {sortedMonthlyOverrides.map((override) => (\r\n                                  <div key={override.id} className=\"flex items-center gap-3 p-3 border border-divider rounded-lg\">\r\n                                    <div className=\"flex-shrink-0\">\r\n                                      <div className=\"w-10 h-10 rounded-full flex items-center justify-center bg-primary-100 text-primary-600 dark:bg-primary-900 dark:text-primary-300\">\r\n                                        <Icon icon=\"lucide:calendar\" className=\"w-5 h-5\" />\r\n                                      </div>\r\n                                    </div>\r\n                                    <div className=\"flex-1\">\r\n                                      <div className=\"flex items-center gap-2\">\r\n                                        <span className=\"font-medium\">{override.month} {override.year}</span>\r\n                                        <span className=\"text-sm px-2 py-1 rounded-full bg-primary-100 text-primary-700 dark:bg-primary-900 dark:text-primary-300\">\r\n                                          Override\r\n                                        </span>\r\n                                      </div>\r\n                                      <div className=\"text-sm text-default-500 mt-1\">\r\n                                        Updated: {new Date(override.updatedAt).toLocaleDateString()}\r\n                                      </div>\r\n                                    </div>\r\n                                    <div className=\"text-right\">\r\n                                      <div className=\"font-bold text-lg text-primary\">\r\n                                        ₹{override.startingCapital.toLocaleString()}\r\n                                      </div>\r\n                                      <div className=\"flex gap-1 mt-1\">\r\n                                        <Button\r\n                                          size=\"sm\"\r\n                                          variant=\"flat\"\r\n                                          color=\"danger\"\r\n                                          onPress={() => handleRemoveMonthlyOverride(override.month, override.year)}\r\n                                          startContent={<Icon icon=\"lucide:trash\" className=\"w-3 h-3\" />}\r\n                                        >\r\n                                          Remove\r\n                                        </Button>\r\n                                      </div>\r\n                                    </div>\r\n                                  </div>\r\n                                ))}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </motion.div>\r\n                    )}\r\n                  </AnimatePresence>\r\n                </Tab>\r\n                <Tab\r\n                  key=\"milestones\"\r\n                  title={\r\n                    <div className=\"flex items-center gap-2 opacity-75 cursor-not-allowed text-default-600\">\r\n                      <span>Milestones</span>\r\n                      <Icon icon=\"lucide:lock\" className=\"w-3 h-3\" />\r\n                    </div>\r\n                  }\r\n                  isDisabled={true}\r\n                >\r\n                  <AnimatePresence mode=\"wait\">\r\n                    {selectedTab === \"milestones\" && (\r\n                      <motion.div\r\n                        key=\"milestones-content\"\r\n                        initial={{ opacity: 0, y: 10 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        exit={{ opacity: 0, y: 10 }}\r\n                        transition={{ duration: 0.2 }}\r\n                      >\r\n                        <div className=\"py-3 space-y-3\">\r\n                          <p className=\"text-xs text-foreground-500 p-3 bg-content1/30 rounded-lg border border-divider/30\">\r\n                            Track your progress and celebrate achievements\r\n                          </p>\r\n\r\n                          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\r\n                            {ALL_MILESTONES.map((milestone) => {\r\n                              const isAchieved = achievedMilestones.some(a => a.id === milestone.id);\r\n                              const achievedAt = isAchieved\r\n                                ? new Date(achievedMilestones.find(a => a.id === milestone.id)?.achievedAt || '').toLocaleDateString()\r\n                                : null;\r\n                              return (\r\n                                <div\r\n                                  key={milestone.id}\r\n                                  className={`p-3 border rounded-lg flex items-center gap-3 transition-colors ${isAchieved\r\n                                    ? 'bg-success-50 dark:bg-success-900/20 border-success-200 dark:border-success-800'\r\n                                    : 'bg-background/50 border-divider/50 hover:bg-content1/30'\r\n                                  }`}\r\n                                >\r\n                                  <div className={`flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center ${isAchieved\r\n                                      ? 'bg-success-200 text-success-800 dark:bg-success-800 dark:text-success-200'\r\n                                      : 'bg-default-200 text-default-600 dark:bg-default-700 dark:text-default-300'\r\n                                    }`}\r\n                                  >\r\n                                    <Icon icon={milestone.icon} className=\"w-3 h-3\" />\r\n                                  </div>\r\n                                  <div className=\"flex-1 min-w-0\">\r\n                                    <h4 className={`font-medium text-xs ${isAchieved ? 'text-success-800 dark:text-success-200' : 'text-foreground'}`}>\r\n                                      {milestone.name}\r\n                                    </h4>\r\n                                    <p className={`text-xs mt-0.5 ${isAchieved ? 'text-success-700 dark:text-success-300' : 'text-default-500'}`}>\r\n                                      {milestone.description}\r\n                                    </p>\r\n                                    {isAchieved && (\r\n                                      <p className=\"text-xs text-default-400 mt-1\">\r\n                                        {achievedAt}\r\n                                      </p>\r\n                                    )}\r\n                                  </div>\r\n                                  {isAchieved && (\r\n                                    <Icon icon=\"lucide:check-circle\" className=\"w-4 h-4 text-success flex-shrink-0\" />\r\n                                  )}\r\n                                </div>\r\n                              );\r\n                            })}\r\n                          </div>\r\n                        </div>\r\n                      </motion.div>\r\n                    )}\r\n                  </AnimatePresence>\r\n                </Tab>\r\n              </Tabs>\r\n            </ModalBody>\r\n            <ModalFooter className=\"flex-shrink-0 border-t border-divider/50 px-6 py-3 bg-gradient-to-r from-background/50 to-content1/30\">\r\n              <Button\r\n                variant=\"flat\"\r\n                onPress={onClose}\r\n                size=\"sm\"\r\n                className=\"w-full sm:w-auto min-w-20\"\r\n                startContent={<Icon icon=\"lucide:x\" className=\"w-3 h-3\" />}\r\n              >\r\n                Close\r\n              </Button>\r\n            </ModalFooter>\r\n\r\n            {/* Yearly Starting Capital Modal */}\r\n            <YearlyStartingCapitalModal\r\n              isOpen={isYearlyCapitalModalOpen}\r\n              onOpenChange={setIsYearlyCapitalModalOpen}\r\n            />\r\n          </>\r\n        )}\r\n      </ModalContent>\r\n    </Modal>\r\n  );\r\n};","import { useState, useEffect, useCallback } from 'react';\r\nimport { ALL_MILESTONES, Milestone } from '../utils/milestones';\r\nimport { useTrades } from './use-trades';\r\nimport { useTruePortfolio } from '../utils/TruePortfolioContext';\r\nimport { useAccountingMethod } from '../context/AccountingMethodContext';\r\nimport { SupabaseService } from '../services/supabaseService';\r\n\r\ninterface AchievedMilestone extends Milestone {\r\n  achievedAt: string; // ISO date string\r\n}\r\n\r\nexport const useMilestones = () => {\r\n  const { trades } = useTrades();\r\n  const { getAllMonthlyTruePortfolios, portfolioSize, yearlyStartingCapitals } = useTruePortfolio();\r\n  const { accountingMethod } = useAccountingMethod();\r\n  const useCashBasis = accountingMethod === 'cash';\r\n\r\n  // Get monthly portfolios with accounting method-aware calculations\r\n  const monthlyPortfolios = getAllMonthlyTruePortfolios(trades, useCashBasis);\r\n\r\n  const [achievedMilestones, setAchievedMilestones] = useState<AchievedMilestone[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  // Load milestones from IndexedDB on mount\r\n  useEffect(() => {\r\n    const loadMilestones = async () => {\r\n      if (typeof window === 'undefined') {\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const milestonesRecord = await SupabaseService.getMilestonesData();\r\n        if (milestonesRecord && milestonesRecord.achievements) {\r\n          setAchievedMilestones(milestonesRecord.achievements);\r\n        }\r\n      } catch (error) {\r\n        } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    loadMilestones();\r\n  }, []);\r\n\r\n  const checkAndAwardMilestones = useCallback(() => {\r\n    const newlyAchieved: AchievedMilestone[] = [];\r\n\r\n    // For cash basis, deduplicate trades to avoid double counting in milestone calculations\r\n    let uniqueTrades = trades;\r\n    if (useCashBasis) {\r\n      const seenTradeIds = new Set();\r\n      uniqueTrades = trades.filter(trade => {\r\n        const originalId = trade.id.split('_exit_')[0];\r\n        if (seenTradeIds.has(originalId)) return false;\r\n        seenTradeIds.add(originalId);\r\n        return true;\r\n      });\r\n    }\r\n\r\n    ALL_MILESTONES.forEach(milestone => {\r\n      // Check if already achieved\r\n      const alreadyAchieved = achievedMilestones.some(a => a.id === milestone.id);\r\n\r\n      if (!alreadyAchieved) {\r\n        // Check if criteria is met with accounting method-aware data (use deduplicated trades)\r\n        if (milestone.criteria(uniqueTrades, monthlyPortfolios, portfolioSize, yearlyStartingCapitals, useCashBasis)) {\r\n          newlyAchieved.push({\r\n            ...milestone,\r\n            achievedAt: new Date().toISOString(),\r\n          });\r\n        }\r\n      }\r\n    });\r\n\r\n    if (newlyAchieved.length > 0) {\r\n      setAchievedMilestones(prev => {\r\n        const updated = [...prev, ...newlyAchieved];\r\n        // Ensure uniqueness and sort by achievedAt\r\n        const uniqueAndSorted = Array.from(new Set(updated.map(m => m.id)))\r\n          .map(id => updated.find(m => m.id === id)!)\r\n          .sort((a, b) => new Date(a.achievedAt).getTime() - new Date(b.achievedAt).getTime());\r\n        return uniqueAndSorted;\r\n      });\r\n    }\r\n  }, [trades, monthlyPortfolios, portfolioSize, yearlyStartingCapitals, useCashBasis]); // Removed achievedMilestones to prevent infinite loops\r\n\r\n  useEffect(() => {\r\n    // Debounce milestone checking to prevent excessive re-evaluation\r\n    const timeoutId = setTimeout(() => {\r\n      checkAndAwardMilestones();\r\n    }, 100);\r\n\r\n    return () => clearTimeout(timeoutId);\r\n  }, [checkAndAwardMilestones]); // Re-run when dependencies change\r\n\r\n  // Save milestones to Supabase\r\n  useEffect(() => {\r\n    if (!isLoading && typeof window !== 'undefined') {\r\n      SupabaseService.saveMilestonesData(achievedMilestones);\r\n    }\r\n  }, [achievedMilestones, isLoading]);\r\n\r\n  return {\r\n    achievedMilestones,\r\n    ALL_MILESTONES,\r\n    isLoading,\r\n  };\r\n};","import React from \"react\";\r\nimport { useGlobalFilter } from \"../context/GlobalFilterContext\";\r\nimport { Button, Dropdown, DropdownTrigger, DropdownMenu, DropdownItem, Input, Tooltip } from \"@heroui/react\";\r\nimport { Icon } from \"@iconify/react\";\r\nimport { useTrades } from \"../hooks/use-trades\";\r\nimport { useAccountingMethod } from \"../context/AccountingMethodContext\";\r\n\r\nconst filterOptions = [\r\n  { key: \"all\", label: \"All Time\" },\r\n  { key: \"week\", label: \"Past 1 Week\" },\r\n  { key: \"month\", label: \"Past 1 Month\" },\r\n  { key: \"fy\", label: \"This FY\" },\r\n  { key: \"cy\", label: \"This CY\" },\r\n  { key: \"pick-month\", label: \"Pick Month/Year\" },\r\n  { key: \"custom\", label: \"Custom Range\" },\r\n];\r\n\r\nconst months = [\r\n  \"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"\r\n];\r\nconst years = Array.from({ length: 10 }, (_, i) => new Date().getFullYear() - i);\r\n\r\nexport const GlobalFilterBar: React.FC = () => {\r\n  const { filter, setFilter } = useGlobalFilter();\r\n  const { clearAllTrades } = useTrades();\r\n  const { clearAccountingMethodData } = useAccountingMethod();\r\n\r\n  // Comprehensive clear all data handler\r\n  const handleClearAllData = React.useCallback(async () => {\r\n    const confirmed = window.confirm(\r\n      '⚠️ WARNING: This will permanently delete ALL data including:\\n\\n' +\r\n      '• All trades and trade data\\n' +\r\n      '• Portfolio settings and capital changes\\n' +\r\n      '• Custom setups and growth areas\\n' +\r\n      '• All cached and backup data\\n' +\r\n      '• User preferences and settings\\n\\n' +\r\n      'This action CANNOT be undone!\\n\\n' +\r\n      'Are you absolutely sure you want to continue?'\r\n    );\r\n\r\n    if (confirmed) {\r\n      const doubleConfirm = window.confirm(\r\n        '🚨 FINAL CONFIRMATION\\n\\n' +\r\n        'You are about to delete ALL application data.\\n' +\r\n        'This includes everything you have entered.\\n\\n' +\r\n        'Type \"DELETE\" in the next prompt to confirm.'\r\n      );\r\n\r\n      if (doubleConfirm) {\r\n        const finalConfirm = window.prompt(\r\n          'Type \"DELETE\" (in capital letters) to confirm deletion of all data:'\r\n        );\r\n\r\n        if (finalConfirm === 'DELETE') {\r\n          try {\r\n\r\n            // Clear all trades using the hook function (now async)\r\n            await clearAllTrades();\r\n\r\n            // Clear accounting method data\r\n            clearAccountingMethodData();\r\n\r\n            // Clear all localStorage data comprehensively\r\n            const keysToRemove = [];\r\n            for (let i = 0; i < localStorage.length; i++) {\r\n              const key = localStorage.key(i);\r\n              if (key) {\r\n                keysToRemove.push(key);\r\n              }\r\n            }\r\n\r\n            // Remove all localStorage keys\r\n            keysToRemove.forEach(key => {\r\n              try {\r\n                localStorage.removeItem(key);\r\n\r\n              } catch (error) {\r\n                // Silent cleanup\r\n              }\r\n            });\r\n\r\n            // Clear all sessionStorage data\r\n            try {\r\n              sessionStorage.clear();\r\n            } catch (error) {\r\n              // Silent cleanup\r\n            }\r\n\r\n            // Clear any IndexedDB data if present\r\n            if ('indexedDB' in window) {\r\n              try {\r\n                const dbNames = ['trades', 'portfolio', 'settings', 'cache'];\r\n                dbNames.forEach(dbName => {\r\n                  indexedDB.deleteDatabase(dbName);\r\n                });\r\n              } catch (error) {\r\n                // Silent cleanup\r\n              }\r\n            }\r\n\r\n            // Show success message and reload\r\n            alert('✅ All data has been successfully cleared!\\n\\nThe page will now reload to reset the application.');\r\n\r\n            // Force reload to reset all state\r\n            window.location.reload();\r\n\r\n          } catch (error) {\r\n            alert('❌ An error occurred while clearing data. Please try again or refresh the page manually.');\r\n          }\r\n        } else {\r\n          alert('❌ Deletion cancelled. You must type \"DELETE\" exactly to confirm.');\r\n        }\r\n      }\r\n    }\r\n  }, [clearAllTrades, clearAccountingMethodData]);\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-4 p-4 border-b border-divider bg-background/80\">\r\n      <Dropdown>\r\n        <DropdownTrigger>\r\n          <Button variant=\"flat\" className=\"font-medium\">\r\n            {filterOptions.find(opt => opt.key === filter.type)?.label || \"All Time\"}\r\n          </Button>\r\n        </DropdownTrigger>\r\n        <DropdownMenu\r\n          aria-label=\"Global Filter\"\r\n          selectionMode=\"single\"\r\n          selectedKeys={[filter.type === \"month\" ? \"pick-month\" : filter.type === \"custom\" ? \"custom\" : filter.type]}\r\n          onSelectionChange={keys => {\r\n            const selected = Array.from(keys)[0] as string;\r\n            if (selected === \"pick-month\") {\r\n              setFilter({ type: \"month\", month: new Date().getMonth(), year: new Date().getFullYear() });\r\n            } else if (selected === \"custom\") {\r\n              setFilter({ type: \"custom\", startDate: new Date(), endDate: new Date() });\r\n            } else {\r\n              setFilter({ type: selected as any });\r\n            }\r\n          }}\r\n        >\r\n          {filterOptions.map(opt => (\r\n            <DropdownItem key={opt.key} textValue={opt.label}>{opt.label}</DropdownItem>\r\n          ))}\r\n        </DropdownMenu>\r\n      </Dropdown>\r\n      {/* Month/Year Picker */}\r\n      {filter.type === \"month\" && (\r\n        <>\r\n          <Dropdown>\r\n            <DropdownTrigger>\r\n              <Button variant=\"flat\">\r\n                {months[filter.month ?? new Date().getMonth()]}\r\n              </Button>\r\n            </DropdownTrigger>\r\n            <DropdownMenu\r\n              aria-label=\"Select Month\"\r\n              selectionMode=\"single\"\r\n              selectedKeys={[String(filter.month ?? new Date().getMonth())]}\r\n              onSelectionChange={keys => {\r\n                const monthIdx = Number(Array.from(keys)[0]);\r\n                setFilter(f => ({ ...f, type: \"month\", month: monthIdx }));\r\n              }}\r\n            >\r\n              {months.map((m, idx) => (\r\n                <DropdownItem key={idx} textValue={m}>{m}</DropdownItem>\r\n              ))}\r\n            </DropdownMenu>\r\n          </Dropdown>\r\n          <Dropdown>\r\n            <DropdownTrigger>\r\n              <Button variant=\"flat\">\r\n                {filter.year ?? new Date().getFullYear()}\r\n              </Button>\r\n            </DropdownTrigger>\r\n            <DropdownMenu\r\n              aria-label=\"Select Year\"\r\n              selectionMode=\"single\"\r\n              selectedKeys={[String(filter.year ?? new Date().getFullYear())]}\r\n              onSelectionChange={keys => {\r\n                const year = Number(Array.from(keys)[0]);\r\n                setFilter(f => ({ ...f, type: \"month\", year }));\r\n              }}\r\n            >\r\n              {years.map(y => (\r\n                <DropdownItem key={y} textValue={String(y)}>{y}</DropdownItem>\r\n              ))}\r\n            </DropdownMenu>\r\n          </Dropdown>\r\n        </>\r\n      )}\r\n      {/* Custom Range Picker */}\r\n      {filter.type === \"custom\" && (\r\n        <div className=\"flex items-center gap-2\">\r\n          <Input\r\n            type=\"date\"\r\n            label=\"Start Date\"\r\n            value={filter.startDate ? new Date(filter.startDate).toISOString().slice(0, 10) : \"\"}\r\n            onChange={e => {\r\n              const date = e.target.value ? new Date(e.target.value) : undefined;\r\n              setFilter(f => ({ ...f, startDate: date }));\r\n            }}\r\n            size=\"sm\"\r\n          />\r\n          <span>-</span>\r\n          <Input\r\n            type=\"date\"\r\n            label=\"End Date\"\r\n            value={filter.endDate ? new Date(filter.endDate).toISOString().slice(0, 10) : \"\"}\r\n            onChange={e => {\r\n              const date = e.target.value ? new Date(e.target.value) : undefined;\r\n              setFilter(f => ({ ...f, endDate: date }));\r\n            }}\r\n            size=\"sm\"\r\n          />\r\n        </div>\r\n      )}\r\n      <div className=\"flex-1\" />\r\n      <Dropdown>\r\n        <DropdownTrigger>\r\n          <Button\r\n            isIconOnly\r\n            size=\"sm\"\r\n            variant=\"bordered\"\r\n            className=\"ml-auto hover:bg-danger/10 transition\"\r\n          >\r\n            <Icon icon=\"lucide:settings\" className=\"text-lg\" />\r\n          </Button>\r\n        </DropdownTrigger>\r\n        <DropdownMenu\r\n          aria-label=\"Settings options\"\r\n          onAction={(key) => {\r\n            if (key === 'clear-all') {\r\n              handleClearAllData();\r\n            }\r\n          }}\r\n        >\r\n          <DropdownItem\r\n            key=\"clear-all\"\r\n            startContent={<Icon icon=\"lucide:trash-2\" />}\r\n            className=\"text-danger\"\r\n            color=\"danger\"\r\n            textValue=\"Clear All Data\"\r\n          >\r\n            Clear All Data\r\n          </DropdownItem>\r\n        </DropdownMenu>\r\n      </Dropdown>\r\n    </div>\r\n  );\r\n};","import React from 'react';\r\n\r\ninterface AnimatedBrandNameProps {\r\n  className?: string;\r\n}\r\n\r\nexport const AnimatedBrandName: React.FC<AnimatedBrandNameProps> = ({ className = '' }) => {\r\n  return (\r\n    <div className={`hidden sm:flex items-center overflow-hidden ${className}`}>\r\n      <style>\r\n        {`\r\n          @keyframes slideUp {\r\n            0% {\r\n              transform: translateY(100%);\r\n              opacity: 0;\r\n            }\r\n            100% {\r\n              transform: translateY(0);\r\n              opacity: 1;\r\n            }\r\n          }\r\n\r\n          @keyframes glowPulse {\r\n            0%, 100% {\r\n              text-shadow: 0 0 0 rgba(255, 255, 255, 0);\r\n            }\r\n            50% {\r\n              text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);\r\n            }\r\n          }\r\n\r\n          .animate-letter {\r\n            display: inline-block;\r\n            animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;\r\n            opacity: 0;\r\n          }\r\n\r\n          .premium-text {\r\n            animation: glowPulse 3s infinite;\r\n          }\r\n        `}\r\n      </style>\r\n      <div className=\"flex items-center gap-1\">\r\n        <div className=\"flex\">\r\n          {'NEXUS'.split('').map((letter, index) => (\r\n            <span\r\n              key={index}\r\n              className=\"animate-letter text-black dark:text-white font-bold text-lg tracking-wider\"\r\n              style={{ animationDelay: `${index * 0.1}s` }}\r\n            >\r\n              {letter}\r\n            </span>\r\n          ))}\r\n        </div>\r\n        <div className=\"w-px h-6 bg-gradient-to-b from-gray-400 to-gray-600 mx-2\" />\r\n        <div className=\"flex\">\r\n          {'TRADE'.split('').map((letter, index) => (\r\n            <span\r\n              key={index}\r\n              className=\"animate-letter text-gray-600 dark:text-gray-400 font-medium premium-text\"\r\n              style={{ animationDelay: `${(index + 6) * 0.1}s` }}\r\n            >\r\n              {letter}\r\n            </span>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};","import React from 'react';\r\nimport { Card, CardBody, Button } from '@heroui/react';\r\n\r\ninterface ErrorBoundaryState {\r\n  hasError: boolean;\r\n  error?: Error;\r\n  errorInfo?: React.ErrorInfo;\r\n}\r\n\r\ninterface ErrorBoundaryProps {\r\n  children: React.ReactNode;\r\n  fallback?: React.ComponentType<{ error?: Error; resetError: () => void }>;\r\n}\r\n\r\nclass ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {\r\n  constructor(props: ErrorBoundaryProps) {\r\n    super(props);\r\n    this.state = { hasError: false };\r\n  }\r\n\r\n  static getDerivedStateFromError(error: Error): ErrorBoundaryState {\r\n    // Update state so the next render will show the fallback UI\r\n    return { hasError: true, error };\r\n  }\r\n\r\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n    // Store error info in state\r\n    this.setState({ error, errorInfo });\r\n\r\n    // In production, you would send this to an error reporting service\r\n    // Example: Sentry.captureException(error, { extra: errorInfo });\r\n  }\r\n\r\n  resetError = () => {\r\n    this.setState({ hasError: false, error: undefined, errorInfo: undefined });\r\n  };\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      // Custom fallback UI\r\n      if (this.props.fallback) {\r\n        const FallbackComponent = this.props.fallback;\r\n        return <FallbackComponent error={this.state.error} resetError={this.resetError} />;\r\n      }\r\n\r\n      // Default fallback UI\r\n      return (\r\n        <div className=\"min-h-screen flex items-center justify-center p-4\">\r\n          <Card className=\"max-w-md w-full\">\r\n            <CardBody className=\"text-center space-y-4\">\r\n              <div className=\"text-6xl\">💥</div>\r\n              <h2 className=\"text-xl font-semibold text-danger\">Something went wrong</h2>\r\n              <p className=\"text-default-600\">\r\n                The application encountered an unexpected error. Please try refreshing the page.\r\n              </p>\r\n\r\n              {process.env.NODE_ENV === 'development' && this.state.error && (\r\n                <details className=\"text-left text-sm bg-default-100 p-3 rounded\">\r\n                  <summary className=\"cursor-pointer font-medium\">Error Details</summary>\r\n                  <pre className=\"mt-2 text-xs overflow-auto\">\r\n                    {this.state.error.toString()}\r\n                    {this.state.errorInfo?.componentStack}\r\n                  </pre>\r\n                </details>\r\n              )}\r\n\r\n              <div className=\"flex gap-2 justify-center\">\r\n                <Button\r\n                  color=\"primary\"\r\n                  onPress={this.resetError}\r\n                >\r\n                  Try Again\r\n                </Button>\r\n                <Button\r\n                  variant=\"bordered\"\r\n                  onPress={() => window.location.reload()}\r\n                >\r\n                  Refresh Page\r\n                </Button>\r\n              </div>\r\n            </CardBody>\r\n          </Card>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\nexport default ErrorBoundary;\r\n","\"use client\";\n\n// src/react/index.tsx\nimport { useEffect } from \"react\";\n\n// package.json\nvar name = \"@vercel/analytics\";\nvar version = \"1.5.0\";\n\n// src/queue.ts\nvar initQueue = () => {\n  if (window.va) return;\n  window.va = function a(...params) {\n    (window.vaq = window.vaq || []).push(params);\n  };\n};\n\n// src/utils.ts\nfunction isBrowser() {\n  return typeof window !== \"undefined\";\n}\nfunction detectEnvironment() {\n  try {\n    const env = process.env.NODE_ENV;\n    if (env === \"development\" || env === \"test\") {\n      return \"development\";\n    }\n  } catch (e) {\n  }\n  return \"production\";\n}\nfunction setMode(mode = \"auto\") {\n  if (mode === \"auto\") {\n    window.vam = detectEnvironment();\n    return;\n  }\n  window.vam = mode;\n}\nfunction getMode() {\n  const mode = isBrowser() ? window.vam : detectEnvironment();\n  return mode || \"production\";\n}\nfunction isProduction() {\n  return getMode() === \"production\";\n}\nfunction isDevelopment() {\n  return getMode() === \"development\";\n}\nfunction removeKey(key, { [key]: _, ...rest }) {\n  return rest;\n}\nfunction parseProperties(properties, options) {\n  if (!properties) return void 0;\n  let props = properties;\n  const errorProperties = [];\n  for (const [key, value] of Object.entries(properties)) {\n    if (typeof value === \"object\" && value !== null) {\n      if (options.strip) {\n        props = removeKey(key, props);\n      } else {\n        errorProperties.push(key);\n      }\n    }\n  }\n  if (errorProperties.length > 0 && !options.strip) {\n    throw Error(\n      `The following properties are not valid: ${errorProperties.join(\n        \", \"\n      )}. Only strings, numbers, booleans, and null are allowed.`\n    );\n  }\n  return props;\n}\nfunction getScriptSrc(props) {\n  if (props.scriptSrc) {\n    return props.scriptSrc;\n  }\n  if (isDevelopment()) {\n    return \"https://va.vercel-scripts.com/v1/script.debug.js\";\n  }\n  if (props.basePath) {\n    return `${props.basePath}/insights/script.js`;\n  }\n  return \"/_vercel/insights/script.js\";\n}\n\n// src/generic.ts\nfunction inject(props = {\n  debug: true\n}) {\n  var _a;\n  if (!isBrowser()) return;\n  setMode(props.mode);\n  initQueue();\n  if (props.beforeSend) {\n    (_a = window.va) == null ? void 0 : _a.call(window, \"beforeSend\", props.beforeSend);\n  }\n  const src = getScriptSrc(props);\n  if (document.head.querySelector(`script[src*=\"${src}\"]`)) return;\n  const script = document.createElement(\"script\");\n  script.src = src;\n  script.defer = true;\n  script.dataset.sdkn = name + (props.framework ? `/${props.framework}` : \"\");\n  script.dataset.sdkv = version;\n  if (props.disableAutoTrack) {\n    script.dataset.disableAutoTrack = \"1\";\n  }\n  if (props.endpoint) {\n    script.dataset.endpoint = props.endpoint;\n  } else if (props.basePath) {\n    script.dataset.endpoint = `${props.basePath}/insights`;\n  }\n  if (props.dsn) {\n    script.dataset.dsn = props.dsn;\n  }\n  script.onerror = () => {\n    const errorMessage = isDevelopment() ? \"Please check if any ad blockers are enabled and try again.\" : \"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.\";\n    console.log(\n      `[Vercel Web Analytics] Failed to load script from ${src}. ${errorMessage}`\n    );\n  };\n  if (isDevelopment() && props.debug === false) {\n    script.dataset.debug = \"false\";\n  }\n  document.head.appendChild(script);\n}\nfunction track(name2, properties, options) {\n  var _a, _b;\n  if (!isBrowser()) {\n    const msg = \"[Vercel Web Analytics] Please import `track` from `@vercel/analytics/server` when using this function in a server environment\";\n    if (isProduction()) {\n      console.warn(msg);\n    } else {\n      throw new Error(msg);\n    }\n    return;\n  }\n  if (!properties) {\n    (_a = window.va) == null ? void 0 : _a.call(window, \"event\", { name: name2, options });\n    return;\n  }\n  try {\n    const props = parseProperties(properties, {\n      strip: isProduction()\n    });\n    (_b = window.va) == null ? void 0 : _b.call(window, \"event\", {\n      name: name2,\n      data: props,\n      options\n    });\n  } catch (err) {\n    if (err instanceof Error && isDevelopment()) {\n      console.error(err);\n    }\n  }\n}\nfunction pageview({\n  route,\n  path\n}) {\n  var _a;\n  (_a = window.va) == null ? void 0 : _a.call(window, \"pageview\", { route, path });\n}\n\n// src/react/utils.ts\nfunction getBasePath() {\n  if (typeof process === \"undefined\" || typeof process.env === \"undefined\") {\n    return void 0;\n  }\n  return process.env.REACT_APP_VERCEL_OBSERVABILITY_BASEPATH;\n}\n\n// src/react/index.tsx\nfunction Analytics(props) {\n  useEffect(() => {\n    var _a;\n    if (props.beforeSend) {\n      (_a = window.va) == null ? void 0 : _a.call(window, \"beforeSend\", props.beforeSend);\n    }\n  }, [props.beforeSend]);\n  useEffect(() => {\n    inject({\n      framework: props.framework || \"react\",\n      basePath: props.basePath ?? getBasePath(),\n      ...props.route !== void 0 && { disableAutoTrack: true },\n      ...props\n    });\n  }, []);\n  useEffect(() => {\n    if (props.route && props.path) {\n      pageview({ route: props.route, path: props.path });\n    }\n  }, [props.route, props.path]);\n  return null;\n}\nexport {\n  Analytics,\n  track\n};\n//# sourceMappingURL=index.mjs.map","import React from \"react\";\nimport { Spinner } from \"@heroui/react\";\nimport { motion } from \"framer-motion\";\n\ninterface LoaderProps {\n  size?: 'sm' | 'md' | 'lg';\n  message?: string;\n  fullScreen?: boolean;\n  className?: string;\n}\n\n// High-performance loader component with GPU acceleration\nexport const Loader: React.FC<LoaderProps> = React.memo(({\n  size = 'md',\n  message = 'Loading...',\n  fullScreen = false,\n  className = ''\n}) => {\n  const containerClasses = fullScreen\n    ? 'fixed inset-0 z-50 flex items-center justify-center bg-background/80 backdrop-blur-sm gpu-accelerated'\n    : 'flex flex-col items-center justify-center min-h-[200px] gpu-accelerated';\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, scale: 0.9 }}\n      animate={{ opacity: 1, scale: 1 }}\n      transition={{ duration: 0.3, ease: \"easeOut\" }}\n      className={`${containerClasses} ${className}`}\n    >\n      <motion.div\n        initial={{ opacity: 0, scale: 0.8 }}\n        animate={{ opacity: 1, scale: 1 }}\n        transition={{ duration: 0.4, delay: 0.1 }}\n        className=\"mb-4\"\n      >\n        <div className=\"relative gpu-accelerated\">\n          <motion.div\n            animate={{ rotate: 360 }}\n            transition={{ duration: 1.5, repeat: Infinity, ease: \"linear\" }}\n            className=\"w-10 h-10 border-2 border-foreground/20 border-t-foreground rounded-full loading-spinner\"\n          />\n          <motion.div\n            animate={{\n              scale: [1, 1.2, 1],\n              opacity: [0.3, 0.8, 0.3]\n            }}\n            transition={{\n              duration: 2,\n              repeat: Infinity,\n              ease: \"easeInOut\"\n            }}\n            className=\"absolute inset-0 w-10 h-10 border border-foreground/10 rounded-full gpu-accelerated\"\n          />\n        </div>\n      </motion.div>\n\n      <motion.div\n        initial={{ opacity: 0, y: 10 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.4, delay: 0.2 }}\n      >\n        <p className=\"text-sm font-medium text-foreground/80 mb-2 font-sans optimized-text\">{message}</p>\n        <div className=\"flex items-center justify-center gap-1\">\n          {[0, 1, 2].map((i) => (\n            <motion.div\n              key={i}\n              className=\"w-1 h-1 bg-foreground rounded-full gpu-accelerated\"\n              animate={{\n                scale: [1, 1.4, 1],\n                opacity: [0.4, 1, 0.4],\n                y: [0, -2, 0]\n              }}\n              transition={{\n                duration: 1.2,\n                repeat: Infinity,\n                delay: i * 0.15,\n                ease: \"easeInOut\"\n              }}\n            />\n          ))}\n        </div>\n      </motion.div>\n    </motion.div>\n  );\n});\n\nLoader.displayName = 'Loader';","import React, { useState, useEffect } from 'react'\r\nimport { motion, AnimatePresence } from 'framer-motion'\r\nimport { Icon } from '@iconify/react'\r\nimport { useAuth } from '../../context/AuthContext'\r\nimport { getAuthErrorMessage, AuthService } from '../../services/authService'\r\nimport { TradeTrackerLogo } from '../icons/TradeTrackerLogo'\r\nimport { AnimatedBrandName } from '../AnimatedBrandName'\r\nimport '../../styles/auth-performance.css'\r\n\r\ntype AuthMode = 'signin' | 'signup' | 'forgot-password'\r\n\r\ninterface AuthModalProps {\r\n  isOpen?: boolean\r\n  onClose?: () => void\r\n  onGuestMode?: () => void\r\n  onShowAuth?: () => void\r\n}\r\n\r\nexport const AuthModal: React.FC<AuthModalProps> = ({ isOpen = true, onClose, onGuestMode, onShowAuth }) => {\r\n  const [mode, setMode] = useState<AuthMode>('signin')\r\n  const [email, setEmail] = useState('')\r\n  const [password, setPassword] = useState('')\r\n  const [confirmPassword, setConfirmPassword] = useState('')\r\n  const [firstName, setFirstName] = useState('')\r\n  const [lastName, setLastName] = useState('')\r\n  const [showPassword, setShowPassword] = useState(false)\r\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false)\r\n  const [isLoading, setIsLoading] = useState(false)\r\n  const [error, setError] = useState('')\r\n  const [success, setSuccess] = useState('')\r\n  const [focusedField, setFocusedField] = useState<string | null>(null)\r\n  const [isReady, setIsReady] = useState(false)\r\n\r\n  // Prevent initial render stutter\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => setIsReady(true), 50)\r\n    return () => clearTimeout(timer)\r\n  }, [])\r\n\r\n  const { signIn, signUp, signInWithProvider, resetPassword, resendVerification } = useAuth()\r\n\r\n  // Optimized animation variants with GPU acceleration\r\n  const containerVariants = {\r\n    hidden: {\r\n      opacity: 0,\r\n      scale: 0.98,\r\n      y: 10,\r\n      filter: \"blur(4px)\"\r\n    },\r\n    visible: {\r\n      opacity: 1,\r\n      scale: 1,\r\n      y: 0,\r\n      filter: \"blur(0px)\",\r\n      transition: {\r\n        duration: 0.25,\r\n        ease: [0.25, 0.46, 0.45, 0.94],\r\n        filter: { duration: 0.15 }\r\n      }\r\n    },\r\n    exit: {\r\n      opacity: 0,\r\n      scale: 0.98,\r\n      y: -10,\r\n      filter: \"blur(4px)\",\r\n      transition: {\r\n        duration: 0.2,\r\n        ease: [0.25, 0.46, 0.45, 0.94]\r\n      }\r\n    }\r\n  }\r\n\r\n  const formVariants = {\r\n    hidden: { opacity: 0, y: 8 },\r\n    visible: {\r\n      opacity: 1,\r\n      y: 0,\r\n      transition: {\r\n        duration: 0.2,\r\n        delay: 0.05,\r\n        ease: [0.25, 0.46, 0.45, 0.94]\r\n      }\r\n    },\r\n    exit: {\r\n      opacity: 0,\r\n      y: -8,\r\n      transition: { duration: 0.15 }\r\n    }\r\n  }\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault()\r\n    e.stopPropagation() // Prevent event bubbling\r\n    console.log('🔐 Form submitted, mode:', mode, 'email:', email)\r\n\r\n    // Clear any existing errors/success messages\r\n    setError('')\r\n    setSuccess('')\r\n    setIsLoading(true)\r\n\r\n    // Prevent any potential page refresh\r\n    if (e.target) {\r\n      (e.target as HTMLFormElement).setAttribute('data-submitting', 'true')\r\n    }\r\n\r\n    try {\r\n      if (mode === 'signin') {\r\n        console.log('🔐 Attempting sign in...')\r\n        const { error } = await signIn(email, password)\r\n\r\n        if (error) {\r\n          console.error('❌ Sign in error received:', error)\r\n          const errorCode = getAuthErrorMessage({ message: error } as any)\r\n          console.log('📝 Error code mapped to:', errorCode)\r\n\r\n          // Handle specific error cases with custom messages\r\n          if (errorCode === 'INVALID_CREDENTIALS') {\r\n            // Simple, direct error message like password reset\r\n            const errorMessage = `❌ Incorrect email or password!\r\n\r\n💡 New user? Click \"Sign Up Instead\" below to create an account.`\r\n            console.log('🔴 Setting error message:', errorMessage)\r\n            setError(errorMessage)\r\n            console.log('🔴 Error state should now be:', errorMessage)\r\n          } else if (errorCode === 'EMAIL_NOT_CONFIRMED') {\r\n            const emailError = `❌ Email not verified! Check your inbox and click the verification link.`\r\n            setError(emailError)\r\n          } else {\r\n            setError(errorCode)\r\n          }\r\n          console.log('❌ Error set in UI:', errorCode)\r\n        } else {\r\n          console.log('✅ Sign in successful!')\r\n        }\r\n      } else if (mode === 'signup') {\r\n        if (password !== confirmPassword) {\r\n          setError('Passwords do not match')\r\n          return\r\n        }\r\n        if (password.length < 6) {\r\n          setError('Password must be at least 6 characters long')\r\n          return\r\n        }\r\n\r\n        const { error } = await signUp(email, password, firstName, lastName)\r\n        if (error) {\r\n          setError(getAuthErrorMessage({ message: error } as any))\r\n        } else {\r\n          setSuccess(`✅ Account created successfully!\r\n\r\n📧 Please check your email (${email}) for a verification link.\r\n\r\n⚠️ You must verify your email before you can sign in.\r\n\r\n💡 Check your spam folder if you don't see the email within a few minutes.`)\r\n          setMode('signin')\r\n          setPassword('')\r\n          setConfirmPassword('')\r\n        }\r\n      } else if (mode === 'forgot-password') {\r\n        const { error } = await resetPassword(email)\r\n        if (error) {\r\n          setError(getAuthErrorMessage({ message: error } as any))\r\n        } else {\r\n          setSuccess(`If this email exists, a reset link was sent.`)\r\n          setMode('signin')\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('❌ Unexpected error in handleSubmit:', error)\r\n      setError('An unexpected error occurred. Please try again.')\r\n    } finally {\r\n      setIsLoading(false)\r\n      console.log('🔄 Form submission completed, loading set to false')\r\n\r\n      // Remove the submitting attribute\r\n      if (e.target) {\r\n        (e.target as HTMLFormElement).removeAttribute('data-submitting')\r\n      }\r\n    }\r\n  }\r\n\r\n  const resetForm = () => {\r\n    setEmail('')\r\n    setPassword('')\r\n    setConfirmPassword('')\r\n    setFirstName('')\r\n    setLastName('')\r\n    setError('')\r\n    setSuccess('')\r\n    setShowPassword(false)\r\n  }\r\n\r\n  const switchMode = (newMode: AuthMode) => {\r\n    setMode(newMode)\r\n    resetForm()\r\n  }\r\n\r\n  const handleResendVerification = async () => {\r\n    if (!email) {\r\n      setError('Please enter your email address first')\r\n      return\r\n    }\r\n\r\n    setIsLoading(true)\r\n    setError('')\r\n    setSuccess('')\r\n\r\n    try {\r\n      const { error } = await resendVerification(email)\r\n      if (error) {\r\n        setError(error)\r\n      } else {\r\n        setSuccess(`Verification email sent! Check your inbox.`)\r\n      }\r\n    } catch (error) {\r\n      setError('Failed to resend verification email. Please try again.')\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  const handleSocialAuth = async (provider: 'twitter' | 'google' | 'github') => {\r\n    setIsLoading(true)\r\n    setError('')\r\n    setSuccess('')\r\n\r\n    const { error } = await signInWithProvider(provider)\r\n\r\n    if (error) {\r\n      setError(error)\r\n      setIsLoading(false)\r\n    }\r\n    // If successful, the user will be redirected, so we don't need to set loading to false\r\n  }\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n      {/* Optimized Background Overlay */}\r\n      <motion.div\r\n        className=\"auth-modal-backdrop absolute inset-0 bg-black/15\"\r\n        initial={{ opacity: 0 }}\r\n        animate={{ opacity: 1 }}\r\n        exit={{ opacity: 0 }}\r\n        transition={{ duration: 0.15 }}\r\n      />\r\n\r\n      <motion.div\r\n        variants={containerVariants}\r\n        initial=\"hidden\"\r\n        animate={isReady ? \"visible\" : \"hidden\"}\r\n        exit=\"exit\"\r\n        className=\"auth-modal-container relative w-full max-w-sm z-10\"\r\n        data-loading={!isReady}\r\n      >\r\n        {/* Optimized Card with GPU acceleration */}\r\n        <div className=\"auth-modal-card relative bg-white/98 dark:bg-black/98 border border-gray-200/30 dark:border-gray-700/30 rounded-xl shadow-xl overflow-hidden\">\r\n          {/* Content */}\r\n          <div className=\"p-6\">\r\n            {/* Minimal Header */}\r\n            <div className=\"text-center mb-6\">\r\n              <div className=\"flex items-center justify-center mb-4\">\r\n                <svg\r\n                  viewBox=\"0 0 24 24\"\r\n                  className=\"h-6 w-6 text-black dark:text-white\"\r\n                  fill=\"none\"\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                >\r\n                  <circle\r\n                    cx=\"12\"\r\n                    cy=\"12\"\r\n                    r=\"10\"\r\n                    stroke=\"currentColor\"\r\n                    strokeWidth=\"1.5\"\r\n                    fill=\"none\"\r\n                  />\r\n                  <path\r\n                    d=\"M12 6L16 10L12 18L8 10L12 6Z\"\r\n                    fill=\"currentColor\"\r\n                    stroke=\"currentColor\"\r\n                    strokeWidth=\"0.5\"\r\n                    strokeLinejoin=\"round\"\r\n                  />\r\n                </svg>\r\n              </div>\r\n\r\n              <h1 className=\"text-lg font-semibold text-black dark:text-white mb-1\">\r\n                {mode === 'signin' && 'Sign In'}\r\n                {mode === 'signup' && 'Sign Up'}\r\n                {mode === 'forgot-password' && 'Reset Password'}\r\n              </h1>\r\n\r\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                {mode === 'signin' && 'Welcome back'}\r\n                {mode === 'signup' && 'Create your account'}\r\n                {mode === 'forgot-password' && 'Enter your email'}\r\n              </p>\r\n            </div>\r\n\r\n            {/* Minimal Error Message */}\r\n            {error && (\r\n              <div className=\"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded text-center\">\r\n                <p className=\"text-xs text-red-600 dark:text-red-400 leading-relaxed\">\r\n                  {error}\r\n                </p>\r\n                {(error.includes('Email not verified') || error.includes('Sign in failed')) && (\r\n                  <div className=\"mt-2 flex justify-center gap-2\">\r\n                    {error.includes('Email not verified') && (\r\n                      <button\r\n                        onClick={handleResendVerification}\r\n                        disabled={isLoading || !email}\r\n                        className=\"text-xs text-red-600 dark:text-red-400 underline hover:no-underline disabled:opacity-50\"\r\n                      >\r\n                        Resend Email\r\n                      </button>\r\n                    )}\r\n                    {error.includes('Sign in failed') && mode === 'signin' && (\r\n                      <button\r\n                        onClick={() => switchMode('signup')}\r\n                        className=\"text-xs text-red-600 dark:text-red-400 underline hover:no-underline\"\r\n                      >\r\n                        Sign Up Instead\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n\r\n\r\n            {/* Minimal Success Message */}\r\n            {success && (\r\n              <div className=\"mb-4 p-3 bg-gray-50 dark:bg-gray-900/20 border border-gray-200 dark:border-gray-700 rounded text-center\">\r\n                <p className=\"text-xs text-gray-600 dark:text-gray-400 leading-relaxed\">\r\n                  {success}\r\n                </p>\r\n              </div>\r\n            )}\r\n\r\n            {/* Optimized Form */}\r\n            <form\r\n              onSubmit={handleSubmit}\r\n              className=\"auth-form-container space-y-3\"\r\n              noValidate\r\n              autoComplete=\"off\"\r\n              data-testid=\"auth-form\"\r\n            >\r\n              {/* Name Fields for Signup */}\r\n              {mode === 'signup' && (\r\n                <div className=\"grid grid-cols-2 gap-2\">\r\n                  <input\r\n                    type=\"text\"\r\n                    placeholder=\"First\"\r\n                    value={firstName}\r\n                    onChange={(e) => setFirstName(e.target.value)}\r\n                    className=\"auth-input w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded text-sm focus:outline-none focus:border-black dark:focus:border-white\"\r\n                  />\r\n                  <input\r\n                    type=\"text\"\r\n                    placeholder=\"Last\"\r\n                    value={lastName}\r\n                    onChange={(e) => setLastName(e.target.value)}\r\n                    className=\"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded text-sm focus:outline-none focus:border-black dark:focus:border-white transition-colors\"\r\n                  />\r\n                </div>\r\n              )}\r\n\r\n              {/* Email Field */}\r\n              <input\r\n                type=\"email\"\r\n                placeholder=\"Email\"\r\n                value={email}\r\n                onChange={(e) => setEmail(e.target.value)}\r\n                required\r\n                className=\"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded text-sm focus:outline-none focus:border-black dark:focus:border-white transition-colors\"\r\n              />\r\n\r\n              {/* Password Field */}\r\n              {mode !== 'forgot-password' && (\r\n                <div className=\"relative\">\r\n                  <input\r\n                    type={showPassword ? 'text' : 'password'}\r\n                    placeholder=\"Password\"\r\n                    value={password}\r\n                    onChange={(e) => setPassword(e.target.value)}\r\n                    required\r\n                    className=\"w-full px-3 py-2 pr-8 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded text-sm focus:outline-none focus:border-black dark:focus:border-white transition-colors\"\r\n                  />\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowPassword(!showPassword)}\r\n                    className=\"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\r\n                  >\r\n                    <Icon icon={showPassword ? 'mdi:eye-off' : 'mdi:eye'} className=\"text-sm\" />\r\n                  </button>\r\n                </div>\r\n              )}\r\n\r\n              {/* Confirm Password Field */}\r\n              {mode === 'signup' && (\r\n                <div className=\"relative\">\r\n                  <input\r\n                    type={showConfirmPassword ? 'text' : 'password'}\r\n                    placeholder=\"Confirm Password\"\r\n                    value={confirmPassword}\r\n                    onChange={(e) => setConfirmPassword(e.target.value)}\r\n                    required\r\n                    className=\"w-full px-3 py-2 pr-8 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded text-sm focus:outline-none focus:border-black dark:focus:border-white transition-colors\"\r\n                  />\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowConfirmPassword(!showConfirmPassword)}\r\n                    className=\"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\r\n                  >\r\n                    <Icon icon={showConfirmPassword ? 'mdi:eye-off' : 'mdi:eye'} className=\"text-sm\" />\r\n                  </button>\r\n                </div>\r\n              )}\r\n\r\n              {/* Forgot Password Link - Only show for sign in mode */}\r\n              {mode === 'signin' && (\r\n                <div className=\"text-center\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => switchMode('forgot-password')}\r\n                    className=\"text-xs text-gray-500 dark:text-gray-400 hover:text-black dark:hover:text-white transition-colors underline\"\r\n                  >\r\n                    Forgot your password?\r\n                  </button>\r\n                </div>\r\n              )}\r\n\r\n              {/* Submit Button */}\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isLoading}\r\n                className=\"auth-button w-full py-2 px-4 bg-black dark:bg-white text-white dark:text-black text-sm font-medium rounded hover:bg-gray-800 dark:hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n              >\r\n                {isLoading ? (\r\n                  <div className=\"flex items-center justify-center\">\r\n                    <div className=\"auth-spinner w-4 h-4 border-2 border-white/30 dark:border-black/30 border-t-white dark:border-t-black rounded-full\" />\r\n                  </div>\r\n                ) : (\r\n                  <>\r\n                    {mode === 'signin' && 'Sign In'}\r\n                    {mode === 'signup' && 'Sign Up'}\r\n                    {mode === 'forgot-password' && 'Send Reset Email'}\r\n                  </>\r\n                )}\r\n              </button>\r\n            </form>\r\n\r\n            {/* Social Authentication */}\r\n            {mode !== 'forgot-password' && (\r\n              <div className=\"mt-4\">\r\n                <div className=\"relative\">\r\n                  <div className=\"absolute inset-0 flex items-center\">\r\n                    <div className=\"w-full border-t border-gray-200 dark:border-gray-700\" />\r\n                  </div>\r\n                  <div className=\"relative flex justify-center text-xs\">\r\n                    <span className=\"bg-white dark:bg-black px-2 text-gray-500 dark:text-gray-400\">\r\n                      OR CONTINUE WITH\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"mt-4 space-y-2\">\r\n                  {/* Continue with X (Twitter) */}\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => handleSocialAuth('twitter')}\r\n                    disabled={isLoading}\r\n                    className=\"social-auth-button w-full flex items-center justify-center px-3 py-2 border border-gray-200 dark:border-gray-700 rounded text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-black hover:bg-gray-50 dark:hover:bg-gray-900 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                  >\r\n                    <Icon icon=\"mdi:twitter\" className=\"w-4 h-4 mr-2\" />\r\n                    Continue with X\r\n                  </button>\r\n\r\n                  {/* Continue with Google */}\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => handleSocialAuth('google')}\r\n                    disabled={isLoading}\r\n                    className=\"w-full flex items-center justify-center px-3 py-2 border border-gray-200 dark:border-gray-700 rounded text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-black hover:bg-gray-50 dark:hover:bg-gray-900 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                  >\r\n                    <Icon icon=\"mdi:google\" className=\"w-4 h-4 mr-2\" />\r\n                    Continue with Google\r\n                  </button>\r\n\r\n                  {/* Continue with GitHub */}\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => handleSocialAuth('github')}\r\n                    disabled={isLoading}\r\n                    className=\"w-full flex items-center justify-center px-3 py-2 border border-gray-200 dark:border-gray-700 rounded text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-black hover:bg-gray-50 dark:hover:bg-gray-900 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                  >\r\n                    <Icon icon=\"mdi:github\" className=\"w-4 h-4 mr-2\" />\r\n                    Continue with GitHub\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Minimal Navigation */}\r\n            <div className=\"mt-4 text-center space-y-2\">\r\n              {mode === 'signin' && (\r\n                <p className=\"text-xs text-gray-600 dark:text-gray-400\">\r\n                  Don't have an account?{' '}\r\n                  <button\r\n                    onClick={() => switchMode('signup')}\r\n                    className=\"text-black dark:text-white underline hover:no-underline transition-colors\"\r\n                  >\r\n                    Sign up\r\n                  </button>\r\n                </p>\r\n              )}\r\n\r\n              {mode === 'signup' && (\r\n                <div className=\"space-y-1\">\r\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400\">\r\n                    Already have an account?{' '}\r\n                    <button\r\n                      onClick={() => switchMode('signin')}\r\n                      className=\"text-black dark:text-white underline hover:no-underline transition-colors\"\r\n                    >\r\n                      Sign in\r\n                    </button>\r\n                  </p>\r\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400\">\r\n                    Forgot your password?{' '}\r\n                    <button\r\n                      onClick={() => switchMode('forgot-password')}\r\n                      className=\"text-black dark:text-white underline hover:no-underline transition-colors\"\r\n                    >\r\n                      Reset it\r\n                    </button>\r\n                  </p>\r\n                </div>\r\n              )}\r\n\r\n              {mode === 'forgot-password' && (\r\n                <div className=\"space-y-1\">\r\n                  <button\r\n                    onClick={() => switchMode('signin')}\r\n                    className=\"text-xs text-gray-600 dark:text-gray-400 hover:text-black dark:hover:text-white transition-colors underline\"\r\n                  >\r\n                    ← Back to sign in\r\n                  </button>\r\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400\">\r\n                    Don't have an account?{' '}\r\n                    <button\r\n                      onClick={() => switchMode('signup')}\r\n                      className=\"text-black dark:text-white underline hover:no-underline transition-colors\"\r\n                    >\r\n                      Sign up\r\n                    </button>\r\n                  </p>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Guest Mode Option */}\r\n            {onGuestMode && (\r\n              <div className=\"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 text-center\">\r\n                <button\r\n                  onClick={onGuestMode}\r\n                  className=\"text-xs text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors\"\r\n                >\r\n                  Continue as Guest\r\n                </button>\r\n                <p className=\"text-xs text-gray-400 dark:text-gray-500 mt-1\">\r\n                  Limited features available\r\n                </p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </motion.div>\r\n    </div>\r\n  )\r\n}\r\n","import React, { ReactNode, useEffect, useState } from 'react'\nimport { useAuth } from '../../context/AuthContext'\nimport { AuthModal } from './AuthModal'\nimport { Spinner } from '@heroui/react'\nimport { motion } from 'framer-motion'\nimport { Icon } from '@iconify/react'\nimport '../../styles/auth-performance.css'\n\ninterface AuthGuardProps {\n  children: ReactNode\n  fallback?: ReactNode\n}\n\nexport const AuthGuard: React.FC<AuthGuardProps> = ({ children, fallback }) => {\n  const { user, session, loading, error } = useAuth()\n  const [mounted, setMounted] = useState(false)\n  const [showAuthModal, setShowAuthModal] = useState(false)\n  const [isGuestMode, setIsGuestMode] = useState(false)\n  const [authError, setAuthError] = useState<string | null>(null)\n\n  // Track when component is mounted\n  useEffect(() => {\n    setMounted(true)\n  }, [])\n\n  // Handle authentication errors\n  useEffect(() => {\n    if (error) {\n      console.log('🔐 AuthGuard detected auth error:', error)\n      setAuthError(error)\n    }\n  }, [error])\n\n  // Show loading spinner while checking authentication\n  if (!mounted || loading) {\n    return (\n      <div className=\"min-h-screen bg-background font-sans antialiased\">\n        {/* Backdrop with subtle pattern */}\n        <div className=\"absolute inset-0 bg-gradient-to-br from-background via-background to-background\">\n          <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(17,24,28,0.03),transparent_70%)] dark:bg-[radial-gradient(circle_at_50%_50%,rgba(236,237,238,0.02),transparent_70%)]\" />\n        </div>\n\n        {/* Loading content */}\n        <div className=\"relative z-10 min-h-screen flex items-center justify-center px-6\">\n          <motion.div\n            initial={{ opacity: 0, scale: 0.9 }}\n            animate={{ opacity: 1, scale: 1 }}\n            transition={{ duration: 0.3, ease: \"easeOut\" }}\n            className=\"flex flex-col items-center justify-center text-center max-w-sm mx-auto\"\n          >\n            {/* Logo */}\n            <motion.div\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.6, delay: 0.1 }}\n              className=\"mb-16\"\n            >\n              <div className=\"flex flex-col items-center justify-center space-y-6\">\n                {/* Animated Logo Icon */}\n                <motion.div\n                  animate={{\n                    rotate: 360,\n                    scale: [1, 1.02, 1]\n                  }}\n                  transition={{\n                    rotate: { duration: 20, repeat: Infinity, ease: \"linear\" },\n                    scale: { duration: 4, repeat: Infinity, ease: \"easeInOut\" }\n                  }}\n                  className=\"relative\"\n                >\n                  {/* Outer glow ring */}\n                  <motion.div\n                    animate={{\n                      scale: [1, 1.1, 1],\n                      opacity: [0.1, 0.3, 0.1]\n                    }}\n                    transition={{\n                      duration: 3,\n                      repeat: Infinity,\n                      ease: \"easeInOut\"\n                    }}\n                    className=\"absolute inset-0 w-16 h-16 border border-foreground/10 rounded-full -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2\"\n                  />\n\n                  <svg\n                    viewBox=\"0 0 24 24\"\n                    className=\"h-16 w-16 text-foreground relative z-10\"\n                    fill=\"none\"\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                  >\n                    <motion.circle\n                      cx=\"12\"\n                      cy=\"12\"\n                      r=\"10\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"1\"\n                      fill=\"none\"\n                      initial={{ pathLength: 0, opacity: 0 }}\n                      animate={{ pathLength: 1, opacity: 1 }}\n                      transition={{ duration: 2, ease: \"easeInOut\" }}\n                    />\n                    <motion.path\n                      d=\"M12 6L16 10L12 18L8 10L12 6Z\"\n                      fill=\"currentColor\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"0.2\"\n                      strokeLinejoin=\"round\"\n                      initial={{ scale: 0, opacity: 0 }}\n                      animate={{ scale: 1, opacity: 1 }}\n                      transition={{ duration: 1, delay: 0.8, ease: \"backOut\" }}\n                    />\n                    <motion.path\n                      d=\"M8 10L12 14L16 10\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"0.2\"\n                      fill=\"none\"\n                      opacity=\"0.5\"\n                      initial={{ pathLength: 0, opacity: 0 }}\n                      animate={{ pathLength: 1, opacity: 0.5 }}\n                      transition={{ duration: 1.2, delay: 1.2, ease: \"easeInOut\" }}\n                    />\n                  </svg>\n                </motion.div>\n\n                {/* Brand Name */}\n                <motion.div\n                  initial={{ opacity: 0, y: 10 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ duration: 0.8, delay: 0.4 }}\n                  className=\"text-center\"\n                >\n                  <motion.h1\n                    className=\"text-3xl font-bold tracking-wider text-foreground font-sans\"\n                    initial={{ letterSpacing: \"0.3em\", opacity: 0 }}\n                    animate={{ letterSpacing: \"0.15em\", opacity: 1 }}\n                    transition={{ duration: 1, delay: 0.6 }}\n                  >\n                    NEXUS\n                  </motion.h1>\n                  <motion.div\n                    initial={{ width: 0, opacity: 0 }}\n                    animate={{ width: \"100%\", opacity: 0.3 }}\n                    transition={{ duration: 1, delay: 1 }}\n                    className=\"h-px bg-foreground mt-3 mx-auto\"\n                  />\n                </motion.div>\n              </div>\n            </motion.div>\n\n            {/* Spinner */}\n            <motion.div\n              initial={{ opacity: 0, scale: 0.8 }}\n              animate={{ opacity: 1, scale: 1 }}\n              transition={{ duration: 0.4, delay: 0.2 }}\n              className=\"mb-8 flex justify-center\"\n            >\n              <div className=\"relative flex items-center justify-center\">\n                <motion.div\n                  animate={{ rotate: 360 }}\n                  transition={{ duration: 1.5, repeat: Infinity, ease: \"linear\" }}\n                  className=\"w-12 h-12 border-2 border-foreground/15 border-t-foreground rounded-full\"\n                />\n                <motion.div\n                  animate={{\n                    scale: [1, 1.15, 1],\n                    opacity: [0.2, 0.6, 0.2]\n                  }}\n                  transition={{\n                    duration: 2.5,\n                    repeat: Infinity,\n                    ease: \"easeInOut\"\n                  }}\n                  className=\"absolute inset-0 w-12 h-12 border border-foreground/8 rounded-full\"\n                />\n                <motion.div\n                  animate={{\n                    scale: [1, 1.3, 1],\n                    opacity: [0.1, 0.4, 0.1]\n                  }}\n                  transition={{\n                    duration: 3,\n                    repeat: Infinity,\n                    ease: \"easeInOut\",\n                    delay: 0.5\n                  }}\n                  className=\"absolute inset-0 w-12 h-12 border border-foreground/5 rounded-full\"\n                />\n              </div>\n            </motion.div>\n\n            {/* Loading text */}\n            <motion.div\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.4, delay: 0.3 }}\n              className=\"text-center\"\n            >\n              <motion.p\n                className=\"text-sm font-medium text-foreground/70 mb-4 font-sans tracking-wide\"\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                transition={{ duration: 0.6, delay: 0.5 }}\n              >\n                {!mounted ? 'Initializing...' : 'Checking authentication...'}\n              </motion.p>\n\n              <div className=\"flex items-center justify-center gap-1.5\">\n                {[0, 1, 2].map((i) => (\n                  <motion.div\n                    key={i}\n                    className=\"w-1.5 h-1.5 bg-foreground/60 rounded-full\"\n                    animate={{\n                      scale: [1, 1.3, 1],\n                      opacity: [0.3, 1, 0.3],\n                      y: [0, -3, 0]\n                    }}\n                    transition={{\n                      duration: 1.4,\n                      repeat: Infinity,\n                      delay: i * 0.2,\n                      ease: \"easeInOut\"\n                    }}\n                  />\n                ))}\n              </div>\n            </motion.div>\n          </motion.div>\n        </div>\n      </div>\n    )\n  }\n\n  // If user is authenticated, render children\n  if (user && session) {\n    return <>{children}</>\n  }\n\n  // If user chose guest mode, render children without auth\n  if (isGuestMode) {\n    return (\n      <>\n        {children}\n        {showAuthModal && (\n          <AuthModal\n            isOpen={showAuthModal}\n            onClose={() => setShowAuthModal(false)}\n          />\n        )}\n      </>\n    )\n  }\n\n  // Show auth modal with option to continue as guest\n  return (\n    <>\n      {children}\n      <AuthModal\n        isOpen={true}\n        onClose={() => setIsGuestMode(true)}\n        onGuestMode={() => setIsGuestMode(true)}\n        onShowAuth={() => setShowAuthModal(true)}\n      />\n    </>\n  )\n}\n\nexport default AuthGuard\n","/*\n * Dexie.js - a minimalistic wrapper for IndexedDB\n * ===============================================\n *\n * By David Fahlander, david.fahlander@gmail.com\n *\n * Version 4.0.11, Wed Jan 15 2025\n *\n * https://dexie.org\n *\n * Apache License Version 2.0, January 2004, http://www.apache.org/licenses/\n */\n \n(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define(factory) :\n    (global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.Dexie = factory());\n})(this, (function () { 'use strict';\n\n    /*! *****************************************************************************\n    Copyright (c) Microsoft Corporation.\n    Permission to use, copy, modify, and/or distribute this software for any\n    purpose with or without fee is hereby granted.\n    THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\n    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\n    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\n    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\n    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\n    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\n    PERFORMANCE OF THIS SOFTWARE.\n    ***************************************************************************** */\n    var extendStatics = function(d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    function __extends(d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    }\n    var __assign = function() {\n        __assign = Object.assign || function __assign(t) {\n            for (var s, i = 1, n = arguments.length; i < n; i++) {\n                s = arguments[i];\n                for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n            }\n            return t;\n        };\n        return __assign.apply(this, arguments);\n    };\n    function __spreadArray(to, from, pack) {\n        if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n            if (ar || !(i in from)) {\n                if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n                ar[i] = from[i];\n            }\n        }\n        return to.concat(ar || Array.prototype.slice.call(from));\n    }\n\n    var _global = typeof globalThis !== 'undefined' ? globalThis :\n        typeof self !== 'undefined' ? self :\n            typeof window !== 'undefined' ? window :\n                global;\n\n    var keys = Object.keys;\n    var isArray = Array.isArray;\n    if (typeof Promise !== 'undefined' && !_global.Promise) {\n        _global.Promise = Promise;\n    }\n    function extend(obj, extension) {\n        if (typeof extension !== 'object')\n            return obj;\n        keys(extension).forEach(function (key) {\n            obj[key] = extension[key];\n        });\n        return obj;\n    }\n    var getProto = Object.getPrototypeOf;\n    var _hasOwn = {}.hasOwnProperty;\n    function hasOwn(obj, prop) {\n        return _hasOwn.call(obj, prop);\n    }\n    function props(proto, extension) {\n        if (typeof extension === 'function')\n            extension = extension(getProto(proto));\n        (typeof Reflect === \"undefined\" ? keys : Reflect.ownKeys)(extension).forEach(function (key) {\n            setProp(proto, key, extension[key]);\n        });\n    }\n    var defineProperty = Object.defineProperty;\n    function setProp(obj, prop, functionOrGetSet, options) {\n        defineProperty(obj, prop, extend(functionOrGetSet && hasOwn(functionOrGetSet, \"get\") && typeof functionOrGetSet.get === 'function' ?\n            { get: functionOrGetSet.get, set: functionOrGetSet.set, configurable: true } :\n            { value: functionOrGetSet, configurable: true, writable: true }, options));\n    }\n    function derive(Child) {\n        return {\n            from: function (Parent) {\n                Child.prototype = Object.create(Parent.prototype);\n                setProp(Child.prototype, \"constructor\", Child);\n                return {\n                    extend: props.bind(null, Child.prototype)\n                };\n            }\n        };\n    }\n    var getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n    function getPropertyDescriptor(obj, prop) {\n        var pd = getOwnPropertyDescriptor(obj, prop);\n        var proto;\n        return pd || (proto = getProto(obj)) && getPropertyDescriptor(proto, prop);\n    }\n    var _slice = [].slice;\n    function slice(args, start, end) {\n        return _slice.call(args, start, end);\n    }\n    function override(origFunc, overridedFactory) {\n        return overridedFactory(origFunc);\n    }\n    function assert(b) {\n        if (!b)\n            throw new Error(\"Assertion Failed\");\n    }\n    function asap$1(fn) {\n        if (_global.setImmediate)\n            setImmediate(fn);\n        else\n            setTimeout(fn, 0);\n    }\n    function arrayToObject(array, extractor) {\n        return array.reduce(function (result, item, i) {\n            var nameAndValue = extractor(item, i);\n            if (nameAndValue)\n                result[nameAndValue[0]] = nameAndValue[1];\n            return result;\n        }, {});\n    }\n    function getByKeyPath(obj, keyPath) {\n        if (typeof keyPath === 'string' && hasOwn(obj, keyPath))\n            return obj[keyPath];\n        if (!keyPath)\n            return obj;\n        if (typeof keyPath !== 'string') {\n            var rv = [];\n            for (var i = 0, l = keyPath.length; i < l; ++i) {\n                var val = getByKeyPath(obj, keyPath[i]);\n                rv.push(val);\n            }\n            return rv;\n        }\n        var period = keyPath.indexOf('.');\n        if (period !== -1) {\n            var innerObj = obj[keyPath.substr(0, period)];\n            return innerObj == null ? undefined : getByKeyPath(innerObj, keyPath.substr(period + 1));\n        }\n        return undefined;\n    }\n    function setByKeyPath(obj, keyPath, value) {\n        if (!obj || keyPath === undefined)\n            return;\n        if ('isFrozen' in Object && Object.isFrozen(obj))\n            return;\n        if (typeof keyPath !== 'string' && 'length' in keyPath) {\n            assert(typeof value !== 'string' && 'length' in value);\n            for (var i = 0, l = keyPath.length; i < l; ++i) {\n                setByKeyPath(obj, keyPath[i], value[i]);\n            }\n        }\n        else {\n            var period = keyPath.indexOf('.');\n            if (period !== -1) {\n                var currentKeyPath = keyPath.substr(0, period);\n                var remainingKeyPath = keyPath.substr(period + 1);\n                if (remainingKeyPath === \"\")\n                    if (value === undefined) {\n                        if (isArray(obj) && !isNaN(parseInt(currentKeyPath)))\n                            obj.splice(currentKeyPath, 1);\n                        else\n                            delete obj[currentKeyPath];\n                    }\n                    else\n                        obj[currentKeyPath] = value;\n                else {\n                    var innerObj = obj[currentKeyPath];\n                    if (!innerObj || !hasOwn(obj, currentKeyPath))\n                        innerObj = (obj[currentKeyPath] = {});\n                    setByKeyPath(innerObj, remainingKeyPath, value);\n                }\n            }\n            else {\n                if (value === undefined) {\n                    if (isArray(obj) && !isNaN(parseInt(keyPath)))\n                        obj.splice(keyPath, 1);\n                    else\n                        delete obj[keyPath];\n                }\n                else\n                    obj[keyPath] = value;\n            }\n        }\n    }\n    function delByKeyPath(obj, keyPath) {\n        if (typeof keyPath === 'string')\n            setByKeyPath(obj, keyPath, undefined);\n        else if ('length' in keyPath)\n            [].map.call(keyPath, function (kp) {\n                setByKeyPath(obj, kp, undefined);\n            });\n    }\n    function shallowClone(obj) {\n        var rv = {};\n        for (var m in obj) {\n            if (hasOwn(obj, m))\n                rv[m] = obj[m];\n        }\n        return rv;\n    }\n    var concat = [].concat;\n    function flatten(a) {\n        return concat.apply([], a);\n    }\n    var intrinsicTypeNames = \"BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey\"\n        .split(',').concat(flatten([8, 16, 32, 64].map(function (num) { return [\"Int\", \"Uint\", \"Float\"].map(function (t) { return t + num + \"Array\"; }); }))).filter(function (t) { return _global[t]; });\n    var intrinsicTypes = new Set(intrinsicTypeNames.map(function (t) { return _global[t]; }));\n    function cloneSimpleObjectTree(o) {\n        var rv = {};\n        for (var k in o)\n            if (hasOwn(o, k)) {\n                var v = o[k];\n                rv[k] = !v || typeof v !== 'object' || intrinsicTypes.has(v.constructor) ? v : cloneSimpleObjectTree(v);\n            }\n        return rv;\n    }\n    function objectIsEmpty(o) {\n        for (var k in o)\n            if (hasOwn(o, k))\n                return false;\n        return true;\n    }\n    var circularRefs = null;\n    function deepClone(any) {\n        circularRefs = new WeakMap();\n        var rv = innerDeepClone(any);\n        circularRefs = null;\n        return rv;\n    }\n    function innerDeepClone(x) {\n        if (!x || typeof x !== 'object')\n            return x;\n        var rv = circularRefs.get(x);\n        if (rv)\n            return rv;\n        if (isArray(x)) {\n            rv = [];\n            circularRefs.set(x, rv);\n            for (var i = 0, l = x.length; i < l; ++i) {\n                rv.push(innerDeepClone(x[i]));\n            }\n        }\n        else if (intrinsicTypes.has(x.constructor)) {\n            rv = x;\n        }\n        else {\n            var proto = getProto(x);\n            rv = proto === Object.prototype ? {} : Object.create(proto);\n            circularRefs.set(x, rv);\n            for (var prop in x) {\n                if (hasOwn(x, prop)) {\n                    rv[prop] = innerDeepClone(x[prop]);\n                }\n            }\n        }\n        return rv;\n    }\n    var toString = {}.toString;\n    function toStringTag(o) {\n        return toString.call(o).slice(8, -1);\n    }\n    var iteratorSymbol = typeof Symbol !== 'undefined' ?\n        Symbol.iterator :\n        '@@iterator';\n    var getIteratorOf = typeof iteratorSymbol === \"symbol\" ? function (x) {\n        var i;\n        return x != null && (i = x[iteratorSymbol]) && i.apply(x);\n    } : function () { return null; };\n    function delArrayItem(a, x) {\n        var i = a.indexOf(x);\n        if (i >= 0)\n            a.splice(i, 1);\n        return i >= 0;\n    }\n    var NO_CHAR_ARRAY = {};\n    function getArrayOf(arrayLike) {\n        var i, a, x, it;\n        if (arguments.length === 1) {\n            if (isArray(arrayLike))\n                return arrayLike.slice();\n            if (this === NO_CHAR_ARRAY && typeof arrayLike === 'string')\n                return [arrayLike];\n            if ((it = getIteratorOf(arrayLike))) {\n                a = [];\n                while ((x = it.next()), !x.done)\n                    a.push(x.value);\n                return a;\n            }\n            if (arrayLike == null)\n                return [arrayLike];\n            i = arrayLike.length;\n            if (typeof i === 'number') {\n                a = new Array(i);\n                while (i--)\n                    a[i] = arrayLike[i];\n                return a;\n            }\n            return [arrayLike];\n        }\n        i = arguments.length;\n        a = new Array(i);\n        while (i--)\n            a[i] = arguments[i];\n        return a;\n    }\n    var isAsyncFunction = typeof Symbol !== 'undefined'\n        ? function (fn) { return fn[Symbol.toStringTag] === 'AsyncFunction'; }\n        : function () { return false; };\n\n    var dexieErrorNames = [\n        'Modify',\n        'Bulk',\n        'OpenFailed',\n        'VersionChange',\n        'Schema',\n        'Upgrade',\n        'InvalidTable',\n        'MissingAPI',\n        'NoSuchDatabase',\n        'InvalidArgument',\n        'SubTransaction',\n        'Unsupported',\n        'Internal',\n        'DatabaseClosed',\n        'PrematureCommit',\n        'ForeignAwait'\n    ];\n    var idbDomErrorNames = [\n        'Unknown',\n        'Constraint',\n        'Data',\n        'TransactionInactive',\n        'ReadOnly',\n        'Version',\n        'NotFound',\n        'InvalidState',\n        'InvalidAccess',\n        'Abort',\n        'Timeout',\n        'QuotaExceeded',\n        'Syntax',\n        'DataClone'\n    ];\n    var errorList = dexieErrorNames.concat(idbDomErrorNames);\n    var defaultTexts = {\n        VersionChanged: \"Database version changed by other database connection\",\n        DatabaseClosed: \"Database has been closed\",\n        Abort: \"Transaction aborted\",\n        TransactionInactive: \"Transaction has already completed or failed\",\n        MissingAPI: \"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb\"\n    };\n    function DexieError(name, msg) {\n        this.name = name;\n        this.message = msg;\n    }\n    derive(DexieError).from(Error).extend({\n        toString: function () { return this.name + \": \" + this.message; }\n    });\n    function getMultiErrorMessage(msg, failures) {\n        return msg + \". Errors: \" + Object.keys(failures)\n            .map(function (key) { return failures[key].toString(); })\n            .filter(function (v, i, s) { return s.indexOf(v) === i; })\n            .join('\\n');\n    }\n    function ModifyError(msg, failures, successCount, failedKeys) {\n        this.failures = failures;\n        this.failedKeys = failedKeys;\n        this.successCount = successCount;\n        this.message = getMultiErrorMessage(msg, failures);\n    }\n    derive(ModifyError).from(DexieError);\n    function BulkError(msg, failures) {\n        this.name = \"BulkError\";\n        this.failures = Object.keys(failures).map(function (pos) { return failures[pos]; });\n        this.failuresByPos = failures;\n        this.message = getMultiErrorMessage(msg, this.failures);\n    }\n    derive(BulkError).from(DexieError);\n    var errnames = errorList.reduce(function (obj, name) { return (obj[name] = name + \"Error\", obj); }, {});\n    var BaseException = DexieError;\n    var exceptions = errorList.reduce(function (obj, name) {\n        var fullName = name + \"Error\";\n        function DexieError(msgOrInner, inner) {\n            this.name = fullName;\n            if (!msgOrInner) {\n                this.message = defaultTexts[name] || fullName;\n                this.inner = null;\n            }\n            else if (typeof msgOrInner === 'string') {\n                this.message = \"\".concat(msgOrInner).concat(!inner ? '' : '\\n ' + inner);\n                this.inner = inner || null;\n            }\n            else if (typeof msgOrInner === 'object') {\n                this.message = \"\".concat(msgOrInner.name, \" \").concat(msgOrInner.message);\n                this.inner = msgOrInner;\n            }\n        }\n        derive(DexieError).from(BaseException);\n        obj[name] = DexieError;\n        return obj;\n    }, {});\n    exceptions.Syntax = SyntaxError;\n    exceptions.Type = TypeError;\n    exceptions.Range = RangeError;\n    var exceptionMap = idbDomErrorNames.reduce(function (obj, name) {\n        obj[name + \"Error\"] = exceptions[name];\n        return obj;\n    }, {});\n    function mapError(domError, message) {\n        if (!domError || domError instanceof DexieError || domError instanceof TypeError || domError instanceof SyntaxError || !domError.name || !exceptionMap[domError.name])\n            return domError;\n        var rv = new exceptionMap[domError.name](message || domError.message, domError);\n        if (\"stack\" in domError) {\n            setProp(rv, \"stack\", { get: function () {\n                    return this.inner.stack;\n                } });\n        }\n        return rv;\n    }\n    var fullNameExceptions = errorList.reduce(function (obj, name) {\n        if ([\"Syntax\", \"Type\", \"Range\"].indexOf(name) === -1)\n            obj[name + \"Error\"] = exceptions[name];\n        return obj;\n    }, {});\n    fullNameExceptions.ModifyError = ModifyError;\n    fullNameExceptions.DexieError = DexieError;\n    fullNameExceptions.BulkError = BulkError;\n\n    function nop() { }\n    function mirror(val) { return val; }\n    function pureFunctionChain(f1, f2) {\n        if (f1 == null || f1 === mirror)\n            return f2;\n        return function (val) {\n            return f2(f1(val));\n        };\n    }\n    function callBoth(on1, on2) {\n        return function () {\n            on1.apply(this, arguments);\n            on2.apply(this, arguments);\n        };\n    }\n    function hookCreatingChain(f1, f2) {\n        if (f1 === nop)\n            return f2;\n        return function () {\n            var res = f1.apply(this, arguments);\n            if (res !== undefined)\n                arguments[0] = res;\n            var onsuccess = this.onsuccess,\n            onerror = this.onerror;\n            this.onsuccess = null;\n            this.onerror = null;\n            var res2 = f2.apply(this, arguments);\n            if (onsuccess)\n                this.onsuccess = this.onsuccess ? callBoth(onsuccess, this.onsuccess) : onsuccess;\n            if (onerror)\n                this.onerror = this.onerror ? callBoth(onerror, this.onerror) : onerror;\n            return res2 !== undefined ? res2 : res;\n        };\n    }\n    function hookDeletingChain(f1, f2) {\n        if (f1 === nop)\n            return f2;\n        return function () {\n            f1.apply(this, arguments);\n            var onsuccess = this.onsuccess,\n            onerror = this.onerror;\n            this.onsuccess = this.onerror = null;\n            f2.apply(this, arguments);\n            if (onsuccess)\n                this.onsuccess = this.onsuccess ? callBoth(onsuccess, this.onsuccess) : onsuccess;\n            if (onerror)\n                this.onerror = this.onerror ? callBoth(onerror, this.onerror) : onerror;\n        };\n    }\n    function hookUpdatingChain(f1, f2) {\n        if (f1 === nop)\n            return f2;\n        return function (modifications) {\n            var res = f1.apply(this, arguments);\n            extend(modifications, res);\n            var onsuccess = this.onsuccess,\n            onerror = this.onerror;\n            this.onsuccess = null;\n            this.onerror = null;\n            var res2 = f2.apply(this, arguments);\n            if (onsuccess)\n                this.onsuccess = this.onsuccess ? callBoth(onsuccess, this.onsuccess) : onsuccess;\n            if (onerror)\n                this.onerror = this.onerror ? callBoth(onerror, this.onerror) : onerror;\n            return res === undefined ?\n                (res2 === undefined ? undefined : res2) :\n                (extend(res, res2));\n        };\n    }\n    function reverseStoppableEventChain(f1, f2) {\n        if (f1 === nop)\n            return f2;\n        return function () {\n            if (f2.apply(this, arguments) === false)\n                return false;\n            return f1.apply(this, arguments);\n        };\n    }\n    function promisableChain(f1, f2) {\n        if (f1 === nop)\n            return f2;\n        return function () {\n            var res = f1.apply(this, arguments);\n            if (res && typeof res.then === 'function') {\n                var thiz = this, i = arguments.length, args = new Array(i);\n                while (i--)\n                    args[i] = arguments[i];\n                return res.then(function () {\n                    return f2.apply(thiz, args);\n                });\n            }\n            return f2.apply(this, arguments);\n        };\n    }\n\n    var debug = typeof location !== 'undefined' &&\n        /^(http|https):\\/\\/(localhost|127\\.0\\.0\\.1)/.test(location.href);\n    function setDebug(value, filter) {\n        debug = value;\n    }\n\n    var INTERNAL = {};\n    var ZONE_ECHO_LIMIT = 100, _a$1 = typeof Promise === 'undefined' ?\n        [] :\n        (function () {\n            var globalP = Promise.resolve();\n            if (typeof crypto === 'undefined' || !crypto.subtle)\n                return [globalP, getProto(globalP), globalP];\n            var nativeP = crypto.subtle.digest(\"SHA-512\", new Uint8Array([0]));\n            return [\n                nativeP,\n                getProto(nativeP),\n                globalP\n            ];\n        })(), resolvedNativePromise = _a$1[0], nativePromiseProto = _a$1[1], resolvedGlobalPromise = _a$1[2], nativePromiseThen = nativePromiseProto && nativePromiseProto.then;\n    var NativePromise = resolvedNativePromise && resolvedNativePromise.constructor;\n    var patchGlobalPromise = !!resolvedGlobalPromise;\n    function schedulePhysicalTick() {\n        queueMicrotask(physicalTick);\n    }\n    var asap = function (callback, args) {\n        microtickQueue.push([callback, args]);\n        if (needsNewPhysicalTick) {\n            schedulePhysicalTick();\n            needsNewPhysicalTick = false;\n        }\n    };\n    var isOutsideMicroTick = true,\n    needsNewPhysicalTick = true,\n    unhandledErrors = [],\n    rejectingErrors = [],\n    rejectionMapper = mirror;\n    var globalPSD = {\n        id: 'global',\n        global: true,\n        ref: 0,\n        unhandleds: [],\n        onunhandled: nop,\n        pgp: false,\n        env: {},\n        finalize: nop\n    };\n    var PSD = globalPSD;\n    var microtickQueue = [];\n    var numScheduledCalls = 0;\n    var tickFinalizers = [];\n    function DexiePromise(fn) {\n        if (typeof this !== 'object')\n            throw new TypeError('Promises must be constructed via new');\n        this._listeners = [];\n        this._lib = false;\n        var psd = (this._PSD = PSD);\n        if (typeof fn !== 'function') {\n            if (fn !== INTERNAL)\n                throw new TypeError('Not a function');\n            this._state = arguments[1];\n            this._value = arguments[2];\n            if (this._state === false)\n                handleRejection(this, this._value);\n            return;\n        }\n        this._state = null;\n        this._value = null;\n        ++psd.ref;\n        executePromiseTask(this, fn);\n    }\n    var thenProp = {\n        get: function () {\n            var psd = PSD, microTaskId = totalEchoes;\n            function then(onFulfilled, onRejected) {\n                var _this = this;\n                var possibleAwait = !psd.global && (psd !== PSD || microTaskId !== totalEchoes);\n                var cleanup = possibleAwait && !decrementExpectedAwaits();\n                var rv = new DexiePromise(function (resolve, reject) {\n                    propagateToListener(_this, new Listener(nativeAwaitCompatibleWrap(onFulfilled, psd, possibleAwait, cleanup), nativeAwaitCompatibleWrap(onRejected, psd, possibleAwait, cleanup), resolve, reject, psd));\n                });\n                if (this._consoleTask)\n                    rv._consoleTask = this._consoleTask;\n                return rv;\n            }\n            then.prototype = INTERNAL;\n            return then;\n        },\n        set: function (value) {\n            setProp(this, 'then', value && value.prototype === INTERNAL ?\n                thenProp :\n                {\n                    get: function () {\n                        return value;\n                    },\n                    set: thenProp.set\n                });\n        }\n    };\n    props(DexiePromise.prototype, {\n        then: thenProp,\n        _then: function (onFulfilled, onRejected) {\n            propagateToListener(this, new Listener(null, null, onFulfilled, onRejected, PSD));\n        },\n        catch: function (onRejected) {\n            if (arguments.length === 1)\n                return this.then(null, onRejected);\n            var type = arguments[0], handler = arguments[1];\n            return typeof type === 'function' ? this.then(null, function (err) {\n                return err instanceof type ? handler(err) : PromiseReject(err);\n            })\n                : this.then(null, function (err) {\n                    return err && err.name === type ? handler(err) : PromiseReject(err);\n                });\n        },\n        finally: function (onFinally) {\n            return this.then(function (value) {\n                return DexiePromise.resolve(onFinally()).then(function () { return value; });\n            }, function (err) {\n                return DexiePromise.resolve(onFinally()).then(function () { return PromiseReject(err); });\n            });\n        },\n        timeout: function (ms, msg) {\n            var _this = this;\n            return ms < Infinity ?\n                new DexiePromise(function (resolve, reject) {\n                    var handle = setTimeout(function () { return reject(new exceptions.Timeout(msg)); }, ms);\n                    _this.then(resolve, reject).finally(clearTimeout.bind(null, handle));\n                }) : this;\n        }\n    });\n    if (typeof Symbol !== 'undefined' && Symbol.toStringTag)\n        setProp(DexiePromise.prototype, Symbol.toStringTag, 'Dexie.Promise');\n    globalPSD.env = snapShot();\n    function Listener(onFulfilled, onRejected, resolve, reject, zone) {\n        this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n        this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n        this.resolve = resolve;\n        this.reject = reject;\n        this.psd = zone;\n    }\n    props(DexiePromise, {\n        all: function () {\n            var values = getArrayOf.apply(null, arguments)\n                .map(onPossibleParallellAsync);\n            return new DexiePromise(function (resolve, reject) {\n                if (values.length === 0)\n                    resolve([]);\n                var remaining = values.length;\n                values.forEach(function (a, i) { return DexiePromise.resolve(a).then(function (x) {\n                    values[i] = x;\n                    if (!--remaining)\n                        resolve(values);\n                }, reject); });\n            });\n        },\n        resolve: function (value) {\n            if (value instanceof DexiePromise)\n                return value;\n            if (value && typeof value.then === 'function')\n                return new DexiePromise(function (resolve, reject) {\n                    value.then(resolve, reject);\n                });\n            var rv = new DexiePromise(INTERNAL, true, value);\n            return rv;\n        },\n        reject: PromiseReject,\n        race: function () {\n            var values = getArrayOf.apply(null, arguments).map(onPossibleParallellAsync);\n            return new DexiePromise(function (resolve, reject) {\n                values.map(function (value) { return DexiePromise.resolve(value).then(resolve, reject); });\n            });\n        },\n        PSD: {\n            get: function () { return PSD; },\n            set: function (value) { return PSD = value; }\n        },\n        totalEchoes: { get: function () { return totalEchoes; } },\n        newPSD: newScope,\n        usePSD: usePSD,\n        scheduler: {\n            get: function () { return asap; },\n            set: function (value) { asap = value; }\n        },\n        rejectionMapper: {\n            get: function () { return rejectionMapper; },\n            set: function (value) { rejectionMapper = value; }\n        },\n        follow: function (fn, zoneProps) {\n            return new DexiePromise(function (resolve, reject) {\n                return newScope(function (resolve, reject) {\n                    var psd = PSD;\n                    psd.unhandleds = [];\n                    psd.onunhandled = reject;\n                    psd.finalize = callBoth(function () {\n                        var _this = this;\n                        run_at_end_of_this_or_next_physical_tick(function () {\n                            _this.unhandleds.length === 0 ? resolve() : reject(_this.unhandleds[0]);\n                        });\n                    }, psd.finalize);\n                    fn();\n                }, zoneProps, resolve, reject);\n            });\n        }\n    });\n    if (NativePromise) {\n        if (NativePromise.allSettled)\n            setProp(DexiePromise, \"allSettled\", function () {\n                var possiblePromises = getArrayOf.apply(null, arguments).map(onPossibleParallellAsync);\n                return new DexiePromise(function (resolve) {\n                    if (possiblePromises.length === 0)\n                        resolve([]);\n                    var remaining = possiblePromises.length;\n                    var results = new Array(remaining);\n                    possiblePromises.forEach(function (p, i) { return DexiePromise.resolve(p).then(function (value) { return results[i] = { status: \"fulfilled\", value: value }; }, function (reason) { return results[i] = { status: \"rejected\", reason: reason }; })\n                        .then(function () { return --remaining || resolve(results); }); });\n                });\n            });\n        if (NativePromise.any && typeof AggregateError !== 'undefined')\n            setProp(DexiePromise, \"any\", function () {\n                var possiblePromises = getArrayOf.apply(null, arguments).map(onPossibleParallellAsync);\n                return new DexiePromise(function (resolve, reject) {\n                    if (possiblePromises.length === 0)\n                        reject(new AggregateError([]));\n                    var remaining = possiblePromises.length;\n                    var failures = new Array(remaining);\n                    possiblePromises.forEach(function (p, i) { return DexiePromise.resolve(p).then(function (value) { return resolve(value); }, function (failure) {\n                        failures[i] = failure;\n                        if (!--remaining)\n                            reject(new AggregateError(failures));\n                    }); });\n                });\n            });\n        if (NativePromise.withResolvers)\n            DexiePromise.withResolvers = NativePromise.withResolvers;\n    }\n    function executePromiseTask(promise, fn) {\n        try {\n            fn(function (value) {\n                if (promise._state !== null)\n                    return;\n                if (value === promise)\n                    throw new TypeError('A promise cannot be resolved with itself.');\n                var shouldExecuteTick = promise._lib && beginMicroTickScope();\n                if (value && typeof value.then === 'function') {\n                    executePromiseTask(promise, function (resolve, reject) {\n                        value instanceof DexiePromise ?\n                            value._then(resolve, reject) :\n                            value.then(resolve, reject);\n                    });\n                }\n                else {\n                    promise._state = true;\n                    promise._value = value;\n                    propagateAllListeners(promise);\n                }\n                if (shouldExecuteTick)\n                    endMicroTickScope();\n            }, handleRejection.bind(null, promise));\n        }\n        catch (ex) {\n            handleRejection(promise, ex);\n        }\n    }\n    function handleRejection(promise, reason) {\n        rejectingErrors.push(reason);\n        if (promise._state !== null)\n            return;\n        var shouldExecuteTick = promise._lib && beginMicroTickScope();\n        reason = rejectionMapper(reason);\n        promise._state = false;\n        promise._value = reason;\n        addPossiblyUnhandledError(promise);\n        propagateAllListeners(promise);\n        if (shouldExecuteTick)\n            endMicroTickScope();\n    }\n    function propagateAllListeners(promise) {\n        var listeners = promise._listeners;\n        promise._listeners = [];\n        for (var i = 0, len = listeners.length; i < len; ++i) {\n            propagateToListener(promise, listeners[i]);\n        }\n        var psd = promise._PSD;\n        --psd.ref || psd.finalize();\n        if (numScheduledCalls === 0) {\n            ++numScheduledCalls;\n            asap(function () {\n                if (--numScheduledCalls === 0)\n                    finalizePhysicalTick();\n            }, []);\n        }\n    }\n    function propagateToListener(promise, listener) {\n        if (promise._state === null) {\n            promise._listeners.push(listener);\n            return;\n        }\n        var cb = promise._state ? listener.onFulfilled : listener.onRejected;\n        if (cb === null) {\n            return (promise._state ? listener.resolve : listener.reject)(promise._value);\n        }\n        ++listener.psd.ref;\n        ++numScheduledCalls;\n        asap(callListener, [cb, promise, listener]);\n    }\n    function callListener(cb, promise, listener) {\n        try {\n            var ret, value = promise._value;\n            if (!promise._state && rejectingErrors.length)\n                rejectingErrors = [];\n            ret = debug && promise._consoleTask ? promise._consoleTask.run(function () { return cb(value); }) : cb(value);\n            if (!promise._state && rejectingErrors.indexOf(value) === -1) {\n                markErrorAsHandled(promise);\n            }\n            listener.resolve(ret);\n        }\n        catch (e) {\n            listener.reject(e);\n        }\n        finally {\n            if (--numScheduledCalls === 0)\n                finalizePhysicalTick();\n            --listener.psd.ref || listener.psd.finalize();\n        }\n    }\n    function physicalTick() {\n        usePSD(globalPSD, function () {\n            beginMicroTickScope() && endMicroTickScope();\n        });\n    }\n    function beginMicroTickScope() {\n        var wasRootExec = isOutsideMicroTick;\n        isOutsideMicroTick = false;\n        needsNewPhysicalTick = false;\n        return wasRootExec;\n    }\n    function endMicroTickScope() {\n        var callbacks, i, l;\n        do {\n            while (microtickQueue.length > 0) {\n                callbacks = microtickQueue;\n                microtickQueue = [];\n                l = callbacks.length;\n                for (i = 0; i < l; ++i) {\n                    var item = callbacks[i];\n                    item[0].apply(null, item[1]);\n                }\n            }\n        } while (microtickQueue.length > 0);\n        isOutsideMicroTick = true;\n        needsNewPhysicalTick = true;\n    }\n    function finalizePhysicalTick() {\n        var unhandledErrs = unhandledErrors;\n        unhandledErrors = [];\n        unhandledErrs.forEach(function (p) {\n            p._PSD.onunhandled.call(null, p._value, p);\n        });\n        var finalizers = tickFinalizers.slice(0);\n        var i = finalizers.length;\n        while (i)\n            finalizers[--i]();\n    }\n    function run_at_end_of_this_or_next_physical_tick(fn) {\n        function finalizer() {\n            fn();\n            tickFinalizers.splice(tickFinalizers.indexOf(finalizer), 1);\n        }\n        tickFinalizers.push(finalizer);\n        ++numScheduledCalls;\n        asap(function () {\n            if (--numScheduledCalls === 0)\n                finalizePhysicalTick();\n        }, []);\n    }\n    function addPossiblyUnhandledError(promise) {\n        if (!unhandledErrors.some(function (p) { return p._value === promise._value; }))\n            unhandledErrors.push(promise);\n    }\n    function markErrorAsHandled(promise) {\n        var i = unhandledErrors.length;\n        while (i)\n            if (unhandledErrors[--i]._value === promise._value) {\n                unhandledErrors.splice(i, 1);\n                return;\n            }\n    }\n    function PromiseReject(reason) {\n        return new DexiePromise(INTERNAL, false, reason);\n    }\n    function wrap(fn, errorCatcher) {\n        var psd = PSD;\n        return function () {\n            var wasRootExec = beginMicroTickScope(), outerScope = PSD;\n            try {\n                switchToZone(psd, true);\n                return fn.apply(this, arguments);\n            }\n            catch (e) {\n                errorCatcher && errorCatcher(e);\n            }\n            finally {\n                switchToZone(outerScope, false);\n                if (wasRootExec)\n                    endMicroTickScope();\n            }\n        };\n    }\n    var task = { awaits: 0, echoes: 0, id: 0 };\n    var taskCounter = 0;\n    var zoneStack = [];\n    var zoneEchoes = 0;\n    var totalEchoes = 0;\n    var zone_id_counter = 0;\n    function newScope(fn, props, a1, a2) {\n        var parent = PSD, psd = Object.create(parent);\n        psd.parent = parent;\n        psd.ref = 0;\n        psd.global = false;\n        psd.id = ++zone_id_counter;\n        globalPSD.env;\n        psd.env = patchGlobalPromise ? {\n            Promise: DexiePromise,\n            PromiseProp: { value: DexiePromise, configurable: true, writable: true },\n            all: DexiePromise.all,\n            race: DexiePromise.race,\n            allSettled: DexiePromise.allSettled,\n            any: DexiePromise.any,\n            resolve: DexiePromise.resolve,\n            reject: DexiePromise.reject,\n        } : {};\n        if (props)\n            extend(psd, props);\n        ++parent.ref;\n        psd.finalize = function () {\n            --this.parent.ref || this.parent.finalize();\n        };\n        var rv = usePSD(psd, fn, a1, a2);\n        if (psd.ref === 0)\n            psd.finalize();\n        return rv;\n    }\n    function incrementExpectedAwaits() {\n        if (!task.id)\n            task.id = ++taskCounter;\n        ++task.awaits;\n        task.echoes += ZONE_ECHO_LIMIT;\n        return task.id;\n    }\n    function decrementExpectedAwaits() {\n        if (!task.awaits)\n            return false;\n        if (--task.awaits === 0)\n            task.id = 0;\n        task.echoes = task.awaits * ZONE_ECHO_LIMIT;\n        return true;\n    }\n    if (('' + nativePromiseThen).indexOf('[native code]') === -1) {\n        incrementExpectedAwaits = decrementExpectedAwaits = nop;\n    }\n    function onPossibleParallellAsync(possiblePromise) {\n        if (task.echoes && possiblePromise && possiblePromise.constructor === NativePromise) {\n            incrementExpectedAwaits();\n            return possiblePromise.then(function (x) {\n                decrementExpectedAwaits();\n                return x;\n            }, function (e) {\n                decrementExpectedAwaits();\n                return rejection(e);\n            });\n        }\n        return possiblePromise;\n    }\n    function zoneEnterEcho(targetZone) {\n        ++totalEchoes;\n        if (!task.echoes || --task.echoes === 0) {\n            task.echoes = task.awaits = task.id = 0;\n        }\n        zoneStack.push(PSD);\n        switchToZone(targetZone, true);\n    }\n    function zoneLeaveEcho() {\n        var zone = zoneStack[zoneStack.length - 1];\n        zoneStack.pop();\n        switchToZone(zone, false);\n    }\n    function switchToZone(targetZone, bEnteringZone) {\n        var currentZone = PSD;\n        if (bEnteringZone ? task.echoes && (!zoneEchoes++ || targetZone !== PSD) : zoneEchoes && (!--zoneEchoes || targetZone !== PSD)) {\n            queueMicrotask(bEnteringZone ? zoneEnterEcho.bind(null, targetZone) : zoneLeaveEcho);\n        }\n        if (targetZone === PSD)\n            return;\n        PSD = targetZone;\n        if (currentZone === globalPSD)\n            globalPSD.env = snapShot();\n        if (patchGlobalPromise) {\n            var GlobalPromise = globalPSD.env.Promise;\n            var targetEnv = targetZone.env;\n            if (currentZone.global || targetZone.global) {\n                Object.defineProperty(_global, 'Promise', targetEnv.PromiseProp);\n                GlobalPromise.all = targetEnv.all;\n                GlobalPromise.race = targetEnv.race;\n                GlobalPromise.resolve = targetEnv.resolve;\n                GlobalPromise.reject = targetEnv.reject;\n                if (targetEnv.allSettled)\n                    GlobalPromise.allSettled = targetEnv.allSettled;\n                if (targetEnv.any)\n                    GlobalPromise.any = targetEnv.any;\n            }\n        }\n    }\n    function snapShot() {\n        var GlobalPromise = _global.Promise;\n        return patchGlobalPromise ? {\n            Promise: GlobalPromise,\n            PromiseProp: Object.getOwnPropertyDescriptor(_global, \"Promise\"),\n            all: GlobalPromise.all,\n            race: GlobalPromise.race,\n            allSettled: GlobalPromise.allSettled,\n            any: GlobalPromise.any,\n            resolve: GlobalPromise.resolve,\n            reject: GlobalPromise.reject,\n        } : {};\n    }\n    function usePSD(psd, fn, a1, a2, a3) {\n        var outerScope = PSD;\n        try {\n            switchToZone(psd, true);\n            return fn(a1, a2, a3);\n        }\n        finally {\n            switchToZone(outerScope, false);\n        }\n    }\n    function nativeAwaitCompatibleWrap(fn, zone, possibleAwait, cleanup) {\n        return typeof fn !== 'function' ? fn : function () {\n            var outerZone = PSD;\n            if (possibleAwait)\n                incrementExpectedAwaits();\n            switchToZone(zone, true);\n            try {\n                return fn.apply(this, arguments);\n            }\n            finally {\n                switchToZone(outerZone, false);\n                if (cleanup)\n                    queueMicrotask(decrementExpectedAwaits);\n            }\n        };\n    }\n    function execInGlobalContext(cb) {\n        if (Promise === NativePromise && task.echoes === 0) {\n            if (zoneEchoes === 0) {\n                cb();\n            }\n            else {\n                enqueueNativeMicroTask(cb);\n            }\n        }\n        else {\n            setTimeout(cb, 0);\n        }\n    }\n    var rejection = DexiePromise.reject;\n\n    function tempTransaction(db, mode, storeNames, fn) {\n        if (!db.idbdb || (!db._state.openComplete && (!PSD.letThrough && !db._vip))) {\n            if (db._state.openComplete) {\n                return rejection(new exceptions.DatabaseClosed(db._state.dbOpenError));\n            }\n            if (!db._state.isBeingOpened) {\n                if (!db._state.autoOpen)\n                    return rejection(new exceptions.DatabaseClosed());\n                db.open().catch(nop);\n            }\n            return db._state.dbReadyPromise.then(function () { return tempTransaction(db, mode, storeNames, fn); });\n        }\n        else {\n            var trans = db._createTransaction(mode, storeNames, db._dbSchema);\n            try {\n                trans.create();\n                db._state.PR1398_maxLoop = 3;\n            }\n            catch (ex) {\n                if (ex.name === errnames.InvalidState && db.isOpen() && --db._state.PR1398_maxLoop > 0) {\n                    console.warn('Dexie: Need to reopen db');\n                    db.close({ disableAutoOpen: false });\n                    return db.open().then(function () { return tempTransaction(db, mode, storeNames, fn); });\n                }\n                return rejection(ex);\n            }\n            return trans._promise(mode, function (resolve, reject) {\n                return newScope(function () {\n                    PSD.trans = trans;\n                    return fn(resolve, reject, trans);\n                });\n            }).then(function (result) {\n                if (mode === 'readwrite')\n                    try {\n                        trans.idbtrans.commit();\n                    }\n                    catch (_a) { }\n                return mode === 'readonly' ? result : trans._completion.then(function () { return result; });\n            });\n        }\n    }\n\n    var DEXIE_VERSION = '4.0.11';\n    var maxString = String.fromCharCode(65535);\n    var minKey = -Infinity;\n    var INVALID_KEY_ARGUMENT = \"Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.\";\n    var STRING_EXPECTED = \"String expected.\";\n    var connections = [];\n    var DBNAMES_DB = '__dbnames';\n    var READONLY = 'readonly';\n    var READWRITE = 'readwrite';\n\n    function combine(filter1, filter2) {\n        return filter1 ?\n            filter2 ?\n                function () { return filter1.apply(this, arguments) && filter2.apply(this, arguments); } :\n                filter1 :\n            filter2;\n    }\n\n    var AnyRange = {\n        type: 3 ,\n        lower: -Infinity,\n        lowerOpen: false,\n        upper: [[]],\n        upperOpen: false\n    };\n\n    function workaroundForUndefinedPrimKey(keyPath) {\n        return typeof keyPath === \"string\" && !/\\./.test(keyPath)\n            ? function (obj) {\n                if (obj[keyPath] === undefined && (keyPath in obj)) {\n                    obj = deepClone(obj);\n                    delete obj[keyPath];\n                }\n                return obj;\n            }\n            : function (obj) { return obj; };\n    }\n\n    function Entity() {\n        throw exceptions.Type();\n    }\n\n    function cmp(a, b) {\n        try {\n            var ta = type(a);\n            var tb = type(b);\n            if (ta !== tb) {\n                if (ta === 'Array')\n                    return 1;\n                if (tb === 'Array')\n                    return -1;\n                if (ta === 'binary')\n                    return 1;\n                if (tb === 'binary')\n                    return -1;\n                if (ta === 'string')\n                    return 1;\n                if (tb === 'string')\n                    return -1;\n                if (ta === 'Date')\n                    return 1;\n                if (tb !== 'Date')\n                    return NaN;\n                return -1;\n            }\n            switch (ta) {\n                case 'number':\n                case 'Date':\n                case 'string':\n                    return a > b ? 1 : a < b ? -1 : 0;\n                case 'binary': {\n                    return compareUint8Arrays(getUint8Array(a), getUint8Array(b));\n                }\n                case 'Array':\n                    return compareArrays(a, b);\n            }\n        }\n        catch (_a) { }\n        return NaN;\n    }\n    function compareArrays(a, b) {\n        var al = a.length;\n        var bl = b.length;\n        var l = al < bl ? al : bl;\n        for (var i = 0; i < l; ++i) {\n            var res = cmp(a[i], b[i]);\n            if (res !== 0)\n                return res;\n        }\n        return al === bl ? 0 : al < bl ? -1 : 1;\n    }\n    function compareUint8Arrays(a, b) {\n        var al = a.length;\n        var bl = b.length;\n        var l = al < bl ? al : bl;\n        for (var i = 0; i < l; ++i) {\n            if (a[i] !== b[i])\n                return a[i] < b[i] ? -1 : 1;\n        }\n        return al === bl ? 0 : al < bl ? -1 : 1;\n    }\n    function type(x) {\n        var t = typeof x;\n        if (t !== 'object')\n            return t;\n        if (ArrayBuffer.isView(x))\n            return 'binary';\n        var tsTag = toStringTag(x);\n        return tsTag === 'ArrayBuffer' ? 'binary' : tsTag;\n    }\n    function getUint8Array(a) {\n        if (a instanceof Uint8Array)\n            return a;\n        if (ArrayBuffer.isView(a))\n            return new Uint8Array(a.buffer, a.byteOffset, a.byteLength);\n        return new Uint8Array(a);\n    }\n\n    var Table =  (function () {\n        function Table() {\n        }\n        Table.prototype._trans = function (mode, fn, writeLocked) {\n            var trans = this._tx || PSD.trans;\n            var tableName = this.name;\n            var task = debug && typeof console !== 'undefined' && console.createTask && console.createTask(\"Dexie: \".concat(mode === 'readonly' ? 'read' : 'write', \" \").concat(this.name));\n            function checkTableInTransaction(resolve, reject, trans) {\n                if (!trans.schema[tableName])\n                    throw new exceptions.NotFound(\"Table \" + tableName + \" not part of transaction\");\n                return fn(trans.idbtrans, trans);\n            }\n            var wasRootExec = beginMicroTickScope();\n            try {\n                var p = trans && trans.db._novip === this.db._novip ?\n                    trans === PSD.trans ?\n                        trans._promise(mode, checkTableInTransaction, writeLocked) :\n                        newScope(function () { return trans._promise(mode, checkTableInTransaction, writeLocked); }, { trans: trans, transless: PSD.transless || PSD }) :\n                    tempTransaction(this.db, mode, [this.name], checkTableInTransaction);\n                if (task) {\n                    p._consoleTask = task;\n                    p = p.catch(function (err) {\n                        console.trace(err);\n                        return rejection(err);\n                    });\n                }\n                return p;\n            }\n            finally {\n                if (wasRootExec)\n                    endMicroTickScope();\n            }\n        };\n        Table.prototype.get = function (keyOrCrit, cb) {\n            var _this = this;\n            if (keyOrCrit && keyOrCrit.constructor === Object)\n                return this.where(keyOrCrit).first(cb);\n            if (keyOrCrit == null)\n                return rejection(new exceptions.Type(\"Invalid argument to Table.get()\"));\n            return this._trans('readonly', function (trans) {\n                return _this.core.get({ trans: trans, key: keyOrCrit })\n                    .then(function (res) { return _this.hook.reading.fire(res); });\n            }).then(cb);\n        };\n        Table.prototype.where = function (indexOrCrit) {\n            if (typeof indexOrCrit === 'string')\n                return new this.db.WhereClause(this, indexOrCrit);\n            if (isArray(indexOrCrit))\n                return new this.db.WhereClause(this, \"[\".concat(indexOrCrit.join('+'), \"]\"));\n            var keyPaths = keys(indexOrCrit);\n            if (keyPaths.length === 1)\n                return this\n                    .where(keyPaths[0])\n                    .equals(indexOrCrit[keyPaths[0]]);\n            var compoundIndex = this.schema.indexes.concat(this.schema.primKey).filter(function (ix) {\n                if (ix.compound &&\n                    keyPaths.every(function (keyPath) { return ix.keyPath.indexOf(keyPath) >= 0; })) {\n                    for (var i = 0; i < keyPaths.length; ++i) {\n                        if (keyPaths.indexOf(ix.keyPath[i]) === -1)\n                            return false;\n                    }\n                    return true;\n                }\n                return false;\n            }).sort(function (a, b) { return a.keyPath.length - b.keyPath.length; })[0];\n            if (compoundIndex && this.db._maxKey !== maxString) {\n                var keyPathsInValidOrder = compoundIndex.keyPath.slice(0, keyPaths.length);\n                return this\n                    .where(keyPathsInValidOrder)\n                    .equals(keyPathsInValidOrder.map(function (kp) { return indexOrCrit[kp]; }));\n            }\n            if (!compoundIndex && debug)\n                console.warn(\"The query \".concat(JSON.stringify(indexOrCrit), \" on \").concat(this.name, \" would benefit from a \") +\n                    \"compound index [\".concat(keyPaths.join('+'), \"]\"));\n            var idxByName = this.schema.idxByName;\n            function equals(a, b) {\n                return cmp(a, b) === 0;\n            }\n            var _a = keyPaths.reduce(function (_a, keyPath) {\n                var prevIndex = _a[0], prevFilterFn = _a[1];\n                var index = idxByName[keyPath];\n                var value = indexOrCrit[keyPath];\n                return [\n                    prevIndex || index,\n                    prevIndex || !index ?\n                        combine(prevFilterFn, index && index.multi ?\n                            function (x) {\n                                var prop = getByKeyPath(x, keyPath);\n                                return isArray(prop) && prop.some(function (item) { return equals(value, item); });\n                            } : function (x) { return equals(value, getByKeyPath(x, keyPath)); })\n                        : prevFilterFn\n                ];\n            }, [null, null]), idx = _a[0], filterFunction = _a[1];\n            return idx ?\n                this.where(idx.name).equals(indexOrCrit[idx.keyPath])\n                    .filter(filterFunction) :\n                compoundIndex ?\n                    this.filter(filterFunction) :\n                    this.where(keyPaths).equals('');\n        };\n        Table.prototype.filter = function (filterFunction) {\n            return this.toCollection().and(filterFunction);\n        };\n        Table.prototype.count = function (thenShortcut) {\n            return this.toCollection().count(thenShortcut);\n        };\n        Table.prototype.offset = function (offset) {\n            return this.toCollection().offset(offset);\n        };\n        Table.prototype.limit = function (numRows) {\n            return this.toCollection().limit(numRows);\n        };\n        Table.prototype.each = function (callback) {\n            return this.toCollection().each(callback);\n        };\n        Table.prototype.toArray = function (thenShortcut) {\n            return this.toCollection().toArray(thenShortcut);\n        };\n        Table.prototype.toCollection = function () {\n            return new this.db.Collection(new this.db.WhereClause(this));\n        };\n        Table.prototype.orderBy = function (index) {\n            return new this.db.Collection(new this.db.WhereClause(this, isArray(index) ?\n                \"[\".concat(index.join('+'), \"]\") :\n                index));\n        };\n        Table.prototype.reverse = function () {\n            return this.toCollection().reverse();\n        };\n        Table.prototype.mapToClass = function (constructor) {\n            var _a = this, db = _a.db, tableName = _a.name;\n            this.schema.mappedClass = constructor;\n            if (constructor.prototype instanceof Entity) {\n                constructor =  (function (_super) {\n                    __extends(class_1, _super);\n                    function class_1() {\n                        return _super !== null && _super.apply(this, arguments) || this;\n                    }\n                    Object.defineProperty(class_1.prototype, \"db\", {\n                        get: function () { return db; },\n                        enumerable: false,\n                        configurable: true\n                    });\n                    class_1.prototype.table = function () { return tableName; };\n                    return class_1;\n                }(constructor));\n            }\n            var inheritedProps = new Set();\n            for (var proto = constructor.prototype; proto; proto = getProto(proto)) {\n                Object.getOwnPropertyNames(proto).forEach(function (propName) { return inheritedProps.add(propName); });\n            }\n            var readHook = function (obj) {\n                if (!obj)\n                    return obj;\n                var res = Object.create(constructor.prototype);\n                for (var m in obj)\n                    if (!inheritedProps.has(m))\n                        try {\n                            res[m] = obj[m];\n                        }\n                        catch (_) { }\n                return res;\n            };\n            if (this.schema.readHook) {\n                this.hook.reading.unsubscribe(this.schema.readHook);\n            }\n            this.schema.readHook = readHook;\n            this.hook(\"reading\", readHook);\n            return constructor;\n        };\n        Table.prototype.defineClass = function () {\n            function Class(content) {\n                extend(this, content);\n            }\n            return this.mapToClass(Class);\n        };\n        Table.prototype.add = function (obj, key) {\n            var _this = this;\n            var _a = this.schema.primKey, auto = _a.auto, keyPath = _a.keyPath;\n            var objToAdd = obj;\n            if (keyPath && auto) {\n                objToAdd = workaroundForUndefinedPrimKey(keyPath)(obj);\n            }\n            return this._trans('readwrite', function (trans) {\n                return _this.core.mutate({ trans: trans, type: 'add', keys: key != null ? [key] : null, values: [objToAdd] });\n            }).then(function (res) { return res.numFailures ? DexiePromise.reject(res.failures[0]) : res.lastResult; })\n                .then(function (lastResult) {\n                if (keyPath) {\n                    try {\n                        setByKeyPath(obj, keyPath, lastResult);\n                    }\n                    catch (_) { }\n                }\n                return lastResult;\n            });\n        };\n        Table.prototype.update = function (keyOrObject, modifications) {\n            if (typeof keyOrObject === 'object' && !isArray(keyOrObject)) {\n                var key = getByKeyPath(keyOrObject, this.schema.primKey.keyPath);\n                if (key === undefined)\n                    return rejection(new exceptions.InvalidArgument(\"Given object does not contain its primary key\"));\n                return this.where(\":id\").equals(key).modify(modifications);\n            }\n            else {\n                return this.where(\":id\").equals(keyOrObject).modify(modifications);\n            }\n        };\n        Table.prototype.put = function (obj, key) {\n            var _this = this;\n            var _a = this.schema.primKey, auto = _a.auto, keyPath = _a.keyPath;\n            var objToAdd = obj;\n            if (keyPath && auto) {\n                objToAdd = workaroundForUndefinedPrimKey(keyPath)(obj);\n            }\n            return this._trans('readwrite', function (trans) { return _this.core.mutate({ trans: trans, type: 'put', values: [objToAdd], keys: key != null ? [key] : null }); })\n                .then(function (res) { return res.numFailures ? DexiePromise.reject(res.failures[0]) : res.lastResult; })\n                .then(function (lastResult) {\n                if (keyPath) {\n                    try {\n                        setByKeyPath(obj, keyPath, lastResult);\n                    }\n                    catch (_) { }\n                }\n                return lastResult;\n            });\n        };\n        Table.prototype.delete = function (key) {\n            var _this = this;\n            return this._trans('readwrite', function (trans) { return _this.core.mutate({ trans: trans, type: 'delete', keys: [key] }); })\n                .then(function (res) { return res.numFailures ? DexiePromise.reject(res.failures[0]) : undefined; });\n        };\n        Table.prototype.clear = function () {\n            var _this = this;\n            return this._trans('readwrite', function (trans) { return _this.core.mutate({ trans: trans, type: 'deleteRange', range: AnyRange }); })\n                .then(function (res) { return res.numFailures ? DexiePromise.reject(res.failures[0]) : undefined; });\n        };\n        Table.prototype.bulkGet = function (keys) {\n            var _this = this;\n            return this._trans('readonly', function (trans) {\n                return _this.core.getMany({\n                    keys: keys,\n                    trans: trans\n                }).then(function (result) { return result.map(function (res) { return _this.hook.reading.fire(res); }); });\n            });\n        };\n        Table.prototype.bulkAdd = function (objects, keysOrOptions, options) {\n            var _this = this;\n            var keys = Array.isArray(keysOrOptions) ? keysOrOptions : undefined;\n            options = options || (keys ? undefined : keysOrOptions);\n            var wantResults = options ? options.allKeys : undefined;\n            return this._trans('readwrite', function (trans) {\n                var _a = _this.schema.primKey, auto = _a.auto, keyPath = _a.keyPath;\n                if (keyPath && keys)\n                    throw new exceptions.InvalidArgument(\"bulkAdd(): keys argument invalid on tables with inbound keys\");\n                if (keys && keys.length !== objects.length)\n                    throw new exceptions.InvalidArgument(\"Arguments objects and keys must have the same length\");\n                var numObjects = objects.length;\n                var objectsToAdd = keyPath && auto ?\n                    objects.map(workaroundForUndefinedPrimKey(keyPath)) :\n                    objects;\n                return _this.core.mutate({ trans: trans, type: 'add', keys: keys, values: objectsToAdd, wantResults: wantResults })\n                    .then(function (_a) {\n                    var numFailures = _a.numFailures, results = _a.results, lastResult = _a.lastResult, failures = _a.failures;\n                    var result = wantResults ? results : lastResult;\n                    if (numFailures === 0)\n                        return result;\n                    throw new BulkError(\"\".concat(_this.name, \".bulkAdd(): \").concat(numFailures, \" of \").concat(numObjects, \" operations failed\"), failures);\n                });\n            });\n        };\n        Table.prototype.bulkPut = function (objects, keysOrOptions, options) {\n            var _this = this;\n            var keys = Array.isArray(keysOrOptions) ? keysOrOptions : undefined;\n            options = options || (keys ? undefined : keysOrOptions);\n            var wantResults = options ? options.allKeys : undefined;\n            return this._trans('readwrite', function (trans) {\n                var _a = _this.schema.primKey, auto = _a.auto, keyPath = _a.keyPath;\n                if (keyPath && keys)\n                    throw new exceptions.InvalidArgument(\"bulkPut(): keys argument invalid on tables with inbound keys\");\n                if (keys && keys.length !== objects.length)\n                    throw new exceptions.InvalidArgument(\"Arguments objects and keys must have the same length\");\n                var numObjects = objects.length;\n                var objectsToPut = keyPath && auto ?\n                    objects.map(workaroundForUndefinedPrimKey(keyPath)) :\n                    objects;\n                return _this.core.mutate({ trans: trans, type: 'put', keys: keys, values: objectsToPut, wantResults: wantResults })\n                    .then(function (_a) {\n                    var numFailures = _a.numFailures, results = _a.results, lastResult = _a.lastResult, failures = _a.failures;\n                    var result = wantResults ? results : lastResult;\n                    if (numFailures === 0)\n                        return result;\n                    throw new BulkError(\"\".concat(_this.name, \".bulkPut(): \").concat(numFailures, \" of \").concat(numObjects, \" operations failed\"), failures);\n                });\n            });\n        };\n        Table.prototype.bulkUpdate = function (keysAndChanges) {\n            var _this = this;\n            var coreTable = this.core;\n            var keys = keysAndChanges.map(function (entry) { return entry.key; });\n            var changeSpecs = keysAndChanges.map(function (entry) { return entry.changes; });\n            var offsetMap = [];\n            return this._trans('readwrite', function (trans) {\n                return coreTable.getMany({ trans: trans, keys: keys, cache: 'clone' }).then(function (objs) {\n                    var resultKeys = [];\n                    var resultObjs = [];\n                    keysAndChanges.forEach(function (_a, idx) {\n                        var key = _a.key, changes = _a.changes;\n                        var obj = objs[idx];\n                        if (obj) {\n                            for (var _i = 0, _b = Object.keys(changes); _i < _b.length; _i++) {\n                                var keyPath = _b[_i];\n                                var value = changes[keyPath];\n                                if (keyPath === _this.schema.primKey.keyPath) {\n                                    if (cmp(value, key) !== 0) {\n                                        throw new exceptions.Constraint(\"Cannot update primary key in bulkUpdate()\");\n                                    }\n                                }\n                                else {\n                                    setByKeyPath(obj, keyPath, value);\n                                }\n                            }\n                            offsetMap.push(idx);\n                            resultKeys.push(key);\n                            resultObjs.push(obj);\n                        }\n                    });\n                    var numEntries = resultKeys.length;\n                    return coreTable\n                        .mutate({\n                        trans: trans,\n                        type: 'put',\n                        keys: resultKeys,\n                        values: resultObjs,\n                        updates: {\n                            keys: keys,\n                            changeSpecs: changeSpecs\n                        }\n                    })\n                        .then(function (_a) {\n                        var numFailures = _a.numFailures, failures = _a.failures;\n                        if (numFailures === 0)\n                            return numEntries;\n                        for (var _i = 0, _b = Object.keys(failures); _i < _b.length; _i++) {\n                            var offset = _b[_i];\n                            var mappedOffset = offsetMap[Number(offset)];\n                            if (mappedOffset != null) {\n                                var failure = failures[offset];\n                                delete failures[offset];\n                                failures[mappedOffset] = failure;\n                            }\n                        }\n                        throw new BulkError(\"\".concat(_this.name, \".bulkUpdate(): \").concat(numFailures, \" of \").concat(numEntries, \" operations failed\"), failures);\n                    });\n                });\n            });\n        };\n        Table.prototype.bulkDelete = function (keys) {\n            var _this = this;\n            var numKeys = keys.length;\n            return this._trans('readwrite', function (trans) {\n                return _this.core.mutate({ trans: trans, type: 'delete', keys: keys });\n            }).then(function (_a) {\n                var numFailures = _a.numFailures, lastResult = _a.lastResult, failures = _a.failures;\n                if (numFailures === 0)\n                    return lastResult;\n                throw new BulkError(\"\".concat(_this.name, \".bulkDelete(): \").concat(numFailures, \" of \").concat(numKeys, \" operations failed\"), failures);\n            });\n        };\n        return Table;\n    }());\n\n    function Events(ctx) {\n        var evs = {};\n        var rv = function (eventName, subscriber) {\n            if (subscriber) {\n                var i = arguments.length, args = new Array(i - 1);\n                while (--i)\n                    args[i - 1] = arguments[i];\n                evs[eventName].subscribe.apply(null, args);\n                return ctx;\n            }\n            else if (typeof (eventName) === 'string') {\n                return evs[eventName];\n            }\n        };\n        rv.addEventType = add;\n        for (var i = 1, l = arguments.length; i < l; ++i) {\n            add(arguments[i]);\n        }\n        return rv;\n        function add(eventName, chainFunction, defaultFunction) {\n            if (typeof eventName === 'object')\n                return addConfiguredEvents(eventName);\n            if (!chainFunction)\n                chainFunction = reverseStoppableEventChain;\n            if (!defaultFunction)\n                defaultFunction = nop;\n            var context = {\n                subscribers: [],\n                fire: defaultFunction,\n                subscribe: function (cb) {\n                    if (context.subscribers.indexOf(cb) === -1) {\n                        context.subscribers.push(cb);\n                        context.fire = chainFunction(context.fire, cb);\n                    }\n                },\n                unsubscribe: function (cb) {\n                    context.subscribers = context.subscribers.filter(function (fn) { return fn !== cb; });\n                    context.fire = context.subscribers.reduce(chainFunction, defaultFunction);\n                }\n            };\n            evs[eventName] = rv[eventName] = context;\n            return context;\n        }\n        function addConfiguredEvents(cfg) {\n            keys(cfg).forEach(function (eventName) {\n                var args = cfg[eventName];\n                if (isArray(args)) {\n                    add(eventName, cfg[eventName][0], cfg[eventName][1]);\n                }\n                else if (args === 'asap') {\n                    var context = add(eventName, mirror, function fire() {\n                        var i = arguments.length, args = new Array(i);\n                        while (i--)\n                            args[i] = arguments[i];\n                        context.subscribers.forEach(function (fn) {\n                            asap$1(function fireEvent() {\n                                fn.apply(null, args);\n                            });\n                        });\n                    });\n                }\n                else\n                    throw new exceptions.InvalidArgument(\"Invalid event config\");\n            });\n        }\n    }\n\n    function makeClassConstructor(prototype, constructor) {\n        derive(constructor).from({ prototype: prototype });\n        return constructor;\n    }\n\n    function createTableConstructor(db) {\n        return makeClassConstructor(Table.prototype, function Table(name, tableSchema, trans) {\n            this.db = db;\n            this._tx = trans;\n            this.name = name;\n            this.schema = tableSchema;\n            this.hook = db._allTables[name] ? db._allTables[name].hook : Events(null, {\n                \"creating\": [hookCreatingChain, nop],\n                \"reading\": [pureFunctionChain, mirror],\n                \"updating\": [hookUpdatingChain, nop],\n                \"deleting\": [hookDeletingChain, nop]\n            });\n        });\n    }\n\n    function isPlainKeyRange(ctx, ignoreLimitFilter) {\n        return !(ctx.filter || ctx.algorithm || ctx.or) &&\n            (ignoreLimitFilter ? ctx.justLimit : !ctx.replayFilter);\n    }\n    function addFilter(ctx, fn) {\n        ctx.filter = combine(ctx.filter, fn);\n    }\n    function addReplayFilter(ctx, factory, isLimitFilter) {\n        var curr = ctx.replayFilter;\n        ctx.replayFilter = curr ? function () { return combine(curr(), factory()); } : factory;\n        ctx.justLimit = isLimitFilter && !curr;\n    }\n    function addMatchFilter(ctx, fn) {\n        ctx.isMatch = combine(ctx.isMatch, fn);\n    }\n    function getIndexOrStore(ctx, coreSchema) {\n        if (ctx.isPrimKey)\n            return coreSchema.primaryKey;\n        var index = coreSchema.getIndexByKeyPath(ctx.index);\n        if (!index)\n            throw new exceptions.Schema(\"KeyPath \" + ctx.index + \" on object store \" + coreSchema.name + \" is not indexed\");\n        return index;\n    }\n    function openCursor(ctx, coreTable, trans) {\n        var index = getIndexOrStore(ctx, coreTable.schema);\n        return coreTable.openCursor({\n            trans: trans,\n            values: !ctx.keysOnly,\n            reverse: ctx.dir === 'prev',\n            unique: !!ctx.unique,\n            query: {\n                index: index,\n                range: ctx.range\n            }\n        });\n    }\n    function iter(ctx, fn, coreTrans, coreTable) {\n        var filter = ctx.replayFilter ? combine(ctx.filter, ctx.replayFilter()) : ctx.filter;\n        if (!ctx.or) {\n            return iterate(openCursor(ctx, coreTable, coreTrans), combine(ctx.algorithm, filter), fn, !ctx.keysOnly && ctx.valueMapper);\n        }\n        else {\n            var set_1 = {};\n            var union = function (item, cursor, advance) {\n                if (!filter || filter(cursor, advance, function (result) { return cursor.stop(result); }, function (err) { return cursor.fail(err); })) {\n                    var primaryKey = cursor.primaryKey;\n                    var key = '' + primaryKey;\n                    if (key === '[object ArrayBuffer]')\n                        key = '' + new Uint8Array(primaryKey);\n                    if (!hasOwn(set_1, key)) {\n                        set_1[key] = true;\n                        fn(item, cursor, advance);\n                    }\n                }\n            };\n            return Promise.all([\n                ctx.or._iterate(union, coreTrans),\n                iterate(openCursor(ctx, coreTable, coreTrans), ctx.algorithm, union, !ctx.keysOnly && ctx.valueMapper)\n            ]);\n        }\n    }\n    function iterate(cursorPromise, filter, fn, valueMapper) {\n        var mappedFn = valueMapper ? function (x, c, a) { return fn(valueMapper(x), c, a); } : fn;\n        var wrappedFn = wrap(mappedFn);\n        return cursorPromise.then(function (cursor) {\n            if (cursor) {\n                return cursor.start(function () {\n                    var c = function () { return cursor.continue(); };\n                    if (!filter || filter(cursor, function (advancer) { return c = advancer; }, function (val) { cursor.stop(val); c = nop; }, function (e) { cursor.fail(e); c = nop; }))\n                        wrappedFn(cursor.value, cursor, function (advancer) { return c = advancer; });\n                    c();\n                });\n            }\n        });\n    }\n\n    var PropModification =  (function () {\n        function PropModification(spec) {\n            this[\"@@propmod\"] = spec;\n        }\n        PropModification.prototype.execute = function (value) {\n            var _a;\n            var spec = this[\"@@propmod\"];\n            if (spec.add !== undefined) {\n                var term = spec.add;\n                if (isArray(term)) {\n                    return __spreadArray(__spreadArray([], (isArray(value) ? value : []), true), term, true).sort();\n                }\n                if (typeof term === 'number')\n                    return (Number(value) || 0) + term;\n                if (typeof term === 'bigint') {\n                    try {\n                        return BigInt(value) + term;\n                    }\n                    catch (_b) {\n                        return BigInt(0) + term;\n                    }\n                }\n                throw new TypeError(\"Invalid term \".concat(term));\n            }\n            if (spec.remove !== undefined) {\n                var subtrahend_1 = spec.remove;\n                if (isArray(subtrahend_1)) {\n                    return isArray(value) ? value.filter(function (item) { return !subtrahend_1.includes(item); }).sort() : [];\n                }\n                if (typeof subtrahend_1 === 'number')\n                    return Number(value) - subtrahend_1;\n                if (typeof subtrahend_1 === 'bigint') {\n                    try {\n                        return BigInt(value) - subtrahend_1;\n                    }\n                    catch (_c) {\n                        return BigInt(0) - subtrahend_1;\n                    }\n                }\n                throw new TypeError(\"Invalid subtrahend \".concat(subtrahend_1));\n            }\n            var prefixToReplace = (_a = spec.replacePrefix) === null || _a === void 0 ? void 0 : _a[0];\n            if (prefixToReplace && typeof value === 'string' && value.startsWith(prefixToReplace)) {\n                return spec.replacePrefix[1] + value.substring(prefixToReplace.length);\n            }\n            return value;\n        };\n        return PropModification;\n    }());\n\n    var Collection =  (function () {\n        function Collection() {\n        }\n        Collection.prototype._read = function (fn, cb) {\n            var ctx = this._ctx;\n            return ctx.error ?\n                ctx.table._trans(null, rejection.bind(null, ctx.error)) :\n                ctx.table._trans('readonly', fn).then(cb);\n        };\n        Collection.prototype._write = function (fn) {\n            var ctx = this._ctx;\n            return ctx.error ?\n                ctx.table._trans(null, rejection.bind(null, ctx.error)) :\n                ctx.table._trans('readwrite', fn, \"locked\");\n        };\n        Collection.prototype._addAlgorithm = function (fn) {\n            var ctx = this._ctx;\n            ctx.algorithm = combine(ctx.algorithm, fn);\n        };\n        Collection.prototype._iterate = function (fn, coreTrans) {\n            return iter(this._ctx, fn, coreTrans, this._ctx.table.core);\n        };\n        Collection.prototype.clone = function (props) {\n            var rv = Object.create(this.constructor.prototype), ctx = Object.create(this._ctx);\n            if (props)\n                extend(ctx, props);\n            rv._ctx = ctx;\n            return rv;\n        };\n        Collection.prototype.raw = function () {\n            this._ctx.valueMapper = null;\n            return this;\n        };\n        Collection.prototype.each = function (fn) {\n            var ctx = this._ctx;\n            return this._read(function (trans) { return iter(ctx, fn, trans, ctx.table.core); });\n        };\n        Collection.prototype.count = function (cb) {\n            var _this = this;\n            return this._read(function (trans) {\n                var ctx = _this._ctx;\n                var coreTable = ctx.table.core;\n                if (isPlainKeyRange(ctx, true)) {\n                    return coreTable.count({\n                        trans: trans,\n                        query: {\n                            index: getIndexOrStore(ctx, coreTable.schema),\n                            range: ctx.range\n                        }\n                    }).then(function (count) { return Math.min(count, ctx.limit); });\n                }\n                else {\n                    var count = 0;\n                    return iter(ctx, function () { ++count; return false; }, trans, coreTable)\n                        .then(function () { return count; });\n                }\n            }).then(cb);\n        };\n        Collection.prototype.sortBy = function (keyPath, cb) {\n            var parts = keyPath.split('.').reverse(), lastPart = parts[0], lastIndex = parts.length - 1;\n            function getval(obj, i) {\n                if (i)\n                    return getval(obj[parts[i]], i - 1);\n                return obj[lastPart];\n            }\n            var order = this._ctx.dir === \"next\" ? 1 : -1;\n            function sorter(a, b) {\n                var aVal = getval(a, lastIndex), bVal = getval(b, lastIndex);\n                return cmp(aVal, bVal) * order;\n            }\n            return this.toArray(function (a) {\n                return a.sort(sorter);\n            }).then(cb);\n        };\n        Collection.prototype.toArray = function (cb) {\n            var _this = this;\n            return this._read(function (trans) {\n                var ctx = _this._ctx;\n                if (ctx.dir === 'next' && isPlainKeyRange(ctx, true) && ctx.limit > 0) {\n                    var valueMapper_1 = ctx.valueMapper;\n                    var index = getIndexOrStore(ctx, ctx.table.core.schema);\n                    return ctx.table.core.query({\n                        trans: trans,\n                        limit: ctx.limit,\n                        values: true,\n                        query: {\n                            index: index,\n                            range: ctx.range\n                        }\n                    }).then(function (_a) {\n                        var result = _a.result;\n                        return valueMapper_1 ? result.map(valueMapper_1) : result;\n                    });\n                }\n                else {\n                    var a_1 = [];\n                    return iter(ctx, function (item) { return a_1.push(item); }, trans, ctx.table.core).then(function () { return a_1; });\n                }\n            }, cb);\n        };\n        Collection.prototype.offset = function (offset) {\n            var ctx = this._ctx;\n            if (offset <= 0)\n                return this;\n            ctx.offset += offset;\n            if (isPlainKeyRange(ctx)) {\n                addReplayFilter(ctx, function () {\n                    var offsetLeft = offset;\n                    return function (cursor, advance) {\n                        if (offsetLeft === 0)\n                            return true;\n                        if (offsetLeft === 1) {\n                            --offsetLeft;\n                            return false;\n                        }\n                        advance(function () {\n                            cursor.advance(offsetLeft);\n                            offsetLeft = 0;\n                        });\n                        return false;\n                    };\n                });\n            }\n            else {\n                addReplayFilter(ctx, function () {\n                    var offsetLeft = offset;\n                    return function () { return (--offsetLeft < 0); };\n                });\n            }\n            return this;\n        };\n        Collection.prototype.limit = function (numRows) {\n            this._ctx.limit = Math.min(this._ctx.limit, numRows);\n            addReplayFilter(this._ctx, function () {\n                var rowsLeft = numRows;\n                return function (cursor, advance, resolve) {\n                    if (--rowsLeft <= 0)\n                        advance(resolve);\n                    return rowsLeft >= 0;\n                };\n            }, true);\n            return this;\n        };\n        Collection.prototype.until = function (filterFunction, bIncludeStopEntry) {\n            addFilter(this._ctx, function (cursor, advance, resolve) {\n                if (filterFunction(cursor.value)) {\n                    advance(resolve);\n                    return bIncludeStopEntry;\n                }\n                else {\n                    return true;\n                }\n            });\n            return this;\n        };\n        Collection.prototype.first = function (cb) {\n            return this.limit(1).toArray(function (a) { return a[0]; }).then(cb);\n        };\n        Collection.prototype.last = function (cb) {\n            return this.reverse().first(cb);\n        };\n        Collection.prototype.filter = function (filterFunction) {\n            addFilter(this._ctx, function (cursor) {\n                return filterFunction(cursor.value);\n            });\n            addMatchFilter(this._ctx, filterFunction);\n            return this;\n        };\n        Collection.prototype.and = function (filter) {\n            return this.filter(filter);\n        };\n        Collection.prototype.or = function (indexName) {\n            return new this.db.WhereClause(this._ctx.table, indexName, this);\n        };\n        Collection.prototype.reverse = function () {\n            this._ctx.dir = (this._ctx.dir === \"prev\" ? \"next\" : \"prev\");\n            if (this._ondirectionchange)\n                this._ondirectionchange(this._ctx.dir);\n            return this;\n        };\n        Collection.prototype.desc = function () {\n            return this.reverse();\n        };\n        Collection.prototype.eachKey = function (cb) {\n            var ctx = this._ctx;\n            ctx.keysOnly = !ctx.isMatch;\n            return this.each(function (val, cursor) { cb(cursor.key, cursor); });\n        };\n        Collection.prototype.eachUniqueKey = function (cb) {\n            this._ctx.unique = \"unique\";\n            return this.eachKey(cb);\n        };\n        Collection.prototype.eachPrimaryKey = function (cb) {\n            var ctx = this._ctx;\n            ctx.keysOnly = !ctx.isMatch;\n            return this.each(function (val, cursor) { cb(cursor.primaryKey, cursor); });\n        };\n        Collection.prototype.keys = function (cb) {\n            var ctx = this._ctx;\n            ctx.keysOnly = !ctx.isMatch;\n            var a = [];\n            return this.each(function (item, cursor) {\n                a.push(cursor.key);\n            }).then(function () {\n                return a;\n            }).then(cb);\n        };\n        Collection.prototype.primaryKeys = function (cb) {\n            var ctx = this._ctx;\n            if (ctx.dir === 'next' && isPlainKeyRange(ctx, true) && ctx.limit > 0) {\n                return this._read(function (trans) {\n                    var index = getIndexOrStore(ctx, ctx.table.core.schema);\n                    return ctx.table.core.query({\n                        trans: trans,\n                        values: false,\n                        limit: ctx.limit,\n                        query: {\n                            index: index,\n                            range: ctx.range\n                        }\n                    });\n                }).then(function (_a) {\n                    var result = _a.result;\n                    return result;\n                }).then(cb);\n            }\n            ctx.keysOnly = !ctx.isMatch;\n            var a = [];\n            return this.each(function (item, cursor) {\n                a.push(cursor.primaryKey);\n            }).then(function () {\n                return a;\n            }).then(cb);\n        };\n        Collection.prototype.uniqueKeys = function (cb) {\n            this._ctx.unique = \"unique\";\n            return this.keys(cb);\n        };\n        Collection.prototype.firstKey = function (cb) {\n            return this.limit(1).keys(function (a) { return a[0]; }).then(cb);\n        };\n        Collection.prototype.lastKey = function (cb) {\n            return this.reverse().firstKey(cb);\n        };\n        Collection.prototype.distinct = function () {\n            var ctx = this._ctx, idx = ctx.index && ctx.table.schema.idxByName[ctx.index];\n            if (!idx || !idx.multi)\n                return this;\n            var set = {};\n            addFilter(this._ctx, function (cursor) {\n                var strKey = cursor.primaryKey.toString();\n                var found = hasOwn(set, strKey);\n                set[strKey] = true;\n                return !found;\n            });\n            return this;\n        };\n        Collection.prototype.modify = function (changes) {\n            var _this = this;\n            var ctx = this._ctx;\n            return this._write(function (trans) {\n                var modifyer;\n                if (typeof changes === 'function') {\n                    modifyer = changes;\n                }\n                else {\n                    var keyPaths = keys(changes);\n                    var numKeys = keyPaths.length;\n                    modifyer = function (item) {\n                        var anythingModified = false;\n                        for (var i = 0; i < numKeys; ++i) {\n                            var keyPath = keyPaths[i];\n                            var val = changes[keyPath];\n                            var origVal = getByKeyPath(item, keyPath);\n                            if (val instanceof PropModification) {\n                                setByKeyPath(item, keyPath, val.execute(origVal));\n                                anythingModified = true;\n                            }\n                            else if (origVal !== val) {\n                                setByKeyPath(item, keyPath, val);\n                                anythingModified = true;\n                            }\n                        }\n                        return anythingModified;\n                    };\n                }\n                var coreTable = ctx.table.core;\n                var _a = coreTable.schema.primaryKey, outbound = _a.outbound, extractKey = _a.extractKey;\n                var limit = 200;\n                var modifyChunkSize = _this.db._options.modifyChunkSize;\n                if (modifyChunkSize) {\n                    if (typeof modifyChunkSize == 'object') {\n                        limit = modifyChunkSize[coreTable.name] || modifyChunkSize['*'] || 200;\n                    }\n                    else {\n                        limit = modifyChunkSize;\n                    }\n                }\n                var totalFailures = [];\n                var successCount = 0;\n                var failedKeys = [];\n                var applyMutateResult = function (expectedCount, res) {\n                    var failures = res.failures, numFailures = res.numFailures;\n                    successCount += expectedCount - numFailures;\n                    for (var _i = 0, _a = keys(failures); _i < _a.length; _i++) {\n                        var pos = _a[_i];\n                        totalFailures.push(failures[pos]);\n                    }\n                };\n                return _this.clone().primaryKeys().then(function (keys) {\n                    var criteria = isPlainKeyRange(ctx) &&\n                        ctx.limit === Infinity &&\n                        (typeof changes !== 'function' || changes === deleteCallback) && {\n                        index: ctx.index,\n                        range: ctx.range\n                    };\n                    var nextChunk = function (offset) {\n                        var count = Math.min(limit, keys.length - offset);\n                        return coreTable.getMany({\n                            trans: trans,\n                            keys: keys.slice(offset, offset + count),\n                            cache: \"immutable\"\n                        }).then(function (values) {\n                            var addValues = [];\n                            var putValues = [];\n                            var putKeys = outbound ? [] : null;\n                            var deleteKeys = [];\n                            for (var i = 0; i < count; ++i) {\n                                var origValue = values[i];\n                                var ctx_1 = {\n                                    value: deepClone(origValue),\n                                    primKey: keys[offset + i]\n                                };\n                                if (modifyer.call(ctx_1, ctx_1.value, ctx_1) !== false) {\n                                    if (ctx_1.value == null) {\n                                        deleteKeys.push(keys[offset + i]);\n                                    }\n                                    else if (!outbound && cmp(extractKey(origValue), extractKey(ctx_1.value)) !== 0) {\n                                        deleteKeys.push(keys[offset + i]);\n                                        addValues.push(ctx_1.value);\n                                    }\n                                    else {\n                                        putValues.push(ctx_1.value);\n                                        if (outbound)\n                                            putKeys.push(keys[offset + i]);\n                                    }\n                                }\n                            }\n                            return Promise.resolve(addValues.length > 0 &&\n                                coreTable.mutate({ trans: trans, type: 'add', values: addValues })\n                                    .then(function (res) {\n                                    for (var pos in res.failures) {\n                                        deleteKeys.splice(parseInt(pos), 1);\n                                    }\n                                    applyMutateResult(addValues.length, res);\n                                })).then(function () { return (putValues.length > 0 || (criteria && typeof changes === 'object')) &&\n                                coreTable.mutate({\n                                    trans: trans,\n                                    type: 'put',\n                                    keys: putKeys,\n                                    values: putValues,\n                                    criteria: criteria,\n                                    changeSpec: typeof changes !== 'function'\n                                        && changes,\n                                    isAdditionalChunk: offset > 0\n                                }).then(function (res) { return applyMutateResult(putValues.length, res); }); }).then(function () { return (deleteKeys.length > 0 || (criteria && changes === deleteCallback)) &&\n                                coreTable.mutate({\n                                    trans: trans,\n                                    type: 'delete',\n                                    keys: deleteKeys,\n                                    criteria: criteria,\n                                    isAdditionalChunk: offset > 0\n                                }).then(function (res) { return applyMutateResult(deleteKeys.length, res); }); }).then(function () {\n                                return keys.length > offset + count && nextChunk(offset + limit);\n                            });\n                        });\n                    };\n                    return nextChunk(0).then(function () {\n                        if (totalFailures.length > 0)\n                            throw new ModifyError(\"Error modifying one or more objects\", totalFailures, successCount, failedKeys);\n                        return keys.length;\n                    });\n                });\n            });\n        };\n        Collection.prototype.delete = function () {\n            var ctx = this._ctx, range = ctx.range;\n            if (isPlainKeyRange(ctx) &&\n                (ctx.isPrimKey || range.type === 3 ))\n             {\n                return this._write(function (trans) {\n                    var primaryKey = ctx.table.core.schema.primaryKey;\n                    var coreRange = range;\n                    return ctx.table.core.count({ trans: trans, query: { index: primaryKey, range: coreRange } }).then(function (count) {\n                        return ctx.table.core.mutate({ trans: trans, type: 'deleteRange', range: coreRange })\n                            .then(function (_a) {\n                            var failures = _a.failures; _a.lastResult; _a.results; var numFailures = _a.numFailures;\n                            if (numFailures)\n                                throw new ModifyError(\"Could not delete some values\", Object.keys(failures).map(function (pos) { return failures[pos]; }), count - numFailures);\n                            return count - numFailures;\n                        });\n                    });\n                });\n            }\n            return this.modify(deleteCallback);\n        };\n        return Collection;\n    }());\n    var deleteCallback = function (value, ctx) { return ctx.value = null; };\n\n    function createCollectionConstructor(db) {\n        return makeClassConstructor(Collection.prototype, function Collection(whereClause, keyRangeGenerator) {\n            this.db = db;\n            var keyRange = AnyRange, error = null;\n            if (keyRangeGenerator)\n                try {\n                    keyRange = keyRangeGenerator();\n                }\n                catch (ex) {\n                    error = ex;\n                }\n            var whereCtx = whereClause._ctx;\n            var table = whereCtx.table;\n            var readingHook = table.hook.reading.fire;\n            this._ctx = {\n                table: table,\n                index: whereCtx.index,\n                isPrimKey: (!whereCtx.index || (table.schema.primKey.keyPath && whereCtx.index === table.schema.primKey.name)),\n                range: keyRange,\n                keysOnly: false,\n                dir: \"next\",\n                unique: \"\",\n                algorithm: null,\n                filter: null,\n                replayFilter: null,\n                justLimit: true,\n                isMatch: null,\n                offset: 0,\n                limit: Infinity,\n                error: error,\n                or: whereCtx.or,\n                valueMapper: readingHook !== mirror ? readingHook : null\n            };\n        });\n    }\n\n    function simpleCompare(a, b) {\n        return a < b ? -1 : a === b ? 0 : 1;\n    }\n    function simpleCompareReverse(a, b) {\n        return a > b ? -1 : a === b ? 0 : 1;\n    }\n\n    function fail(collectionOrWhereClause, err, T) {\n        var collection = collectionOrWhereClause instanceof WhereClause ?\n            new collectionOrWhereClause.Collection(collectionOrWhereClause) :\n            collectionOrWhereClause;\n        collection._ctx.error = T ? new T(err) : new TypeError(err);\n        return collection;\n    }\n    function emptyCollection(whereClause) {\n        return new whereClause.Collection(whereClause, function () { return rangeEqual(\"\"); }).limit(0);\n    }\n    function upperFactory(dir) {\n        return dir === \"next\" ?\n            function (s) { return s.toUpperCase(); } :\n            function (s) { return s.toLowerCase(); };\n    }\n    function lowerFactory(dir) {\n        return dir === \"next\" ?\n            function (s) { return s.toLowerCase(); } :\n            function (s) { return s.toUpperCase(); };\n    }\n    function nextCasing(key, lowerKey, upperNeedle, lowerNeedle, cmp, dir) {\n        var length = Math.min(key.length, lowerNeedle.length);\n        var llp = -1;\n        for (var i = 0; i < length; ++i) {\n            var lwrKeyChar = lowerKey[i];\n            if (lwrKeyChar !== lowerNeedle[i]) {\n                if (cmp(key[i], upperNeedle[i]) < 0)\n                    return key.substr(0, i) + upperNeedle[i] + upperNeedle.substr(i + 1);\n                if (cmp(key[i], lowerNeedle[i]) < 0)\n                    return key.substr(0, i) + lowerNeedle[i] + upperNeedle.substr(i + 1);\n                if (llp >= 0)\n                    return key.substr(0, llp) + lowerKey[llp] + upperNeedle.substr(llp + 1);\n                return null;\n            }\n            if (cmp(key[i], lwrKeyChar) < 0)\n                llp = i;\n        }\n        if (length < lowerNeedle.length && dir === \"next\")\n            return key + upperNeedle.substr(key.length);\n        if (length < key.length && dir === \"prev\")\n            return key.substr(0, upperNeedle.length);\n        return (llp < 0 ? null : key.substr(0, llp) + lowerNeedle[llp] + upperNeedle.substr(llp + 1));\n    }\n    function addIgnoreCaseAlgorithm(whereClause, match, needles, suffix) {\n        var upper, lower, compare, upperNeedles, lowerNeedles, direction, nextKeySuffix, needlesLen = needles.length;\n        if (!needles.every(function (s) { return typeof s === 'string'; })) {\n            return fail(whereClause, STRING_EXPECTED);\n        }\n        function initDirection(dir) {\n            upper = upperFactory(dir);\n            lower = lowerFactory(dir);\n            compare = (dir === \"next\" ? simpleCompare : simpleCompareReverse);\n            var needleBounds = needles.map(function (needle) {\n                return { lower: lower(needle), upper: upper(needle) };\n            }).sort(function (a, b) {\n                return compare(a.lower, b.lower);\n            });\n            upperNeedles = needleBounds.map(function (nb) { return nb.upper; });\n            lowerNeedles = needleBounds.map(function (nb) { return nb.lower; });\n            direction = dir;\n            nextKeySuffix = (dir === \"next\" ? \"\" : suffix);\n        }\n        initDirection(\"next\");\n        var c = new whereClause.Collection(whereClause, function () { return createRange(upperNeedles[0], lowerNeedles[needlesLen - 1] + suffix); });\n        c._ondirectionchange = function (direction) {\n            initDirection(direction);\n        };\n        var firstPossibleNeedle = 0;\n        c._addAlgorithm(function (cursor, advance, resolve) {\n            var key = cursor.key;\n            if (typeof key !== 'string')\n                return false;\n            var lowerKey = lower(key);\n            if (match(lowerKey, lowerNeedles, firstPossibleNeedle)) {\n                return true;\n            }\n            else {\n                var lowestPossibleCasing = null;\n                for (var i = firstPossibleNeedle; i < needlesLen; ++i) {\n                    var casing = nextCasing(key, lowerKey, upperNeedles[i], lowerNeedles[i], compare, direction);\n                    if (casing === null && lowestPossibleCasing === null)\n                        firstPossibleNeedle = i + 1;\n                    else if (lowestPossibleCasing === null || compare(lowestPossibleCasing, casing) > 0) {\n                        lowestPossibleCasing = casing;\n                    }\n                }\n                if (lowestPossibleCasing !== null) {\n                    advance(function () { cursor.continue(lowestPossibleCasing + nextKeySuffix); });\n                }\n                else {\n                    advance(resolve);\n                }\n                return false;\n            }\n        });\n        return c;\n    }\n    function createRange(lower, upper, lowerOpen, upperOpen) {\n        return {\n            type: 2 ,\n            lower: lower,\n            upper: upper,\n            lowerOpen: lowerOpen,\n            upperOpen: upperOpen\n        };\n    }\n    function rangeEqual(value) {\n        return {\n            type: 1 ,\n            lower: value,\n            upper: value\n        };\n    }\n\n    var WhereClause =  (function () {\n        function WhereClause() {\n        }\n        Object.defineProperty(WhereClause.prototype, \"Collection\", {\n            get: function () {\n                return this._ctx.table.db.Collection;\n            },\n            enumerable: false,\n            configurable: true\n        });\n        WhereClause.prototype.between = function (lower, upper, includeLower, includeUpper) {\n            includeLower = includeLower !== false;\n            includeUpper = includeUpper === true;\n            try {\n                if ((this._cmp(lower, upper) > 0) ||\n                    (this._cmp(lower, upper) === 0 && (includeLower || includeUpper) && !(includeLower && includeUpper)))\n                    return emptyCollection(this);\n                return new this.Collection(this, function () { return createRange(lower, upper, !includeLower, !includeUpper); });\n            }\n            catch (e) {\n                return fail(this, INVALID_KEY_ARGUMENT);\n            }\n        };\n        WhereClause.prototype.equals = function (value) {\n            if (value == null)\n                return fail(this, INVALID_KEY_ARGUMENT);\n            return new this.Collection(this, function () { return rangeEqual(value); });\n        };\n        WhereClause.prototype.above = function (value) {\n            if (value == null)\n                return fail(this, INVALID_KEY_ARGUMENT);\n            return new this.Collection(this, function () { return createRange(value, undefined, true); });\n        };\n        WhereClause.prototype.aboveOrEqual = function (value) {\n            if (value == null)\n                return fail(this, INVALID_KEY_ARGUMENT);\n            return new this.Collection(this, function () { return createRange(value, undefined, false); });\n        };\n        WhereClause.prototype.below = function (value) {\n            if (value == null)\n                return fail(this, INVALID_KEY_ARGUMENT);\n            return new this.Collection(this, function () { return createRange(undefined, value, false, true); });\n        };\n        WhereClause.prototype.belowOrEqual = function (value) {\n            if (value == null)\n                return fail(this, INVALID_KEY_ARGUMENT);\n            return new this.Collection(this, function () { return createRange(undefined, value); });\n        };\n        WhereClause.prototype.startsWith = function (str) {\n            if (typeof str !== 'string')\n                return fail(this, STRING_EXPECTED);\n            return this.between(str, str + maxString, true, true);\n        };\n        WhereClause.prototype.startsWithIgnoreCase = function (str) {\n            if (str === \"\")\n                return this.startsWith(str);\n            return addIgnoreCaseAlgorithm(this, function (x, a) { return x.indexOf(a[0]) === 0; }, [str], maxString);\n        };\n        WhereClause.prototype.equalsIgnoreCase = function (str) {\n            return addIgnoreCaseAlgorithm(this, function (x, a) { return x === a[0]; }, [str], \"\");\n        };\n        WhereClause.prototype.anyOfIgnoreCase = function () {\n            var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n            if (set.length === 0)\n                return emptyCollection(this);\n            return addIgnoreCaseAlgorithm(this, function (x, a) { return a.indexOf(x) !== -1; }, set, \"\");\n        };\n        WhereClause.prototype.startsWithAnyOfIgnoreCase = function () {\n            var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n            if (set.length === 0)\n                return emptyCollection(this);\n            return addIgnoreCaseAlgorithm(this, function (x, a) { return a.some(function (n) { return x.indexOf(n) === 0; }); }, set, maxString);\n        };\n        WhereClause.prototype.anyOf = function () {\n            var _this = this;\n            var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n            var compare = this._cmp;\n            try {\n                set.sort(compare);\n            }\n            catch (e) {\n                return fail(this, INVALID_KEY_ARGUMENT);\n            }\n            if (set.length === 0)\n                return emptyCollection(this);\n            var c = new this.Collection(this, function () { return createRange(set[0], set[set.length - 1]); });\n            c._ondirectionchange = function (direction) {\n                compare = (direction === \"next\" ?\n                    _this._ascending :\n                    _this._descending);\n                set.sort(compare);\n            };\n            var i = 0;\n            c._addAlgorithm(function (cursor, advance, resolve) {\n                var key = cursor.key;\n                while (compare(key, set[i]) > 0) {\n                    ++i;\n                    if (i === set.length) {\n                        advance(resolve);\n                        return false;\n                    }\n                }\n                if (compare(key, set[i]) === 0) {\n                    return true;\n                }\n                else {\n                    advance(function () { cursor.continue(set[i]); });\n                    return false;\n                }\n            });\n            return c;\n        };\n        WhereClause.prototype.notEqual = function (value) {\n            return this.inAnyRange([[minKey, value], [value, this.db._maxKey]], { includeLowers: false, includeUppers: false });\n        };\n        WhereClause.prototype.noneOf = function () {\n            var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n            if (set.length === 0)\n                return new this.Collection(this);\n            try {\n                set.sort(this._ascending);\n            }\n            catch (e) {\n                return fail(this, INVALID_KEY_ARGUMENT);\n            }\n            var ranges = set.reduce(function (res, val) { return res ?\n                res.concat([[res[res.length - 1][1], val]]) :\n                [[minKey, val]]; }, null);\n            ranges.push([set[set.length - 1], this.db._maxKey]);\n            return this.inAnyRange(ranges, { includeLowers: false, includeUppers: false });\n        };\n        WhereClause.prototype.inAnyRange = function (ranges, options) {\n            var _this = this;\n            var cmp = this._cmp, ascending = this._ascending, descending = this._descending, min = this._min, max = this._max;\n            if (ranges.length === 0)\n                return emptyCollection(this);\n            if (!ranges.every(function (range) {\n                return range[0] !== undefined &&\n                    range[1] !== undefined &&\n                    ascending(range[0], range[1]) <= 0;\n            })) {\n                return fail(this, \"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower\", exceptions.InvalidArgument);\n            }\n            var includeLowers = !options || options.includeLowers !== false;\n            var includeUppers = options && options.includeUppers === true;\n            function addRange(ranges, newRange) {\n                var i = 0, l = ranges.length;\n                for (; i < l; ++i) {\n                    var range = ranges[i];\n                    if (cmp(newRange[0], range[1]) < 0 && cmp(newRange[1], range[0]) > 0) {\n                        range[0] = min(range[0], newRange[0]);\n                        range[1] = max(range[1], newRange[1]);\n                        break;\n                    }\n                }\n                if (i === l)\n                    ranges.push(newRange);\n                return ranges;\n            }\n            var sortDirection = ascending;\n            function rangeSorter(a, b) { return sortDirection(a[0], b[0]); }\n            var set;\n            try {\n                set = ranges.reduce(addRange, []);\n                set.sort(rangeSorter);\n            }\n            catch (ex) {\n                return fail(this, INVALID_KEY_ARGUMENT);\n            }\n            var rangePos = 0;\n            var keyIsBeyondCurrentEntry = includeUppers ?\n                function (key) { return ascending(key, set[rangePos][1]) > 0; } :\n                function (key) { return ascending(key, set[rangePos][1]) >= 0; };\n            var keyIsBeforeCurrentEntry = includeLowers ?\n                function (key) { return descending(key, set[rangePos][0]) > 0; } :\n                function (key) { return descending(key, set[rangePos][0]) >= 0; };\n            function keyWithinCurrentRange(key) {\n                return !keyIsBeyondCurrentEntry(key) && !keyIsBeforeCurrentEntry(key);\n            }\n            var checkKey = keyIsBeyondCurrentEntry;\n            var c = new this.Collection(this, function () { return createRange(set[0][0], set[set.length - 1][1], !includeLowers, !includeUppers); });\n            c._ondirectionchange = function (direction) {\n                if (direction === \"next\") {\n                    checkKey = keyIsBeyondCurrentEntry;\n                    sortDirection = ascending;\n                }\n                else {\n                    checkKey = keyIsBeforeCurrentEntry;\n                    sortDirection = descending;\n                }\n                set.sort(rangeSorter);\n            };\n            c._addAlgorithm(function (cursor, advance, resolve) {\n                var key = cursor.key;\n                while (checkKey(key)) {\n                    ++rangePos;\n                    if (rangePos === set.length) {\n                        advance(resolve);\n                        return false;\n                    }\n                }\n                if (keyWithinCurrentRange(key)) {\n                    return true;\n                }\n                else if (_this._cmp(key, set[rangePos][1]) === 0 || _this._cmp(key, set[rangePos][0]) === 0) {\n                    return false;\n                }\n                else {\n                    advance(function () {\n                        if (sortDirection === ascending)\n                            cursor.continue(set[rangePos][0]);\n                        else\n                            cursor.continue(set[rangePos][1]);\n                    });\n                    return false;\n                }\n            });\n            return c;\n        };\n        WhereClause.prototype.startsWithAnyOf = function () {\n            var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n            if (!set.every(function (s) { return typeof s === 'string'; })) {\n                return fail(this, \"startsWithAnyOf() only works with strings\");\n            }\n            if (set.length === 0)\n                return emptyCollection(this);\n            return this.inAnyRange(set.map(function (str) { return [str, str + maxString]; }));\n        };\n        return WhereClause;\n    }());\n\n    function createWhereClauseConstructor(db) {\n        return makeClassConstructor(WhereClause.prototype, function WhereClause(table, index, orCollection) {\n            this.db = db;\n            this._ctx = {\n                table: table,\n                index: index === \":id\" ? null : index,\n                or: orCollection\n            };\n            this._cmp = this._ascending = cmp;\n            this._descending = function (a, b) { return cmp(b, a); };\n            this._max = function (a, b) { return cmp(a, b) > 0 ? a : b; };\n            this._min = function (a, b) { return cmp(a, b) < 0 ? a : b; };\n            this._IDBKeyRange = db._deps.IDBKeyRange;\n            if (!this._IDBKeyRange)\n                throw new exceptions.MissingAPI();\n        });\n    }\n\n    function eventRejectHandler(reject) {\n        return wrap(function (event) {\n            preventDefault(event);\n            reject(event.target.error);\n            return false;\n        });\n    }\n    function preventDefault(event) {\n        if (event.stopPropagation)\n            event.stopPropagation();\n        if (event.preventDefault)\n            event.preventDefault();\n    }\n\n    var DEXIE_STORAGE_MUTATED_EVENT_NAME = 'storagemutated';\n    var STORAGE_MUTATED_DOM_EVENT_NAME = 'x-storagemutated-1';\n    var globalEvents = Events(null, DEXIE_STORAGE_MUTATED_EVENT_NAME);\n\n    var Transaction =  (function () {\n        function Transaction() {\n        }\n        Transaction.prototype._lock = function () {\n            assert(!PSD.global);\n            ++this._reculock;\n            if (this._reculock === 1 && !PSD.global)\n                PSD.lockOwnerFor = this;\n            return this;\n        };\n        Transaction.prototype._unlock = function () {\n            assert(!PSD.global);\n            if (--this._reculock === 0) {\n                if (!PSD.global)\n                    PSD.lockOwnerFor = null;\n                while (this._blockedFuncs.length > 0 && !this._locked()) {\n                    var fnAndPSD = this._blockedFuncs.shift();\n                    try {\n                        usePSD(fnAndPSD[1], fnAndPSD[0]);\n                    }\n                    catch (e) { }\n                }\n            }\n            return this;\n        };\n        Transaction.prototype._locked = function () {\n            return this._reculock && PSD.lockOwnerFor !== this;\n        };\n        Transaction.prototype.create = function (idbtrans) {\n            var _this = this;\n            if (!this.mode)\n                return this;\n            var idbdb = this.db.idbdb;\n            var dbOpenError = this.db._state.dbOpenError;\n            assert(!this.idbtrans);\n            if (!idbtrans && !idbdb) {\n                switch (dbOpenError && dbOpenError.name) {\n                    case \"DatabaseClosedError\":\n                        throw new exceptions.DatabaseClosed(dbOpenError);\n                    case \"MissingAPIError\":\n                        throw new exceptions.MissingAPI(dbOpenError.message, dbOpenError);\n                    default:\n                        throw new exceptions.OpenFailed(dbOpenError);\n                }\n            }\n            if (!this.active)\n                throw new exceptions.TransactionInactive();\n            assert(this._completion._state === null);\n            idbtrans = this.idbtrans = idbtrans ||\n                (this.db.core\n                    ? this.db.core.transaction(this.storeNames, this.mode, { durability: this.chromeTransactionDurability })\n                    : idbdb.transaction(this.storeNames, this.mode, { durability: this.chromeTransactionDurability }));\n            idbtrans.onerror = wrap(function (ev) {\n                preventDefault(ev);\n                _this._reject(idbtrans.error);\n            });\n            idbtrans.onabort = wrap(function (ev) {\n                preventDefault(ev);\n                _this.active && _this._reject(new exceptions.Abort(idbtrans.error));\n                _this.active = false;\n                _this.on(\"abort\").fire(ev);\n            });\n            idbtrans.oncomplete = wrap(function () {\n                _this.active = false;\n                _this._resolve();\n                if ('mutatedParts' in idbtrans) {\n                    globalEvents.storagemutated.fire(idbtrans[\"mutatedParts\"]);\n                }\n            });\n            return this;\n        };\n        Transaction.prototype._promise = function (mode, fn, bWriteLock) {\n            var _this = this;\n            if (mode === 'readwrite' && this.mode !== 'readwrite')\n                return rejection(new exceptions.ReadOnly(\"Transaction is readonly\"));\n            if (!this.active)\n                return rejection(new exceptions.TransactionInactive());\n            if (this._locked()) {\n                return new DexiePromise(function (resolve, reject) {\n                    _this._blockedFuncs.push([function () {\n                            _this._promise(mode, fn, bWriteLock).then(resolve, reject);\n                        }, PSD]);\n                });\n            }\n            else if (bWriteLock) {\n                return newScope(function () {\n                    var p = new DexiePromise(function (resolve, reject) {\n                        _this._lock();\n                        var rv = fn(resolve, reject, _this);\n                        if (rv && rv.then)\n                            rv.then(resolve, reject);\n                    });\n                    p.finally(function () { return _this._unlock(); });\n                    p._lib = true;\n                    return p;\n                });\n            }\n            else {\n                var p = new DexiePromise(function (resolve, reject) {\n                    var rv = fn(resolve, reject, _this);\n                    if (rv && rv.then)\n                        rv.then(resolve, reject);\n                });\n                p._lib = true;\n                return p;\n            }\n        };\n        Transaction.prototype._root = function () {\n            return this.parent ? this.parent._root() : this;\n        };\n        Transaction.prototype.waitFor = function (promiseLike) {\n            var root = this._root();\n            var promise = DexiePromise.resolve(promiseLike);\n            if (root._waitingFor) {\n                root._waitingFor = root._waitingFor.then(function () { return promise; });\n            }\n            else {\n                root._waitingFor = promise;\n                root._waitingQueue = [];\n                var store = root.idbtrans.objectStore(root.storeNames[0]);\n                (function spin() {\n                    ++root._spinCount;\n                    while (root._waitingQueue.length)\n                        (root._waitingQueue.shift())();\n                    if (root._waitingFor)\n                        store.get(-Infinity).onsuccess = spin;\n                }());\n            }\n            var currentWaitPromise = root._waitingFor;\n            return new DexiePromise(function (resolve, reject) {\n                promise.then(function (res) { return root._waitingQueue.push(wrap(resolve.bind(null, res))); }, function (err) { return root._waitingQueue.push(wrap(reject.bind(null, err))); }).finally(function () {\n                    if (root._waitingFor === currentWaitPromise) {\n                        root._waitingFor = null;\n                    }\n                });\n            });\n        };\n        Transaction.prototype.abort = function () {\n            if (this.active) {\n                this.active = false;\n                if (this.idbtrans)\n                    this.idbtrans.abort();\n                this._reject(new exceptions.Abort());\n            }\n        };\n        Transaction.prototype.table = function (tableName) {\n            var memoizedTables = (this._memoizedTables || (this._memoizedTables = {}));\n            if (hasOwn(memoizedTables, tableName))\n                return memoizedTables[tableName];\n            var tableSchema = this.schema[tableName];\n            if (!tableSchema) {\n                throw new exceptions.NotFound(\"Table \" + tableName + \" not part of transaction\");\n            }\n            var transactionBoundTable = new this.db.Table(tableName, tableSchema, this);\n            transactionBoundTable.core = this.db.core.table(tableName);\n            memoizedTables[tableName] = transactionBoundTable;\n            return transactionBoundTable;\n        };\n        return Transaction;\n    }());\n\n    function createTransactionConstructor(db) {\n        return makeClassConstructor(Transaction.prototype, function Transaction(mode, storeNames, dbschema, chromeTransactionDurability, parent) {\n            var _this = this;\n            this.db = db;\n            this.mode = mode;\n            this.storeNames = storeNames;\n            this.schema = dbschema;\n            this.chromeTransactionDurability = chromeTransactionDurability;\n            this.idbtrans = null;\n            this.on = Events(this, \"complete\", \"error\", \"abort\");\n            this.parent = parent || null;\n            this.active = true;\n            this._reculock = 0;\n            this._blockedFuncs = [];\n            this._resolve = null;\n            this._reject = null;\n            this._waitingFor = null;\n            this._waitingQueue = null;\n            this._spinCount = 0;\n            this._completion = new DexiePromise(function (resolve, reject) {\n                _this._resolve = resolve;\n                _this._reject = reject;\n            });\n            this._completion.then(function () {\n                _this.active = false;\n                _this.on.complete.fire();\n            }, function (e) {\n                var wasActive = _this.active;\n                _this.active = false;\n                _this.on.error.fire(e);\n                _this.parent ?\n                    _this.parent._reject(e) :\n                    wasActive && _this.idbtrans && _this.idbtrans.abort();\n                return rejection(e);\n            });\n        });\n    }\n\n    function createIndexSpec(name, keyPath, unique, multi, auto, compound, isPrimKey) {\n        return {\n            name: name,\n            keyPath: keyPath,\n            unique: unique,\n            multi: multi,\n            auto: auto,\n            compound: compound,\n            src: (unique && !isPrimKey ? '&' : '') + (multi ? '*' : '') + (auto ? \"++\" : \"\") + nameFromKeyPath(keyPath)\n        };\n    }\n    function nameFromKeyPath(keyPath) {\n        return typeof keyPath === 'string' ?\n            keyPath :\n            keyPath ? ('[' + [].join.call(keyPath, '+') + ']') : \"\";\n    }\n\n    function createTableSchema(name, primKey, indexes) {\n        return {\n            name: name,\n            primKey: primKey,\n            indexes: indexes,\n            mappedClass: null,\n            idxByName: arrayToObject(indexes, function (index) { return [index.name, index]; })\n        };\n    }\n\n    function safariMultiStoreFix(storeNames) {\n        return storeNames.length === 1 ? storeNames[0] : storeNames;\n    }\n    var getMaxKey = function (IdbKeyRange) {\n        try {\n            IdbKeyRange.only([[]]);\n            getMaxKey = function () { return [[]]; };\n            return [[]];\n        }\n        catch (e) {\n            getMaxKey = function () { return maxString; };\n            return maxString;\n        }\n    };\n\n    function getKeyExtractor(keyPath) {\n        if (keyPath == null) {\n            return function () { return undefined; };\n        }\n        else if (typeof keyPath === 'string') {\n            return getSinglePathKeyExtractor(keyPath);\n        }\n        else {\n            return function (obj) { return getByKeyPath(obj, keyPath); };\n        }\n    }\n    function getSinglePathKeyExtractor(keyPath) {\n        var split = keyPath.split('.');\n        if (split.length === 1) {\n            return function (obj) { return obj[keyPath]; };\n        }\n        else {\n            return function (obj) { return getByKeyPath(obj, keyPath); };\n        }\n    }\n\n    function arrayify(arrayLike) {\n        return [].slice.call(arrayLike);\n    }\n    var _id_counter = 0;\n    function getKeyPathAlias(keyPath) {\n        return keyPath == null ?\n            \":id\" :\n            typeof keyPath === 'string' ?\n                keyPath :\n                \"[\".concat(keyPath.join('+'), \"]\");\n    }\n    function createDBCore(db, IdbKeyRange, tmpTrans) {\n        function extractSchema(db, trans) {\n            var tables = arrayify(db.objectStoreNames);\n            return {\n                schema: {\n                    name: db.name,\n                    tables: tables.map(function (table) { return trans.objectStore(table); }).map(function (store) {\n                        var keyPath = store.keyPath, autoIncrement = store.autoIncrement;\n                        var compound = isArray(keyPath);\n                        var outbound = keyPath == null;\n                        var indexByKeyPath = {};\n                        var result = {\n                            name: store.name,\n                            primaryKey: {\n                                name: null,\n                                isPrimaryKey: true,\n                                outbound: outbound,\n                                compound: compound,\n                                keyPath: keyPath,\n                                autoIncrement: autoIncrement,\n                                unique: true,\n                                extractKey: getKeyExtractor(keyPath)\n                            },\n                            indexes: arrayify(store.indexNames).map(function (indexName) { return store.index(indexName); })\n                                .map(function (index) {\n                                var name = index.name, unique = index.unique, multiEntry = index.multiEntry, keyPath = index.keyPath;\n                                var compound = isArray(keyPath);\n                                var result = {\n                                    name: name,\n                                    compound: compound,\n                                    keyPath: keyPath,\n                                    unique: unique,\n                                    multiEntry: multiEntry,\n                                    extractKey: getKeyExtractor(keyPath)\n                                };\n                                indexByKeyPath[getKeyPathAlias(keyPath)] = result;\n                                return result;\n                            }),\n                            getIndexByKeyPath: function (keyPath) { return indexByKeyPath[getKeyPathAlias(keyPath)]; }\n                        };\n                        indexByKeyPath[\":id\"] = result.primaryKey;\n                        if (keyPath != null) {\n                            indexByKeyPath[getKeyPathAlias(keyPath)] = result.primaryKey;\n                        }\n                        return result;\n                    })\n                },\n                hasGetAll: tables.length > 0 && ('getAll' in trans.objectStore(tables[0])) &&\n                    !(typeof navigator !== 'undefined' && /Safari/.test(navigator.userAgent) &&\n                        !/(Chrome\\/|Edge\\/)/.test(navigator.userAgent) &&\n                        [].concat(navigator.userAgent.match(/Safari\\/(\\d*)/))[1] < 604)\n            };\n        }\n        function makeIDBKeyRange(range) {\n            if (range.type === 3 )\n                return null;\n            if (range.type === 4 )\n                throw new Error(\"Cannot convert never type to IDBKeyRange\");\n            var lower = range.lower, upper = range.upper, lowerOpen = range.lowerOpen, upperOpen = range.upperOpen;\n            var idbRange = lower === undefined ?\n                upper === undefined ?\n                    null :\n                    IdbKeyRange.upperBound(upper, !!upperOpen) :\n                upper === undefined ?\n                    IdbKeyRange.lowerBound(lower, !!lowerOpen) :\n                    IdbKeyRange.bound(lower, upper, !!lowerOpen, !!upperOpen);\n            return idbRange;\n        }\n        function createDbCoreTable(tableSchema) {\n            var tableName = tableSchema.name;\n            function mutate(_a) {\n                var trans = _a.trans, type = _a.type, keys = _a.keys, values = _a.values, range = _a.range;\n                return new Promise(function (resolve, reject) {\n                    resolve = wrap(resolve);\n                    var store = trans.objectStore(tableName);\n                    var outbound = store.keyPath == null;\n                    var isAddOrPut = type === \"put\" || type === \"add\";\n                    if (!isAddOrPut && type !== 'delete' && type !== 'deleteRange')\n                        throw new Error(\"Invalid operation type: \" + type);\n                    var length = (keys || values || { length: 1 }).length;\n                    if (keys && values && keys.length !== values.length) {\n                        throw new Error(\"Given keys array must have same length as given values array.\");\n                    }\n                    if (length === 0)\n                        return resolve({ numFailures: 0, failures: {}, results: [], lastResult: undefined });\n                    var req;\n                    var reqs = [];\n                    var failures = [];\n                    var numFailures = 0;\n                    var errorHandler = function (event) {\n                        ++numFailures;\n                        preventDefault(event);\n                    };\n                    if (type === 'deleteRange') {\n                        if (range.type === 4 )\n                            return resolve({ numFailures: numFailures, failures: failures, results: [], lastResult: undefined });\n                        if (range.type === 3 )\n                            reqs.push(req = store.clear());\n                        else\n                            reqs.push(req = store.delete(makeIDBKeyRange(range)));\n                    }\n                    else {\n                        var _a = isAddOrPut ?\n                            outbound ?\n                                [values, keys] :\n                                [values, null] :\n                            [keys, null], args1 = _a[0], args2 = _a[1];\n                        if (isAddOrPut) {\n                            for (var i = 0; i < length; ++i) {\n                                reqs.push(req = (args2 && args2[i] !== undefined ?\n                                    store[type](args1[i], args2[i]) :\n                                    store[type](args1[i])));\n                                req.onerror = errorHandler;\n                            }\n                        }\n                        else {\n                            for (var i = 0; i < length; ++i) {\n                                reqs.push(req = store[type](args1[i]));\n                                req.onerror = errorHandler;\n                            }\n                        }\n                    }\n                    var done = function (event) {\n                        var lastResult = event.target.result;\n                        reqs.forEach(function (req, i) { return req.error != null && (failures[i] = req.error); });\n                        resolve({\n                            numFailures: numFailures,\n                            failures: failures,\n                            results: type === \"delete\" ? keys : reqs.map(function (req) { return req.result; }),\n                            lastResult: lastResult\n                        });\n                    };\n                    req.onerror = function (event) {\n                        errorHandler(event);\n                        done(event);\n                    };\n                    req.onsuccess = done;\n                });\n            }\n            function openCursor(_a) {\n                var trans = _a.trans, values = _a.values, query = _a.query, reverse = _a.reverse, unique = _a.unique;\n                return new Promise(function (resolve, reject) {\n                    resolve = wrap(resolve);\n                    var index = query.index, range = query.range;\n                    var store = trans.objectStore(tableName);\n                    var source = index.isPrimaryKey ?\n                        store :\n                        store.index(index.name);\n                    var direction = reverse ?\n                        unique ?\n                            \"prevunique\" :\n                            \"prev\" :\n                        unique ?\n                            \"nextunique\" :\n                            \"next\";\n                    var req = values || !('openKeyCursor' in source) ?\n                        source.openCursor(makeIDBKeyRange(range), direction) :\n                        source.openKeyCursor(makeIDBKeyRange(range), direction);\n                    req.onerror = eventRejectHandler(reject);\n                    req.onsuccess = wrap(function (ev) {\n                        var cursor = req.result;\n                        if (!cursor) {\n                            resolve(null);\n                            return;\n                        }\n                        cursor.___id = ++_id_counter;\n                        cursor.done = false;\n                        var _cursorContinue = cursor.continue.bind(cursor);\n                        var _cursorContinuePrimaryKey = cursor.continuePrimaryKey;\n                        if (_cursorContinuePrimaryKey)\n                            _cursorContinuePrimaryKey = _cursorContinuePrimaryKey.bind(cursor);\n                        var _cursorAdvance = cursor.advance.bind(cursor);\n                        var doThrowCursorIsNotStarted = function () { throw new Error(\"Cursor not started\"); };\n                        var doThrowCursorIsStopped = function () { throw new Error(\"Cursor not stopped\"); };\n                        cursor.trans = trans;\n                        cursor.stop = cursor.continue = cursor.continuePrimaryKey = cursor.advance = doThrowCursorIsNotStarted;\n                        cursor.fail = wrap(reject);\n                        cursor.next = function () {\n                            var _this = this;\n                            var gotOne = 1;\n                            return this.start(function () { return gotOne-- ? _this.continue() : _this.stop(); }).then(function () { return _this; });\n                        };\n                        cursor.start = function (callback) {\n                            var iterationPromise = new Promise(function (resolveIteration, rejectIteration) {\n                                resolveIteration = wrap(resolveIteration);\n                                req.onerror = eventRejectHandler(rejectIteration);\n                                cursor.fail = rejectIteration;\n                                cursor.stop = function (value) {\n                                    cursor.stop = cursor.continue = cursor.continuePrimaryKey = cursor.advance = doThrowCursorIsStopped;\n                                    resolveIteration(value);\n                                };\n                            });\n                            var guardedCallback = function () {\n                                if (req.result) {\n                                    try {\n                                        callback();\n                                    }\n                                    catch (err) {\n                                        cursor.fail(err);\n                                    }\n                                }\n                                else {\n                                    cursor.done = true;\n                                    cursor.start = function () { throw new Error(\"Cursor behind last entry\"); };\n                                    cursor.stop();\n                                }\n                            };\n                            req.onsuccess = wrap(function (ev) {\n                                req.onsuccess = guardedCallback;\n                                guardedCallback();\n                            });\n                            cursor.continue = _cursorContinue;\n                            cursor.continuePrimaryKey = _cursorContinuePrimaryKey;\n                            cursor.advance = _cursorAdvance;\n                            guardedCallback();\n                            return iterationPromise;\n                        };\n                        resolve(cursor);\n                    }, reject);\n                });\n            }\n            function query(hasGetAll) {\n                return function (request) {\n                    return new Promise(function (resolve, reject) {\n                        resolve = wrap(resolve);\n                        var trans = request.trans, values = request.values, limit = request.limit, query = request.query;\n                        var nonInfinitLimit = limit === Infinity ? undefined : limit;\n                        var index = query.index, range = query.range;\n                        var store = trans.objectStore(tableName);\n                        var source = index.isPrimaryKey ? store : store.index(index.name);\n                        var idbKeyRange = makeIDBKeyRange(range);\n                        if (limit === 0)\n                            return resolve({ result: [] });\n                        if (hasGetAll) {\n                            var req = values ?\n                                source.getAll(idbKeyRange, nonInfinitLimit) :\n                                source.getAllKeys(idbKeyRange, nonInfinitLimit);\n                            req.onsuccess = function (event) { return resolve({ result: event.target.result }); };\n                            req.onerror = eventRejectHandler(reject);\n                        }\n                        else {\n                            var count_1 = 0;\n                            var req_1 = values || !('openKeyCursor' in source) ?\n                                source.openCursor(idbKeyRange) :\n                                source.openKeyCursor(idbKeyRange);\n                            var result_1 = [];\n                            req_1.onsuccess = function (event) {\n                                var cursor = req_1.result;\n                                if (!cursor)\n                                    return resolve({ result: result_1 });\n                                result_1.push(values ? cursor.value : cursor.primaryKey);\n                                if (++count_1 === limit)\n                                    return resolve({ result: result_1 });\n                                cursor.continue();\n                            };\n                            req_1.onerror = eventRejectHandler(reject);\n                        }\n                    });\n                };\n            }\n            return {\n                name: tableName,\n                schema: tableSchema,\n                mutate: mutate,\n                getMany: function (_a) {\n                    var trans = _a.trans, keys = _a.keys;\n                    return new Promise(function (resolve, reject) {\n                        resolve = wrap(resolve);\n                        var store = trans.objectStore(tableName);\n                        var length = keys.length;\n                        var result = new Array(length);\n                        var keyCount = 0;\n                        var callbackCount = 0;\n                        var req;\n                        var successHandler = function (event) {\n                            var req = event.target;\n                            if ((result[req._pos] = req.result) != null)\n                                ;\n                            if (++callbackCount === keyCount)\n                                resolve(result);\n                        };\n                        var errorHandler = eventRejectHandler(reject);\n                        for (var i = 0; i < length; ++i) {\n                            var key = keys[i];\n                            if (key != null) {\n                                req = store.get(keys[i]);\n                                req._pos = i;\n                                req.onsuccess = successHandler;\n                                req.onerror = errorHandler;\n                                ++keyCount;\n                            }\n                        }\n                        if (keyCount === 0)\n                            resolve(result);\n                    });\n                },\n                get: function (_a) {\n                    var trans = _a.trans, key = _a.key;\n                    return new Promise(function (resolve, reject) {\n                        resolve = wrap(resolve);\n                        var store = trans.objectStore(tableName);\n                        var req = store.get(key);\n                        req.onsuccess = function (event) { return resolve(event.target.result); };\n                        req.onerror = eventRejectHandler(reject);\n                    });\n                },\n                query: query(hasGetAll),\n                openCursor: openCursor,\n                count: function (_a) {\n                    var query = _a.query, trans = _a.trans;\n                    var index = query.index, range = query.range;\n                    return new Promise(function (resolve, reject) {\n                        var store = trans.objectStore(tableName);\n                        var source = index.isPrimaryKey ? store : store.index(index.name);\n                        var idbKeyRange = makeIDBKeyRange(range);\n                        var req = idbKeyRange ? source.count(idbKeyRange) : source.count();\n                        req.onsuccess = wrap(function (ev) { return resolve(ev.target.result); });\n                        req.onerror = eventRejectHandler(reject);\n                    });\n                }\n            };\n        }\n        var _a = extractSchema(db, tmpTrans), schema = _a.schema, hasGetAll = _a.hasGetAll;\n        var tables = schema.tables.map(function (tableSchema) { return createDbCoreTable(tableSchema); });\n        var tableMap = {};\n        tables.forEach(function (table) { return tableMap[table.name] = table; });\n        return {\n            stack: \"dbcore\",\n            transaction: db.transaction.bind(db),\n            table: function (name) {\n                var result = tableMap[name];\n                if (!result)\n                    throw new Error(\"Table '\".concat(name, \"' not found\"));\n                return tableMap[name];\n            },\n            MIN_KEY: -Infinity,\n            MAX_KEY: getMaxKey(IdbKeyRange),\n            schema: schema\n        };\n    }\n\n    function createMiddlewareStack(stackImpl, middlewares) {\n        return middlewares.reduce(function (down, _a) {\n            var create = _a.create;\n            return (__assign(__assign({}, down), create(down)));\n        }, stackImpl);\n    }\n    function createMiddlewareStacks(middlewares, idbdb, _a, tmpTrans) {\n        var IDBKeyRange = _a.IDBKeyRange; _a.indexedDB;\n        var dbcore = createMiddlewareStack(createDBCore(idbdb, IDBKeyRange, tmpTrans), middlewares.dbcore);\n        return {\n            dbcore: dbcore\n        };\n    }\n    function generateMiddlewareStacks(db, tmpTrans) {\n        var idbdb = tmpTrans.db;\n        var stacks = createMiddlewareStacks(db._middlewares, idbdb, db._deps, tmpTrans);\n        db.core = stacks.dbcore;\n        db.tables.forEach(function (table) {\n            var tableName = table.name;\n            if (db.core.schema.tables.some(function (tbl) { return tbl.name === tableName; })) {\n                table.core = db.core.table(tableName);\n                if (db[tableName] instanceof db.Table) {\n                    db[tableName].core = table.core;\n                }\n            }\n        });\n    }\n\n    function setApiOnPlace(db, objs, tableNames, dbschema) {\n        tableNames.forEach(function (tableName) {\n            var schema = dbschema[tableName];\n            objs.forEach(function (obj) {\n                var propDesc = getPropertyDescriptor(obj, tableName);\n                if (!propDesc || (\"value\" in propDesc && propDesc.value === undefined)) {\n                    if (obj === db.Transaction.prototype || obj instanceof db.Transaction) {\n                        setProp(obj, tableName, {\n                            get: function () { return this.table(tableName); },\n                            set: function (value) {\n                                defineProperty(this, tableName, { value: value, writable: true, configurable: true, enumerable: true });\n                            }\n                        });\n                    }\n                    else {\n                        obj[tableName] = new db.Table(tableName, schema);\n                    }\n                }\n            });\n        });\n    }\n    function removeTablesApi(db, objs) {\n        objs.forEach(function (obj) {\n            for (var key in obj) {\n                if (obj[key] instanceof db.Table)\n                    delete obj[key];\n            }\n        });\n    }\n    function lowerVersionFirst(a, b) {\n        return a._cfg.version - b._cfg.version;\n    }\n    function runUpgraders(db, oldVersion, idbUpgradeTrans, reject) {\n        var globalSchema = db._dbSchema;\n        if (idbUpgradeTrans.objectStoreNames.contains('$meta') && !globalSchema.$meta) {\n            globalSchema.$meta = createTableSchema(\"$meta\", parseIndexSyntax(\"\")[0], []);\n            db._storeNames.push('$meta');\n        }\n        var trans = db._createTransaction('readwrite', db._storeNames, globalSchema);\n        trans.create(idbUpgradeTrans);\n        trans._completion.catch(reject);\n        var rejectTransaction = trans._reject.bind(trans);\n        var transless = PSD.transless || PSD;\n        newScope(function () {\n            PSD.trans = trans;\n            PSD.transless = transless;\n            if (oldVersion === 0) {\n                keys(globalSchema).forEach(function (tableName) {\n                    createTable(idbUpgradeTrans, tableName, globalSchema[tableName].primKey, globalSchema[tableName].indexes);\n                });\n                generateMiddlewareStacks(db, idbUpgradeTrans);\n                DexiePromise.follow(function () { return db.on.populate.fire(trans); }).catch(rejectTransaction);\n            }\n            else {\n                generateMiddlewareStacks(db, idbUpgradeTrans);\n                return getExistingVersion(db, trans, oldVersion)\n                    .then(function (oldVersion) { return updateTablesAndIndexes(db, oldVersion, trans, idbUpgradeTrans); })\n                    .catch(rejectTransaction);\n            }\n        });\n    }\n    function patchCurrentVersion(db, idbUpgradeTrans) {\n        createMissingTables(db._dbSchema, idbUpgradeTrans);\n        if (idbUpgradeTrans.db.version % 10 === 0 && !idbUpgradeTrans.objectStoreNames.contains('$meta')) {\n            idbUpgradeTrans.db.createObjectStore('$meta').add(Math.ceil((idbUpgradeTrans.db.version / 10) - 1), 'version');\n        }\n        var globalSchema = buildGlobalSchema(db, db.idbdb, idbUpgradeTrans);\n        adjustToExistingIndexNames(db, db._dbSchema, idbUpgradeTrans);\n        var diff = getSchemaDiff(globalSchema, db._dbSchema);\n        var _loop_1 = function (tableChange) {\n            if (tableChange.change.length || tableChange.recreate) {\n                console.warn(\"Unable to patch indexes of table \".concat(tableChange.name, \" because it has changes on the type of index or primary key.\"));\n                return { value: void 0 };\n            }\n            var store = idbUpgradeTrans.objectStore(tableChange.name);\n            tableChange.add.forEach(function (idx) {\n                if (debug)\n                    console.debug(\"Dexie upgrade patch: Creating missing index \".concat(tableChange.name, \".\").concat(idx.src));\n                addIndex(store, idx);\n            });\n        };\n        for (var _i = 0, _a = diff.change; _i < _a.length; _i++) {\n            var tableChange = _a[_i];\n            var state_1 = _loop_1(tableChange);\n            if (typeof state_1 === \"object\")\n                return state_1.value;\n        }\n    }\n    function getExistingVersion(db, trans, oldVersion) {\n        if (trans.storeNames.includes('$meta')) {\n            return trans.table('$meta').get('version').then(function (metaVersion) {\n                return metaVersion != null ? metaVersion : oldVersion;\n            });\n        }\n        else {\n            return DexiePromise.resolve(oldVersion);\n        }\n    }\n    function updateTablesAndIndexes(db, oldVersion, trans, idbUpgradeTrans) {\n        var queue = [];\n        var versions = db._versions;\n        var globalSchema = db._dbSchema = buildGlobalSchema(db, db.idbdb, idbUpgradeTrans);\n        var versToRun = versions.filter(function (v) { return v._cfg.version >= oldVersion; });\n        if (versToRun.length === 0) {\n            return DexiePromise.resolve();\n        }\n        versToRun.forEach(function (version) {\n            queue.push(function () {\n                var oldSchema = globalSchema;\n                var newSchema = version._cfg.dbschema;\n                adjustToExistingIndexNames(db, oldSchema, idbUpgradeTrans);\n                adjustToExistingIndexNames(db, newSchema, idbUpgradeTrans);\n                globalSchema = db._dbSchema = newSchema;\n                var diff = getSchemaDiff(oldSchema, newSchema);\n                diff.add.forEach(function (tuple) {\n                    createTable(idbUpgradeTrans, tuple[0], tuple[1].primKey, tuple[1].indexes);\n                });\n                diff.change.forEach(function (change) {\n                    if (change.recreate) {\n                        throw new exceptions.Upgrade(\"Not yet support for changing primary key\");\n                    }\n                    else {\n                        var store_1 = idbUpgradeTrans.objectStore(change.name);\n                        change.add.forEach(function (idx) { return addIndex(store_1, idx); });\n                        change.change.forEach(function (idx) {\n                            store_1.deleteIndex(idx.name);\n                            addIndex(store_1, idx);\n                        });\n                        change.del.forEach(function (idxName) { return store_1.deleteIndex(idxName); });\n                    }\n                });\n                var contentUpgrade = version._cfg.contentUpgrade;\n                if (contentUpgrade && version._cfg.version > oldVersion) {\n                    generateMiddlewareStacks(db, idbUpgradeTrans);\n                    trans._memoizedTables = {};\n                    var upgradeSchema_1 = shallowClone(newSchema);\n                    diff.del.forEach(function (table) {\n                        upgradeSchema_1[table] = oldSchema[table];\n                    });\n                    removeTablesApi(db, [db.Transaction.prototype]);\n                    setApiOnPlace(db, [db.Transaction.prototype], keys(upgradeSchema_1), upgradeSchema_1);\n                    trans.schema = upgradeSchema_1;\n                    var contentUpgradeIsAsync_1 = isAsyncFunction(contentUpgrade);\n                    if (contentUpgradeIsAsync_1) {\n                        incrementExpectedAwaits();\n                    }\n                    var returnValue_1;\n                    var promiseFollowed = DexiePromise.follow(function () {\n                        returnValue_1 = contentUpgrade(trans);\n                        if (returnValue_1) {\n                            if (contentUpgradeIsAsync_1) {\n                                var decrementor = decrementExpectedAwaits.bind(null, null);\n                                returnValue_1.then(decrementor, decrementor);\n                            }\n                        }\n                    });\n                    return (returnValue_1 && typeof returnValue_1.then === 'function' ?\n                        DexiePromise.resolve(returnValue_1) : promiseFollowed.then(function () { return returnValue_1; }));\n                }\n            });\n            queue.push(function (idbtrans) {\n                var newSchema = version._cfg.dbschema;\n                deleteRemovedTables(newSchema, idbtrans);\n                removeTablesApi(db, [db.Transaction.prototype]);\n                setApiOnPlace(db, [db.Transaction.prototype], db._storeNames, db._dbSchema);\n                trans.schema = db._dbSchema;\n            });\n            queue.push(function (idbtrans) {\n                if (db.idbdb.objectStoreNames.contains('$meta')) {\n                    if (Math.ceil(db.idbdb.version / 10) === version._cfg.version) {\n                        db.idbdb.deleteObjectStore('$meta');\n                        delete db._dbSchema.$meta;\n                        db._storeNames = db._storeNames.filter(function (name) { return name !== '$meta'; });\n                    }\n                    else {\n                        idbtrans.objectStore('$meta').put(version._cfg.version, 'version');\n                    }\n                }\n            });\n        });\n        function runQueue() {\n            return queue.length ? DexiePromise.resolve(queue.shift()(trans.idbtrans)).then(runQueue) :\n                DexiePromise.resolve();\n        }\n        return runQueue().then(function () {\n            createMissingTables(globalSchema, idbUpgradeTrans);\n        });\n    }\n    function getSchemaDiff(oldSchema, newSchema) {\n        var diff = {\n            del: [],\n            add: [],\n            change: []\n        };\n        var table;\n        for (table in oldSchema) {\n            if (!newSchema[table])\n                diff.del.push(table);\n        }\n        for (table in newSchema) {\n            var oldDef = oldSchema[table], newDef = newSchema[table];\n            if (!oldDef) {\n                diff.add.push([table, newDef]);\n            }\n            else {\n                var change = {\n                    name: table,\n                    def: newDef,\n                    recreate: false,\n                    del: [],\n                    add: [],\n                    change: []\n                };\n                if ((\n                '' + (oldDef.primKey.keyPath || '')) !== ('' + (newDef.primKey.keyPath || '')) ||\n                    (oldDef.primKey.auto !== newDef.primKey.auto)) {\n                    change.recreate = true;\n                    diff.change.push(change);\n                }\n                else {\n                    var oldIndexes = oldDef.idxByName;\n                    var newIndexes = newDef.idxByName;\n                    var idxName = void 0;\n                    for (idxName in oldIndexes) {\n                        if (!newIndexes[idxName])\n                            change.del.push(idxName);\n                    }\n                    for (idxName in newIndexes) {\n                        var oldIdx = oldIndexes[idxName], newIdx = newIndexes[idxName];\n                        if (!oldIdx)\n                            change.add.push(newIdx);\n                        else if (oldIdx.src !== newIdx.src)\n                            change.change.push(newIdx);\n                    }\n                    if (change.del.length > 0 || change.add.length > 0 || change.change.length > 0) {\n                        diff.change.push(change);\n                    }\n                }\n            }\n        }\n        return diff;\n    }\n    function createTable(idbtrans, tableName, primKey, indexes) {\n        var store = idbtrans.db.createObjectStore(tableName, primKey.keyPath ?\n            { keyPath: primKey.keyPath, autoIncrement: primKey.auto } :\n            { autoIncrement: primKey.auto });\n        indexes.forEach(function (idx) { return addIndex(store, idx); });\n        return store;\n    }\n    function createMissingTables(newSchema, idbtrans) {\n        keys(newSchema).forEach(function (tableName) {\n            if (!idbtrans.db.objectStoreNames.contains(tableName)) {\n                if (debug)\n                    console.debug('Dexie: Creating missing table', tableName);\n                createTable(idbtrans, tableName, newSchema[tableName].primKey, newSchema[tableName].indexes);\n            }\n        });\n    }\n    function deleteRemovedTables(newSchema, idbtrans) {\n        [].slice.call(idbtrans.db.objectStoreNames).forEach(function (storeName) {\n            return newSchema[storeName] == null && idbtrans.db.deleteObjectStore(storeName);\n        });\n    }\n    function addIndex(store, idx) {\n        store.createIndex(idx.name, idx.keyPath, { unique: idx.unique, multiEntry: idx.multi });\n    }\n    function buildGlobalSchema(db, idbdb, tmpTrans) {\n        var globalSchema = {};\n        var dbStoreNames = slice(idbdb.objectStoreNames, 0);\n        dbStoreNames.forEach(function (storeName) {\n            var store = tmpTrans.objectStore(storeName);\n            var keyPath = store.keyPath;\n            var primKey = createIndexSpec(nameFromKeyPath(keyPath), keyPath || \"\", true, false, !!store.autoIncrement, keyPath && typeof keyPath !== \"string\", true);\n            var indexes = [];\n            for (var j = 0; j < store.indexNames.length; ++j) {\n                var idbindex = store.index(store.indexNames[j]);\n                keyPath = idbindex.keyPath;\n                var index = createIndexSpec(idbindex.name, keyPath, !!idbindex.unique, !!idbindex.multiEntry, false, keyPath && typeof keyPath !== \"string\", false);\n                indexes.push(index);\n            }\n            globalSchema[storeName] = createTableSchema(storeName, primKey, indexes);\n        });\n        return globalSchema;\n    }\n    function readGlobalSchema(db, idbdb, tmpTrans) {\n        db.verno = idbdb.version / 10;\n        var globalSchema = db._dbSchema = buildGlobalSchema(db, idbdb, tmpTrans);\n        db._storeNames = slice(idbdb.objectStoreNames, 0);\n        setApiOnPlace(db, [db._allTables], keys(globalSchema), globalSchema);\n    }\n    function verifyInstalledSchema(db, tmpTrans) {\n        var installedSchema = buildGlobalSchema(db, db.idbdb, tmpTrans);\n        var diff = getSchemaDiff(installedSchema, db._dbSchema);\n        return !(diff.add.length || diff.change.some(function (ch) { return ch.add.length || ch.change.length; }));\n    }\n    function adjustToExistingIndexNames(db, schema, idbtrans) {\n        var storeNames = idbtrans.db.objectStoreNames;\n        for (var i = 0; i < storeNames.length; ++i) {\n            var storeName = storeNames[i];\n            var store = idbtrans.objectStore(storeName);\n            db._hasGetAll = 'getAll' in store;\n            for (var j = 0; j < store.indexNames.length; ++j) {\n                var indexName = store.indexNames[j];\n                var keyPath = store.index(indexName).keyPath;\n                var dexieName = typeof keyPath === 'string' ? keyPath : \"[\" + slice(keyPath).join('+') + \"]\";\n                if (schema[storeName]) {\n                    var indexSpec = schema[storeName].idxByName[dexieName];\n                    if (indexSpec) {\n                        indexSpec.name = indexName;\n                        delete schema[storeName].idxByName[dexieName];\n                        schema[storeName].idxByName[indexName] = indexSpec;\n                    }\n                }\n            }\n        }\n        if (typeof navigator !== 'undefined' && /Safari/.test(navigator.userAgent) &&\n            !/(Chrome\\/|Edge\\/)/.test(navigator.userAgent) &&\n            _global.WorkerGlobalScope && _global instanceof _global.WorkerGlobalScope &&\n            [].concat(navigator.userAgent.match(/Safari\\/(\\d*)/))[1] < 604) {\n            db._hasGetAll = false;\n        }\n    }\n    function parseIndexSyntax(primKeyAndIndexes) {\n        return primKeyAndIndexes.split(',').map(function (index, indexNum) {\n            index = index.trim();\n            var name = index.replace(/([&*]|\\+\\+)/g, \"\");\n            var keyPath = /^\\[/.test(name) ? name.match(/^\\[(.*)\\]$/)[1].split('+') : name;\n            return createIndexSpec(name, keyPath || null, /\\&/.test(index), /\\*/.test(index), /\\+\\+/.test(index), isArray(keyPath), indexNum === 0);\n        });\n    }\n\n    var Version =  (function () {\n        function Version() {\n        }\n        Version.prototype._parseStoresSpec = function (stores, outSchema) {\n            keys(stores).forEach(function (tableName) {\n                if (stores[tableName] !== null) {\n                    var indexes = parseIndexSyntax(stores[tableName]);\n                    var primKey = indexes.shift();\n                    primKey.unique = true;\n                    if (primKey.multi)\n                        throw new exceptions.Schema(\"Primary key cannot be multi-valued\");\n                    indexes.forEach(function (idx) {\n                        if (idx.auto)\n                            throw new exceptions.Schema(\"Only primary key can be marked as autoIncrement (++)\");\n                        if (!idx.keyPath)\n                            throw new exceptions.Schema(\"Index must have a name and cannot be an empty string\");\n                    });\n                    outSchema[tableName] = createTableSchema(tableName, primKey, indexes);\n                }\n            });\n        };\n        Version.prototype.stores = function (stores) {\n            var db = this.db;\n            this._cfg.storesSource = this._cfg.storesSource ?\n                extend(this._cfg.storesSource, stores) :\n                stores;\n            var versions = db._versions;\n            var storesSpec = {};\n            var dbschema = {};\n            versions.forEach(function (version) {\n                extend(storesSpec, version._cfg.storesSource);\n                dbschema = (version._cfg.dbschema = {});\n                version._parseStoresSpec(storesSpec, dbschema);\n            });\n            db._dbSchema = dbschema;\n            removeTablesApi(db, [db._allTables, db, db.Transaction.prototype]);\n            setApiOnPlace(db, [db._allTables, db, db.Transaction.prototype, this._cfg.tables], keys(dbschema), dbschema);\n            db._storeNames = keys(dbschema);\n            return this;\n        };\n        Version.prototype.upgrade = function (upgradeFunction) {\n            this._cfg.contentUpgrade = promisableChain(this._cfg.contentUpgrade || nop, upgradeFunction);\n            return this;\n        };\n        return Version;\n    }());\n\n    function createVersionConstructor(db) {\n        return makeClassConstructor(Version.prototype, function Version(versionNumber) {\n            this.db = db;\n            this._cfg = {\n                version: versionNumber,\n                storesSource: null,\n                dbschema: {},\n                tables: {},\n                contentUpgrade: null\n            };\n        });\n    }\n\n    function getDbNamesTable(indexedDB, IDBKeyRange) {\n        var dbNamesDB = indexedDB[\"_dbNamesDB\"];\n        if (!dbNamesDB) {\n            dbNamesDB = indexedDB[\"_dbNamesDB\"] = new Dexie$1(DBNAMES_DB, {\n                addons: [],\n                indexedDB: indexedDB,\n                IDBKeyRange: IDBKeyRange,\n            });\n            dbNamesDB.version(1).stores({ dbnames: \"name\" });\n        }\n        return dbNamesDB.table(\"dbnames\");\n    }\n    function hasDatabasesNative(indexedDB) {\n        return indexedDB && typeof indexedDB.databases === \"function\";\n    }\n    function getDatabaseNames(_a) {\n        var indexedDB = _a.indexedDB, IDBKeyRange = _a.IDBKeyRange;\n        return hasDatabasesNative(indexedDB)\n            ? Promise.resolve(indexedDB.databases()).then(function (infos) {\n                return infos\n                    .map(function (info) { return info.name; })\n                    .filter(function (name) { return name !== DBNAMES_DB; });\n            })\n            : getDbNamesTable(indexedDB, IDBKeyRange).toCollection().primaryKeys();\n    }\n    function _onDatabaseCreated(_a, name) {\n        var indexedDB = _a.indexedDB, IDBKeyRange = _a.IDBKeyRange;\n        !hasDatabasesNative(indexedDB) &&\n            name !== DBNAMES_DB &&\n            getDbNamesTable(indexedDB, IDBKeyRange).put({ name: name }).catch(nop);\n    }\n    function _onDatabaseDeleted(_a, name) {\n        var indexedDB = _a.indexedDB, IDBKeyRange = _a.IDBKeyRange;\n        !hasDatabasesNative(indexedDB) &&\n            name !== DBNAMES_DB &&\n            getDbNamesTable(indexedDB, IDBKeyRange).delete(name).catch(nop);\n    }\n\n    function vip(fn) {\n        return newScope(function () {\n            PSD.letThrough = true;\n            return fn();\n        });\n    }\n\n    function idbReady() {\n        var isSafari = !navigator.userAgentData &&\n            /Safari\\//.test(navigator.userAgent) &&\n            !/Chrom(e|ium)\\//.test(navigator.userAgent);\n        if (!isSafari || !indexedDB.databases)\n            return Promise.resolve();\n        var intervalId;\n        return new Promise(function (resolve) {\n            var tryIdb = function () { return indexedDB.databases().finally(resolve); };\n            intervalId = setInterval(tryIdb, 100);\n            tryIdb();\n        }).finally(function () { return clearInterval(intervalId); });\n    }\n\n    var _a;\n    function isEmptyRange(node) {\n        return !(\"from\" in node);\n    }\n    var RangeSet = function (fromOrTree, to) {\n        if (this) {\n            extend(this, arguments.length ? { d: 1, from: fromOrTree, to: arguments.length > 1 ? to : fromOrTree } : { d: 0 });\n        }\n        else {\n            var rv = new RangeSet();\n            if (fromOrTree && (\"d\" in fromOrTree)) {\n                extend(rv, fromOrTree);\n            }\n            return rv;\n        }\n    };\n    props(RangeSet.prototype, (_a = {\n            add: function (rangeSet) {\n                mergeRanges(this, rangeSet);\n                return this;\n            },\n            addKey: function (key) {\n                addRange(this, key, key);\n                return this;\n            },\n            addKeys: function (keys) {\n                var _this = this;\n                keys.forEach(function (key) { return addRange(_this, key, key); });\n                return this;\n            },\n            hasKey: function (key) {\n                var node = getRangeSetIterator(this).next(key).value;\n                return node && cmp(node.from, key) <= 0 && cmp(node.to, key) >= 0;\n            }\n        },\n        _a[iteratorSymbol] = function () {\n            return getRangeSetIterator(this);\n        },\n        _a));\n    function addRange(target, from, to) {\n        var diff = cmp(from, to);\n        if (isNaN(diff))\n            return;\n        if (diff > 0)\n            throw RangeError();\n        if (isEmptyRange(target))\n            return extend(target, { from: from, to: to, d: 1 });\n        var left = target.l;\n        var right = target.r;\n        if (cmp(to, target.from) < 0) {\n            left\n                ? addRange(left, from, to)\n                : (target.l = { from: from, to: to, d: 1, l: null, r: null });\n            return rebalance(target);\n        }\n        if (cmp(from, target.to) > 0) {\n            right\n                ? addRange(right, from, to)\n                : (target.r = { from: from, to: to, d: 1, l: null, r: null });\n            return rebalance(target);\n        }\n        if (cmp(from, target.from) < 0) {\n            target.from = from;\n            target.l = null;\n            target.d = right ? right.d + 1 : 1;\n        }\n        if (cmp(to, target.to) > 0) {\n            target.to = to;\n            target.r = null;\n            target.d = target.l ? target.l.d + 1 : 1;\n        }\n        var rightWasCutOff = !target.r;\n        if (left && !target.l) {\n            mergeRanges(target, left);\n        }\n        if (right && rightWasCutOff) {\n            mergeRanges(target, right);\n        }\n    }\n    function mergeRanges(target, newSet) {\n        function _addRangeSet(target, _a) {\n            var from = _a.from, to = _a.to, l = _a.l, r = _a.r;\n            addRange(target, from, to);\n            if (l)\n                _addRangeSet(target, l);\n            if (r)\n                _addRangeSet(target, r);\n        }\n        if (!isEmptyRange(newSet))\n            _addRangeSet(target, newSet);\n    }\n    function rangesOverlap(rangeSet1, rangeSet2) {\n        var i1 = getRangeSetIterator(rangeSet2);\n        var nextResult1 = i1.next();\n        if (nextResult1.done)\n            return false;\n        var a = nextResult1.value;\n        var i2 = getRangeSetIterator(rangeSet1);\n        var nextResult2 = i2.next(a.from);\n        var b = nextResult2.value;\n        while (!nextResult1.done && !nextResult2.done) {\n            if (cmp(b.from, a.to) <= 0 && cmp(b.to, a.from) >= 0)\n                return true;\n            cmp(a.from, b.from) < 0\n                ? (a = (nextResult1 = i1.next(b.from)).value)\n                : (b = (nextResult2 = i2.next(a.from)).value);\n        }\n        return false;\n    }\n    function getRangeSetIterator(node) {\n        var state = isEmptyRange(node) ? null : { s: 0, n: node };\n        return {\n            next: function (key) {\n                var keyProvided = arguments.length > 0;\n                while (state) {\n                    switch (state.s) {\n                        case 0:\n                            state.s = 1;\n                            if (keyProvided) {\n                                while (state.n.l && cmp(key, state.n.from) < 0)\n                                    state = { up: state, n: state.n.l, s: 1 };\n                            }\n                            else {\n                                while (state.n.l)\n                                    state = { up: state, n: state.n.l, s: 1 };\n                            }\n                        case 1:\n                            state.s = 2;\n                            if (!keyProvided || cmp(key, state.n.to) <= 0)\n                                return { value: state.n, done: false };\n                        case 2:\n                            if (state.n.r) {\n                                state.s = 3;\n                                state = { up: state, n: state.n.r, s: 0 };\n                                continue;\n                            }\n                        case 3:\n                            state = state.up;\n                    }\n                }\n                return { done: true };\n            },\n        };\n    }\n    function rebalance(target) {\n        var _a, _b;\n        var diff = (((_a = target.r) === null || _a === void 0 ? void 0 : _a.d) || 0) - (((_b = target.l) === null || _b === void 0 ? void 0 : _b.d) || 0);\n        var r = diff > 1 ? \"r\" : diff < -1 ? \"l\" : \"\";\n        if (r) {\n            var l = r === \"r\" ? \"l\" : \"r\";\n            var rootClone = __assign({}, target);\n            var oldRootRight = target[r];\n            target.from = oldRootRight.from;\n            target.to = oldRootRight.to;\n            target[r] = oldRootRight[r];\n            rootClone[r] = oldRootRight[l];\n            target[l] = rootClone;\n            rootClone.d = computeDepth(rootClone);\n        }\n        target.d = computeDepth(target);\n    }\n    function computeDepth(_a) {\n        var r = _a.r, l = _a.l;\n        return (r ? (l ? Math.max(r.d, l.d) : r.d) : l ? l.d : 0) + 1;\n    }\n\n    function extendObservabilitySet(target, newSet) {\n        keys(newSet).forEach(function (part) {\n            if (target[part])\n                mergeRanges(target[part], newSet[part]);\n            else\n                target[part] = cloneSimpleObjectTree(newSet[part]);\n        });\n        return target;\n    }\n\n    function obsSetsOverlap(os1, os2) {\n        return os1.all || os2.all || Object.keys(os1).some(function (key) { return os2[key] && rangesOverlap(os2[key], os1[key]); });\n    }\n\n    var cache = {};\n\n    var unsignaledParts = {};\n    var isTaskEnqueued = false;\n    function signalSubscribersLazily(part, optimistic) {\n        extendObservabilitySet(unsignaledParts, part);\n        if (!isTaskEnqueued) {\n            isTaskEnqueued = true;\n            setTimeout(function () {\n                isTaskEnqueued = false;\n                var parts = unsignaledParts;\n                unsignaledParts = {};\n                signalSubscribersNow(parts, false);\n            }, 0);\n        }\n    }\n    function signalSubscribersNow(updatedParts, deleteAffectedCacheEntries) {\n        if (deleteAffectedCacheEntries === void 0) { deleteAffectedCacheEntries = false; }\n        var queriesToSignal = new Set();\n        if (updatedParts.all) {\n            for (var _i = 0, _a = Object.values(cache); _i < _a.length; _i++) {\n                var tblCache = _a[_i];\n                collectTableSubscribers(tblCache, updatedParts, queriesToSignal, deleteAffectedCacheEntries);\n            }\n        }\n        else {\n            for (var key in updatedParts) {\n                var parts = /^idb\\:\\/\\/(.*)\\/(.*)\\//.exec(key);\n                if (parts) {\n                    var dbName = parts[1], tableName = parts[2];\n                    var tblCache = cache[\"idb://\".concat(dbName, \"/\").concat(tableName)];\n                    if (tblCache)\n                        collectTableSubscribers(tblCache, updatedParts, queriesToSignal, deleteAffectedCacheEntries);\n                }\n            }\n        }\n        queriesToSignal.forEach(function (requery) { return requery(); });\n    }\n    function collectTableSubscribers(tblCache, updatedParts, outQueriesToSignal, deleteAffectedCacheEntries) {\n        var updatedEntryLists = [];\n        for (var _i = 0, _a = Object.entries(tblCache.queries.query); _i < _a.length; _i++) {\n            var _b = _a[_i], indexName = _b[0], entries = _b[1];\n            var filteredEntries = [];\n            for (var _c = 0, entries_1 = entries; _c < entries_1.length; _c++) {\n                var entry = entries_1[_c];\n                if (obsSetsOverlap(updatedParts, entry.obsSet)) {\n                    entry.subscribers.forEach(function (requery) { return outQueriesToSignal.add(requery); });\n                }\n                else if (deleteAffectedCacheEntries) {\n                    filteredEntries.push(entry);\n                }\n            }\n            if (deleteAffectedCacheEntries)\n                updatedEntryLists.push([indexName, filteredEntries]);\n        }\n        if (deleteAffectedCacheEntries) {\n            for (var _d = 0, updatedEntryLists_1 = updatedEntryLists; _d < updatedEntryLists_1.length; _d++) {\n                var _e = updatedEntryLists_1[_d], indexName = _e[0], filteredEntries = _e[1];\n                tblCache.queries.query[indexName] = filteredEntries;\n            }\n        }\n    }\n\n    function dexieOpen(db) {\n        var state = db._state;\n        var indexedDB = db._deps.indexedDB;\n        if (state.isBeingOpened || db.idbdb)\n            return state.dbReadyPromise.then(function () { return state.dbOpenError ?\n                rejection(state.dbOpenError) :\n                db; });\n        state.isBeingOpened = true;\n        state.dbOpenError = null;\n        state.openComplete = false;\n        var openCanceller = state.openCanceller;\n        var nativeVerToOpen = Math.round(db.verno * 10);\n        var schemaPatchMode = false;\n        function throwIfCancelled() {\n            if (state.openCanceller !== openCanceller)\n                throw new exceptions.DatabaseClosed('db.open() was cancelled');\n        }\n        var resolveDbReady = state.dbReadyResolve,\n        upgradeTransaction = null, wasCreated = false;\n        var tryOpenDB = function () { return new DexiePromise(function (resolve, reject) {\n            throwIfCancelled();\n            if (!indexedDB)\n                throw new exceptions.MissingAPI();\n            var dbName = db.name;\n            var req = state.autoSchema || !nativeVerToOpen ?\n                indexedDB.open(dbName) :\n                indexedDB.open(dbName, nativeVerToOpen);\n            if (!req)\n                throw new exceptions.MissingAPI();\n            req.onerror = eventRejectHandler(reject);\n            req.onblocked = wrap(db._fireOnBlocked);\n            req.onupgradeneeded = wrap(function (e) {\n                upgradeTransaction = req.transaction;\n                if (state.autoSchema && !db._options.allowEmptyDB) {\n                    req.onerror = preventDefault;\n                    upgradeTransaction.abort();\n                    req.result.close();\n                    var delreq = indexedDB.deleteDatabase(dbName);\n                    delreq.onsuccess = delreq.onerror = wrap(function () {\n                        reject(new exceptions.NoSuchDatabase(\"Database \".concat(dbName, \" doesnt exist\")));\n                    });\n                }\n                else {\n                    upgradeTransaction.onerror = eventRejectHandler(reject);\n                    var oldVer = e.oldVersion > Math.pow(2, 62) ? 0 : e.oldVersion;\n                    wasCreated = oldVer < 1;\n                    db.idbdb = req.result;\n                    if (schemaPatchMode) {\n                        patchCurrentVersion(db, upgradeTransaction);\n                    }\n                    runUpgraders(db, oldVer / 10, upgradeTransaction, reject);\n                }\n            }, reject);\n            req.onsuccess = wrap(function () {\n                upgradeTransaction = null;\n                var idbdb = db.idbdb = req.result;\n                var objectStoreNames = slice(idbdb.objectStoreNames);\n                if (objectStoreNames.length > 0)\n                    try {\n                        var tmpTrans = idbdb.transaction(safariMultiStoreFix(objectStoreNames), 'readonly');\n                        if (state.autoSchema)\n                            readGlobalSchema(db, idbdb, tmpTrans);\n                        else {\n                            adjustToExistingIndexNames(db, db._dbSchema, tmpTrans);\n                            if (!verifyInstalledSchema(db, tmpTrans) && !schemaPatchMode) {\n                                console.warn(\"Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this.\");\n                                idbdb.close();\n                                nativeVerToOpen = idbdb.version + 1;\n                                schemaPatchMode = true;\n                                return resolve(tryOpenDB());\n                            }\n                        }\n                        generateMiddlewareStacks(db, tmpTrans);\n                    }\n                    catch (e) {\n                    }\n                connections.push(db);\n                idbdb.onversionchange = wrap(function (ev) {\n                    state.vcFired = true;\n                    db.on(\"versionchange\").fire(ev);\n                });\n                idbdb.onclose = wrap(function (ev) {\n                    db.on(\"close\").fire(ev);\n                });\n                if (wasCreated)\n                    _onDatabaseCreated(db._deps, dbName);\n                resolve();\n            }, reject);\n        }).catch(function (err) {\n            switch (err === null || err === void 0 ? void 0 : err.name) {\n                case \"UnknownError\":\n                    if (state.PR1398_maxLoop > 0) {\n                        state.PR1398_maxLoop--;\n                        console.warn('Dexie: Workaround for Chrome UnknownError on open()');\n                        return tryOpenDB();\n                    }\n                    break;\n                case \"VersionError\":\n                    if (nativeVerToOpen > 0) {\n                        nativeVerToOpen = 0;\n                        return tryOpenDB();\n                    }\n                    break;\n            }\n            return DexiePromise.reject(err);\n        }); };\n        return DexiePromise.race([\n            openCanceller,\n            (typeof navigator === 'undefined' ? DexiePromise.resolve() : idbReady()).then(tryOpenDB)\n        ]).then(function () {\n            throwIfCancelled();\n            state.onReadyBeingFired = [];\n            return DexiePromise.resolve(vip(function () { return db.on.ready.fire(db.vip); })).then(function fireRemainders() {\n                if (state.onReadyBeingFired.length > 0) {\n                    var remainders_1 = state.onReadyBeingFired.reduce(promisableChain, nop);\n                    state.onReadyBeingFired = [];\n                    return DexiePromise.resolve(vip(function () { return remainders_1(db.vip); })).then(fireRemainders);\n                }\n            });\n        }).finally(function () {\n            if (state.openCanceller === openCanceller) {\n                state.onReadyBeingFired = null;\n                state.isBeingOpened = false;\n            }\n        }).catch(function (err) {\n            state.dbOpenError = err;\n            try {\n                upgradeTransaction && upgradeTransaction.abort();\n            }\n            catch (_a) { }\n            if (openCanceller === state.openCanceller) {\n                db._close();\n            }\n            return rejection(err);\n        }).finally(function () {\n            state.openComplete = true;\n            resolveDbReady();\n        }).then(function () {\n            if (wasCreated) {\n                var everything_1 = {};\n                db.tables.forEach(function (table) {\n                    table.schema.indexes.forEach(function (idx) {\n                        if (idx.name)\n                            everything_1[\"idb://\".concat(db.name, \"/\").concat(table.name, \"/\").concat(idx.name)] = new RangeSet(-Infinity, [[[]]]);\n                    });\n                    everything_1[\"idb://\".concat(db.name, \"/\").concat(table.name, \"/\")] = everything_1[\"idb://\".concat(db.name, \"/\").concat(table.name, \"/:dels\")] = new RangeSet(-Infinity, [[[]]]);\n                });\n                globalEvents(DEXIE_STORAGE_MUTATED_EVENT_NAME).fire(everything_1);\n                signalSubscribersNow(everything_1, true);\n            }\n            return db;\n        });\n    }\n\n    function awaitIterator(iterator) {\n        var callNext = function (result) { return iterator.next(result); }, doThrow = function (error) { return iterator.throw(error); }, onSuccess = step(callNext), onError = step(doThrow);\n        function step(getNext) {\n            return function (val) {\n                var next = getNext(val), value = next.value;\n                return next.done ? value :\n                    (!value || typeof value.then !== 'function' ?\n                        isArray(value) ? Promise.all(value).then(onSuccess, onError) : onSuccess(value) :\n                        value.then(onSuccess, onError));\n            };\n        }\n        return step(callNext)();\n    }\n\n    function extractTransactionArgs(mode, _tableArgs_, scopeFunc) {\n        var i = arguments.length;\n        if (i < 2)\n            throw new exceptions.InvalidArgument(\"Too few arguments\");\n        var args = new Array(i - 1);\n        while (--i)\n            args[i - 1] = arguments[i];\n        scopeFunc = args.pop();\n        var tables = flatten(args);\n        return [mode, tables, scopeFunc];\n    }\n    function enterTransactionScope(db, mode, storeNames, parentTransaction, scopeFunc) {\n        return DexiePromise.resolve().then(function () {\n            var transless = PSD.transless || PSD;\n            var trans = db._createTransaction(mode, storeNames, db._dbSchema, parentTransaction);\n            trans.explicit = true;\n            var zoneProps = {\n                trans: trans,\n                transless: transless\n            };\n            if (parentTransaction) {\n                trans.idbtrans = parentTransaction.idbtrans;\n            }\n            else {\n                try {\n                    trans.create();\n                    trans.idbtrans._explicit = true;\n                    db._state.PR1398_maxLoop = 3;\n                }\n                catch (ex) {\n                    if (ex.name === errnames.InvalidState && db.isOpen() && --db._state.PR1398_maxLoop > 0) {\n                        console.warn('Dexie: Need to reopen db');\n                        db.close({ disableAutoOpen: false });\n                        return db.open().then(function () { return enterTransactionScope(db, mode, storeNames, null, scopeFunc); });\n                    }\n                    return rejection(ex);\n                }\n            }\n            var scopeFuncIsAsync = isAsyncFunction(scopeFunc);\n            if (scopeFuncIsAsync) {\n                incrementExpectedAwaits();\n            }\n            var returnValue;\n            var promiseFollowed = DexiePromise.follow(function () {\n                returnValue = scopeFunc.call(trans, trans);\n                if (returnValue) {\n                    if (scopeFuncIsAsync) {\n                        var decrementor = decrementExpectedAwaits.bind(null, null);\n                        returnValue.then(decrementor, decrementor);\n                    }\n                    else if (typeof returnValue.next === 'function' && typeof returnValue.throw === 'function') {\n                        returnValue = awaitIterator(returnValue);\n                    }\n                }\n            }, zoneProps);\n            return (returnValue && typeof returnValue.then === 'function' ?\n                DexiePromise.resolve(returnValue).then(function (x) { return trans.active ?\n                    x\n                    : rejection(new exceptions.PrematureCommit(\"Transaction committed too early. See http://bit.ly/2kdckMn\")); })\n                : promiseFollowed.then(function () { return returnValue; })).then(function (x) {\n                if (parentTransaction)\n                    trans._resolve();\n                return trans._completion.then(function () { return x; });\n            }).catch(function (e) {\n                trans._reject(e);\n                return rejection(e);\n            });\n        });\n    }\n\n    function pad(a, value, count) {\n        var result = isArray(a) ? a.slice() : [a];\n        for (var i = 0; i < count; ++i)\n            result.push(value);\n        return result;\n    }\n    function createVirtualIndexMiddleware(down) {\n        return __assign(__assign({}, down), { table: function (tableName) {\n                var table = down.table(tableName);\n                var schema = table.schema;\n                var indexLookup = {};\n                var allVirtualIndexes = [];\n                function addVirtualIndexes(keyPath, keyTail, lowLevelIndex) {\n                    var keyPathAlias = getKeyPathAlias(keyPath);\n                    var indexList = (indexLookup[keyPathAlias] = indexLookup[keyPathAlias] || []);\n                    var keyLength = keyPath == null ? 0 : typeof keyPath === 'string' ? 1 : keyPath.length;\n                    var isVirtual = keyTail > 0;\n                    var virtualIndex = __assign(__assign({}, lowLevelIndex), { name: isVirtual\n                            ? \"\".concat(keyPathAlias, \"(virtual-from:\").concat(lowLevelIndex.name, \")\")\n                            : lowLevelIndex.name, lowLevelIndex: lowLevelIndex, isVirtual: isVirtual, keyTail: keyTail, keyLength: keyLength, extractKey: getKeyExtractor(keyPath), unique: !isVirtual && lowLevelIndex.unique });\n                    indexList.push(virtualIndex);\n                    if (!virtualIndex.isPrimaryKey) {\n                        allVirtualIndexes.push(virtualIndex);\n                    }\n                    if (keyLength > 1) {\n                        var virtualKeyPath = keyLength === 2 ?\n                            keyPath[0] :\n                            keyPath.slice(0, keyLength - 1);\n                        addVirtualIndexes(virtualKeyPath, keyTail + 1, lowLevelIndex);\n                    }\n                    indexList.sort(function (a, b) { return a.keyTail - b.keyTail; });\n                    return virtualIndex;\n                }\n                var primaryKey = addVirtualIndexes(schema.primaryKey.keyPath, 0, schema.primaryKey);\n                indexLookup[\":id\"] = [primaryKey];\n                for (var _i = 0, _a = schema.indexes; _i < _a.length; _i++) {\n                    var index = _a[_i];\n                    addVirtualIndexes(index.keyPath, 0, index);\n                }\n                function findBestIndex(keyPath) {\n                    var result = indexLookup[getKeyPathAlias(keyPath)];\n                    return result && result[0];\n                }\n                function translateRange(range, keyTail) {\n                    return {\n                        type: range.type === 1  ?\n                            2  :\n                            range.type,\n                        lower: pad(range.lower, range.lowerOpen ? down.MAX_KEY : down.MIN_KEY, keyTail),\n                        lowerOpen: true,\n                        upper: pad(range.upper, range.upperOpen ? down.MIN_KEY : down.MAX_KEY, keyTail),\n                        upperOpen: true\n                    };\n                }\n                function translateRequest(req) {\n                    var index = req.query.index;\n                    return index.isVirtual ? __assign(__assign({}, req), { query: {\n                            index: index.lowLevelIndex,\n                            range: translateRange(req.query.range, index.keyTail)\n                        } }) : req;\n                }\n                var result = __assign(__assign({}, table), { schema: __assign(__assign({}, schema), { primaryKey: primaryKey, indexes: allVirtualIndexes, getIndexByKeyPath: findBestIndex }), count: function (req) {\n                        return table.count(translateRequest(req));\n                    }, query: function (req) {\n                        return table.query(translateRequest(req));\n                    }, openCursor: function (req) {\n                        var _a = req.query.index, keyTail = _a.keyTail, isVirtual = _a.isVirtual, keyLength = _a.keyLength;\n                        if (!isVirtual)\n                            return table.openCursor(req);\n                        function createVirtualCursor(cursor) {\n                            function _continue(key) {\n                                key != null ?\n                                    cursor.continue(pad(key, req.reverse ? down.MAX_KEY : down.MIN_KEY, keyTail)) :\n                                    req.unique ?\n                                        cursor.continue(cursor.key.slice(0, keyLength)\n                                            .concat(req.reverse\n                                            ? down.MIN_KEY\n                                            : down.MAX_KEY, keyTail)) :\n                                        cursor.continue();\n                            }\n                            var virtualCursor = Object.create(cursor, {\n                                continue: { value: _continue },\n                                continuePrimaryKey: {\n                                    value: function (key, primaryKey) {\n                                        cursor.continuePrimaryKey(pad(key, down.MAX_KEY, keyTail), primaryKey);\n                                    }\n                                },\n                                primaryKey: {\n                                    get: function () {\n                                        return cursor.primaryKey;\n                                    }\n                                },\n                                key: {\n                                    get: function () {\n                                        var key = cursor.key;\n                                        return keyLength === 1 ?\n                                            key[0] :\n                                            key.slice(0, keyLength);\n                                    }\n                                },\n                                value: {\n                                    get: function () {\n                                        return cursor.value;\n                                    }\n                                }\n                            });\n                            return virtualCursor;\n                        }\n                        return table.openCursor(translateRequest(req))\n                            .then(function (cursor) { return cursor && createVirtualCursor(cursor); });\n                    } });\n                return result;\n            } });\n    }\n    var virtualIndexMiddleware = {\n        stack: \"dbcore\",\n        name: \"VirtualIndexMiddleware\",\n        level: 1,\n        create: createVirtualIndexMiddleware\n    };\n\n    function getObjectDiff(a, b, rv, prfx) {\n        rv = rv || {};\n        prfx = prfx || '';\n        keys(a).forEach(function (prop) {\n            if (!hasOwn(b, prop)) {\n                rv[prfx + prop] = undefined;\n            }\n            else {\n                var ap = a[prop], bp = b[prop];\n                if (typeof ap === 'object' && typeof bp === 'object' && ap && bp) {\n                    var apTypeName = toStringTag(ap);\n                    var bpTypeName = toStringTag(bp);\n                    if (apTypeName !== bpTypeName) {\n                        rv[prfx + prop] = b[prop];\n                    }\n                    else if (apTypeName === 'Object') {\n                        getObjectDiff(ap, bp, rv, prfx + prop + '.');\n                    }\n                    else if (ap !== bp) {\n                        rv[prfx + prop] = b[prop];\n                    }\n                }\n                else if (ap !== bp)\n                    rv[prfx + prop] = b[prop];\n            }\n        });\n        keys(b).forEach(function (prop) {\n            if (!hasOwn(a, prop)) {\n                rv[prfx + prop] = b[prop];\n            }\n        });\n        return rv;\n    }\n\n    function getEffectiveKeys(primaryKey, req) {\n        if (req.type === 'delete')\n            return req.keys;\n        return req.keys || req.values.map(primaryKey.extractKey);\n    }\n\n    var hooksMiddleware = {\n        stack: \"dbcore\",\n        name: \"HooksMiddleware\",\n        level: 2,\n        create: function (downCore) { return (__assign(__assign({}, downCore), { table: function (tableName) {\n                var downTable = downCore.table(tableName);\n                var primaryKey = downTable.schema.primaryKey;\n                var tableMiddleware = __assign(__assign({}, downTable), { mutate: function (req) {\n                        var dxTrans = PSD.trans;\n                        var _a = dxTrans.table(tableName).hook, deleting = _a.deleting, creating = _a.creating, updating = _a.updating;\n                        switch (req.type) {\n                            case 'add':\n                                if (creating.fire === nop)\n                                    break;\n                                return dxTrans._promise('readwrite', function () { return addPutOrDelete(req); }, true);\n                            case 'put':\n                                if (creating.fire === nop && updating.fire === nop)\n                                    break;\n                                return dxTrans._promise('readwrite', function () { return addPutOrDelete(req); }, true);\n                            case 'delete':\n                                if (deleting.fire === nop)\n                                    break;\n                                return dxTrans._promise('readwrite', function () { return addPutOrDelete(req); }, true);\n                            case 'deleteRange':\n                                if (deleting.fire === nop)\n                                    break;\n                                return dxTrans._promise('readwrite', function () { return deleteRange(req); }, true);\n                        }\n                        return downTable.mutate(req);\n                        function addPutOrDelete(req) {\n                            var dxTrans = PSD.trans;\n                            var keys = req.keys || getEffectiveKeys(primaryKey, req);\n                            if (!keys)\n                                throw new Error(\"Keys missing\");\n                            req = req.type === 'add' || req.type === 'put' ? __assign(__assign({}, req), { keys: keys }) : __assign({}, req);\n                            if (req.type !== 'delete')\n                                req.values = __spreadArray([], req.values, true);\n                            if (req.keys)\n                                req.keys = __spreadArray([], req.keys, true);\n                            return getExistingValues(downTable, req, keys).then(function (existingValues) {\n                                var contexts = keys.map(function (key, i) {\n                                    var existingValue = existingValues[i];\n                                    var ctx = { onerror: null, onsuccess: null };\n                                    if (req.type === 'delete') {\n                                        deleting.fire.call(ctx, key, existingValue, dxTrans);\n                                    }\n                                    else if (req.type === 'add' || existingValue === undefined) {\n                                        var generatedPrimaryKey = creating.fire.call(ctx, key, req.values[i], dxTrans);\n                                        if (key == null && generatedPrimaryKey != null) {\n                                            key = generatedPrimaryKey;\n                                            req.keys[i] = key;\n                                            if (!primaryKey.outbound) {\n                                                setByKeyPath(req.values[i], primaryKey.keyPath, key);\n                                            }\n                                        }\n                                    }\n                                    else {\n                                        var objectDiff = getObjectDiff(existingValue, req.values[i]);\n                                        var additionalChanges_1 = updating.fire.call(ctx, objectDiff, key, existingValue, dxTrans);\n                                        if (additionalChanges_1) {\n                                            var requestedValue_1 = req.values[i];\n                                            Object.keys(additionalChanges_1).forEach(function (keyPath) {\n                                                if (hasOwn(requestedValue_1, keyPath)) {\n                                                    requestedValue_1[keyPath] = additionalChanges_1[keyPath];\n                                                }\n                                                else {\n                                                    setByKeyPath(requestedValue_1, keyPath, additionalChanges_1[keyPath]);\n                                                }\n                                            });\n                                        }\n                                    }\n                                    return ctx;\n                                });\n                                return downTable.mutate(req).then(function (_a) {\n                                    var failures = _a.failures, results = _a.results, numFailures = _a.numFailures, lastResult = _a.lastResult;\n                                    for (var i = 0; i < keys.length; ++i) {\n                                        var primKey = results ? results[i] : keys[i];\n                                        var ctx = contexts[i];\n                                        if (primKey == null) {\n                                            ctx.onerror && ctx.onerror(failures[i]);\n                                        }\n                                        else {\n                                            ctx.onsuccess && ctx.onsuccess(req.type === 'put' && existingValues[i] ?\n                                                req.values[i] :\n                                                primKey\n                                            );\n                                        }\n                                    }\n                                    return { failures: failures, results: results, numFailures: numFailures, lastResult: lastResult };\n                                }).catch(function (error) {\n                                    contexts.forEach(function (ctx) { return ctx.onerror && ctx.onerror(error); });\n                                    return Promise.reject(error);\n                                });\n                            });\n                        }\n                        function deleteRange(req) {\n                            return deleteNextChunk(req.trans, req.range, 10000);\n                        }\n                        function deleteNextChunk(trans, range, limit) {\n                            return downTable.query({ trans: trans, values: false, query: { index: primaryKey, range: range }, limit: limit })\n                                .then(function (_a) {\n                                var result = _a.result;\n                                return addPutOrDelete({ type: 'delete', keys: result, trans: trans }).then(function (res) {\n                                    if (res.numFailures > 0)\n                                        return Promise.reject(res.failures[0]);\n                                    if (result.length < limit) {\n                                        return { failures: [], numFailures: 0, lastResult: undefined };\n                                    }\n                                    else {\n                                        return deleteNextChunk(trans, __assign(__assign({}, range), { lower: result[result.length - 1], lowerOpen: true }), limit);\n                                    }\n                                });\n                            });\n                        }\n                    } });\n                return tableMiddleware;\n            } })); }\n    };\n    function getExistingValues(table, req, effectiveKeys) {\n        return req.type === \"add\"\n            ? Promise.resolve([])\n            : table.getMany({ trans: req.trans, keys: effectiveKeys, cache: \"immutable\" });\n    }\n\n    function getFromTransactionCache(keys, cache, clone) {\n        try {\n            if (!cache)\n                return null;\n            if (cache.keys.length < keys.length)\n                return null;\n            var result = [];\n            for (var i = 0, j = 0; i < cache.keys.length && j < keys.length; ++i) {\n                if (cmp(cache.keys[i], keys[j]) !== 0)\n                    continue;\n                result.push(clone ? deepClone(cache.values[i]) : cache.values[i]);\n                ++j;\n            }\n            return result.length === keys.length ? result : null;\n        }\n        catch (_a) {\n            return null;\n        }\n    }\n    var cacheExistingValuesMiddleware = {\n        stack: \"dbcore\",\n        level: -1,\n        create: function (core) {\n            return {\n                table: function (tableName) {\n                    var table = core.table(tableName);\n                    return __assign(__assign({}, table), { getMany: function (req) {\n                            if (!req.cache) {\n                                return table.getMany(req);\n                            }\n                            var cachedResult = getFromTransactionCache(req.keys, req.trans[\"_cache\"], req.cache === \"clone\");\n                            if (cachedResult) {\n                                return DexiePromise.resolve(cachedResult);\n                            }\n                            return table.getMany(req).then(function (res) {\n                                req.trans[\"_cache\"] = {\n                                    keys: req.keys,\n                                    values: req.cache === \"clone\" ? deepClone(res) : res,\n                                };\n                                return res;\n                            });\n                        }, mutate: function (req) {\n                            if (req.type !== \"add\")\n                                req.trans[\"_cache\"] = null;\n                            return table.mutate(req);\n                        } });\n                },\n            };\n        },\n    };\n\n    function isCachableContext(ctx, table) {\n        return (ctx.trans.mode === 'readonly' &&\n            !!ctx.subscr &&\n            !ctx.trans.explicit &&\n            ctx.trans.db._options.cache !== 'disabled' &&\n            !table.schema.primaryKey.outbound);\n    }\n\n    function isCachableRequest(type, req) {\n        switch (type) {\n            case 'query':\n                return req.values && !req.unique;\n            case 'get':\n                return false;\n            case 'getMany':\n                return false;\n            case 'count':\n                return false;\n            case 'openCursor':\n                return false;\n        }\n    }\n\n    var observabilityMiddleware = {\n        stack: \"dbcore\",\n        level: 0,\n        name: \"Observability\",\n        create: function (core) {\n            var dbName = core.schema.name;\n            var FULL_RANGE = new RangeSet(core.MIN_KEY, core.MAX_KEY);\n            return __assign(__assign({}, core), { transaction: function (stores, mode, options) {\n                    if (PSD.subscr && mode !== 'readonly') {\n                        throw new exceptions.ReadOnly(\"Readwrite transaction in liveQuery context. Querier source: \".concat(PSD.querier));\n                    }\n                    return core.transaction(stores, mode, options);\n                }, table: function (tableName) {\n                    var table = core.table(tableName);\n                    var schema = table.schema;\n                    var primaryKey = schema.primaryKey, indexes = schema.indexes;\n                    var extractKey = primaryKey.extractKey, outbound = primaryKey.outbound;\n                    var indexesWithAutoIncPK = primaryKey.autoIncrement && indexes.filter(function (index) { return index.compound && index.keyPath.includes(primaryKey.keyPath); });\n                    var tableClone = __assign(__assign({}, table), { mutate: function (req) {\n                            var _a, _b;\n                            var trans = req.trans;\n                            var mutatedParts = req.mutatedParts || (req.mutatedParts = {});\n                            var getRangeSet = function (indexName) {\n                                var part = \"idb://\".concat(dbName, \"/\").concat(tableName, \"/\").concat(indexName);\n                                return (mutatedParts[part] ||\n                                    (mutatedParts[part] = new RangeSet()));\n                            };\n                            var pkRangeSet = getRangeSet(\"\");\n                            var delsRangeSet = getRangeSet(\":dels\");\n                            var type = req.type;\n                            var _c = req.type === \"deleteRange\"\n                                ? [req.range]\n                                : req.type === \"delete\"\n                                    ? [req.keys]\n                                    : req.values.length < 50\n                                        ? [getEffectiveKeys(primaryKey, req).filter(function (id) { return id; }), req.values]\n                                        : [], keys = _c[0], newObjs = _c[1];\n                            var oldCache = req.trans[\"_cache\"];\n                            if (isArray(keys)) {\n                                pkRangeSet.addKeys(keys);\n                                var oldObjs = type === 'delete' || keys.length === newObjs.length ? getFromTransactionCache(keys, oldCache) : null;\n                                if (!oldObjs) {\n                                    delsRangeSet.addKeys(keys);\n                                }\n                                if (oldObjs || newObjs) {\n                                    trackAffectedIndexes(getRangeSet, schema, oldObjs, newObjs);\n                                }\n                            }\n                            else if (keys) {\n                                var range = {\n                                    from: (_a = keys.lower) !== null && _a !== void 0 ? _a : core.MIN_KEY,\n                                    to: (_b = keys.upper) !== null && _b !== void 0 ? _b : core.MAX_KEY\n                                };\n                                delsRangeSet.add(range);\n                                pkRangeSet.add(range);\n                            }\n                            else {\n                                pkRangeSet.add(FULL_RANGE);\n                                delsRangeSet.add(FULL_RANGE);\n                                schema.indexes.forEach(function (idx) { return getRangeSet(idx.name).add(FULL_RANGE); });\n                            }\n                            return table.mutate(req).then(function (res) {\n                                if (keys && (req.type === 'add' || req.type === 'put')) {\n                                    pkRangeSet.addKeys(res.results);\n                                    if (indexesWithAutoIncPK) {\n                                        indexesWithAutoIncPK.forEach(function (idx) {\n                                            var idxVals = req.values.map(function (v) { return idx.extractKey(v); });\n                                            var pkPos = idx.keyPath.findIndex(function (prop) { return prop === primaryKey.keyPath; });\n                                            for (var i = 0, len = res.results.length; i < len; ++i) {\n                                                idxVals[i][pkPos] = res.results[i];\n                                            }\n                                            getRangeSet(idx.name).addKeys(idxVals);\n                                        });\n                                    }\n                                }\n                                trans.mutatedParts = extendObservabilitySet(trans.mutatedParts || {}, mutatedParts);\n                                return res;\n                            });\n                        } });\n                    var getRange = function (_a) {\n                        var _b, _c;\n                        var _d = _a.query, index = _d.index, range = _d.range;\n                        return [\n                            index,\n                            new RangeSet((_b = range.lower) !== null && _b !== void 0 ? _b : core.MIN_KEY, (_c = range.upper) !== null && _c !== void 0 ? _c : core.MAX_KEY),\n                        ];\n                    };\n                    var readSubscribers = {\n                        get: function (req) { return [primaryKey, new RangeSet(req.key)]; },\n                        getMany: function (req) { return [primaryKey, new RangeSet().addKeys(req.keys)]; },\n                        count: getRange,\n                        query: getRange,\n                        openCursor: getRange,\n                    };\n                    keys(readSubscribers).forEach(function (method) {\n                        tableClone[method] = function (req) {\n                            var subscr = PSD.subscr;\n                            var isLiveQuery = !!subscr;\n                            var cachable = isCachableContext(PSD, table) && isCachableRequest(method, req);\n                            var obsSet = cachable\n                                ? req.obsSet = {}\n                                : subscr;\n                            if (isLiveQuery) {\n                                var getRangeSet = function (indexName) {\n                                    var part = \"idb://\".concat(dbName, \"/\").concat(tableName, \"/\").concat(indexName);\n                                    return (obsSet[part] ||\n                                        (obsSet[part] = new RangeSet()));\n                                };\n                                var pkRangeSet_1 = getRangeSet(\"\");\n                                var delsRangeSet_1 = getRangeSet(\":dels\");\n                                var _a = readSubscribers[method](req), queriedIndex = _a[0], queriedRanges = _a[1];\n                                if (method === 'query' && queriedIndex.isPrimaryKey && !req.values) {\n                                    delsRangeSet_1.add(queriedRanges);\n                                }\n                                else {\n                                    getRangeSet(queriedIndex.name || \"\").add(queriedRanges);\n                                }\n                                if (!queriedIndex.isPrimaryKey) {\n                                    if (method === \"count\") {\n                                        delsRangeSet_1.add(FULL_RANGE);\n                                    }\n                                    else {\n                                        var keysPromise_1 = method === \"query\" &&\n                                            outbound &&\n                                            req.values &&\n                                            table.query(__assign(__assign({}, req), { values: false }));\n                                        return table[method].apply(this, arguments).then(function (res) {\n                                            if (method === \"query\") {\n                                                if (outbound && req.values) {\n                                                    return keysPromise_1.then(function (_a) {\n                                                        var resultingKeys = _a.result;\n                                                        pkRangeSet_1.addKeys(resultingKeys);\n                                                        return res;\n                                                    });\n                                                }\n                                                var pKeys = req.values\n                                                    ? res.result.map(extractKey)\n                                                    : res.result;\n                                                if (req.values) {\n                                                    pkRangeSet_1.addKeys(pKeys);\n                                                }\n                                                else {\n                                                    delsRangeSet_1.addKeys(pKeys);\n                                                }\n                                            }\n                                            else if (method === \"openCursor\") {\n                                                var cursor_1 = res;\n                                                var wantValues_1 = req.values;\n                                                return (cursor_1 &&\n                                                    Object.create(cursor_1, {\n                                                        key: {\n                                                            get: function () {\n                                                                delsRangeSet_1.addKey(cursor_1.primaryKey);\n                                                                return cursor_1.key;\n                                                            },\n                                                        },\n                                                        primaryKey: {\n                                                            get: function () {\n                                                                var pkey = cursor_1.primaryKey;\n                                                                delsRangeSet_1.addKey(pkey);\n                                                                return pkey;\n                                                            },\n                                                        },\n                                                        value: {\n                                                            get: function () {\n                                                                wantValues_1 && pkRangeSet_1.addKey(cursor_1.primaryKey);\n                                                                return cursor_1.value;\n                                                            },\n                                                        },\n                                                    }));\n                                            }\n                                            return res;\n                                        });\n                                    }\n                                }\n                            }\n                            return table[method].apply(this, arguments);\n                        };\n                    });\n                    return tableClone;\n                } });\n        },\n    };\n    function trackAffectedIndexes(getRangeSet, schema, oldObjs, newObjs) {\n        function addAffectedIndex(ix) {\n            var rangeSet = getRangeSet(ix.name || \"\");\n            function extractKey(obj) {\n                return obj != null ? ix.extractKey(obj) : null;\n            }\n            var addKeyOrKeys = function (key) { return ix.multiEntry && isArray(key)\n                ? key.forEach(function (key) { return rangeSet.addKey(key); })\n                : rangeSet.addKey(key); };\n            (oldObjs || newObjs).forEach(function (_, i) {\n                var oldKey = oldObjs && extractKey(oldObjs[i]);\n                var newKey = newObjs && extractKey(newObjs[i]);\n                if (cmp(oldKey, newKey) !== 0) {\n                    if (oldKey != null)\n                        addKeyOrKeys(oldKey);\n                    if (newKey != null)\n                        addKeyOrKeys(newKey);\n                }\n            });\n        }\n        schema.indexes.forEach(addAffectedIndex);\n    }\n\n    function adjustOptimisticFromFailures(tblCache, req, res) {\n        if (res.numFailures === 0)\n            return req;\n        if (req.type === 'deleteRange') {\n            return null;\n        }\n        var numBulkOps = req.keys\n            ? req.keys.length\n            : 'values' in req && req.values\n                ? req.values.length\n                : 1;\n        if (res.numFailures === numBulkOps) {\n            return null;\n        }\n        var clone = __assign({}, req);\n        if (isArray(clone.keys)) {\n            clone.keys = clone.keys.filter(function (_, i) { return !(i in res.failures); });\n        }\n        if ('values' in clone && isArray(clone.values)) {\n            clone.values = clone.values.filter(function (_, i) { return !(i in res.failures); });\n        }\n        return clone;\n    }\n\n    function isAboveLower(key, range) {\n        return range.lower === undefined\n            ? true\n            : range.lowerOpen\n                ? cmp(key, range.lower) > 0\n                : cmp(key, range.lower) >= 0;\n    }\n    function isBelowUpper(key, range) {\n        return range.upper === undefined\n            ? true\n            : range.upperOpen\n                ? cmp(key, range.upper) < 0\n                : cmp(key, range.upper) <= 0;\n    }\n    function isWithinRange(key, range) {\n        return isAboveLower(key, range) && isBelowUpper(key, range);\n    }\n\n    function applyOptimisticOps(result, req, ops, table, cacheEntry, immutable) {\n        if (!ops || ops.length === 0)\n            return result;\n        var index = req.query.index;\n        var multiEntry = index.multiEntry;\n        var queryRange = req.query.range;\n        var primaryKey = table.schema.primaryKey;\n        var extractPrimKey = primaryKey.extractKey;\n        var extractIndex = index.extractKey;\n        var extractLowLevelIndex = (index.lowLevelIndex || index).extractKey;\n        var finalResult = ops.reduce(function (result, op) {\n            var modifedResult = result;\n            var includedValues = [];\n            if (op.type === 'add' || op.type === 'put') {\n                var includedPKs = new RangeSet();\n                for (var i = op.values.length - 1; i >= 0; --i) {\n                    var value = op.values[i];\n                    var pk = extractPrimKey(value);\n                    if (includedPKs.hasKey(pk))\n                        continue;\n                    var key = extractIndex(value);\n                    if (multiEntry && isArray(key)\n                        ? key.some(function (k) { return isWithinRange(k, queryRange); })\n                        : isWithinRange(key, queryRange)) {\n                        includedPKs.addKey(pk);\n                        includedValues.push(value);\n                    }\n                }\n            }\n            switch (op.type) {\n                case 'add': {\n                    var existingKeys_1 = new RangeSet().addKeys(req.values ? result.map(function (v) { return extractPrimKey(v); }) : result);\n                    modifedResult = result.concat(req.values\n                        ? includedValues.filter(function (v) {\n                            var key = extractPrimKey(v);\n                            if (existingKeys_1.hasKey(key))\n                                return false;\n                            existingKeys_1.addKey(key);\n                            return true;\n                        })\n                        : includedValues\n                            .map(function (v) { return extractPrimKey(v); })\n                            .filter(function (k) {\n                            if (existingKeys_1.hasKey(k))\n                                return false;\n                            existingKeys_1.addKey(k);\n                            return true;\n                        }));\n                    break;\n                }\n                case 'put': {\n                    var keySet_1 = new RangeSet().addKeys(op.values.map(function (v) { return extractPrimKey(v); }));\n                    modifedResult = result\n                        .filter(\n                    function (item) { return !keySet_1.hasKey(req.values ? extractPrimKey(item) : item); })\n                        .concat(\n                    req.values\n                        ? includedValues\n                        : includedValues.map(function (v) { return extractPrimKey(v); }));\n                    break;\n                }\n                case 'delete':\n                    var keysToDelete_1 = new RangeSet().addKeys(op.keys);\n                    modifedResult = result.filter(function (item) {\n                        return !keysToDelete_1.hasKey(req.values ? extractPrimKey(item) : item);\n                    });\n                    break;\n                case 'deleteRange':\n                    var range_1 = op.range;\n                    modifedResult = result.filter(function (item) { return !isWithinRange(extractPrimKey(item), range_1); });\n                    break;\n            }\n            return modifedResult;\n        }, result);\n        if (finalResult === result)\n            return result;\n        finalResult.sort(function (a, b) {\n            return cmp(extractLowLevelIndex(a), extractLowLevelIndex(b)) ||\n                cmp(extractPrimKey(a), extractPrimKey(b));\n        });\n        if (req.limit && req.limit < Infinity) {\n            if (finalResult.length > req.limit) {\n                finalResult.length = req.limit;\n            }\n            else if (result.length === req.limit && finalResult.length < req.limit) {\n                cacheEntry.dirty = true;\n            }\n        }\n        return immutable ? Object.freeze(finalResult) : finalResult;\n    }\n\n    function areRangesEqual(r1, r2) {\n        return (cmp(r1.lower, r2.lower) === 0 &&\n            cmp(r1.upper, r2.upper) === 0 &&\n            !!r1.lowerOpen === !!r2.lowerOpen &&\n            !!r1.upperOpen === !!r2.upperOpen);\n    }\n\n    function compareLowers(lower1, lower2, lowerOpen1, lowerOpen2) {\n        if (lower1 === undefined)\n            return lower2 !== undefined ? -1 : 0;\n        if (lower2 === undefined)\n            return 1;\n        var c = cmp(lower1, lower2);\n        if (c === 0) {\n            if (lowerOpen1 && lowerOpen2)\n                return 0;\n            if (lowerOpen1)\n                return 1;\n            if (lowerOpen2)\n                return -1;\n        }\n        return c;\n    }\n    function compareUppers(upper1, upper2, upperOpen1, upperOpen2) {\n        if (upper1 === undefined)\n            return upper2 !== undefined ? 1 : 0;\n        if (upper2 === undefined)\n            return -1;\n        var c = cmp(upper1, upper2);\n        if (c === 0) {\n            if (upperOpen1 && upperOpen2)\n                return 0;\n            if (upperOpen1)\n                return -1;\n            if (upperOpen2)\n                return 1;\n        }\n        return c;\n    }\n    function isSuperRange(r1, r2) {\n        return (compareLowers(r1.lower, r2.lower, r1.lowerOpen, r2.lowerOpen) <= 0 &&\n            compareUppers(r1.upper, r2.upper, r1.upperOpen, r2.upperOpen) >= 0);\n    }\n\n    function findCompatibleQuery(dbName, tableName, type, req) {\n        var tblCache = cache[\"idb://\".concat(dbName, \"/\").concat(tableName)];\n        if (!tblCache)\n            return [];\n        var queries = tblCache.queries[type];\n        if (!queries)\n            return [null, false, tblCache, null];\n        var indexName = req.query ? req.query.index.name : null;\n        var entries = queries[indexName || ''];\n        if (!entries)\n            return [null, false, tblCache, null];\n        switch (type) {\n            case 'query':\n                var equalEntry = entries.find(function (entry) {\n                    return entry.req.limit === req.limit &&\n                        entry.req.values === req.values &&\n                        areRangesEqual(entry.req.query.range, req.query.range);\n                });\n                if (equalEntry)\n                    return [\n                        equalEntry,\n                        true,\n                        tblCache,\n                        entries,\n                    ];\n                var superEntry = entries.find(function (entry) {\n                    var limit = 'limit' in entry.req ? entry.req.limit : Infinity;\n                    return (limit >= req.limit &&\n                        (req.values ? entry.req.values : true) &&\n                        isSuperRange(entry.req.query.range, req.query.range));\n                });\n                return [superEntry, false, tblCache, entries];\n            case 'count':\n                var countQuery = entries.find(function (entry) {\n                    return areRangesEqual(entry.req.query.range, req.query.range);\n                });\n                return [countQuery, !!countQuery, tblCache, entries];\n        }\n    }\n\n    function subscribeToCacheEntry(cacheEntry, container, requery, signal) {\n        cacheEntry.subscribers.add(requery);\n        signal.addEventListener(\"abort\", function () {\n            cacheEntry.subscribers.delete(requery);\n            if (cacheEntry.subscribers.size === 0) {\n                enqueForDeletion(cacheEntry, container);\n            }\n        });\n    }\n    function enqueForDeletion(cacheEntry, container) {\n        setTimeout(function () {\n            if (cacheEntry.subscribers.size === 0) {\n                delArrayItem(container, cacheEntry);\n            }\n        }, 3000);\n    }\n\n    var cacheMiddleware = {\n        stack: 'dbcore',\n        level: 0,\n        name: 'Cache',\n        create: function (core) {\n            var dbName = core.schema.name;\n            var coreMW = __assign(__assign({}, core), { transaction: function (stores, mode, options) {\n                    var idbtrans = core.transaction(stores, mode, options);\n                    if (mode === 'readwrite') {\n                        var ac_1 = new AbortController();\n                        var signal = ac_1.signal;\n                        var endTransaction = function (wasCommitted) { return function () {\n                            ac_1.abort();\n                            if (mode === 'readwrite') {\n                                var affectedSubscribers_1 = new Set();\n                                for (var _i = 0, stores_1 = stores; _i < stores_1.length; _i++) {\n                                    var storeName = stores_1[_i];\n                                    var tblCache = cache[\"idb://\".concat(dbName, \"/\").concat(storeName)];\n                                    if (tblCache) {\n                                        var table = core.table(storeName);\n                                        var ops = tblCache.optimisticOps.filter(function (op) { return op.trans === idbtrans; });\n                                        if (idbtrans._explicit && wasCommitted && idbtrans.mutatedParts) {\n                                            for (var _a = 0, _b = Object.values(tblCache.queries.query); _a < _b.length; _a++) {\n                                                var entries = _b[_a];\n                                                for (var _c = 0, _d = entries.slice(); _c < _d.length; _c++) {\n                                                    var entry = _d[_c];\n                                                    if (obsSetsOverlap(entry.obsSet, idbtrans.mutatedParts)) {\n                                                        delArrayItem(entries, entry);\n                                                        entry.subscribers.forEach(function (requery) { return affectedSubscribers_1.add(requery); });\n                                                    }\n                                                }\n                                            }\n                                        }\n                                        else if (ops.length > 0) {\n                                            tblCache.optimisticOps = tblCache.optimisticOps.filter(function (op) { return op.trans !== idbtrans; });\n                                            for (var _e = 0, _f = Object.values(tblCache.queries.query); _e < _f.length; _e++) {\n                                                var entries = _f[_e];\n                                                for (var _g = 0, _h = entries.slice(); _g < _h.length; _g++) {\n                                                    var entry = _h[_g];\n                                                    if (entry.res != null &&\n                                                        idbtrans.mutatedParts\n    ) {\n                                                        if (wasCommitted && !entry.dirty) {\n                                                            var freezeResults = Object.isFrozen(entry.res);\n                                                            var modRes = applyOptimisticOps(entry.res, entry.req, ops, table, entry, freezeResults);\n                                                            if (entry.dirty) {\n                                                                delArrayItem(entries, entry);\n                                                                entry.subscribers.forEach(function (requery) { return affectedSubscribers_1.add(requery); });\n                                                            }\n                                                            else if (modRes !== entry.res) {\n                                                                entry.res = modRes;\n                                                                entry.promise = DexiePromise.resolve({ result: modRes });\n                                                            }\n                                                        }\n                                                        else {\n                                                            if (entry.dirty) {\n                                                                delArrayItem(entries, entry);\n                                                            }\n                                                            entry.subscribers.forEach(function (requery) { return affectedSubscribers_1.add(requery); });\n                                                        }\n                                                    }\n                                                }\n                                            }\n                                        }\n                                    }\n                                }\n                                affectedSubscribers_1.forEach(function (requery) { return requery(); });\n                            }\n                        }; };\n                        idbtrans.addEventListener('abort', endTransaction(false), {\n                            signal: signal,\n                        });\n                        idbtrans.addEventListener('error', endTransaction(false), {\n                            signal: signal,\n                        });\n                        idbtrans.addEventListener('complete', endTransaction(true), {\n                            signal: signal,\n                        });\n                    }\n                    return idbtrans;\n                }, table: function (tableName) {\n                    var downTable = core.table(tableName);\n                    var primKey = downTable.schema.primaryKey;\n                    var tableMW = __assign(__assign({}, downTable), { mutate: function (req) {\n                            var trans = PSD.trans;\n                            if (primKey.outbound ||\n                                trans.db._options.cache === 'disabled' ||\n                                trans.explicit ||\n                                trans.idbtrans.mode !== 'readwrite'\n                            ) {\n                                return downTable.mutate(req);\n                            }\n                            var tblCache = cache[\"idb://\".concat(dbName, \"/\").concat(tableName)];\n                            if (!tblCache)\n                                return downTable.mutate(req);\n                            var promise = downTable.mutate(req);\n                            if ((req.type === 'add' || req.type === 'put') && (req.values.length >= 50 || getEffectiveKeys(primKey, req).some(function (key) { return key == null; }))) {\n                                promise.then(function (res) {\n                                    var reqWithResolvedKeys = __assign(__assign({}, req), { values: req.values.map(function (value, i) {\n                                            var _a;\n                                            if (res.failures[i])\n                                                return value;\n                                            var valueWithKey = ((_a = primKey.keyPath) === null || _a === void 0 ? void 0 : _a.includes('.'))\n                                                ? deepClone(value)\n                                                : __assign({}, value);\n                                            setByKeyPath(valueWithKey, primKey.keyPath, res.results[i]);\n                                            return valueWithKey;\n                                        }) });\n                                    var adjustedReq = adjustOptimisticFromFailures(tblCache, reqWithResolvedKeys, res);\n                                    tblCache.optimisticOps.push(adjustedReq);\n                                    queueMicrotask(function () { return req.mutatedParts && signalSubscribersLazily(req.mutatedParts); });\n                                });\n                            }\n                            else {\n                                tblCache.optimisticOps.push(req);\n                                req.mutatedParts && signalSubscribersLazily(req.mutatedParts);\n                                promise.then(function (res) {\n                                    if (res.numFailures > 0) {\n                                        delArrayItem(tblCache.optimisticOps, req);\n                                        var adjustedReq = adjustOptimisticFromFailures(tblCache, req, res);\n                                        if (adjustedReq) {\n                                            tblCache.optimisticOps.push(adjustedReq);\n                                        }\n                                        req.mutatedParts && signalSubscribersLazily(req.mutatedParts);\n                                    }\n                                });\n                                promise.catch(function () {\n                                    delArrayItem(tblCache.optimisticOps, req);\n                                    req.mutatedParts && signalSubscribersLazily(req.mutatedParts);\n                                });\n                            }\n                            return promise;\n                        }, query: function (req) {\n                            var _a;\n                            if (!isCachableContext(PSD, downTable) || !isCachableRequest(\"query\", req))\n                                return downTable.query(req);\n                            var freezeResults = ((_a = PSD.trans) === null || _a === void 0 ? void 0 : _a.db._options.cache) === 'immutable';\n                            var _b = PSD, requery = _b.requery, signal = _b.signal;\n                            var _c = findCompatibleQuery(dbName, tableName, 'query', req), cacheEntry = _c[0], exactMatch = _c[1], tblCache = _c[2], container = _c[3];\n                            if (cacheEntry && exactMatch) {\n                                cacheEntry.obsSet = req.obsSet;\n                            }\n                            else {\n                                var promise = downTable.query(req).then(function (res) {\n                                    var result = res.result;\n                                    if (cacheEntry)\n                                        cacheEntry.res = result;\n                                    if (freezeResults) {\n                                        for (var i = 0, l = result.length; i < l; ++i) {\n                                            Object.freeze(result[i]);\n                                        }\n                                        Object.freeze(result);\n                                    }\n                                    else {\n                                        res.result = deepClone(result);\n                                    }\n                                    return res;\n                                }).catch(function (error) {\n                                    if (container && cacheEntry)\n                                        delArrayItem(container, cacheEntry);\n                                    return Promise.reject(error);\n                                });\n                                cacheEntry = {\n                                    obsSet: req.obsSet,\n                                    promise: promise,\n                                    subscribers: new Set(),\n                                    type: 'query',\n                                    req: req,\n                                    dirty: false,\n                                };\n                                if (container) {\n                                    container.push(cacheEntry);\n                                }\n                                else {\n                                    container = [cacheEntry];\n                                    if (!tblCache) {\n                                        tblCache = cache[\"idb://\".concat(dbName, \"/\").concat(tableName)] = {\n                                            queries: {\n                                                query: {},\n                                                count: {},\n                                            },\n                                            objs: new Map(),\n                                            optimisticOps: [],\n                                            unsignaledParts: {}\n                                        };\n                                    }\n                                    tblCache.queries.query[req.query.index.name || ''] = container;\n                                }\n                            }\n                            subscribeToCacheEntry(cacheEntry, container, requery, signal);\n                            return cacheEntry.promise.then(function (res) {\n                                return {\n                                    result: applyOptimisticOps(res.result, req, tblCache === null || tblCache === void 0 ? void 0 : tblCache.optimisticOps, downTable, cacheEntry, freezeResults),\n                                };\n                            });\n                        } });\n                    return tableMW;\n                } });\n            return coreMW;\n        },\n    };\n\n    function vipify(target, vipDb) {\n        return new Proxy(target, {\n            get: function (target, prop, receiver) {\n                if (prop === 'db')\n                    return vipDb;\n                return Reflect.get(target, prop, receiver);\n            }\n        });\n    }\n\n    var Dexie$1 =  (function () {\n        function Dexie(name, options) {\n            var _this = this;\n            this._middlewares = {};\n            this.verno = 0;\n            var deps = Dexie.dependencies;\n            this._options = options = __assign({\n                addons: Dexie.addons, autoOpen: true,\n                indexedDB: deps.indexedDB, IDBKeyRange: deps.IDBKeyRange, cache: 'cloned' }, options);\n            this._deps = {\n                indexedDB: options.indexedDB,\n                IDBKeyRange: options.IDBKeyRange\n            };\n            var addons = options.addons;\n            this._dbSchema = {};\n            this._versions = [];\n            this._storeNames = [];\n            this._allTables = {};\n            this.idbdb = null;\n            this._novip = this;\n            var state = {\n                dbOpenError: null,\n                isBeingOpened: false,\n                onReadyBeingFired: null,\n                openComplete: false,\n                dbReadyResolve: nop,\n                dbReadyPromise: null,\n                cancelOpen: nop,\n                openCanceller: null,\n                autoSchema: true,\n                PR1398_maxLoop: 3,\n                autoOpen: options.autoOpen,\n            };\n            state.dbReadyPromise = new DexiePromise(function (resolve) {\n                state.dbReadyResolve = resolve;\n            });\n            state.openCanceller = new DexiePromise(function (_, reject) {\n                state.cancelOpen = reject;\n            });\n            this._state = state;\n            this.name = name;\n            this.on = Events(this, \"populate\", \"blocked\", \"versionchange\", \"close\", { ready: [promisableChain, nop] });\n            this.on.ready.subscribe = override(this.on.ready.subscribe, function (subscribe) {\n                return function (subscriber, bSticky) {\n                    Dexie.vip(function () {\n                        var state = _this._state;\n                        if (state.openComplete) {\n                            if (!state.dbOpenError)\n                                DexiePromise.resolve().then(subscriber);\n                            if (bSticky)\n                                subscribe(subscriber);\n                        }\n                        else if (state.onReadyBeingFired) {\n                            state.onReadyBeingFired.push(subscriber);\n                            if (bSticky)\n                                subscribe(subscriber);\n                        }\n                        else {\n                            subscribe(subscriber);\n                            var db_1 = _this;\n                            if (!bSticky)\n                                subscribe(function unsubscribe() {\n                                    db_1.on.ready.unsubscribe(subscriber);\n                                    db_1.on.ready.unsubscribe(unsubscribe);\n                                });\n                        }\n                    });\n                };\n            });\n            this.Collection = createCollectionConstructor(this);\n            this.Table = createTableConstructor(this);\n            this.Transaction = createTransactionConstructor(this);\n            this.Version = createVersionConstructor(this);\n            this.WhereClause = createWhereClauseConstructor(this);\n            this.on(\"versionchange\", function (ev) {\n                if (ev.newVersion > 0)\n                    console.warn(\"Another connection wants to upgrade database '\".concat(_this.name, \"'. Closing db now to resume the upgrade.\"));\n                else\n                    console.warn(\"Another connection wants to delete database '\".concat(_this.name, \"'. Closing db now to resume the delete request.\"));\n                _this.close({ disableAutoOpen: false });\n            });\n            this.on(\"blocked\", function (ev) {\n                if (!ev.newVersion || ev.newVersion < ev.oldVersion)\n                    console.warn(\"Dexie.delete('\".concat(_this.name, \"') was blocked\"));\n                else\n                    console.warn(\"Upgrade '\".concat(_this.name, \"' blocked by other connection holding version \").concat(ev.oldVersion / 10));\n            });\n            this._maxKey = getMaxKey(options.IDBKeyRange);\n            this._createTransaction = function (mode, storeNames, dbschema, parentTransaction) { return new _this.Transaction(mode, storeNames, dbschema, _this._options.chromeTransactionDurability, parentTransaction); };\n            this._fireOnBlocked = function (ev) {\n                _this.on(\"blocked\").fire(ev);\n                connections\n                    .filter(function (c) { return c.name === _this.name && c !== _this && !c._state.vcFired; })\n                    .map(function (c) { return c.on(\"versionchange\").fire(ev); });\n            };\n            this.use(cacheExistingValuesMiddleware);\n            this.use(cacheMiddleware);\n            this.use(observabilityMiddleware);\n            this.use(virtualIndexMiddleware);\n            this.use(hooksMiddleware);\n            var vipDB = new Proxy(this, {\n                get: function (_, prop, receiver) {\n                    if (prop === '_vip')\n                        return true;\n                    if (prop === 'table')\n                        return function (tableName) { return vipify(_this.table(tableName), vipDB); };\n                    var rv = Reflect.get(_, prop, receiver);\n                    if (rv instanceof Table)\n                        return vipify(rv, vipDB);\n                    if (prop === 'tables')\n                        return rv.map(function (t) { return vipify(t, vipDB); });\n                    if (prop === '_createTransaction')\n                        return function () {\n                            var tx = rv.apply(this, arguments);\n                            return vipify(tx, vipDB);\n                        };\n                    return rv;\n                }\n            });\n            this.vip = vipDB;\n            addons.forEach(function (addon) { return addon(_this); });\n        }\n        Dexie.prototype.version = function (versionNumber) {\n            if (isNaN(versionNumber) || versionNumber < 0.1)\n                throw new exceptions.Type(\"Given version is not a positive number\");\n            versionNumber = Math.round(versionNumber * 10) / 10;\n            if (this.idbdb || this._state.isBeingOpened)\n                throw new exceptions.Schema(\"Cannot add version when database is open\");\n            this.verno = Math.max(this.verno, versionNumber);\n            var versions = this._versions;\n            var versionInstance = versions.filter(function (v) { return v._cfg.version === versionNumber; })[0];\n            if (versionInstance)\n                return versionInstance;\n            versionInstance = new this.Version(versionNumber);\n            versions.push(versionInstance);\n            versions.sort(lowerVersionFirst);\n            versionInstance.stores({});\n            this._state.autoSchema = false;\n            return versionInstance;\n        };\n        Dexie.prototype._whenReady = function (fn) {\n            var _this = this;\n            return (this.idbdb && (this._state.openComplete || PSD.letThrough || this._vip)) ? fn() : new DexiePromise(function (resolve, reject) {\n                if (_this._state.openComplete) {\n                    return reject(new exceptions.DatabaseClosed(_this._state.dbOpenError));\n                }\n                if (!_this._state.isBeingOpened) {\n                    if (!_this._state.autoOpen) {\n                        reject(new exceptions.DatabaseClosed());\n                        return;\n                    }\n                    _this.open().catch(nop);\n                }\n                _this._state.dbReadyPromise.then(resolve, reject);\n            }).then(fn);\n        };\n        Dexie.prototype.use = function (_a) {\n            var stack = _a.stack, create = _a.create, level = _a.level, name = _a.name;\n            if (name)\n                this.unuse({ stack: stack, name: name });\n            var middlewares = this._middlewares[stack] || (this._middlewares[stack] = []);\n            middlewares.push({ stack: stack, create: create, level: level == null ? 10 : level, name: name });\n            middlewares.sort(function (a, b) { return a.level - b.level; });\n            return this;\n        };\n        Dexie.prototype.unuse = function (_a) {\n            var stack = _a.stack, name = _a.name, create = _a.create;\n            if (stack && this._middlewares[stack]) {\n                this._middlewares[stack] = this._middlewares[stack].filter(function (mw) {\n                    return create ? mw.create !== create :\n                        name ? mw.name !== name :\n                            false;\n                });\n            }\n            return this;\n        };\n        Dexie.prototype.open = function () {\n            var _this = this;\n            return usePSD(globalPSD,\n            function () { return dexieOpen(_this); });\n        };\n        Dexie.prototype._close = function () {\n            var state = this._state;\n            var idx = connections.indexOf(this);\n            if (idx >= 0)\n                connections.splice(idx, 1);\n            if (this.idbdb) {\n                try {\n                    this.idbdb.close();\n                }\n                catch (e) { }\n                this.idbdb = null;\n            }\n            if (!state.isBeingOpened) {\n                state.dbReadyPromise = new DexiePromise(function (resolve) {\n                    state.dbReadyResolve = resolve;\n                });\n                state.openCanceller = new DexiePromise(function (_, reject) {\n                    state.cancelOpen = reject;\n                });\n            }\n        };\n        Dexie.prototype.close = function (_a) {\n            var _b = _a === void 0 ? { disableAutoOpen: true } : _a, disableAutoOpen = _b.disableAutoOpen;\n            var state = this._state;\n            if (disableAutoOpen) {\n                if (state.isBeingOpened) {\n                    state.cancelOpen(new exceptions.DatabaseClosed());\n                }\n                this._close();\n                state.autoOpen = false;\n                state.dbOpenError = new exceptions.DatabaseClosed();\n            }\n            else {\n                this._close();\n                state.autoOpen = this._options.autoOpen ||\n                    state.isBeingOpened;\n                state.openComplete = false;\n                state.dbOpenError = null;\n            }\n        };\n        Dexie.prototype.delete = function (closeOptions) {\n            var _this = this;\n            if (closeOptions === void 0) { closeOptions = { disableAutoOpen: true }; }\n            var hasInvalidArguments = arguments.length > 0 && typeof arguments[0] !== 'object';\n            var state = this._state;\n            return new DexiePromise(function (resolve, reject) {\n                var doDelete = function () {\n                    _this.close(closeOptions);\n                    var req = _this._deps.indexedDB.deleteDatabase(_this.name);\n                    req.onsuccess = wrap(function () {\n                        _onDatabaseDeleted(_this._deps, _this.name);\n                        resolve();\n                    });\n                    req.onerror = eventRejectHandler(reject);\n                    req.onblocked = _this._fireOnBlocked;\n                };\n                if (hasInvalidArguments)\n                    throw new exceptions.InvalidArgument(\"Invalid closeOptions argument to db.delete()\");\n                if (state.isBeingOpened) {\n                    state.dbReadyPromise.then(doDelete);\n                }\n                else {\n                    doDelete();\n                }\n            });\n        };\n        Dexie.prototype.backendDB = function () {\n            return this.idbdb;\n        };\n        Dexie.prototype.isOpen = function () {\n            return this.idbdb !== null;\n        };\n        Dexie.prototype.hasBeenClosed = function () {\n            var dbOpenError = this._state.dbOpenError;\n            return dbOpenError && (dbOpenError.name === 'DatabaseClosed');\n        };\n        Dexie.prototype.hasFailed = function () {\n            return this._state.dbOpenError !== null;\n        };\n        Dexie.prototype.dynamicallyOpened = function () {\n            return this._state.autoSchema;\n        };\n        Object.defineProperty(Dexie.prototype, \"tables\", {\n            get: function () {\n                var _this = this;\n                return keys(this._allTables).map(function (name) { return _this._allTables[name]; });\n            },\n            enumerable: false,\n            configurable: true\n        });\n        Dexie.prototype.transaction = function () {\n            var args = extractTransactionArgs.apply(this, arguments);\n            return this._transaction.apply(this, args);\n        };\n        Dexie.prototype._transaction = function (mode, tables, scopeFunc) {\n            var _this = this;\n            var parentTransaction = PSD.trans;\n            if (!parentTransaction || parentTransaction.db !== this || mode.indexOf('!') !== -1)\n                parentTransaction = null;\n            var onlyIfCompatible = mode.indexOf('?') !== -1;\n            mode = mode.replace('!', '').replace('?', '');\n            var idbMode, storeNames;\n            try {\n                storeNames = tables.map(function (table) {\n                    var storeName = table instanceof _this.Table ? table.name : table;\n                    if (typeof storeName !== 'string')\n                        throw new TypeError(\"Invalid table argument to Dexie.transaction(). Only Table or String are allowed\");\n                    return storeName;\n                });\n                if (mode == \"r\" || mode === READONLY)\n                    idbMode = READONLY;\n                else if (mode == \"rw\" || mode == READWRITE)\n                    idbMode = READWRITE;\n                else\n                    throw new exceptions.InvalidArgument(\"Invalid transaction mode: \" + mode);\n                if (parentTransaction) {\n                    if (parentTransaction.mode === READONLY && idbMode === READWRITE) {\n                        if (onlyIfCompatible) {\n                            parentTransaction = null;\n                        }\n                        else\n                            throw new exceptions.SubTransaction(\"Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY\");\n                    }\n                    if (parentTransaction) {\n                        storeNames.forEach(function (storeName) {\n                            if (parentTransaction && parentTransaction.storeNames.indexOf(storeName) === -1) {\n                                if (onlyIfCompatible) {\n                                    parentTransaction = null;\n                                }\n                                else\n                                    throw new exceptions.SubTransaction(\"Table \" + storeName +\n                                        \" not included in parent transaction.\");\n                            }\n                        });\n                    }\n                    if (onlyIfCompatible && parentTransaction && !parentTransaction.active) {\n                        parentTransaction = null;\n                    }\n                }\n            }\n            catch (e) {\n                return parentTransaction ?\n                    parentTransaction._promise(null, function (_, reject) { reject(e); }) :\n                    rejection(e);\n            }\n            var enterTransaction = enterTransactionScope.bind(null, this, idbMode, storeNames, parentTransaction, scopeFunc);\n            return (parentTransaction ?\n                parentTransaction._promise(idbMode, enterTransaction, \"lock\") :\n                PSD.trans ?\n                    usePSD(PSD.transless, function () { return _this._whenReady(enterTransaction); }) :\n                    this._whenReady(enterTransaction));\n        };\n        Dexie.prototype.table = function (tableName) {\n            if (!hasOwn(this._allTables, tableName)) {\n                throw new exceptions.InvalidTable(\"Table \".concat(tableName, \" does not exist\"));\n            }\n            return this._allTables[tableName];\n        };\n        return Dexie;\n    }());\n\n    var symbolObservable = typeof Symbol !== \"undefined\" && \"observable\" in Symbol\n        ? Symbol.observable\n        : \"@@observable\";\n    var Observable =  (function () {\n        function Observable(subscribe) {\n            this._subscribe = subscribe;\n        }\n        Observable.prototype.subscribe = function (x, error, complete) {\n            return this._subscribe(!x || typeof x === \"function\" ? { next: x, error: error, complete: complete } : x);\n        };\n        Observable.prototype[symbolObservable] = function () {\n            return this;\n        };\n        return Observable;\n    }());\n\n    var domDeps;\n    try {\n        domDeps = {\n            indexedDB: _global.indexedDB || _global.mozIndexedDB || _global.webkitIndexedDB || _global.msIndexedDB,\n            IDBKeyRange: _global.IDBKeyRange || _global.webkitIDBKeyRange\n        };\n    }\n    catch (e) {\n        domDeps = { indexedDB: null, IDBKeyRange: null };\n    }\n\n    function liveQuery(querier) {\n        var hasValue = false;\n        var currentValue;\n        var observable = new Observable(function (observer) {\n            var scopeFuncIsAsync = isAsyncFunction(querier);\n            function execute(ctx) {\n                var wasRootExec = beginMicroTickScope();\n                try {\n                    if (scopeFuncIsAsync) {\n                        incrementExpectedAwaits();\n                    }\n                    var rv = newScope(querier, ctx);\n                    if (scopeFuncIsAsync) {\n                        rv = rv.finally(decrementExpectedAwaits);\n                    }\n                    return rv;\n                }\n                finally {\n                    wasRootExec && endMicroTickScope();\n                }\n            }\n            var closed = false;\n            var abortController;\n            var accumMuts = {};\n            var currentObs = {};\n            var subscription = {\n                get closed() {\n                    return closed;\n                },\n                unsubscribe: function () {\n                    if (closed)\n                        return;\n                    closed = true;\n                    if (abortController)\n                        abortController.abort();\n                    if (startedListening)\n                        globalEvents.storagemutated.unsubscribe(mutationListener);\n                },\n            };\n            observer.start && observer.start(subscription);\n            var startedListening = false;\n            var doQuery = function () { return execInGlobalContext(_doQuery); };\n            function shouldNotify() {\n                return obsSetsOverlap(currentObs, accumMuts);\n            }\n            var mutationListener = function (parts) {\n                extendObservabilitySet(accumMuts, parts);\n                if (shouldNotify()) {\n                    doQuery();\n                }\n            };\n            var _doQuery = function () {\n                if (closed ||\n                    !domDeps.indexedDB)\n                 {\n                    return;\n                }\n                accumMuts = {};\n                var subscr = {};\n                if (abortController)\n                    abortController.abort();\n                abortController = new AbortController();\n                var ctx = {\n                    subscr: subscr,\n                    signal: abortController.signal,\n                    requery: doQuery,\n                    querier: querier,\n                    trans: null\n                };\n                var ret = execute(ctx);\n                Promise.resolve(ret).then(function (result) {\n                    hasValue = true;\n                    currentValue = result;\n                    if (closed || ctx.signal.aborted) {\n                        return;\n                    }\n                    accumMuts = {};\n                    currentObs = subscr;\n                    if (!objectIsEmpty(currentObs) && !startedListening) {\n                        globalEvents(DEXIE_STORAGE_MUTATED_EVENT_NAME, mutationListener);\n                        startedListening = true;\n                    }\n                    execInGlobalContext(function () { return !closed && observer.next && observer.next(result); });\n                }, function (err) {\n                    hasValue = false;\n                    if (!['DatabaseClosedError', 'AbortError'].includes(err === null || err === void 0 ? void 0 : err.name)) {\n                        if (!closed)\n                            execInGlobalContext(function () {\n                                if (closed)\n                                    return;\n                                observer.error && observer.error(err);\n                            });\n                    }\n                });\n            };\n            setTimeout(doQuery, 0);\n            return subscription;\n        });\n        observable.hasValue = function () { return hasValue; };\n        observable.getValue = function () { return currentValue; };\n        return observable;\n    }\n\n    var Dexie = Dexie$1;\n    props(Dexie, __assign(__assign({}, fullNameExceptions), {\n        delete: function (databaseName) {\n            var db = new Dexie(databaseName, { addons: [] });\n            return db.delete();\n        },\n        exists: function (name) {\n            return new Dexie(name, { addons: [] }).open().then(function (db) {\n                db.close();\n                return true;\n            }).catch('NoSuchDatabaseError', function () { return false; });\n        },\n        getDatabaseNames: function (cb) {\n            try {\n                return getDatabaseNames(Dexie.dependencies).then(cb);\n            }\n            catch (_a) {\n                return rejection(new exceptions.MissingAPI());\n            }\n        },\n        defineClass: function () {\n            function Class(content) {\n                extend(this, content);\n            }\n            return Class;\n        }, ignoreTransaction: function (scopeFunc) {\n            return PSD.trans ?\n                usePSD(PSD.transless, scopeFunc) :\n                scopeFunc();\n        }, vip: vip, async: function (generatorFn) {\n            return function () {\n                try {\n                    var rv = awaitIterator(generatorFn.apply(this, arguments));\n                    if (!rv || typeof rv.then !== 'function')\n                        return DexiePromise.resolve(rv);\n                    return rv;\n                }\n                catch (e) {\n                    return rejection(e);\n                }\n            };\n        }, spawn: function (generatorFn, args, thiz) {\n            try {\n                var rv = awaitIterator(generatorFn.apply(thiz, args || []));\n                if (!rv || typeof rv.then !== 'function')\n                    return DexiePromise.resolve(rv);\n                return rv;\n            }\n            catch (e) {\n                return rejection(e);\n            }\n        },\n        currentTransaction: {\n            get: function () { return PSD.trans || null; }\n        }, waitFor: function (promiseOrFunction, optionalTimeout) {\n            var promise = DexiePromise.resolve(typeof promiseOrFunction === 'function' ?\n                Dexie.ignoreTransaction(promiseOrFunction) :\n                promiseOrFunction)\n                .timeout(optionalTimeout || 60000);\n            return PSD.trans ?\n                PSD.trans.waitFor(promise) :\n                promise;\n        },\n        Promise: DexiePromise,\n        debug: {\n            get: function () { return debug; },\n            set: function (value) {\n                setDebug(value);\n            }\n        },\n        derive: derive, extend: extend, props: props, override: override,\n        Events: Events, on: globalEvents, liveQuery: liveQuery, extendObservabilitySet: extendObservabilitySet,\n        getByKeyPath: getByKeyPath, setByKeyPath: setByKeyPath, delByKeyPath: delByKeyPath, shallowClone: shallowClone, deepClone: deepClone, getObjectDiff: getObjectDiff, cmp: cmp, asap: asap$1,\n        minKey: minKey,\n        addons: [],\n        connections: connections,\n        errnames: errnames,\n        dependencies: domDeps, cache: cache,\n        semVer: DEXIE_VERSION, version: DEXIE_VERSION.split('.')\n            .map(function (n) { return parseInt(n); })\n            .reduce(function (p, c, i) { return p + (c / Math.pow(10, i * 2)); }) }));\n    Dexie.maxKey = getMaxKey(Dexie.dependencies.IDBKeyRange);\n\n    if (typeof dispatchEvent !== 'undefined' && typeof addEventListener !== 'undefined') {\n        globalEvents(DEXIE_STORAGE_MUTATED_EVENT_NAME, function (updatedParts) {\n            if (!propagatingLocally) {\n                var event_1;\n                event_1 = new CustomEvent(STORAGE_MUTATED_DOM_EVENT_NAME, {\n                    detail: updatedParts\n                });\n                propagatingLocally = true;\n                dispatchEvent(event_1);\n                propagatingLocally = false;\n            }\n        });\n        addEventListener(STORAGE_MUTATED_DOM_EVENT_NAME, function (_a) {\n            var detail = _a.detail;\n            if (!propagatingLocally) {\n                propagateLocally(detail);\n            }\n        });\n    }\n    function propagateLocally(updateParts) {\n        var wasMe = propagatingLocally;\n        try {\n            propagatingLocally = true;\n            globalEvents.storagemutated.fire(updateParts);\n            signalSubscribersNow(updateParts, true);\n        }\n        finally {\n            propagatingLocally = wasMe;\n        }\n    }\n    var propagatingLocally = false;\n\n    var bc;\n    var createBC = function () { };\n    if (typeof BroadcastChannel !== 'undefined') {\n        createBC = function () {\n            bc = new BroadcastChannel(STORAGE_MUTATED_DOM_EVENT_NAME);\n            bc.onmessage = function (ev) { return ev.data && propagateLocally(ev.data); };\n        };\n        createBC();\n        if (typeof bc.unref === 'function') {\n            bc.unref();\n        }\n        globalEvents(DEXIE_STORAGE_MUTATED_EVENT_NAME, function (changedParts) {\n            if (!propagatingLocally) {\n                bc.postMessage(changedParts);\n            }\n        });\n    }\n\n    if (typeof addEventListener !== 'undefined') {\n        addEventListener('pagehide', function (event) {\n            if (!Dexie$1.disableBfCache && event.persisted) {\n                if (debug)\n                    console.debug('Dexie: handling persisted pagehide');\n                bc === null || bc === void 0 ? void 0 : bc.close();\n                for (var _i = 0, connections_1 = connections; _i < connections_1.length; _i++) {\n                    var db = connections_1[_i];\n                    db.close({ disableAutoOpen: false });\n                }\n            }\n        });\n        addEventListener('pageshow', function (event) {\n            if (!Dexie$1.disableBfCache && event.persisted) {\n                if (debug)\n                    console.debug('Dexie: handling persisted pageshow');\n                createBC();\n                propagateLocally({ all: new RangeSet(-Infinity, [[]]) });\n            }\n        });\n    }\n\n    function add(value) {\n        return new PropModification({ add: value });\n    }\n\n    function remove(value) {\n        return new PropModification({ remove: value });\n    }\n\n    function replacePrefix(a, b) {\n        return new PropModification({ replacePrefix: [a, b] });\n    }\n\n    DexiePromise.rejectionMapper = mapError;\n    setDebug(debug);\n\n    var namedExports = /*#__PURE__*/Object.freeze({\n        __proto__: null,\n        Dexie: Dexie$1,\n        liveQuery: liveQuery,\n        Entity: Entity,\n        cmp: cmp,\n        PropModification: PropModification,\n        replacePrefix: replacePrefix,\n        add: add,\n        remove: remove,\n        'default': Dexie$1,\n        RangeSet: RangeSet,\n        mergeRanges: mergeRanges,\n        rangesOverlap: rangesOverlap\n    });\n\n    __assign(Dexie$1, namedExports, { default: Dexie$1 });\n\n    return Dexie$1;\n\n}));\n//# sourceMappingURL=dexie.js.map\n","// Making the module version consumable via require - to prohibit\n// multiple occurrancies of the same module in the same app\n// (dual package hazard, https://nodejs.org/api/packages.html#dual-package-hazard)\nimport _Dexie from \"./dist/dexie.js\";\nconst DexieSymbol = Symbol.for(\"Dexie\");\nconst Dexie = globalThis[DexieSymbol] || (globalThis[DexieSymbol] = _Dexie);\nif (_Dexie.semVer !== Dexie.semVer) {\n    throw new Error(`Two different versions of Dexie loaded in the same app: ${_Dexie.semVer} and ${Dexie.semVer}`);\n}\nconst { liveQuery, mergeRanges, rangesOverlap, RangeSet, cmp, Entity,\n    PropModification, replacePrefix, add, remove } = Dexie;\nexport { liveQuery, mergeRanges, rangesOverlap, RangeSet, cmp, Dexie, Entity,\n    PropModification, replacePrefix, add, remove };\nexport default Dexie;\n","import Dexie, { Table } from 'dexie';\r\nimport { Trade } from '../types/trade';\r\n\r\n// Database interfaces\r\nexport interface TradeRecord extends Trade {\r\n  id: string;\r\n  createdAt?: Date;\r\n  updatedAt?: Date;\r\n}\r\n\r\nexport interface TradeSettings {\r\n  id?: number;\r\n  search_query?: string;\r\n  status_filter?: string;\r\n  sort_descriptor?: any;\r\n  visible_columns?: string[];\r\n  updatedAt?: Date;\r\n}\r\n\r\nexport interface UserPreferences {\r\n  id?: number;\r\n  is_mobile_menu_open?: boolean;\r\n  is_profile_open?: boolean;\r\n  user_name?: string;\r\n  is_full_width_enabled?: boolean;\r\n  accounting_method?: string;\r\n  theme?: string;\r\n  updatedAt?: Date;\r\n}\r\n\r\nexport interface PortfolioData {\r\n  id?: number;\r\n  type: 'yearly_capital' | 'capital_change' | 'monthly_override';\r\n  year?: number;\r\n  month?: string;\r\n  amount: number;\r\n  date?: string;\r\n  description?: string;\r\n  updatedAt?: Date;\r\n}\r\n\r\nexport interface TaxData {\r\n  id?: number;\r\n  year: number;\r\n  data: any;\r\n  updatedAt?: Date;\r\n}\r\n\r\nexport interface CommentaryData {\r\n  id?: number;\r\n  year: string;\r\n  data: any;\r\n  updatedAt?: Date;\r\n}\r\n\r\nexport interface DashboardConfig {\r\n  id?: number;\r\n  config: any;\r\n  updatedAt?: Date;\r\n}\r\n\r\nexport interface MilestonesData {\r\n  id?: number;\r\n  achievements: any[];\r\n  updatedAt?: Date;\r\n}\r\n\r\nexport interface MiscData {\r\n  id?: number;\r\n  key: string;\r\n  value: any;\r\n  updatedAt?: Date;\r\n}\r\n\r\nexport interface BackupRecord {\r\n  id?: number;\r\n  type: 'trades' | 'settings' | 'preferences' | 'portfolio' | 'tax' | 'dashboard' | 'milestones' | 'misc' | 'chartImages';\r\n  data: any;\r\n  createdAt: Date;\r\n  description?: string;\r\n}\r\n\r\n// Chart image blob storage interface\r\nexport interface ChartImageBlob {\r\n  id: string;\r\n  tradeId: string;\r\n  imageType: 'beforeEntry' | 'afterExit';\r\n  filename: string;\r\n  mimeType: string;\r\n  size: number;\r\n  data: Blob;\r\n  uploadedAt: Date;\r\n  compressed: boolean;\r\n  originalSize?: number;\r\n}\r\n\r\n// Dexie Database Class\r\nexport class TradeJournalDB extends Dexie {\r\n  // Tables\r\n  trades!: Table<TradeRecord>;\r\n  tradeSettings!: Table<TradeSettings>;\r\n  userPreferences!: Table<UserPreferences>;\r\n  portfolioData!: Table<PortfolioData>;\r\n  taxData!: Table<TaxData>;\r\n  commentaryData!: Table<CommentaryData>;\r\n  dashboardConfig!: Table<DashboardConfig>;\r\n  milestonesData!: Table<MilestonesData>;\r\n  miscData!: Table<MiscData>;\r\n  backups!: Table<BackupRecord>;\r\n  chartImageBlobs!: Table<ChartImageBlob>; // NEW: Separate table for chart image blobs\r\n\r\n  constructor() {\r\n    super('TradeJournalDB');\r\n\r\n    // Define schemas - Version 1 (Original)\r\n    this.version(1).stores({\r\n      trades: 'id, name, date, tradeNo, positionStatus, buySell, setup, createdAt, updatedAt',\r\n      tradeSettings: '++id, updatedAt',\r\n      userPreferences: '++id, updatedAt',\r\n      portfolioData: '++id, type, year, month, date, updatedAt',\r\n      taxData: '++id, year, updatedAt',\r\n      commentaryData: '++id, year, updatedAt',\r\n      dashboardConfig: '++id, updatedAt',\r\n      milestonesData: '++id, updatedAt',\r\n      miscData: '++id, key, updatedAt',\r\n      backups: '++id, type, createdAt'\r\n    });\r\n\r\n    // Version 2 - Add Chart Attachments Support\r\n    this.version(2).stores({\r\n      trades: 'id, name, date, tradeNo, positionStatus, buySell, setup, createdAt, updatedAt',\r\n      tradeSettings: '++id, updatedAt',\r\n      userPreferences: '++id, updatedAt',\r\n      portfolioData: '++id, type, year, month, date, updatedAt',\r\n      taxData: '++id, year, updatedAt',\r\n      commentaryData: '++id, year, updatedAt',\r\n      dashboardConfig: '++id, updatedAt',\r\n      milestonesData: '++id, updatedAt',\r\n      miscData: '++id, key, updatedAt',\r\n      backups: '++id, type, createdAt',\r\n      chartImageBlobs: 'id, tradeId, imageType, uploadedAt' // NEW: Chart image blob storage\r\n    }).upgrade(tx => {\r\n      // The chartImageBlobs table will be created automatically\r\n      // Existing trades will work without modification as chartAttachments field is optional\r\n      return (tx as any).trades.toCollection().modify((trade: any) => {\r\n        // Ensure chartAttachments field exists (optional, for consistency)\r\n        if (trade.chartAttachments === undefined) {\r\n          trade.chartAttachments = undefined;\r\n        }\r\n      });\r\n    });\r\n\r\n    // Add hooks for automatic timestamps\r\n    this.trades.hook('creating', function (primKey, obj, trans) {\r\n      obj.createdAt = new Date();\r\n      obj.updatedAt = new Date();\r\n    });\r\n\r\n    this.trades.hook('updating', function (modifications, primKey, obj, trans) {\r\n      (modifications as any).updatedAt = new Date();\r\n    });\r\n\r\n    // Add hooks for other tables\r\n    [this.tradeSettings, this.userPreferences, this.portfolioData, this.taxData, this.commentaryData, this.dashboardConfig, this.milestonesData, this.miscData, this.backups].forEach(table => {\r\n      table.hook('creating', function (primKey, obj, trans) {\r\n        (obj as any).updatedAt = new Date();\r\n      });\r\n\r\n      table.hook('updating', function (modifications, primKey, obj, trans) {\r\n        (modifications as any).updatedAt = new Date();\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\n// Create database instance\r\nexport const db = new TradeJournalDB();\r\n\r\n// Helper function to clean data for IndexedDB storage\r\nfunction cleanDataForIndexedDB(data: any): any {\r\n  if (data === null || data === undefined) {\r\n    return data;\r\n  }\r\n\r\n  if (typeof data === 'function') {\r\n    return undefined; // Remove functions\r\n  }\r\n\r\n  if (typeof data === 'object') {\r\n    if (Array.isArray(data)) {\r\n      return data.map(item => cleanDataForIndexedDB(item)).filter(item => item !== undefined);\r\n    } else {\r\n      const cleaned: any = {};\r\n      for (const [key, value] of Object.entries(data)) {\r\n        const cleanedValue = cleanDataForIndexedDB(value);\r\n        if (cleanedValue !== undefined) {\r\n          cleaned[key] = cleanedValue;\r\n        }\r\n      }\r\n      return cleaned;\r\n    }\r\n  }\r\n\r\n  return data;\r\n}\r\n\r\n// Database utility functions\r\nexport class DatabaseService {\r\n\r\n  // ===== TRADES =====\r\n\r\n  static async getAllTrades(): Promise<TradeRecord[]> {\r\n    try {\r\n      return await db.trades.orderBy('tradeNo').toArray();\r\n    } catch (error) {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  static async getTrade(id: string): Promise<TradeRecord | null> {\r\n    try {\r\n      const trade = await db.trades.get(id);\r\n      return trade || null;\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async saveTrade(trade: TradeRecord): Promise<boolean> {\r\n    try {\r\n      // Clean trade data to ensure it's serializable\r\n      const cleanedTrade = cleanDataForIndexedDB(trade);\r\n\r\n      await db.trades.put(cleanedTrade);\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  static async saveAllTrades(trades: TradeRecord[]): Promise<boolean> {\r\n    try {\r\n      // Clean trades data to ensure it's serializable\r\n      const cleanedTrades = trades.map(trade => cleanDataForIndexedDB(trade));\r\n\r\n      await (db as any).transaction('rw', (db as any).trades, async () => {\r\n        // Clear existing trades and add new ones\r\n        await (db as any).trades.clear();\r\n        await (db as any).trades.bulkAdd(cleanedTrades);\r\n      });\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  static async deleteTrade(id: string): Promise<boolean> {\r\n    try {\r\n      await db.trades.delete(id);\r\n\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // ===== SETTINGS =====\r\n\r\n  static async getTradeSettings(): Promise<TradeSettings | null> {\r\n    try {\r\n      const allSettings = await db.tradeSettings.toArray();\r\n      if (allSettings.length === 0) return null;\r\n\r\n      // Sort by updatedAt and return the latest\r\n      allSettings.sort((a, b) => (b.updatedAt?.getTime() || 0) - (a.updatedAt?.getTime() || 0));\r\n      return allSettings[0];\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async saveTradeSettings(settings: TradeSettings): Promise<boolean> {\r\n    try {\r\n      // Keep only the latest settings record\r\n      await db.transaction('rw', db.tradeSettings, async () => {\r\n        await db.tradeSettings.clear();\r\n        await db.tradeSettings.add(settings);\r\n      });\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // ===== USER PREFERENCES =====\r\n\r\n  static async getUserPreferences(): Promise<UserPreferences | null> {\r\n    try {\r\n      const allPrefs = await db.userPreferences.toArray();\r\n      if (allPrefs.length === 0) return null;\r\n\r\n      // Sort by updatedAt and return the latest\r\n      allPrefs.sort((a, b) => (b.updatedAt?.getTime() || 0) - (a.updatedAt?.getTime() || 0));\r\n      return allPrefs[0];\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async saveUserPreferences(preferences: UserPreferences): Promise<boolean> {\r\n    try {\r\n      // Keep only the latest preferences record\r\n      await db.transaction('rw', db.userPreferences, async () => {\r\n        await db.userPreferences.clear();\r\n        await db.userPreferences.add(preferences);\r\n      });\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // ===== PORTFOLIO DATA =====\r\n\r\n  static async getPortfolioData(): Promise<PortfolioData[]> {\r\n    try {\r\n      return await db.portfolioData.toArray();\r\n    } catch (error) {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  static async savePortfolioData(data: PortfolioData[]): Promise<boolean> {\r\n    try {\r\n      await db.transaction('rw', db.portfolioData, async () => {\r\n        await db.portfolioData.clear();\r\n        await db.portfolioData.bulkAdd(data);\r\n      });\r\n\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // ===== BACKUPS =====\r\n\r\n  static async createBackup(type: 'trades' | 'settings' | 'preferences' | 'portfolio' | 'tax' | 'dashboard' | 'milestones' | 'misc', data: any, description?: string): Promise<boolean> {\r\n    try {\r\n      // Clean data before storing\r\n      const cleanedData = cleanDataForIndexedDB(data);\r\n\r\n      await db.backups.add({\r\n        type,\r\n        data: cleanedData,\r\n        createdAt: new Date(),\r\n        description\r\n      });\r\n\r\n      // Keep only the 5 most recent backups per type\r\n      const allBackups = await db.backups.where('type').equals(type).toArray();\r\n      // Sort by createdAt in memory since we can't chain orderBy after where().equals()\r\n      allBackups.sort((a, b) => a.createdAt.getTime() - b.createdAt.getTime());\r\n\r\n      if (allBackups.length > 5) {\r\n        const toDelete = allBackups.slice(0, -5);\r\n        await db.backups.bulkDelete(toDelete.map(b => b.id!));\r\n      }\r\n\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  static async getLatestBackup(type: 'trades' | 'settings' | 'preferences' | 'portfolio' | 'tax' | 'dashboard' | 'milestones' | 'misc'): Promise<BackupRecord | null> {\r\n    try {\r\n      const backups = await db.backups.where('type').equals(type).toArray();\r\n      if (backups.length === 0) return null;\r\n\r\n      // Sort by createdAt and return the latest\r\n      backups.sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime());\r\n      return backups[0];\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // ===== TAX DATA =====\r\n\r\n  static async getTaxData(year: number): Promise<TaxData | null> {\r\n    try {\r\n      return await db.taxData.where('year').equals(year).first() || null;\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async saveTaxData(year: number, data: any): Promise<boolean> {\r\n    try {\r\n      await db.taxData.put({ year, data });\r\n\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // ===== COMMENTARY DATA =====\r\n\r\n  static async getCommentaryData(year: string): Promise<CommentaryData | null> {\r\n    try {\r\n      return await db.commentaryData.where('year').equals(year).first() || null;\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async saveCommentaryData(year: string, data: any): Promise<boolean> {\r\n    try {\r\n      await db.commentaryData.put({ year, data });\r\n\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // ===== DASHBOARD CONFIG =====\r\n\r\n  static async getDashboardConfig(): Promise<DashboardConfig | null> {\r\n    try {\r\n      const allConfigs = await db.dashboardConfig.toArray();\r\n      if (allConfigs.length === 0) return null;\r\n\r\n      // Sort by updatedAt and return the latest\r\n      allConfigs.sort((a, b) => (b.updatedAt?.getTime() || 0) - (a.updatedAt?.getTime() || 0));\r\n      return allConfigs[0];\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async saveDashboardConfig(config: any): Promise<boolean> {\r\n    try {\r\n      await db.transaction('rw', db.dashboardConfig, async () => {\r\n        await db.dashboardConfig.clear();\r\n        await db.dashboardConfig.add({ config });\r\n      });\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // ===== MILESTONES DATA =====\r\n\r\n  static async getMilestonesData(): Promise<MilestonesData | null> {\r\n    try {\r\n      const allMilestones = await db.milestonesData.toArray();\r\n      if (allMilestones.length === 0) return null;\r\n\r\n      // Sort by updatedAt and return the latest\r\n      allMilestones.sort((a, b) => (b.updatedAt?.getTime() || 0) - (a.updatedAt?.getTime() || 0));\r\n      return allMilestones[0];\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async saveMilestonesData(achievements: any[]): Promise<boolean> {\r\n    try {\r\n      // Clean achievements data to remove functions and non-serializable data\r\n      const cleanedAchievements = cleanDataForIndexedDB(achievements);\r\n\r\n      await db.transaction('rw', db.milestonesData, async () => {\r\n        await db.milestonesData.clear();\r\n        await db.milestonesData.add({ achievements: cleanedAchievements });\r\n      });\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // ===== MISC DATA =====\r\n\r\n  static async getMiscData(key: string): Promise<any> {\r\n    try {\r\n      const record = await db.miscData.where('key').equals(key).first();\r\n      return record ? record.value : null;\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async saveMiscData(key: string, value: any): Promise<boolean> {\r\n    try {\r\n      // Clean the value to ensure it's serializable for IndexedDB\r\n      const cleanedValue = cleanDataForIndexedDB(value);\r\n\r\n      if (cleanedValue === undefined) {\r\n        return false;\r\n      }\r\n\r\n      await db.miscData.put({ key, value: cleanedValue });\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  static async deleteMiscData(key: string): Promise<boolean> {\r\n    try {\r\n      await db.miscData.where('key').equals(key).delete();\r\n\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // ===== CHART IMAGE BLOBS =====\r\n\r\n  static async saveChartImageBlob(imageBlob: ChartImageBlob): Promise<boolean> {\r\n    try {\r\n\r\n      // Validate blob data before saving\r\n      if (!imageBlob.data || !(imageBlob.data instanceof Blob)) {\r\n\r\n        return false;\r\n      }\r\n\r\n      if (imageBlob.data.size === 0) {\r\n\r\n        return false;\r\n      }\r\n\r\n      await db.chartImageBlobs.put(imageBlob);\r\n\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  static async getChartImageBlob(id: string): Promise<ChartImageBlob | null> {\r\n    try {\r\n\r\n      const blob = await db.chartImageBlobs.get(id);\r\n\r\n      if (blob) {\r\n\r\n        // Validate the blob data\r\n        if (!blob.data || !(blob.data instanceof Blob)) {\r\n\r\n          return null;\r\n        }\r\n\r\n        if (blob.data.size === 0) {\r\n\r\n          return null;\r\n        }\r\n      } else {\r\n\r\n      }\r\n\r\n      return blob || null;\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async getAllChartImageBlobs(): Promise<ChartImageBlob[]> {\r\n    try {\r\n      return await db.chartImageBlobs.toArray();\r\n    } catch (error) {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  static async getTradeChartImageBlobs(tradeId: string): Promise<ChartImageBlob[]> {\r\n    try {\r\n      return await db.chartImageBlobs.where('tradeId').equals(tradeId).toArray();\r\n    } catch (error) {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  static async deleteChartImageBlob(id: string): Promise<boolean> {\r\n    try {\r\n      await db.chartImageBlobs.delete(id);\r\n\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  static async updateChartImageBlobTradeId(blobId: string, newTradeId: string): Promise<boolean> {\r\n    try {\r\n      const blob = await db.chartImageBlobs.get(blobId);\r\n      if (!blob) {\r\n\r\n        return false;\r\n      }\r\n\r\n      await db.chartImageBlobs.update(blobId, { tradeId: newTradeId });\r\n\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  static async deleteTradeChartImageBlobs(tradeId: string): Promise<boolean> {\r\n    try {\r\n      const count = await db.chartImageBlobs.where('tradeId').equals(tradeId).delete();\r\n\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  static async getChartImageBlobsSize(): Promise<number> {\r\n    try {\r\n      const blobs = await db.chartImageBlobs.toArray();\r\n      return blobs.reduce((total, blob) => total + blob.size, 0);\r\n    } catch (error) {\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  // ===== CHART IMAGE CLEANUP UTILITIES =====\r\n\r\n  static async clearAllChartImages(): Promise<boolean> {\r\n    try {\r\n      await db.chartImageBlobs.clear();\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  static async getOrphanedChartImages(): Promise<ChartImageBlob[]> {\r\n    try {\r\n      const [blobs, trades] = await Promise.all([\r\n        db.chartImageBlobs.toArray(),\r\n        db.trades.toArray()\r\n      ]);\r\n\r\n      const tradeIds = new Set(trades.map(trade => trade.id));\r\n      const orphanedBlobs = blobs.filter(blob => !tradeIds.has(blob.tradeId));\r\n\r\n      return orphanedBlobs;\r\n    } catch (error) {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  static async cleanupOrphanedChartImages(): Promise<number> {\r\n    try {\r\n      const orphanedBlobs = await this.getOrphanedChartImages();\r\n\r\n      if (orphanedBlobs.length === 0) {\r\n        return 0;\r\n      }\r\n\r\n      const orphanedIds = orphanedBlobs.map(blob => blob.id);\r\n      await db.chartImageBlobs.bulkDelete(orphanedIds);\r\n\r\n      return orphanedBlobs.length;\r\n    } catch (error) {\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  static async inspectChartImageDatabase(): Promise<void> {\r\n    try {\r\n      const [blobs, trades] = await Promise.all([\r\n        db.chartImageBlobs.toArray(),\r\n        db.trades.toArray()\r\n      ]);\r\n\r\n      const tradeIds = new Set(trades.map(trade => trade.id));\r\n      const orphanedBlobs = blobs.filter(blob => !tradeIds.has(blob.tradeId));\r\n      const validBlobs = blobs.filter(blob => tradeIds.has(blob.tradeId));\r\n\r\n      if (orphanedBlobs.length > 0) {\r\n        // Found orphaned blobs - could clean them up here if needed\r\n      }\r\n\r\n      if (validBlobs.length > 0) {\r\n        validBlobs.forEach(blob => {\r\n          const trade = trades.find(t => t.id === blob.tradeId);\r\n          // Found valid blob linked to existing trade\r\n        });\r\n      }\r\n\r\n      } catch (error) {\r\n      }\r\n  }\r\n\r\n  // ===== CHART IMAGE NAVIGATION =====\r\n\r\n  static async getAllChartImageBlobsWithTradeInfo(): Promise<Array<ChartImageBlob & { tradeName?: string; tradeDate?: string; tradeNo?: number }>> {\r\n    try {\r\n      const [blobs, trades] = await Promise.all([\r\n        db.chartImageBlobs.orderBy('uploadedAt').toArray(),\r\n        db.trades.toArray()\r\n      ]);\r\n\r\n      // Create a map of tradeId to trade info for quick lookup\r\n      const tradeMap = new Map(trades.map(trade => [trade.id, {\r\n        name: trade.name,\r\n        date: trade.date,\r\n        tradeNo: trade.tradeNo\r\n      }]));\r\n\r\n      // Enhance blobs with trade information\r\n      return blobs.map((blob: any) => {\r\n        const tradeInfo = tradeMap.get(blob.tradeId);\r\n        return {\r\n          ...blob,\r\n          tradeName: tradeInfo?.name,\r\n          tradeDate: tradeInfo?.date,\r\n          tradeNo: tradeInfo?.tradeNo\r\n        };\r\n      });\r\n    } catch (error) {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  static async getFilteredChartImageBlobs(filter: {\r\n    imageType?: 'beforeEntry' | 'afterExit';\r\n    dateFrom?: string;\r\n    dateTo?: string;\r\n    tradeIds?: string[];\r\n  }): Promise<Array<ChartImageBlob & { tradeName?: string; tradeDate?: string; tradeNo?: number }>> {\r\n    try {\r\n      let blobs = await this.getAllChartImageBlobsWithTradeInfo();\r\n\r\n      // Apply filters\r\n      if (filter.imageType) {\r\n        blobs = blobs.filter(blob => blob.imageType === filter.imageType);\r\n      }\r\n\r\n      if (filter.dateFrom || filter.dateTo) {\r\n        blobs = blobs.filter(blob => {\r\n          if (!blob.tradeDate) return false;\r\n          const tradeDate = new Date(blob.tradeDate);\r\n\r\n          if (filter.dateFrom && tradeDate < new Date(filter.dateFrom)) return false;\r\n          if (filter.dateTo && tradeDate > new Date(filter.dateTo)) return false;\r\n\r\n          return true;\r\n        });\r\n      }\r\n\r\n      if (filter.tradeIds && filter.tradeIds.length > 0) {\r\n        blobs = blobs.filter(blob => filter.tradeIds!.includes(blob.tradeId));\r\n      }\r\n\r\n      return blobs;\r\n    } catch (error) {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  // ===== UTILITIES =====\r\n\r\n  static async clearAllData(): Promise<boolean> {\r\n    try {\r\n      await (db as any).transaction('rw', [(db as any).trades, (db as any).tradeSettings, (db as any).userPreferences, (db as any).portfolioData, (db as any).taxData, (db as any).commentaryData, (db as any).dashboardConfig, (db as any).milestonesData, (db as any).miscData, (db as any).chartImageBlobs], async () => {\r\n        await (db as any).trades.clear();\r\n        await (db as any).tradeSettings.clear();\r\n        await (db as any).userPreferences.clear();\r\n        await (db as any).portfolioData.clear();\r\n        await (db as any).taxData.clear();\r\n        await (db as any).commentaryData.clear();\r\n        await (db as any).dashboardConfig.clear();\r\n        await (db as any).milestonesData.clear();\r\n        await (db as any).miscData.clear();\r\n        await (db as any).chartImageBlobs.clear();\r\n      });\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  static async getDatabaseSize(): Promise<{ trades: number; chartImages: number; total: number }> {\r\n    try {\r\n      const tradesCount = await db.trades.count();\r\n      const settingsCount = await db.tradeSettings.count();\r\n      const prefsCount = await db.userPreferences.count();\r\n      const portfolioCount = await db.portfolioData.count();\r\n      const taxCount = await db.taxData.count();\r\n      const commentaryCount = await db.commentaryData.count();\r\n      const dashboardCount = await db.dashboardConfig.count();\r\n      const milestonesCount = await db.milestonesData.count();\r\n      const miscCount = await db.miscData.count();\r\n      const backupsCount = await db.backups.count();\r\n      const chartImagesCount = await db.chartImageBlobs.count();\r\n\r\n      return {\r\n        trades: tradesCount,\r\n        chartImages: chartImagesCount,\r\n        total: tradesCount + settingsCount + prefsCount + portfolioCount + taxCount + commentaryCount + dashboardCount + milestonesCount + miscCount + backupsCount + chartImagesCount\r\n      };\r\n    } catch (error) {\r\n      return { trades: 0, chartImages: 0, total: 0 };\r\n    }\r\n  }\r\n}\r\n","import { DatabaseService } from '../db/database'\r\nimport { SupabaseService } from './supabaseService'\r\nimport { AuthService } from './authService'\r\n\r\nexport interface MigrationProgress {\r\n  step: string\r\n  current: number\r\n  total: number\r\n  message: string\r\n  completed: boolean\r\n  error?: string\r\n}\r\n\r\nexport type MigrationProgressCallback = (progress: MigrationProgress) => void\r\n\r\nexport class MigrationService {\r\n  /**\r\n   * Migrate all data from IndexedDB to Supabase\r\n   */\r\n  static async migrateToSupabase(\r\n    onProgress?: MigrationProgressCallback\r\n  ): Promise<{ success: boolean; error?: string }> {\r\n    try {\r\n      // Check if user is authenticated\r\n      const isAuthenticated = await AuthService.isAuthenticated()\r\n      if (!isAuthenticated) {\r\n        return { success: false, error: 'User must be authenticated to migrate data' }\r\n      }\r\n\r\n      const steps = [\r\n        'trades',\r\n        'userPreferences',\r\n        'portfolioData',\r\n        'taxData',\r\n        'milestonesData',\r\n        'miscData',\r\n        'chartImageBlobs'\r\n      ]\r\n\r\n      let currentStep = 0\r\n      const totalSteps = steps.length\r\n\r\n      const updateProgress = (step: string, message: string, error?: string) => {\r\n        if (onProgress) {\r\n          onProgress({\r\n            step,\r\n            current: currentStep,\r\n            total: totalSteps,\r\n            message,\r\n            completed: currentStep === totalSteps,\r\n            error\r\n          })\r\n        }\r\n      }\r\n\r\n      // Step 1: Migrate Trades\r\n      currentStep++\r\n      updateProgress('trades', 'Migrating trades...')\r\n\r\n      try {\r\n        const trades = await DatabaseService.getAllTrades()\r\n\r\n        if (trades.length > 0) {\r\n          const success = await SupabaseService.saveAllTrades(trades)\r\n          if (!success) {\r\n            throw new Error('Failed to save trades to Supabase')\r\n          }\r\n        }\r\n\r\n        } catch (error) {\r\n        const errorMsg = `Failed to migrate trades: ${error}`\r\n        updateProgress('trades', errorMsg, errorMsg)\r\n        return { success: false, error: errorMsg }\r\n      }\r\n\r\n      // Step 2: Migrate User Preferences\r\n      currentStep++\r\n      updateProgress('userPreferences', 'Migrating user preferences...')\r\n\r\n      try {\r\n        const preferences = await DatabaseService.getUserPreferences()\r\n        if (preferences) {\r\n          const success = await SupabaseService.saveUserPreferences(preferences)\r\n          if (!success) {\r\n            throw new Error('Failed to save user preferences to Supabase')\r\n          }\r\n        }\r\n        } catch (error) {\r\n        const errorMsg = `Failed to migrate user preferences: ${error}`\r\n        updateProgress('userPreferences', errorMsg, errorMsg)\r\n        return { success: false, error: errorMsg }\r\n      }\r\n\r\n      // Step 3: Migrate Portfolio Data\r\n      currentStep++\r\n      updateProgress('portfolioData', 'Migrating portfolio data...')\r\n\r\n      try {\r\n        const portfolioData = await DatabaseService.getPortfolioData()\r\n        if (portfolioData && portfolioData.length > 0) {\r\n          const success = await SupabaseService.savePortfolioData(portfolioData)\r\n          if (!success) {\r\n            throw new Error('Failed to save portfolio data to Supabase')\r\n          }\r\n        }\r\n        } catch (error) {\r\n        const errorMsg = `Failed to migrate portfolio data: ${error}`\r\n        updateProgress('portfolioData', errorMsg, errorMsg)\r\n        return { success: false, error: errorMsg }\r\n      }\r\n\r\n      // Step 4: Migrate Tax Data\r\n      currentStep++\r\n      updateProgress('taxData', 'Migrating tax data...')\r\n\r\n      try {\r\n        const taxData = await DatabaseService.getTaxData(new Date().getFullYear())\r\n        if (taxData) {\r\n          const success = await SupabaseService.saveTaxData(taxData.year, taxData.data)\r\n          if (!success) {\r\n            throw new Error(`Failed to save tax data for year ${taxData.year}`)\r\n          }\r\n        }\r\n        } catch (error) {\r\n        const errorMsg = `Failed to migrate tax data: ${error}`\r\n        updateProgress('taxData', errorMsg, errorMsg)\r\n        return { success: false, error: errorMsg }\r\n      }\r\n\r\n      // Step 5: Migrate Milestones Data\r\n      currentStep++\r\n      updateProgress('milestonesData', 'Migrating milestones data...')\r\n\r\n      try {\r\n        const milestonesData = await DatabaseService.getMilestonesData()\r\n        if (milestonesData && milestonesData.achievements) {\r\n          const success = await SupabaseService.saveMilestonesData(milestonesData.achievements)\r\n          if (!success) {\r\n            throw new Error('Failed to save milestones data to Supabase')\r\n          }\r\n        }\r\n        } catch (error) {\r\n        const errorMsg = `Failed to migrate milestones data: ${error}`\r\n        updateProgress('milestonesData', errorMsg, errorMsg)\r\n        return { success: false, error: errorMsg }\r\n      }\r\n\r\n      // Step 6: Migrate Misc Data\r\n      currentStep++\r\n      updateProgress('miscData', 'Migrating miscellaneous data...')\r\n\r\n      try {\r\n        // Get all misc data keys and migrate them\r\n        const miscKeys = [\r\n          'tradeSettings',\r\n          'dashboardConfig',\r\n          'commentaryData',\r\n          'globalFilters',\r\n          'chartSettings'\r\n        ]\r\n\r\n        for (const key of miscKeys) {\r\n          try {\r\n            const data = await DatabaseService.getMiscData(key)\r\n            if (data !== null) {\r\n              const success = await SupabaseService.saveMiscData(key, data)\r\n              if (!success) {\r\n                }\r\n            }\r\n          } catch (error) {\r\n            }\r\n        }\r\n        } catch (error) {\r\n        const errorMsg = `Failed to migrate miscellaneous data: ${error}`\r\n        updateProgress('miscData', errorMsg, errorMsg)\r\n        return { success: false, error: errorMsg }\r\n      }\r\n\r\n      // Step 7: Migrate Chart Image Blobs\r\n      currentStep++\r\n      updateProgress('chartImageBlobs', 'Migrating chart images...')\r\n\r\n      try {\r\n        const chartBlobs = await DatabaseService.getAllChartImageBlobs()\r\n\r\n        for (const blob of chartBlobs) {\r\n          const success = await SupabaseService.saveChartImageBlob(blob)\r\n          if (!success) {\r\n            }\r\n        }\r\n        } catch (error) {\r\n        const errorMsg = `Failed to migrate chart images: ${error}`\r\n        updateProgress('chartImageBlobs', errorMsg, errorMsg)\r\n        return { success: false, error: errorMsg }\r\n      }\r\n\r\n      // Migration completed successfully\r\n      updateProgress('completed', 'Migration completed successfully!')\r\n      return { success: true }\r\n\r\n    } catch (error) {\r\n      const errorMsg = `Migration failed: ${error}`\r\n      if (onProgress) {\r\n        onProgress({\r\n          step: 'error',\r\n          current: 0,\r\n          total: 0,\r\n          message: errorMsg,\r\n          completed: false,\r\n          error: errorMsg\r\n        })\r\n      }\r\n\r\n      return { success: false, error: errorMsg }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if there's existing data in IndexedDB that can be migrated\r\n   * Only show migration for users with substantial data (trades, charts, portfolio)\r\n   * NOT for users who only have preferences\r\n   */\r\n  static async hasDataToMigrate(): Promise<boolean> {\r\n    try {\r\n      const [trades, chartBlobs, portfolioData] = await Promise.all([\r\n        DatabaseService.getAllTrades(),\r\n        DatabaseService.getAllChartImageBlobs(),\r\n        DatabaseService.getPortfolioData()\r\n      ])\r\n\r\n      // Check if there's any substantial data to migrate\r\n      // Exclude users who only have preferences\r\n      const hasTradeData = trades.length > 0\r\n      const hasChartData = chartBlobs.length > 0\r\n      const hasPortfolioInfo = portfolioData.length > 0\r\n\r\n      // Only show migration if user has trades, charts, or portfolio data\r\n      return hasTradeData || hasChartData || hasPortfolioInfo\r\n    } catch (error) {\r\n      return false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a summary of data that would be migrated\r\n   */\r\n  static async getMigrationSummary(): Promise<{\r\n    trades: number\r\n    chartImages: number\r\n    hasPreferences: boolean\r\n    hasPortfolioData: boolean\r\n  }> {\r\n    try {\r\n      const [trades, chartBlobs, preferences, portfolioData] = await Promise.all([\r\n        DatabaseService.getAllTrades(),\r\n        DatabaseService.getAllChartImageBlobs(),\r\n        DatabaseService.getUserPreferences(),\r\n        DatabaseService.getPortfolioData()\r\n      ])\r\n\r\n      return {\r\n        trades: trades.length,\r\n        chartImages: chartBlobs.length,\r\n        hasPreferences: !!preferences,\r\n        hasPortfolioData: portfolioData.length > 0\r\n      }\r\n    } catch (error) {\r\n      return {\r\n        trades: 0,\r\n        chartImages: 0,\r\n        hasPreferences: false,\r\n        hasPortfolioData: false\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear IndexedDB data after successful migration (optional)\r\n   */\r\n  static async clearIndexedDBData(): Promise<boolean> {\r\n    try {\r\n      await DatabaseService.clearAllData()\r\n      return true\r\n    } catch (error) {\r\n      return false\r\n    }\r\n  }\r\n}\r\n","import React, { useState, useEffect } from 'react'\r\nimport {\r\n  Modal,\r\n  ModalContent,\r\n  ModalHeader,\r\n  ModalBody,\r\n  ModalFooter,\r\n  Button,\r\n  Progress\r\n} from '@heroui/react'\r\nimport { Icon } from '@iconify/react'\r\nimport { motion, AnimatePresence } from 'framer-motion'\r\nimport { MigrationService, MigrationProgress } from '../../services/migrationService'\r\n\r\ninterface MigrationModalProps {\r\n  isOpen: boolean\r\n  onClose: () => void\r\n  onMigrationComplete: () => void\r\n  onNeverShowAgain?: () => void\r\n}\r\n\r\nexport const MigrationModal: React.FC<MigrationModalProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  onMigrationComplete,\r\n  onNeverShowAgain\r\n}) => {\r\n  const [migrationSummary, setMigrationSummary] = useState<any>(null)\r\n  const [isLoading, setIsLoading] = useState(false)\r\n  const [migrationProgress, setMigrationProgress] = useState<MigrationProgress | null>(null)\r\n  const [migrationCompleted, setMigrationCompleted] = useState(false)\r\n  const [migrationError, setMigrationError] = useState<string | null>(null)\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      loadMigrationSummary()\r\n    }\r\n  }, [isOpen])\r\n\r\n  const loadMigrationSummary = async () => {\r\n    try {\r\n      const summary = await MigrationService.getMigrationSummary()\r\n      setMigrationSummary(summary)\r\n    } catch (error) {\r\n      }\r\n  }\r\n\r\n  const handleStartMigration = async () => {\r\n    setIsLoading(true)\r\n    setMigrationError(null)\r\n    setMigrationCompleted(false)\r\n\r\n    const { success, error } = await MigrationService.migrateToSupabase((progress) => {\r\n      setMigrationProgress(progress)\r\n      if (progress.completed) {\r\n        setMigrationCompleted(true)\r\n        setIsLoading(false)\r\n      }\r\n      if (progress.error) {\r\n        setMigrationError(progress.error)\r\n        setIsLoading(false)\r\n      }\r\n    })\r\n\r\n    if (!success && error) {\r\n      setMigrationError(error)\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  const handleComplete = () => {\r\n    onMigrationComplete()\r\n    onClose()\r\n  }\r\n\r\n  const progressPercentage = migrationProgress\r\n    ? Math.round((migrationProgress.current / migrationProgress.total) * 100)\r\n    : 0\r\n\r\n  return (\r\n    <Modal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      size=\"lg\"\r\n      isDismissable={!isLoading}\r\n      hideCloseButton={isLoading}\r\n      classNames={{\r\n        base: \"bg-transparent\",\r\n        backdrop: \"bg-black/50 backdrop-blur-md\",\r\n        wrapper: \"items-center justify-center\",\r\n        body: \"p-0\",\r\n        header: \"p-0\",\r\n        footer: \"p-0\"\r\n      }}\r\n    >\r\n      <ModalContent className=\"bg-white dark:bg-black border border-gray-200 dark:border-gray-700 shadow-2xl\">\r\n        <ModalHeader className=\"p-6 pb-0\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"w-10 h-10 bg-foreground/5 rounded-full flex items-center justify-center\">\r\n                <Icon icon=\"lucide:cloud-upload\" className=\"w-5 h-5 text-foreground\" />\r\n              </div>\r\n              <div>\r\n                <h2 className=\"text-lg font-semibold text-foreground tracking-tight\">\r\n                  Migrate to Cloud Storage\r\n                </h2>\r\n                <p className=\"text-xs text-foreground/60 mt-0.5\">\r\n                  Move your trading data to secure cloud storage\r\n                </p>\r\n              </div>\r\n            </div>\r\n            {!isLoading && (\r\n              <button\r\n                onClick={onClose}\r\n                className=\"w-8 h-8 rounded-full bg-foreground/5 hover:bg-foreground/10 flex items-center justify-center transition-colors\"\r\n              >\r\n                <Icon icon=\"lucide:x\" className=\"w-4 h-4 text-foreground/60\" />\r\n              </button>\r\n            )}\r\n          </div>\r\n        </ModalHeader>\r\n\r\n        <ModalBody className=\"px-6 py-0\">\r\n          <AnimatePresence mode=\"wait\">\r\n            {!migrationCompleted && !migrationError && (\r\n              <motion.div\r\n                initial={{ opacity: 0, y: 10 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                exit={{ opacity: 0, y: -10 }}\r\n                transition={{ duration: 0.15 }}\r\n              >\r\n                {migrationSummary && (\r\n                <div className=\"mb-6\">\r\n                  <h3 className=\"text-sm font-medium text-foreground mb-3\">Data to be migrated:</h3>\r\n                  <div className=\"grid grid-cols-2 gap-3\">\r\n                    <div className=\"flex items-center justify-between p-3 bg-foreground/3 rounded-lg\">\r\n                      <span className=\"text-sm text-foreground/80\">Trades</span>\r\n                      <span className=\"text-sm font-medium text-foreground bg-foreground/10 px-2 py-1 rounded-full\">\r\n                        {migrationSummary.trades}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"flex items-center justify-between p-3 bg-foreground/3 rounded-lg\">\r\n                      <span className=\"text-sm text-foreground/80\">Chart Images</span>\r\n                      <span className=\"text-sm font-medium text-foreground bg-foreground/10 px-2 py-1 rounded-full\">\r\n                        {migrationSummary.chartImages}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"flex items-center justify-between p-3 bg-foreground/3 rounded-lg\">\r\n                      <span className=\"text-sm text-foreground/80\">User Preferences</span>\r\n                      <span className={`text-xs font-medium px-2 py-1 rounded-full ${\r\n                        migrationSummary.hasPreferences\r\n                          ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300'\r\n                          : 'bg-foreground/10 text-foreground/60'\r\n                      }`}>\r\n                        {migrationSummary.hasPreferences ? \"Yes\" : \"No\"}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"flex items-center justify-between p-3 bg-foreground/3 rounded-lg\">\r\n                      <span className=\"text-sm text-foreground/80\">Portfolio Data</span>\r\n                      <span className={`text-xs font-medium px-2 py-1 rounded-full ${\r\n                        migrationSummary.hasPortfolioData\r\n                          ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300'\r\n                          : 'bg-foreground/10 text-foreground/60'\r\n                      }`}>\r\n                        {migrationSummary.hasPortfolioData ? \"Yes\" : \"No\"}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Features */}\r\n              <div className=\"space-y-3\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"w-6 h-6 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center\">\r\n                    <Icon icon=\"lucide:shield-check\" className=\"w-3 h-3 text-green-600 dark:text-green-400\" />\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"text-sm font-medium text-foreground\">Secure & Private</span>\r\n                    <p className=\"text-xs text-foreground/60\">Your data is encrypted and only accessible by you</p>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"w-6 h-6 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center\">\r\n                    <Icon icon=\"lucide:refresh-cw\" className=\"w-3 h-3 text-blue-600 dark:text-blue-400\" />\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"text-sm font-medium text-foreground\">Automatic Sync</span>\r\n                    <p className=\"text-xs text-foreground/60\">Access your data from any device, always up to date</p>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"w-6 h-6 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center\">\r\n                    <Icon icon=\"lucide:hard-drive\" className=\"w-3 h-3 text-purple-600 dark:text-purple-400\" />\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"text-sm font-medium text-foreground\">Backup & Recovery</span>\r\n                    <p className=\"text-xs text-foreground/60\">Never lose your trading data with automatic backups</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {migrationProgress && (\r\n                <motion.div\r\n                  initial={{ opacity: 0, y: 10 }}\r\n                  animate={{ opacity: 1, y: 0 }}\r\n                  className=\"space-y-3 mt-4 pt-4 border-t border-foreground/10\"\r\n                >\r\n                  <div>\r\n                    <div className=\"flex items-center justify-between mb-2\">\r\n                      <span className=\"text-sm font-medium text-foreground\">Migration Progress</span>\r\n                      <span className=\"text-sm font-medium text-foreground\">{progressPercentage}%</span>\r\n                    </div>\r\n                    <div className=\"relative\">\r\n                      <Progress\r\n                        value={progressPercentage}\r\n                        className=\"mb-2\"\r\n                        classNames={{\r\n                          base: \"max-w-full\",\r\n                          track: \"bg-foreground/10\",\r\n                          indicator: \"bg-foreground\"\r\n                        }}\r\n                      />\r\n                    </div>\r\n                    <p className=\"text-xs text-foreground/60\">\r\n                      {migrationProgress.message}\r\n                    </p>\r\n                  </div>\r\n                </motion.div>\r\n              )}\r\n              </motion.div>\r\n            )}\r\n\r\n            {migrationCompleted && (\r\n            <motion.div\r\n              initial={{ opacity: 0, scale: 0.95 }}\r\n              animate={{ opacity: 1, scale: 1 }}\r\n              className=\"text-center py-6\"\r\n            >\r\n              <div className=\"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                <Icon icon=\"lucide:check-circle\" className=\"w-8 h-8 text-green-600 dark:text-green-400\" />\r\n              </div>\r\n              <h3 className=\"text-lg font-semibold text-foreground mb-2\">Migration Completed!</h3>\r\n              <p className=\"text-sm text-foreground/60 mb-4\">\r\n                Your trading data has been successfully migrated to cloud storage.\r\n              </p>\r\n              <div className=\"inline-flex items-center px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-full text-xs font-medium\">\r\n                All data migrated successfully\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n\r\n          {migrationError && (\r\n            <motion.div\r\n              initial={{ opacity: 0, scale: 0.95 }}\r\n              animate={{ opacity: 1, scale: 1 }}\r\n              className=\"text-center py-6\"\r\n            >\r\n              <div className=\"w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                <Icon icon=\"lucide:alert-circle\" className=\"w-8 h-8 text-red-600 dark:text-red-400\" />\r\n              </div>\r\n              <h3 className=\"text-lg font-semibold text-foreground mb-2\">Migration Failed</h3>\r\n              <p className=\"text-sm text-foreground/60 mb-4\">\r\n                {migrationError}\r\n              </p>\r\n              <div className=\"inline-flex items-center px-3 py-1 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded-full text-xs font-medium\">\r\n                Please try again or contact support\r\n              </div>\r\n            </motion.div>\r\n            )}\r\n          </AnimatePresence>\r\n        </ModalBody>\r\n\r\n        <ModalFooter className=\"px-6 pb-6 pt-0\">\r\n          <div className=\"flex items-center justify-between pt-6 border-t border-foreground/10 w-full\">\r\n            {!migrationCompleted && !migrationError && (\r\n              <>\r\n                <div className=\"flex gap-2\">\r\n                  <button\r\n                    onClick={onClose}\r\n                    disabled={isLoading}\r\n                    className=\"px-4 py-2 text-sm font-medium text-foreground/60 hover:text-foreground transition-colors disabled:opacity-50\"\r\n                  >\r\n                    Cancel\r\n                  </button>\r\n                  {onNeverShowAgain && (\r\n                    <button\r\n                      onClick={onNeverShowAgain}\r\n                      disabled={isLoading}\r\n                      className=\"px-4 py-2 text-sm font-medium text-orange-600 dark:text-orange-400 hover:bg-orange-50 dark:hover:bg-orange-900/20 rounded-lg transition-colors disabled:opacity-50\"\r\n                    >\r\n                      Never show again\r\n                    </button>\r\n                  )}\r\n                </div>\r\n                <button\r\n                  onClick={handleStartMigration}\r\n                  disabled={isLoading}\r\n                  className=\"px-6 py-2 bg-foreground text-background text-sm font-medium rounded-lg hover:bg-foreground/90 transition-colors disabled:opacity-50 flex items-center gap-2\"\r\n                >\r\n                  {isLoading ? (\r\n                    <>\r\n                      <div className=\"w-4 h-4 border-2 border-background/30 border-t-background rounded-full animate-spin\" />\r\n                      Migrating...\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <Icon icon=\"lucide:cloud-upload\" className=\"w-4 h-4\" />\r\n                      Start Migration\r\n                    </>\r\n                  )}\r\n                </button>\r\n              </>\r\n            )}\r\n\r\n            {migrationCompleted && (\r\n              <button\r\n                onClick={handleComplete}\r\n                className=\"w-full px-6 py-2 bg-foreground text-background text-sm font-medium rounded-lg hover:bg-foreground/90 transition-colors flex items-center justify-center gap-2\"\r\n              >\r\n                <Icon icon=\"lucide:arrow-right\" className=\"w-4 h-4\" />\r\n                Continue to App\r\n              </button>\r\n            )}\r\n\r\n            {migrationError && (\r\n              <div className=\"flex gap-2 w-full\">\r\n                <button\r\n                  onClick={onClose}\r\n                  className=\"flex-1 px-4 py-2 text-sm font-medium text-foreground/60 hover:text-foreground transition-colors\"\r\n                >\r\n                  Close\r\n                </button>\r\n                <button\r\n                  onClick={() => {\r\n                    setMigrationError(null)\r\n                    setMigrationProgress(null)\r\n                  }}\r\n                  className=\"flex-1 px-6 py-2 bg-foreground text-background text-sm font-medium rounded-lg hover:bg-foreground/90 transition-colors flex items-center justify-center gap-2\"\r\n                >\r\n                  <Icon icon=\"lucide:refresh-cw\" className=\"w-4 h-4\" />\r\n                  Try Again\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </ModalFooter>\r\n      </ModalContent>\r\n    </Modal>\r\n  )\r\n}\r\n","import React, { useEffect, useState } from 'react'\nimport { useHistory, useLocation } from 'react-router-dom'\nimport { supabase } from '../lib/supabase'\nimport { Spinner, Button } from '@heroui/react'\nimport { motion } from 'framer-motion'\nimport { Icon } from '@iconify/react'\n\nexport const AuthCallback: React.FC = () => {\n  const history = useHistory()\n  const location = useLocation()\n  const [status, setStatus] = useState<'loading' | 'success' | 'error'>('loading')\n  const [error, setError] = useState<string>('')\n\n  useEffect(() => {\n    const handleAuthCallback = async () => {\n      try {\n        // Check URL parameters for errors first\n        const searchParams = new URLSearchParams(location.search)\n        const hashParams = new URLSearchParams(location.hash.substring(1))\n\n        const error = searchParams.get('error') || hashParams.get('error')\n        const errorDescription = searchParams.get('error_description') || hashParams.get('error_description')\n        const accessToken = hashParams.get('access_token')\n        const refreshToken = hashParams.get('refresh_token')\n        const expiresIn = hashParams.get('expires_in')\n        const tokenType = hashParams.get('token_type')\n\n        if (error) {\n          setError(errorDescription || error)\n          setStatus('error')\n          return\n        }\n\n        // Handle implicit flow with access token in hash\n        if (accessToken) {\n          try {\n            // Set the session manually using the tokens from the URL\n            const { data, error: setSessionError } = await supabase.auth.setSession({\n              access_token: accessToken,\n              refresh_token: refreshToken || ''\n            })\n\n            if (setSessionError) {\n              // Don't return here, fall through to session check\n            } else if (data.session) {\n              setStatus('success')\n              setTimeout(() => {\n                history.replace('/')\n              }, 1500)\n              return\n            }\n          } catch (setSessionError) {\n            // Continue to session check\n          }\n        }\n\n        // Handle any URL that might contain session info\n        // This covers cases where Supabase automatically processes the callback\n        if (window.location.hash || window.location.search) {\n          // Give Supabase more time to automatically process the callback\n          await new Promise(resolve => setTimeout(resolve, 3000))\n        }\n\n        // Fallback: Check for existing session with retries\n        let session = null\n        let sessionError = null\n\n        // Try multiple times to get the session\n        for (let attempt = 1; attempt <= 5; attempt++) {\n          const result = await supabase.auth.getSession()\n          sessionError = result.error\n          session = result.data.session\n\n          if (session) {\n            setStatus('success')\n            setTimeout(() => {\n              history.replace('/')\n            }, 1500)\n            return\n          }\n\n          if (sessionError) {\n            console.error('Session error on attempt', attempt, ':', sessionError)\n          }\n\n          // Wait before next attempt\n          if (attempt < 5) {\n            await new Promise(resolve => setTimeout(resolve, 1000))\n          }\n        }\n\n        // If we get here, no session was found after all attempts\n        if (sessionError) {\n          setError(sessionError.message)\n        } else {\n          setError('Authentication failed - no session established')\n        }\n        setStatus('error')\n      } catch (error) {\n        setError('An unexpected error occurred during authentication')\n        setStatus('error')\n      }\n    }\n\n    handleAuthCallback()\n  }, [location.search, location.hash, history])\n\n  if (status === 'loading') {\n    return (\n      <div className=\"min-h-screen bg-background font-sans antialiased\">\n        <div className=\"absolute inset-0 bg-gradient-to-br from-background via-background to-background\">\n          <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(17,24,28,0.03),transparent_70%)] dark:bg-[radial-gradient(circle_at_50%_50%,rgba(236,237,238,0.02),transparent_70%)]\" />\n        </div>\n\n        <div className=\"relative z-10 min-h-screen flex items-center justify-center px-6\">\n          <motion.div\n            initial={{ opacity: 0, scale: 0.9 }}\n            animate={{ opacity: 1, scale: 1 }}\n            transition={{ duration: 0.3, ease: \"easeOut\" }}\n            className=\"flex flex-col items-center justify-center text-center max-w-sm mx-auto\"\n          >\n            <motion.div\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.4, delay: 0.1 }}\n              className=\"mb-8\"\n            >\n              <div className=\"flex items-center justify-center gap-3 mb-4\">\n                <motion.div\n                  animate={{\n                    rotate: 360,\n                    scale: [1, 1.05, 1]\n                  }}\n                  transition={{\n                    rotate: { duration: 12, repeat: Infinity, ease: \"linear\" },\n                    scale: { duration: 2, repeat: Infinity, ease: \"easeInOut\" }\n                  }}\n                >\n                  <svg\n                    viewBox=\"0 0 24 24\"\n                    className=\"h-8 w-8 text-foreground\"\n                    fill=\"none\"\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                  >\n                    <motion.circle\n                      cx=\"12\"\n                      cy=\"12\"\n                      r=\"10\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"1.5\"\n                      fill=\"none\"\n                      initial={{ pathLength: 0, opacity: 0 }}\n                      animate={{ pathLength: 1, opacity: 1 }}\n                      transition={{ duration: 1.5, ease: \"easeInOut\" }}\n                    />\n                    <motion.path\n                      d=\"M12 6L16 10L12 18L8 10L12 6Z\"\n                      fill=\"currentColor\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"0.5\"\n                      strokeLinejoin=\"round\"\n                      initial={{ scale: 0, opacity: 0 }}\n                      animate={{ scale: 1, opacity: 1 }}\n                      transition={{ duration: 0.8, delay: 0.5, ease: \"backOut\" }}\n                    />\n                    <motion.path\n                      d=\"M8 10L12 14L16 10\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"0.5\"\n                      fill=\"none\"\n                      opacity=\"0.7\"\n                      initial={{ pathLength: 0, opacity: 0 }}\n                      animate={{ pathLength: 1, opacity: 0.7 }}\n                      transition={{ duration: 1, delay: 1, ease: \"easeInOut\" }}\n                    />\n                  </svg>\n                </motion.div>\n                <span className=\"text-2xl font-bold tracking-tight text-foreground font-sans\">NEXUS</span>\n              </div>\n            </motion.div>\n\n            <motion.div\n              initial={{ opacity: 0, scale: 0.8 }}\n              animate={{ opacity: 1, scale: 1 }}\n              transition={{ duration: 0.4, delay: 0.2 }}\n              className=\"mb-6\"\n            >\n              <div className=\"relative\">\n                <motion.div\n                  animate={{ rotate: 360 }}\n                  transition={{ duration: 1.5, repeat: Infinity, ease: \"linear\" }}\n                  className=\"w-12 h-12 border-2 border-foreground/20 border-t-foreground rounded-full\"\n                />\n                <motion.div\n                  animate={{\n                    scale: [1, 1.2, 1],\n                    opacity: [0.3, 0.8, 0.3]\n                  }}\n                  transition={{\n                    duration: 2,\n                    repeat: Infinity,\n                    ease: \"easeInOut\"\n                  }}\n                  className=\"absolute inset-0 w-12 h-12 border border-foreground/10 rounded-full\"\n                />\n              </div>\n            </motion.div>\n\n            <motion.div\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.4, delay: 0.3 }}\n            >\n              <p className=\"text-sm font-medium text-foreground/80 mb-2 font-sans\">Completing authentication...</p>\n              <div className=\"flex items-center justify-center gap-1\">\n                {[0, 1, 2].map((i) => (\n                  <motion.div\n                    key={i}\n                    className=\"w-1 h-1 bg-foreground rounded-full\"\n                    animate={{\n                      scale: [1, 1.4, 1],\n                      opacity: [0.4, 1, 0.4],\n                      y: [0, -2, 0]\n                    }}\n                    transition={{\n                      duration: 1.2,\n                      repeat: Infinity,\n                      delay: i * 0.15,\n                      ease: \"easeInOut\"\n                    }}\n                  />\n                ))}\n              </div>\n            </motion.div>\n          </motion.div>\n        </div>\n      </div>\n    )\n  }\n\n  if (status === 'success') {\n    return (\n      <div className=\"min-h-screen bg-background font-sans antialiased\">\n        <div className=\"absolute inset-0 bg-gradient-to-br from-background via-background to-background/95\">\n          <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(34,197,94,0.08),transparent_50%)] dark:bg-[radial-gradient(circle_at_50%_50%,rgba(34,197,94,0.05),transparent_50%)]\" />\n        </div>\n\n        <div className=\"relative z-10 min-h-screen flex items-center justify-center\">\n          <motion.div\n            initial={{ opacity: 0, scale: 0.9 }}\n            animate={{ opacity: 1, scale: 1 }}\n            transition={{ duration: 0.3, ease: \"easeOut\" }}\n            className=\"text-center\"\n          >\n            <motion.div\n              initial={{ opacity: 0, scale: 0.5 }}\n              animate={{ opacity: 1, scale: 1 }}\n              transition={{ duration: 0.5, delay: 0.1 }}\n              className=\"mb-6\"\n            >\n              <div className=\"w-20 h-20 bg-success/10 dark:bg-success/5 rounded-full flex items-center justify-center mx-auto mb-4 backdrop-blur-sm border border-success/20\">\n                <motion.div\n                  initial={{ scale: 0 }}\n                  animate={{ scale: 1 }}\n                  transition={{ duration: 0.4, delay: 0.3, type: \"spring\", stiffness: 200 }}\n                >\n                  <Icon icon=\"lucide:check-circle\" className=\"w-10 h-10 text-success\" />\n                </motion.div>\n              </div>\n            </motion.div>\n\n            <motion.div\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.4, delay: 0.4 }}\n            >\n              <h1 className=\"text-2xl font-bold text-foreground mb-2 font-sans\">\n                Authentication Successful!\n              </h1>\n              <p className=\"text-foreground/70 mb-4 font-sans\">\n                Redirecting you to the application...\n              </p>\n\n              <div className=\"flex items-center justify-center gap-1\">\n                {[0, 1, 2].map((i) => (\n                  <motion.div\n                    key={i}\n                    className=\"w-1 h-1 bg-success rounded-full\"\n                    animate={{ scale: [1, 1.2, 1], opacity: [0.5, 1, 0.5] }}\n                    transition={{ duration: 1, repeat: Infinity, delay: i * 0.2 }}\n                  />\n                ))}\n              </div>\n            </motion.div>\n          </motion.div>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background font-sans antialiased\">\n      <div className=\"absolute inset-0 bg-gradient-to-br from-background via-background to-background/95\">\n        <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(239,68,68,0.1),transparent_50%)] dark:bg-[radial-gradient(circle_at_50%_50%,rgba(239,68,68,0.05),transparent_50%)]\" />\n      </div>\n\n      <div className=\"relative z-10 min-h-screen flex items-center justify-center p-6\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.9 }}\n          animate={{ opacity: 1, scale: 1 }}\n          transition={{ duration: 0.3, ease: \"easeOut\" }}\n          className=\"text-center max-w-md mx-auto\"\n        >\n          <motion.div\n            initial={{ opacity: 0, scale: 0.5 }}\n            animate={{ opacity: 1, scale: 1 }}\n            transition={{ duration: 0.5, delay: 0.1 }}\n            className=\"mb-6\"\n          >\n            <div className=\"w-20 h-20 bg-danger/10 dark:bg-danger/5 rounded-full flex items-center justify-center mx-auto mb-4 backdrop-blur-sm border border-danger/20\">\n              <motion.div\n                initial={{ scale: 0 }}\n                animate={{ scale: 1 }}\n                transition={{ duration: 0.4, delay: 0.3, type: \"spring\", stiffness: 200 }}\n              >\n                <Icon icon=\"lucide:alert-circle\" className=\"w-10 h-10 text-danger\" />\n              </motion.div>\n            </div>\n          </motion.div>\n\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.4, delay: 0.4 }}\n          >\n            <h1 className=\"text-2xl font-bold text-foreground mb-2 font-sans\">\n              Authentication Failed\n            </h1>\n            <p className=\"text-foreground/70 mb-6 font-sans\">\n              {error || 'An error occurred during authentication'}\n            </p>\n\n            <Button\n              color=\"primary\"\n              variant=\"solid\"\n              size=\"lg\"\n              onPress={() => history.replace('/')}\n              startContent={<Icon icon=\"lucide:home\" className=\"w-4 h-4\" />}\n              className=\"bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary/80 transition-all duration-300\"\n            >\n              Return to Home\n            </Button>\n          </motion.div>\n        </motion.div>\n      </div>\n    </div>\n  )\n}\n","import React, { useRef, useState, useEffect, useMemo, useCallback, Suspense } from \"react\";\r\nimport { Icon } from \"@iconify/react\";\r\nimport { Route, Switch, Link, useLocation } from \"react-router-dom\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { Button } from \"@heroui/react\";\r\nimport { ThemeSwitcher } from \"./components/theme-switcher\";\r\nimport { useTheme } from \"@heroui/use-theme\";\r\nimport { TruePortfolioProvider } from \"./utils/TruePortfolioContext\";\r\nimport { TruePortfolioSetupManager } from \"./components/TruePortfolioSetupManager\";\r\nimport { ProfileSettingsModal } from \"./components/ProfileSettingsModal\";\r\nimport { GlobalFilterProvider, useGlobalFilter } from \"./context/GlobalFilterContext\";\r\nimport { AccountingMethodProvider } from \"./context/AccountingMethodContext\";\r\nimport { GlobalFilterBar } from \"./components/GlobalFilterBar\";\r\nimport { TradeTrackerLogo } from './components/icons/TradeTrackerLogo';\r\nimport { AnimatedBrandName } from './components/AnimatedBrandName';\r\nimport ErrorBoundary from \"./components/ErrorBoundary\";\r\nimport { Analytics } from '@vercel/analytics/react';\r\nimport { Loader } from \"./components/Loader\";\r\n\r\n// Lazy load heavy components for better performance with preloading\r\nconst TradeJournal = React.lazy(() => import(\"./components/trade-journal\").then(module => ({ default: module.TradeJournal })));\r\nconst TradeAnalytics = React.lazy(() => import(\"./components/trade-analytics\").then(module => ({ default: module.TradeAnalytics })));\r\nconst TaxAnalytics = React.lazy(() => import(\"./components/tax-analytics\").then(module => ({ default: module.TaxAnalytics })));\r\nconst MonthlyPerformanceTable = React.lazy(() => import(\"./pages/monthly-performance\").then(module => ({ default: module.MonthlyPerformanceTable })));\r\nconst DeepAnalyticsPage = React.lazy(() => import(\"./pages/DeepAnalyticsPage\"));\r\n\r\n// Preload components for faster navigation\r\nconst preloadComponents = () => {\r\n  // Preload most commonly accessed components\r\n  import(\"./components/trade-analytics\");\r\n  import(\"./components/tax-analytics\");\r\n  import(\"./pages/monthly-performance\");\r\n};\r\n\r\n// Authentication and Migration\r\nimport { AuthProvider, useAuth, useUser } from \"./context/AuthContext\";\r\nimport { AuthGuard } from \"./components/auth/AuthGuard\";\r\nimport { MigrationModal } from \"./components/migration/MigrationModal\";\r\nimport { MigrationService } from \"./services/migrationService\";\r\nimport { SupabaseService } from \"./services/supabaseService\";\r\nimport { DatabaseService } from \"./db/database\";\r\nimport { AuthDebug } from \"./components/debug/AuthDebug\";\r\nimport { AuthModal } from \"./components/auth/AuthModal\";\r\nimport { AuthCallback } from \"./pages/AuthCallback\";\r\n// Migrated from IndexedDB to Supabase with authentication\r\n\r\n// Main App Content Component (authenticated users only)\r\nfunction AppContent() {\r\n  const location = useLocation();\r\n  const { theme } = useTheme();\r\n  const { user, signOut } = useAuth();\r\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = React.useState(false);\r\n  const [isProfileOpen, setIsProfileOpen] = React.useState(false);\r\n  const [userName, setUserName] = React.useState('');\r\n  const [loadingPrefs, setLoadingPrefs] = React.useState(true);\r\n  const [isFullWidthEnabled, setIsFullWidthEnabled] = React.useState(false);\r\n  const [showMigrationModal, setShowMigrationModal] = React.useState(false);\r\n  const [showAuthModal, setShowAuthModal] = React.useState(false);\r\n  const [migrationChecked, setMigrationChecked] = React.useState(false);\r\n\r\n  const mainContentRef = useRef<HTMLElement>(null);\r\n  const [isMainContentFullscreen, setIsMainContentFullscreen] = useState(false);\r\n\r\n  const getDefaultUserName = () => {\r\n    // Use user's name from auth or fallback\r\n    return user?.user_metadata?.full_name || user?.email?.split('@')[0] || 'User';\r\n  };\r\n\r\n  // Check for migration on first load\r\n  useEffect(() => {\r\n    const checkForMigration = async () => {\r\n      if (!migrationChecked) {\r\n        // Check if user has completed migration or chosen \"never show again\"\r\n        const migrationCompleted = localStorage.getItem(`migration_completed_${user?.id}`) === 'true';\r\n        const neverShowAgain = localStorage.getItem(`migration_never_show_${user?.id}`) === 'true';\r\n\r\n        if (!migrationCompleted && !neverShowAgain) {\r\n          const hasDataToMigrate = await MigrationService.hasDataToMigrate();\r\n          if (hasDataToMigrate) {\r\n            setShowMigrationModal(true);\r\n          }\r\n        }\r\n        setMigrationChecked(true);\r\n      }\r\n    };\r\n\r\n    if (user) {\r\n      checkForMigration();\r\n    }\r\n  }, [user, migrationChecked]);\r\n\r\n  // Memoize Supabase helper functions to prevent re-creation on every render\r\n  const fetchUserPreferences = useCallback(async () => {\r\n    try {\r\n      const prefs = await SupabaseService.getUserPreferences();\r\n      return prefs;\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  }, []);\r\n\r\n  const saveUserPreferences = useCallback(async (prefs: Partial<{ is_mobile_menu_open: boolean; is_profile_open: boolean; user_name: string; is_full_width_enabled: boolean }>) => {\r\n    try {\r\n      const existing = await fetchUserPreferences() || {};\r\n      const updated = { ...existing, ...prefs };\r\n      await SupabaseService.saveUserPreferences(updated);\r\n    } catch (error) {\r\n      }\r\n  }, [fetchUserPreferences]);\r\n\r\n  React.useEffect(() => {\r\n    // Load preferences from Supabase on mount\r\n    const loadPreferences = async () => {\r\n      try {\r\n        const prefs = await fetchUserPreferences();\r\n        if (prefs) {\r\n          setIsMobileMenuOpen(!!prefs.is_mobile_menu_open);\r\n          setIsProfileOpen(!!prefs.is_profile_open);\r\n          setUserName(prefs.user_name || getDefaultUserName());\r\n          setIsFullWidthEnabled(!!prefs.is_full_width_enabled);\r\n        } else {\r\n          // Set default values for new users\r\n          setUserName(getDefaultUserName());\r\n        }\r\n      } catch (error) {\r\n        // Set default values on error\r\n        setUserName(getDefaultUserName());\r\n      } finally {\r\n        setLoadingPrefs(false);\r\n      }\r\n    };\r\n\r\n    if (user) {\r\n      loadPreferences();\r\n    }\r\n  }, [fetchUserPreferences, user]);\r\n\r\n  React.useEffect(() => {\r\n    if (!loadingPrefs) {\r\n      saveUserPreferences({ is_mobile_menu_open: isMobileMenuOpen });\r\n    }\r\n  }, [isMobileMenuOpen, loadingPrefs, saveUserPreferences]);\r\n\r\n  React.useEffect(() => {\r\n    if (!loadingPrefs) {\r\n      saveUserPreferences({ is_profile_open: isProfileOpen });\r\n    }\r\n  }, [isProfileOpen, loadingPrefs, saveUserPreferences]);\r\n\r\n  React.useEffect(() => {\r\n    if (!loadingPrefs) {\r\n      saveUserPreferences({ user_name: userName });\r\n    }\r\n  }, [userName, loadingPrefs, saveUserPreferences]);\r\n\r\n  React.useEffect(() => {\r\n    if (!loadingPrefs) {\r\n      saveUserPreferences({ is_full_width_enabled: isFullWidthEnabled });\r\n    }\r\n  }, [isFullWidthEnabled, loadingPrefs, saveUserPreferences]);\r\n\r\n  const handleToggleMainContentFullscreen = () => {\r\n    if (!document.fullscreenElement) {\r\n      mainContentRef.current?.requestFullscreen();\r\n    } else {\r\n      document.exitFullscreen();\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleFullscreenChange = () => {\r\n      setIsMainContentFullscreen(document.fullscreenElement === mainContentRef.current);\r\n    };\r\n\r\n    document.addEventListener('fullscreenchange', handleFullscreenChange);\r\n    return () => document.removeEventListener('fullscreenchange', handleFullscreenChange);\r\n  }, []);\r\n\r\n  // PERFORMANCE OPTIMIZATION: Preload components after initial render\r\n  React.useEffect(() => {\r\n    // Preload components after a short delay to not block initial render\r\n    const timer = setTimeout(() => {\r\n      preloadComponents();\r\n    }, 2000);\r\n\r\n    return () => clearTimeout(timer);\r\n  }, []);\r\n\r\n  // Memoize navigation items to prevent unnecessary re-renders\r\n  const navItems = useMemo(() => [\r\n    { path: \"/\", name: \"Journal\", icon: \"lucide:book-open\" },\r\n    { path: \"/analytics\", name: \"Analytics\", icon: \"lucide:bar-chart-2\" },\r\n    { path: \"/tax-analytics\", name: \"Tax Analytics\", icon: \"lucide:calculator\" },\r\n    { path: \"/monthly-performance\", name: \"Monthly Performance\", icon: \"lucide:calendar-check\" },\r\n    { path: \"/deep-analytics\", name: \"Deep Analytics\", icon: \"lucide:pie-chart\" }\r\n  ], []);\r\n\r\n  return (\r\n    <TruePortfolioProvider>\r\n      <AccountingMethodProvider>\r\n        <GlobalFilterProvider>\r\n          <div className=\"min-h-screen bg-background font-sans antialiased\">\r\n          {/* Navigation */}\r\n          <header className=\"sticky top-0 z-40 w-full border-b border-gray-200 dark:border-gray-700 bg-background/80 backdrop-blur-xl backdrop-saturate-150\">\r\n            <nav className=\"px-4 sm:px-6\">\r\n              <div className=\"flex h-16 items-center justify-between\">\r\n                {/* Logo and Mobile Menu Button */}\r\n                <div className=\"flex items-center gap-4\">\r\n                  <Link\r\n                    to=\"/\"\r\n                    className=\"flex items-center gap-2 font-semibold tracking-tight text-foreground hover:opacity-90 transition-opacity\"\r\n                  >\r\n                    <svg\r\n                      viewBox=\"0 0 24 24\"\r\n                      className=\"h-5 w-5 text-foreground\"\r\n                      fill=\"none\"\r\n                      xmlns=\"http://www.w3.org/2000/svg\"\r\n                    >\r\n                      {/* Outer circle */}\r\n                      <circle\r\n                        cx=\"12\"\r\n                        cy=\"12\"\r\n                        r=\"10\"\r\n                        stroke=\"currentColor\"\r\n                        strokeWidth=\"1.5\"\r\n                        fill=\"none\"\r\n                      />\r\n                      {/* Diamond/gem shape */}\r\n                      <path\r\n                        d=\"M12 6L16 10L12 18L8 10L12 6Z\"\r\n                        fill=\"currentColor\"\r\n                        stroke=\"currentColor\"\r\n                        strokeWidth=\"0.5\"\r\n                        strokeLinejoin=\"round\"\r\n                      />\r\n                      {/* Inner diamond lines */}\r\n                      <path\r\n                        d=\"M8 10L12 14L16 10\"\r\n                        stroke=\"currentColor\"\r\n                        strokeWidth=\"0.5\"\r\n                        fill=\"none\"\r\n                        opacity=\"0.7\"\r\n                      />\r\n                    </svg>\r\n                    <AnimatedBrandName className=\"text-foreground\" />\r\n                  </Link>\r\n                  <Button\r\n                    isIconOnly\r\n                    variant=\"light\"\r\n                    size=\"sm\"\r\n                    onPress={() => setIsMobileMenuOpen(!isMobileMenuOpen)}\r\n                    className=\"sm:hidden\"\r\n                  >\r\n                    <Icon icon={isMobileMenuOpen ? \"lucide:x\" : \"lucide:menu\"} className=\"h-5 w-5\" />\r\n                  </Button>\r\n                </div>\r\n\r\n                {/* Desktop Navigation */}\r\n                <div className=\"hidden sm:flex sm:items-center sm:gap-8\">\r\n                  {navItems.map((item) => {\r\n                    const isActive = location.pathname === item.path;\r\n                    return (\r\n                      <Link\r\n                        key={item.path}\r\n                        to={item.path}\r\n                        className={`flex items-center gap-2.5 px-3 py-2 text-sm font-medium transition-colors rounded-lg\r\n                          ${isActive\r\n                            ? 'text-primary-600 dark:text-primary-400 bg-primary-100 dark:bg-primary-900/30 backdrop-blur-md shadow-md'\r\n                            : 'text-gray-700 dark:text-gray-300 hover:text-foreground hover:bg-gray-100 dark:hover:bg-gray-800/50 backdrop-blur-sm transition-all duration-300'\r\n                          }`}\r\n                      >\r\n                        <Icon icon={item.icon} className=\"h-4 w-4\" />\r\n                        {item.name}\r\n                      </Link>\r\n                    );\r\n                  })}\r\n                </div>\r\n\r\n                {/* Right Side Actions */}\r\n                <div className=\"flex items-center gap-3\">\r\n                  <ThemeSwitcher />\r\n                  {user ? (\r\n                    <>\r\n                      <Button\r\n                        variant=\"flat\"\r\n                        size=\"sm\"\r\n                        onPress={() => setIsProfileOpen(true)}\r\n                        className=\"hidden sm:flex items-center gap-1 px-3 py-1.5 rounded-full border border-white/20 bg-white/10 backdrop-blur-md hover:bg-white/20 transition-all duration-300 min-h-0 min-w-0 shadow-sm\"\r\n                        startContent={<Icon icon=\"lucide:user\" className=\"h-4 w-4\" />}\r\n                      >\r\n                        <span className=\"font-medium text-sm leading-none\">{userName}</span>\r\n                      </Button>\r\n                      <Button\r\n                        isIconOnly\r\n                        variant=\"light\"\r\n                        size=\"sm\"\r\n                        onPress={signOut}\r\n                        className=\"hidden sm:flex hover:bg-red-100 dark:hover:bg-red-900/20 transition-all duration-300\"\r\n                      >\r\n                        <Icon icon=\"lucide:log-out\" className=\"h-4 w-4\" />\r\n                      </Button>\r\n                    </>\r\n                  ) : (\r\n                    <Button\r\n                      variant=\"flat\"\r\n                      size=\"sm\"\r\n                      onPress={() => setShowAuthModal(true)}\r\n                      className=\"hidden sm:flex items-center gap-1 px-3 py-1.5 rounded-full border border-white/20 bg-white/10 backdrop-blur-md hover:bg-white/20 transition-all duration-300 min-h-0 min-w-0 shadow-sm\"\r\n                      startContent={<Icon icon=\"lucide:log-in\" className=\"h-4 w-4\" />}\r\n                    >\r\n                      <span className=\"font-medium text-sm leading-none\">Sign In</span>\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </nav>\r\n\r\n            {/* Mobile Navigation */}\r\n            <AnimatePresence>\r\n              {isMobileMenuOpen && (\r\n                <motion.div\r\n                  initial={{ height: 0, opacity: 0 }}\r\n                  animate={{ height: \"auto\", opacity: 1 }}\r\n                  exit={{ height: 0, opacity: 0 }}\r\n                  transition={{ duration: 0.2 }}\r\n                  className=\"sm:hidden border-t border-divider overflow-hidden\"\r\n                >\r\n                  <div className=\"space-y-1 px-4 py-3 bg-background/30 backdrop-blur-xl\">\r\n                    {navItems.map((item) => {\r\n                      const isActive = location.pathname === item.path;\r\n                      return (\r\n                        <Link\r\n                          key={item.path}\r\n                          to={item.path}\r\n                          className={`flex items-center gap-2.5 px-3 py-2 text-sm font-medium transition-colors rounded-lg\r\n                          ${isActive\r\n                            ? 'text-primary-600 dark:text-primary-400 bg-primary-100 dark:bg-primary-900/30 backdrop-blur-md shadow-md'\r\n                            : 'text-gray-700 dark:text-gray-300 hover:text-foreground hover:bg-gray-100 dark:hover:bg-gray-800/50 backdrop-blur-sm transition-all duration-300'\r\n                          }`}\r\n                        >\r\n                          <Icon icon={item.icon} className=\"h-4 w-4\" />\r\n                          {item.name}\r\n                        </Link>\r\n                      );\r\n                    })}\r\n                    {user ? (\r\n                      <>\r\n                        {/* Profile Button for Mobile */}\r\n                        <Button\r\n                          variant=\"light\"\r\n                          size=\"sm\"\r\n                          onPress={() => {\r\n                            setIsProfileOpen(true);\r\n                            setIsMobileMenuOpen(false); // Close mobile menu when opening profile\r\n                          }}\r\n                          className=\"w-full flex items-center gap-2.5 px-3 py-2 text-sm font-medium transition-colors rounded-lg text-gray-700 dark:text-gray-300 hover:text-foreground hover:bg-gray-100 dark:hover:bg-gray-800/50 backdrop-blur-sm transition-all duration-300\"\r\n                          startContent={<Icon icon=\"lucide:user\" className=\"h-4 w-4\" />}\r\n                        >\r\n                          <span>{userName || 'Profile'}</span>\r\n                        </Button>\r\n                        {/* Sign Out Button for Mobile */}\r\n                        <Button\r\n                          isIconOnly\r\n                          variant=\"light\"\r\n                          size=\"sm\"\r\n                          onPress={() => {\r\n                            signOut();\r\n                            setIsMobileMenuOpen(false);\r\n                          }}\r\n                          className=\"flex items-center justify-center text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/20 transition-all duration-300\"\r\n                        >\r\n                          <Icon icon=\"lucide:log-out\" className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      </>\r\n                    ) : (\r\n                      <Button\r\n                        variant=\"light\"\r\n                        size=\"sm\"\r\n                        onPress={() => {\r\n                          setShowAuthModal(true);\r\n                          setIsMobileMenuOpen(false);\r\n                        }}\r\n                        className=\"w-full flex items-center gap-2.5 px-3 py-2 text-sm font-medium transition-colors rounded-lg text-gray-700 dark:text-gray-300 hover:text-foreground hover:bg-gray-100 dark:hover:bg-gray-800/50 backdrop-blur-sm transition-all duration-300\"\r\n                        startContent={<Icon icon=\"lucide:log-in\" className=\"h-4 w-4\" />}\r\n                      >\r\n                        <span>Sign In</span>\r\n                      </Button>\r\n                    )}\r\n                  </div>\r\n                </motion.div>\r\n              )}\r\n            </AnimatePresence>\r\n          </header>\r\n\r\n          {/* Global Filter Bar */}\r\n          <GlobalFilterBar />\r\n\r\n          {/* Main Content */}\r\n          <main ref={mainContentRef} className=\"flex-1 overflow-auto p-4 sm:p-6 lg:p-8\">\r\n            <ErrorBoundary>\r\n              <div className={isFullWidthEnabled ? \"py-6\" : \"max-w-7xl mx-auto py-6\"}>\r\n                <Suspense fallback={<Loader />}>\r\n                  <Switch>\r\n                    <Route path=\"/auth/callback\">\r\n                      <AuthCallback />\r\n                    </Route>\r\n                    <Route path=\"/analytics\">\r\n                      <TradeAnalytics />\r\n                    </Route>\r\n                    <Route exact path=\"/\" render={(props) => (\r\n                      <motion.div\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        transition={{ duration: 0.2 }}\r\n                      >\r\n                        <TradeJournal {...props} toggleFullscreen={handleToggleMainContentFullscreen} isFullscreen={isMainContentFullscreen} />\r\n                      </motion.div>\r\n                    )} />\r\n                    <Route path=\"/tax-analytics\" component={TaxAnalytics} />\r\n                    <Route path=\"/monthly-performance\" component={MonthlyPerformanceTable} />\r\n                    <Route path=\"/deep-analytics\" component={DeepAnalyticsPage} />\r\n                  </Switch>\r\n                </Suspense>\r\n              </div>\r\n            </ErrorBoundary>\r\n          </main>\r\n\r\n          <ProfileSettingsModal\r\n            isOpen={isProfileOpen}\r\n            onOpenChange={setIsProfileOpen}\r\n            userName={userName}\r\n            setUserName={setUserName}\r\n            isFullWidthEnabled={isFullWidthEnabled}\r\n            setIsFullWidthEnabled={setIsFullWidthEnabled}\r\n          />\r\n\r\n          {/* Only show TruePortfolio setup for authenticated users */}\r\n          {user && (\r\n            <TruePortfolioSetupManager\r\n              userName={userName}\r\n              setUserName={setUserName}\r\n            />\r\n          )}\r\n\r\n          {/* Migration Modal - Only for authenticated users */}\r\n          {user && (\r\n            <MigrationModal\r\n              isOpen={showMigrationModal}\r\n              onClose={() => {\r\n                // Just close the modal - don't mark as dismissed\r\n                // User will see it again next time if they still have data\r\n                setShowMigrationModal(false);\r\n              }}\r\n              onMigrationComplete={() => {\r\n                // Mark migration as completed for this user\r\n                if (user?.id) {\r\n                  localStorage.setItem(`migration_completed_${user.id}`, 'true');\r\n                }\r\n                setShowMigrationModal(false);\r\n                // Optionally refresh the page or reload data\r\n                window.location.reload();\r\n              }}\r\n              onNeverShowAgain={() => {\r\n                // Mark as \"never show again\" for this user\r\n                if (user?.id) {\r\n                  localStorage.setItem(`migration_never_show_${user.id}`, 'true');\r\n                }\r\n                setShowMigrationModal(false);\r\n              }}\r\n            />\r\n          )}\r\n\r\n          <Analytics />\r\n          {/* <AuthDebug /> */}\r\n\r\n          {/* Auth Modal for Guest Users */}\r\n          {showAuthModal && (\r\n            <AuthModal\r\n              isOpen={showAuthModal}\r\n              onClose={() => setShowAuthModal(false)}\r\n            />\r\n          )}\r\n          </div>\r\n        </GlobalFilterProvider>\r\n      </AccountingMethodProvider>\r\n    </TruePortfolioProvider>\r\n  );\r\n}\r\n\r\n// Main App Component with Authentication\r\nexport default function App() {\r\n  return (\r\n    <AuthProvider>\r\n      <AuthGuard>\r\n        <AppContent />\r\n      </AuthGuard>\r\n    </AuthProvider>\r\n  );\r\n}","import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport { HeroUIProvider, ToastProvider } from \"@heroui/react\"\nimport { BrowserRouter } from 'react-router-dom'\nimport App from './App.tsx';\nimport './index.css';\n\nReactDOM.createRoot(document.getElementById('root')!).render(\n  <React.StrictMode>\n    <BrowserRouter>\n      <HeroUIProvider>\n        <ToastProvider />\n        <App />\n      </HeroUIProvider>\n    </BrowserRouter>\n  </React.StrictMode>,\n);"],"file":"assets/index-CCg2rRgv.js"}